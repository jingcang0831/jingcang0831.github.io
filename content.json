{"meta":{"title":"zy-blog","subtitle":"æ‘†çƒ‚ä¸­....","description":"å¼€å‘éšç¬”","author":"zy","url":"http://example.com","root":"/"},"pages":[{"title":"ğŸ’¡ åŠªåŠ›çš„æ„ä¹‰å°±æ˜¯å¥½è¿æ¥ä¸´çš„æ—¶å€™æˆ‘è§‰å¾—æˆ‘å€¼å¾—ğŸ’¡","date":"2023-06-15T08:14:58.000Z","updated":"2023-06-30T07:48:48.690Z","comments":true,"path":"about/index.html","permalink":"http://example.com/about/index.html","excerpt":"","text":"spring-securityå®ç°ç®€å•åå°ç®¡ç†ç³»ç»Ÿï¼ˆåç«¯ï¼‰ vue3+js å®ç°ç®€å•å•†åŸç³»ç»Ÿï¼ˆå‰ç«¯ï¼‰ spring-iocç®€å•å®ç°ï¼ˆæºç ï¼‰"},{"title":"åˆ†ç±»","date":"2023-06-16T02:24:33.000Z","updated":"2023-06-16T06:30:01.543Z","comments":true,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""},{"title":"ğŸ’¡ åŠªåŠ›çš„æ„ä¹‰å°±æ˜¯å¥½è¿æ¥ä¸´çš„æ—¶å€™æˆ‘è§‰å¾—æˆ‘å€¼å¾—ğŸ’¡","date":"2023-06-16T02:30:13.000Z","updated":"2023-06-30T07:49:07.371Z","comments":true,"path":"index.html","permalink":"http://example.com/index.html","excerpt":"","text":"spring-securityå®ç°ç®€å•åå°ç®¡ç†ç³»ç»Ÿï¼ˆåç«¯ï¼‰ vue3+js å®ç°ç®€å•å•†åŸç³»ç»Ÿï¼ˆå‰ç«¯ï¼‰ spring-iocç®€å•å®ç°ï¼ˆæºç ï¼‰"},{"title":"tags","date":"2023-06-16T02:30:13.000Z","updated":"2023-06-16T02:31:36.684Z","comments":true,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"elkï¼ˆåå››ï¼‰-å®‰è£…æ–‡æ¡£","slug":"elk/elkï¼ˆåå››ï¼‰-å®‰è£…æ–‡æ¡£","date":"2023-06-30T07:43:39.000Z","updated":"2023-06-30T07:45:11.922Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆåå››ï¼‰-å®‰è£…æ–‡æ¡£/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E5%8D%81%E5%9B%9B%EF%BC%89-%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3/","excerpt":"","text":"å®‰è£…elasticsearch1.éƒ¨ç½²å•ç‚¹es1.1.åˆ›å»ºç½‘ç»œå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦éƒ¨ç½²kibanaå®¹å™¨ï¼Œå› æ­¤éœ€è¦è®©eså’Œkibanaå®¹å™¨äº’è”ã€‚è¿™é‡Œå…ˆåˆ›å»ºä¸€ä¸ªç½‘ç»œï¼š 1docker network create es-net 1.2.åŠ è½½é•œåƒè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨elasticsearchçš„7.12.1ç‰ˆæœ¬çš„é•œåƒï¼Œè¿™ä¸ªé•œåƒä½“ç§¯éå¸¸å¤§ï¼Œæ¥è¿‘1Gã€‚ä¸å»ºè®®å¤§å®¶è‡ªå·±pullã€‚ è¯¾å‰èµ„æ–™æä¾›äº†é•œåƒçš„taråŒ…ï¼š å¤§å®¶å°†å…¶ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œç„¶åè¿è¡Œå‘½ä»¤åŠ è½½å³å¯ï¼š 12# å¯¼å…¥æ•°æ®docker load -i es.tar åŒç†è¿˜æœ‰kibanaçš„taråŒ…ä¹Ÿéœ€è¦è¿™æ ·åšã€‚ 1.3.è¿è¡Œè¿è¡Œdockerå‘½ä»¤ï¼Œéƒ¨ç½²å•ç‚¹esï¼š 1234567891011docker run -d \\ --name es \\ -e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; \\ -e &quot;discovery.type=single-node&quot; \\ -v es-data:/usr/share/elasticsearch/data \\ -v es-plugins:/usr/share/elasticsearch/plugins \\ --privileged \\ --network es-net \\ -p 9200:9200 \\ -p 9300:9300 \\elasticsearch:7.12.1 å‘½ä»¤è§£é‡Šï¼š -e &quot;cluster.name=es-docker-cluster&quot;ï¼šè®¾ç½®é›†ç¾¤åç§° -e &quot;http.host=0.0.0.0&quot;ï¼šç›‘å¬çš„åœ°å€ï¼Œå¯ä»¥å¤–ç½‘è®¿é—® -e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;ï¼šå†…å­˜å¤§å° -e &quot;discovery.type=single-node&quot;ï¼šéé›†ç¾¤æ¨¡å¼ -v es-data:/usr/share/elasticsearch/dataï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ•°æ®ç›®å½• -v es-logs:/usr/share/elasticsearch/logsï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ—¥å¿—ç›®å½• -v es-plugins:/usr/share/elasticsearch/pluginsï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ’ä»¶ç›®å½• --privilegedï¼šæˆäºˆé€»è¾‘å·è®¿é—®æƒ --network es-net ï¼šåŠ å…¥ä¸€ä¸ªåä¸ºes-netçš„ç½‘ç»œä¸­ -p 9200:9200ï¼šç«¯å£æ˜ å°„é…ç½® åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼šhttp://192.168.150.101:9200 å³å¯çœ‹åˆ°elasticsearchçš„å“åº”ç»“æœï¼š 2.éƒ¨ç½²kibanakibanaå¯ä»¥ç»™æˆ‘ä»¬æä¾›ä¸€ä¸ªelasticsearchçš„å¯è§†åŒ–ç•Œé¢ï¼Œä¾¿äºæˆ‘ä»¬å­¦ä¹ ã€‚ 2.1.éƒ¨ç½²è¿è¡Œdockerå‘½ä»¤ï¼Œéƒ¨ç½²kibana 123456docker run -d \\--name kibana \\-e ELASTICSEARCH_HOSTS=http://es:9200 \\--network=es-net \\-p 5601:5601 \\kibana:7.12.1 --network es-net ï¼šåŠ å…¥ä¸€ä¸ªåä¸ºes-netçš„ç½‘ç»œä¸­ï¼Œä¸elasticsearchåœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ -e ELASTICSEARCH_HOSTS=http://es:9200&quot;ï¼šè®¾ç½®elasticsearchçš„åœ°å€ï¼Œå› ä¸ºkibanaå·²ç»ä¸elasticsearchåœ¨ä¸€ä¸ªç½‘ç»œï¼Œå› æ­¤å¯ä»¥ç”¨å®¹å™¨åç›´æ¥è®¿é—®elasticsearch -p 5601:5601ï¼šç«¯å£æ˜ å°„é…ç½® kibanaå¯åŠ¨ä¸€èˆ¬æ¯”è¾ƒæ…¢ï¼Œéœ€è¦å¤šç­‰å¾…ä¸€ä¼šï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ï¼š 1docker logs -f kibana æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼Œå½“æŸ¥çœ‹åˆ°ä¸‹é¢çš„æ—¥å¿—ï¼Œè¯´æ˜æˆåŠŸï¼š æ­¤æ—¶ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥åœ°å€è®¿é—®ï¼šhttp://192.168.150.101:5601ï¼Œå³å¯çœ‹åˆ°ç»“æœ 2.2.DevToolskibanaä¸­æä¾›äº†ä¸€ä¸ªDevToolsç•Œé¢ï¼š è¿™ä¸ªç•Œé¢ä¸­å¯ä»¥ç¼–å†™DSLæ¥æ“ä½œelasticsearchã€‚å¹¶ä¸”å¯¹DSLè¯­å¥æœ‰è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚ 3.å®‰è£…IKåˆ†è¯å™¨3.1.åœ¨çº¿å®‰è£…ikæ’ä»¶ï¼ˆè¾ƒæ…¢ï¼‰12345678910# è¿›å…¥å®¹å™¨å†…éƒ¨docker exec -it elasticsearch /bin/bash# åœ¨çº¿ä¸‹è½½å¹¶å®‰è£…./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip#é€€å‡ºexit#é‡å¯å®¹å™¨docker restart elasticsearch 3.2.ç¦»çº¿å®‰è£…ikæ’ä»¶ï¼ˆæ¨èï¼‰1ï¼‰æŸ¥çœ‹æ•°æ®å·ç›®å½•å®‰è£…æ’ä»¶éœ€è¦çŸ¥é“elasticsearchçš„pluginsç›®å½•ä½ç½®ï¼Œè€Œæˆ‘ä»¬ç”¨äº†æ•°æ®å·æŒ‚è½½ï¼Œå› æ­¤éœ€è¦æŸ¥çœ‹elasticsearchçš„æ•°æ®å·ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹: 1docker volume inspect es-plugins æ˜¾ç¤ºç»“æœï¼š 1234567891011[ &#123; &quot;CreatedAt&quot;: &quot;2022-05-06T10:06:34+08:00&quot;, &quot;Driver&quot;: &quot;local&quot;, &quot;Labels&quot;: null, &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/es-plugins/_data&quot;, &quot;Name&quot;: &quot;es-plugins&quot;, &quot;Options&quot;: null, &quot;Scope&quot;: &quot;local&quot; &#125;] è¯´æ˜pluginsç›®å½•è¢«æŒ‚è½½åˆ°äº†ï¼š/var/lib/docker/volumes/es-plugins/_data è¿™ä¸ªç›®å½•ä¸­ã€‚ 2ï¼‰è§£å‹ç¼©åˆ†è¯å™¨å®‰è£…åŒ…ä¸‹é¢æˆ‘ä»¬éœ€è¦æŠŠè¯¾å‰èµ„æ–™ä¸­çš„ikåˆ†è¯å™¨è§£å‹ç¼©ï¼Œé‡å‘½åä¸ºik 3ï¼‰ä¸Šä¼ åˆ°eså®¹å™¨çš„æ’ä»¶æ•°æ®å·ä¸­ä¹Ÿå°±æ˜¯/var/lib/docker/volumes/es-plugins/_data ï¼š 4ï¼‰é‡å¯å®¹å™¨12# 4ã€é‡å¯å®¹å™¨docker restart es 12# æŸ¥çœ‹esæ—¥å¿—docker logs -f es 5ï¼‰æµ‹è¯•ï¼šIKåˆ†è¯å™¨åŒ…å«ä¸¤ç§æ¨¡å¼ï¼š ik_smartï¼šæœ€å°‘åˆ‡åˆ† ik_max_wordï¼šæœ€ç»†åˆ‡åˆ† 12345GET /_analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;é»‘é©¬ç¨‹åºå‘˜å­¦ä¹ javaå¤ªæ£’äº†&quot;&#125; ç»“æœï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667&#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;é»‘é©¬&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;ç¨‹åºå‘˜&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;ç¨‹åº&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 4, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;å‘˜&quot;, &quot;start_offset&quot; : 4, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;å­¦ä¹ &quot;, &quot;start_offset&quot; : 5, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 4 &#125;, &#123; &quot;token&quot; : &quot;java&quot;, &quot;start_offset&quot; : 7, &quot;end_offset&quot; : 11, &quot;type&quot; : &quot;ENGLISH&quot;, &quot;position&quot; : 5 &#125;, &#123; &quot;token&quot; : &quot;å¤ªæ£’äº†&quot;, &quot;start_offset&quot; : 11, &quot;end_offset&quot; : 14, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 6 &#125;, &#123; &quot;token&quot; : &quot;å¤ªæ£’&quot;, &quot;start_offset&quot; : 11, &quot;end_offset&quot; : 13, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 7 &#125;, &#123; &quot;token&quot; : &quot;äº†&quot;, &quot;start_offset&quot; : 13, &quot;end_offset&quot; : 14, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 8 &#125; ]&#125; 3.3 æ‰©å±•è¯è¯å…¸éšç€äº’è”ç½‘çš„å‘å±•ï¼Œâ€œé€ è¯è¿åŠ¨â€ä¹Ÿè¶Šå‘çš„é¢‘ç¹ã€‚å‡ºç°äº†å¾ˆå¤šæ–°çš„è¯è¯­ï¼Œåœ¨åŸæœ‰çš„è¯æ±‡åˆ—è¡¨ä¸­å¹¶ä¸å­˜åœ¨ã€‚æ¯”å¦‚ï¼šâ€œå¥¥åŠ›ç»™â€ï¼Œâ€œä¼ æ™ºæ’­å®¢â€ ç­‰ã€‚ æ‰€ä»¥æˆ‘ä»¬çš„è¯æ±‡ä¹Ÿéœ€è¦ä¸æ–­çš„æ›´æ–°ï¼ŒIKåˆ†è¯å™¨æä¾›äº†æ‰©å±•è¯æ±‡çš„åŠŸèƒ½ã€‚ 1ï¼‰æ‰“å¼€IKåˆ†è¯å™¨configç›®å½•ï¼š 2ï¼‰åœ¨IKAnalyzer.cfg.xmlé…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š 1234567&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;&lt;properties&gt; &lt;comment&gt;IK Analyzer æ‰©å±•é…ç½®&lt;/comment&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ *** æ·»åŠ æ‰©å±•è¯å…¸--&gt; &lt;entry key=&quot;ext_dict&quot;&gt;ext.dic&lt;/entry&gt;&lt;/properties&gt; 3ï¼‰æ–°å»ºä¸€ä¸ª ext.dicï¼Œå¯ä»¥å‚è€ƒconfigç›®å½•ä¸‹å¤åˆ¶ä¸€ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ 12ä¼ æ™ºæ’­å®¢å¥¥åŠ›ç»™ 4ï¼‰é‡å¯elasticsearch 1234docker restart es# æŸ¥çœ‹ æ—¥å¿—docker logs -f elasticsearch æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½ext.dicé…ç½®æ–‡ä»¶ 5ï¼‰æµ‹è¯•æ•ˆæœï¼š 12345GET /_analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;ä¼ æ™ºæ’­å®¢Javaå°±ä¸šè¶…è¿‡90%,å¥¥åŠ›ç»™ï¼&quot;&#125; æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨Windowsè®°äº‹æœ¬ç¼–è¾‘ 3.4 åœç”¨è¯è¯å…¸åœ¨äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œåœ¨ç½‘ç»œé—´ä¼ è¾“çš„é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥å¾ˆå¤šè¯­è¨€æ˜¯ä¸å…è®¸åœ¨ç½‘ç»œä¸Šä¼ é€’çš„ï¼Œå¦‚ï¼šå…³äºå®—æ•™ã€æ”¿æ²»ç­‰æ•æ„Ÿè¯è¯­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æœç´¢æ—¶ä¹Ÿåº”è¯¥å¿½ç•¥å½“å‰è¯æ±‡ã€‚ IKåˆ†è¯å™¨ä¹Ÿæä¾›äº†å¼ºå¤§çš„åœç”¨è¯åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬åœ¨ç´¢å¼•æ—¶å°±ç›´æ¥å¿½ç•¥å½“å‰çš„åœç”¨è¯æ±‡è¡¨ä¸­çš„å†…å®¹ã€‚ 1ï¼‰IKAnalyzer.cfg.xmlé…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š 123456789&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;&lt;properties&gt; &lt;comment&gt;IK Analyzer æ‰©å±•é…ç½®&lt;/comment&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸--&gt; &lt;entry key=&quot;ext_dict&quot;&gt;ext.dic&lt;/entry&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸ *** æ·»åŠ åœç”¨è¯è¯å…¸--&gt; &lt;entry key=&quot;ext_stopwords&quot;&gt;stopword.dic&lt;/entry&gt;&lt;/properties&gt; 3ï¼‰åœ¨ stopword.dic æ·»åŠ åœç”¨è¯ 1ä¹ å¤§å¤§ 4ï¼‰é‡å¯elasticsearch 123456# é‡å¯æœåŠ¡docker restart elasticsearchdocker restart kibana# æŸ¥çœ‹ æ—¥å¿—docker logs -f elasticsearch æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½stopword.dicé…ç½®æ–‡ä»¶ 5ï¼‰æµ‹è¯•æ•ˆæœï¼š 12345GET /_analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;ä¼ æ™ºæ’­å®¢Javaå°±ä¸šç‡è¶…è¿‡95%,ä¹ å¤§å¤§éƒ½ç‚¹èµ,å¥¥åŠ›ç»™ï¼&quot;&#125; æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨Windowsè®°äº‹æœ¬ç¼–è¾‘ 4.éƒ¨ç½²esé›†ç¾¤æˆ‘ä»¬ä¼šåœ¨å•æœºä¸Šåˆ©ç”¨dockerå®¹å™¨è¿è¡Œå¤šä¸ªeså®ä¾‹æ¥æ¨¡æ‹Ÿesé›†ç¾¤ã€‚ä¸è¿‡ç”Ÿäº§ç¯å¢ƒæ¨èå¤§å®¶æ¯ä¸€å°æœåŠ¡èŠ‚ç‚¹ä»…éƒ¨ç½²ä¸€ä¸ªesçš„å®ä¾‹ã€‚ éƒ¨ç½²esé›†ç¾¤å¯ä»¥ç›´æ¥ä½¿ç”¨docker-composeæ¥å®Œæˆï¼Œä½†è¿™è¦æ±‚ä½ çš„Linuxè™šæ‹Ÿæœºè‡³å°‘æœ‰4Gçš„å†…å­˜ç©ºé—´ 4.1.åˆ›å»ºesé›†ç¾¤é¦–å…ˆç¼–å†™ä¸€ä¸ªdocker-composeæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758version: &#x27;2.2&#x27;services: es01: image: elasticsearch:7.12.1 container_name: es01 environment: - node.name=es01 - cluster.name=es-docker-cluster - discovery.seed_hosts=es02,es03 - cluster.initial_master_nodes=es01,es02,es03 - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; volumes: - data01:/usr/share/elasticsearch/data ports: - 9200:9200 networks: - elastic es02: image: elasticsearch:7.12.1 container_name: es02 environment: - node.name=es02 - cluster.name=es-docker-cluster - discovery.seed_hosts=es01,es03 - cluster.initial_master_nodes=es01,es02,es03 - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; volumes: - data02:/usr/share/elasticsearch/data ports: - 9201:9200 networks: - elastic es03: image: elasticsearch:7.12.1 container_name: es03 environment: - node.name=es03 - cluster.name=es-docker-cluster - discovery.seed_hosts=es01,es02 - cluster.initial_master_nodes=es01,es02,es03 - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; volumes: - data03:/usr/share/elasticsearch/data networks: - elastic ports: - 9202:9200volumes: data01: driver: local data02: driver: local data03: driver: localnetworks: elastic: driver: bridge esè¿è¡Œéœ€è¦ä¿®æ”¹ä¸€äº›linuxç³»ç»Ÿæƒé™ï¼Œä¿®æ”¹/etc/sysctl.confæ–‡ä»¶ 1vi /etc/sysctl.conf æ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š 1vm.max_map_count=262144 ç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œè®©é…ç½®ç”Ÿæ•ˆï¼š 1sysctl -p é€šè¿‡docker-composeå¯åŠ¨é›†ç¾¤ï¼š 1docker-compose up -d 4.2.é›†ç¾¤çŠ¶æ€ç›‘æ§kibanaå¯ä»¥ç›‘æ§esé›†ç¾¤ï¼Œä¸è¿‡æ–°ç‰ˆæœ¬éœ€è¦ä¾èµ–esçš„x-pack åŠŸèƒ½ï¼Œé…ç½®æ¯”è¾ƒå¤æ‚ã€‚ è¿™é‡Œæ¨èä½¿ç”¨cerebroæ¥ç›‘æ§esé›†ç¾¤çŠ¶æ€ï¼Œå®˜æ–¹ç½‘å€ï¼šhttps://github.com/lmenezes/cerebro è¯¾å‰èµ„æ–™å·²ç»æä¾›äº†å®‰è£…åŒ…ï¼š è§£å‹å³å¯ä½¿ç”¨ï¼Œéå¸¸æ–¹ä¾¿ã€‚ è§£å‹å¥½çš„ç›®å½•å¦‚ä¸‹ï¼š è¿›å…¥å¯¹åº”çš„binç›®å½•ï¼š åŒå‡»å…¶ä¸­çš„cerebro.batæ–‡ä»¶å³å¯å¯åŠ¨æœåŠ¡ã€‚ è®¿é—®http://localhost:9000 å³å¯è¿›å…¥ç®¡ç†ç•Œé¢ï¼š è¾“å…¥ä½ çš„elasticsearchçš„ä»»æ„èŠ‚ç‚¹çš„åœ°å€å’Œç«¯å£ï¼Œç‚¹å‡»connectå³å¯ï¼š ç»¿è‰²çš„æ¡ï¼Œä»£è¡¨é›†ç¾¤å¤„äºç»¿è‰²ï¼ˆå¥åº·çŠ¶æ€ï¼‰ã€‚ 4.3.åˆ›å»ºç´¢å¼•åº“1ï¼‰åˆ©ç”¨kibanaçš„DevToolsåˆ›å»ºç´¢å¼•åº“åœ¨DevToolsä¸­è¾“å…¥æŒ‡ä»¤ï¼š 123456789101112PUT /itcast&#123; &quot;settings&quot;: &#123; &quot;number_of_shards&quot;: 3, // åˆ†ç‰‡æ•°é‡ &quot;number_of_replicas&quot;: 1 // å‰¯æœ¬æ•°é‡ &#125;, &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; // mappingæ˜ å°„å®šä¹‰ ... &#125; &#125;&#125; 2ï¼‰åˆ©ç”¨cerebroåˆ›å»ºç´¢å¼•åº“åˆ©ç”¨cerebroè¿˜å¯ä»¥åˆ›å»ºç´¢å¼•åº“ï¼š å¡«å†™ç´¢å¼•åº“ä¿¡æ¯ï¼š ç‚¹å‡»å³ä¸‹è§’çš„createæŒ‰é’®ï¼š 4.4.æŸ¥çœ‹åˆ†ç‰‡æ•ˆæœå›åˆ°é¦–é¡µï¼Œå³å¯æŸ¥çœ‹ç´¢å¼•åº“åˆ†ç‰‡æ•ˆæœï¼š","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆåä¸‰ï¼‰-é›†ç¾¤","slug":"elk/elkï¼ˆåä¸‰ï¼‰-é›†ç¾¤","date":"2023-06-30T07:40:37.000Z","updated":"2023-06-30T07:45:06.805Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆåä¸‰ï¼‰-é›†ç¾¤/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89-%E9%9B%86%E7%BE%A4/","excerpt":"","text":"4.é›†ç¾¤å•æœºçš„elasticsearchåšæ•°æ®å­˜å‚¨ï¼Œå¿…ç„¶é¢ä¸´ä¸¤ä¸ªé—®é¢˜ï¼šæµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜ã€å•ç‚¹æ•…éšœé—®é¢˜ã€‚ æµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜ï¼šå°†ç´¢å¼•åº“ä»é€»è¾‘ä¸Šæ‹†åˆ†ä¸ºNä¸ªåˆ†ç‰‡ï¼ˆshardï¼‰ï¼Œå­˜å‚¨åˆ°å¤šä¸ªèŠ‚ç‚¹ å•ç‚¹æ•…éšœé—®é¢˜ï¼šå°†åˆ†ç‰‡æ•°æ®åœ¨ä¸åŒèŠ‚ç‚¹å¤‡ä»½ï¼ˆreplica ï¼‰ ESé›†ç¾¤ç›¸å…³æ¦‚å¿µ: é›†ç¾¤ï¼ˆclusterï¼‰ï¼šä¸€ç»„æ‹¥æœ‰å…±åŒçš„ cluster name çš„ èŠ‚ç‚¹ã€‚ èŠ‚ç‚¹ï¼ˆnode) ï¼šé›†ç¾¤ä¸­çš„ä¸€ä¸ª Elasticearch å®ä¾‹ åˆ†ç‰‡ï¼ˆshardï¼‰ï¼šç´¢å¼•å¯ä»¥è¢«æ‹†åˆ†ä¸ºä¸åŒçš„éƒ¨åˆ†è¿›è¡Œå­˜å‚¨ï¼Œç§°ä¸ºåˆ†ç‰‡ã€‚åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªç´¢å¼•çš„ä¸åŒåˆ†ç‰‡å¯ä»¥æ‹†åˆ†åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸­ è§£å†³é—®é¢˜ï¼šæ•°æ®é‡å¤ªå¤§ï¼Œå•ç‚¹å­˜å‚¨é‡æœ‰é™çš„é—®é¢˜ã€‚ æ­¤å¤„ï¼Œæˆ‘ä»¬æŠŠæ•°æ®åˆ†æˆ3ç‰‡ï¼šshard0ã€shard1ã€shard2 ä¸»åˆ†ç‰‡ï¼ˆPrimary shardï¼‰ï¼šç›¸å¯¹äºå‰¯æœ¬åˆ†ç‰‡çš„å®šä¹‰ã€‚ å‰¯æœ¬åˆ†ç‰‡ï¼ˆReplica shardï¼‰æ¯ä¸ªä¸»åˆ†ç‰‡å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‰¯æœ¬ï¼Œæ•°æ®å’Œä¸»åˆ†ç‰‡ä¸€æ ·ã€‚ â€‹ æ•°æ®å¤‡ä»½å¯ä»¥ä¿è¯é«˜å¯ç”¨ï¼Œä½†æ˜¯æ¯ä¸ªåˆ†ç‰‡å¤‡ä»½ä¸€ä»½ï¼Œæ‰€éœ€è¦çš„èŠ‚ç‚¹æ•°é‡å°±ä¼šç¿»ä¸€å€ï¼Œæˆæœ¬å®åœ¨æ˜¯å¤ªé«˜äº†ï¼ ä¸ºäº†åœ¨é«˜å¯ç”¨å’Œæˆæœ¬é—´å¯»æ±‚å¹³è¡¡ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š é¦–å…ˆå¯¹æ•°æ®åˆ†ç‰‡ï¼Œå­˜å‚¨åˆ°ä¸åŒèŠ‚ç‚¹ ç„¶åå¯¹æ¯ä¸ªåˆ†ç‰‡è¿›è¡Œå¤‡ä»½ï¼Œæ”¾åˆ°å¯¹æ–¹èŠ‚ç‚¹ï¼Œå®Œæˆäº’ç›¸å¤‡ä»½ è¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘æ‰€éœ€è¦çš„æœåŠ¡èŠ‚ç‚¹æ•°é‡ï¼Œå¦‚å›¾ï¼Œæˆ‘ä»¬ä»¥3åˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡å¤‡ä»½ä¸€ä»½ä¸ºä¾‹ï¼š ç°åœ¨ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½æœ‰1ä¸ªå¤‡ä»½ï¼Œå­˜å‚¨åœ¨3ä¸ªèŠ‚ç‚¹ï¼š node0ï¼šä¿å­˜äº†åˆ†ç‰‡0å’Œ1 node1ï¼šä¿å­˜äº†åˆ†ç‰‡0å’Œ2 node2ï¼šä¿å­˜äº†åˆ†ç‰‡1å’Œ2 4.1.æ­å»ºESé›†ç¾¤å‚è€ƒè¯¾å‰èµ„æ–™çš„æ–‡æ¡£ï¼š å…¶ä¸­çš„ç¬¬å››ç« èŠ‚ï¼š 4.2.é›†ç¾¤è„‘è£‚é—®é¢˜4.2.1.é›†ç¾¤èŒè´£åˆ’åˆ†elasticsearchä¸­é›†ç¾¤èŠ‚ç‚¹æœ‰ä¸åŒçš„èŒè´£åˆ’åˆ†ï¼š é»˜è®¤æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒæ—¶å…·å¤‡ä¸Šè¿°å››ç§è§’è‰²ã€‚ ä½†æ˜¯çœŸå®çš„é›†ç¾¤ä¸€å®šè¦å°†é›†ç¾¤èŒè´£åˆ†ç¦»ï¼š masterèŠ‚ç‚¹ï¼šå¯¹CPUè¦æ±‚é«˜ï¼Œä½†æ˜¯å†…å­˜è¦æ±‚ç¬¬ dataèŠ‚ç‚¹ï¼šå¯¹CPUå’Œå†…å­˜è¦æ±‚éƒ½é«˜ coordinatingèŠ‚ç‚¹ï¼šå¯¹ç½‘ç»œå¸¦å®½ã€CPUè¦æ±‚é«˜ èŒè´£åˆ†ç¦»å¯ä»¥è®©æˆ‘ä»¬æ ¹æ®ä¸åŒèŠ‚ç‚¹çš„éœ€æ±‚åˆ†é…ä¸åŒçš„ç¡¬ä»¶å»éƒ¨ç½²ã€‚è€Œä¸”é¿å…ä¸šåŠ¡ä¹‹é—´çš„äº’ç›¸å¹²æ‰°ã€‚ ä¸€ä¸ªå…¸å‹çš„esé›†ç¾¤èŒè´£åˆ’åˆ†å¦‚å›¾ï¼š 4.2.2.è„‘è£‚é—®é¢˜è„‘è£‚æ˜¯å› ä¸ºé›†ç¾¤ä¸­çš„èŠ‚ç‚¹å¤±è”å¯¼è‡´çš„ã€‚ ä¾‹å¦‚ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œä¸»èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹å¤±è”ï¼š æ­¤æ—¶ï¼Œnode2å’Œnode3è®¤ä¸ºnode1å®•æœºï¼Œå°±ä¼šé‡æ–°é€‰ä¸»ï¼š å½“node3å½“é€‰åï¼Œé›†ç¾¤ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ï¼Œnode2å’Œnode3è‡ªæˆé›†ç¾¤ï¼Œnode1è‡ªæˆé›†ç¾¤ï¼Œä¸¤ä¸ªé›†ç¾¤æ•°æ®ä¸åŒæ­¥ï¼Œå‡ºç°æ•°æ®å·®å¼‚ã€‚ å½“ç½‘ç»œæ¢å¤åï¼Œå› ä¸ºé›†ç¾¤ä¸­æœ‰ä¸¤ä¸ªmasterèŠ‚ç‚¹ï¼Œé›†ç¾¤çŠ¶æ€çš„ä¸ä¸€è‡´ï¼Œå‡ºç°è„‘è£‚çš„æƒ…å†µï¼š è§£å†³è„‘è£‚çš„æ–¹æ¡ˆæ˜¯ï¼Œè¦æ±‚é€‰ç¥¨è¶…è¿‡ ( eligibleèŠ‚ç‚¹æ•°é‡ + 1 ï¼‰&#x2F; 2 æ‰èƒ½å½“é€‰ä¸ºä¸»ï¼Œå› æ­¤eligibleèŠ‚ç‚¹æ•°é‡æœ€å¥½æ˜¯å¥‡æ•°ã€‚å¯¹åº”é…ç½®é¡¹æ˜¯discovery.zen.minimum_master_nodesï¼Œåœ¨es7.0ä»¥åï¼Œå·²ç»æˆä¸ºé»˜è®¤é…ç½®ï¼Œå› æ­¤ä¸€èˆ¬ä¸ä¼šå‘ç”Ÿè„‘è£‚é—®é¢˜ ä¾‹å¦‚ï¼š3ä¸ªèŠ‚ç‚¹å½¢æˆçš„é›†ç¾¤ï¼Œé€‰ç¥¨å¿…é¡»è¶…è¿‡ ï¼ˆ3 + 1ï¼‰ &#x2F; 2 ï¼Œä¹Ÿå°±æ˜¯2ç¥¨ã€‚node3å¾—åˆ°node2å’Œnode3çš„é€‰ç¥¨ï¼Œå½“é€‰ä¸ºä¸»ã€‚node1åªæœ‰è‡ªå·±1ç¥¨ï¼Œæ²¡æœ‰å½“é€‰ã€‚é›†ç¾¤ä¸­ä¾ç„¶åªæœ‰1ä¸ªä¸»èŠ‚ç‚¹ï¼Œæ²¡æœ‰å‡ºç°è„‘è£‚ã€‚ 4.2.3.å°ç»“master eligibleèŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ å‚ä¸é›†ç¾¤é€‰ä¸» ä¸»èŠ‚ç‚¹å¯ä»¥ç®¡ç†é›†ç¾¤çŠ¶æ€ã€ç®¡ç†åˆ†ç‰‡ä¿¡æ¯ã€å¤„ç†åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•åº“çš„è¯·æ±‚ dataèŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ æ•°æ®çš„CRUD coordinatorèŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ è·¯ç”±è¯·æ±‚åˆ°å…¶å®ƒèŠ‚ç‚¹ åˆå¹¶æŸ¥è¯¢åˆ°çš„ç»“æœï¼Œè¿”å›ç»™ç”¨æˆ· 4.3.é›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨å½“æ–°å¢æ–‡æ¡£æ—¶ï¼Œåº”è¯¥ä¿å­˜åˆ°ä¸åŒåˆ†ç‰‡ï¼Œä¿è¯æ•°æ®å‡è¡¡ï¼Œé‚£ä¹ˆcoordinating nodeå¦‚ä½•ç¡®å®šæ•°æ®è¯¥å­˜å‚¨åˆ°å“ªä¸ªåˆ†ç‰‡å‘¢ï¼Ÿ 4.3.1.åˆ†ç‰‡å­˜å‚¨æµ‹è¯•æ’å…¥ä¸‰æ¡æ•°æ®ï¼š æµ‹è¯•å¯ä»¥çœ‹åˆ°ï¼Œä¸‰æ¡æ•°æ®åˆ†åˆ«åœ¨ä¸åŒåˆ†ç‰‡ï¼š ç»“æœï¼š 4.3.2.åˆ†ç‰‡å­˜å‚¨åŸç†elasticsearchä¼šé€šè¿‡hashç®—æ³•æ¥è®¡ç®—æ–‡æ¡£åº”è¯¥å­˜å‚¨åˆ°å“ªä¸ªåˆ†ç‰‡ï¼š è¯´æ˜ï¼š _routingé»˜è®¤æ˜¯æ–‡æ¡£çš„id ç®—æ³•ä¸åˆ†ç‰‡æ•°é‡æœ‰å…³ï¼Œå› æ­¤ç´¢å¼•åº“ä¸€æ—¦åˆ›å»ºï¼Œåˆ†ç‰‡æ•°é‡ä¸èƒ½ä¿®æ”¹ï¼ æ–°å¢æ–‡æ¡£çš„æµç¨‹å¦‚ä¸‹ï¼š è§£è¯»ï¼š 1ï¼‰æ–°å¢ä¸€ä¸ªid&#x3D;1çš„æ–‡æ¡£ 2ï¼‰å¯¹idåšhashè¿ç®—ï¼Œå‡å¦‚å¾—åˆ°çš„æ˜¯2ï¼Œåˆ™åº”è¯¥å­˜å‚¨åˆ°shard-2 3ï¼‰shard-2çš„ä¸»åˆ†ç‰‡åœ¨node3èŠ‚ç‚¹ï¼Œå°†æ•°æ®è·¯ç”±åˆ°node3 4ï¼‰ä¿å­˜æ–‡æ¡£ 5ï¼‰åŒæ­¥ç»™shard-2çš„å‰¯æœ¬replica-2ï¼Œåœ¨node2èŠ‚ç‚¹ 6ï¼‰è¿”å›ç»“æœç»™coordinating-nodeèŠ‚ç‚¹ 4.4.é›†ç¾¤åˆ†å¸ƒå¼æŸ¥è¯¢elasticsearchçš„æŸ¥è¯¢åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼š scatter phaseï¼šåˆ†æ•£é˜¶æ®µï¼Œcoordinating nodeä¼šæŠŠè¯·æ±‚åˆ†å‘åˆ°æ¯ä¸€ä¸ªåˆ†ç‰‡ gather phaseï¼šèšé›†é˜¶æ®µï¼Œcoordinating nodeæ±‡æ€»data nodeçš„æœç´¢ç»“æœï¼Œå¹¶å¤„ç†ä¸ºæœ€ç»ˆç»“æœé›†è¿”å›ç»™ç”¨æˆ· 4.5.é›†ç¾¤æ•…éšœè½¬ç§»é›†ç¾¤çš„masterèŠ‚ç‚¹ä¼šç›‘æ§é›†ç¾¤ä¸­çš„èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚æœå‘ç°æœ‰èŠ‚ç‚¹å®•æœºï¼Œä¼šç«‹å³å°†å®•æœºèŠ‚ç‚¹çš„åˆ†ç‰‡æ•°æ®è¿ç§»åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ï¼Œè¿™ä¸ªå«åšæ•…éšœè½¬ç§»ã€‚ 1ï¼‰ä¾‹å¦‚ä¸€ä¸ªé›†ç¾¤ç»“æ„å¦‚å›¾ï¼š ç°åœ¨ï¼Œnode1æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå…¶å®ƒä¸¤ä¸ªèŠ‚ç‚¹æ˜¯ä»èŠ‚ç‚¹ã€‚ 2ï¼‰çªç„¶ï¼Œnode1å‘ç”Ÿäº†æ•…éšœï¼š å®•æœºåçš„ç¬¬ä¸€ä»¶äº‹ï¼Œéœ€è¦é‡æ–°é€‰ä¸»ï¼Œä¾‹å¦‚é€‰ä¸­äº†node2ï¼š node2æˆä¸ºä¸»èŠ‚ç‚¹åï¼Œä¼šæ£€æµ‹é›†ç¾¤ç›‘æ§çŠ¶æ€ï¼Œå‘ç°ï¼šshard-1ã€shard-0æ²¡æœ‰å‰¯æœ¬èŠ‚ç‚¹ã€‚å› æ­¤éœ€è¦å°†node1ä¸Šçš„æ•°æ®è¿ç§»åˆ°node2ã€node3ï¼š","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆåäºŒï¼‰-æ•°æ®åŒæ­¥","slug":"elk/elkï¼ˆåäºŒï¼‰-æ•°æ®åŒæ­¥","date":"2023-06-30T07:39:15.000Z","updated":"2023-06-30T07:45:02.445Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆåäºŒï¼‰-æ•°æ®åŒæ­¥/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E5%8D%81%E4%BA%8C%EF%BC%89-%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/","excerpt":"","text":"3.æ•°æ®åŒæ­¥elasticsearchä¸­çš„é…’åº—æ•°æ®æ¥è‡ªäºmysqlæ•°æ®åº“ï¼Œå› æ­¤mysqlæ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œelasticsearchä¹Ÿå¿…é¡»è·Ÿç€æ”¹å˜ï¼Œè¿™ä¸ªå°±æ˜¯elasticsearchä¸mysqlä¹‹é—´çš„æ•°æ®åŒæ­¥ã€‚ 3.1.æ€è·¯åˆ†æå¸¸è§çš„æ•°æ®åŒæ­¥æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š åŒæ­¥è°ƒç”¨ å¼‚æ­¥é€šçŸ¥ ç›‘å¬binlog 3.1.1.åŒæ­¥è°ƒç”¨æ–¹æ¡ˆä¸€ï¼šåŒæ­¥è°ƒç”¨ åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š hotel-demoå¯¹å¤–æä¾›æ¥å£ï¼Œç”¨æ¥ä¿®æ”¹elasticsearchä¸­çš„æ•°æ® é…’åº—ç®¡ç†æœåŠ¡åœ¨å®Œæˆæ•°æ®åº“æ“ä½œåï¼Œç›´æ¥è°ƒç”¨hotel-demoæä¾›çš„æ¥å£ï¼Œ 3.1.2.å¼‚æ­¥é€šçŸ¥æ–¹æ¡ˆäºŒï¼šå¼‚æ­¥é€šçŸ¥ æµç¨‹å¦‚ä¸‹ï¼š hotel-adminå¯¹mysqlæ•°æ®åº“æ•°æ®å®Œæˆå¢ã€åˆ ã€æ”¹åï¼Œå‘é€MQæ¶ˆæ¯ hotel-demoç›‘å¬MQï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯åå®Œæˆelasticsearchæ•°æ®ä¿®æ”¹ 3.1.3.ç›‘å¬binlogæ–¹æ¡ˆä¸‰ï¼šç›‘å¬binlog æµç¨‹å¦‚ä¸‹ï¼š ç»™mysqlå¼€å¯binlogåŠŸèƒ½ mysqlå®Œæˆå¢ã€åˆ ã€æ”¹æ“ä½œéƒ½ä¼šè®°å½•åœ¨binlogä¸­ hotel-demoåŸºäºcanalç›‘å¬binlogå˜åŒ–ï¼Œå®æ—¶æ›´æ–°elasticsearchä¸­çš„å†…å®¹ 3.1.4.é€‰æ‹©æ–¹å¼ä¸€ï¼šåŒæ­¥è°ƒç”¨ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç²—æš´ ç¼ºç‚¹ï¼šä¸šåŠ¡è€¦åˆåº¦é«˜ æ–¹å¼äºŒï¼šå¼‚æ­¥é€šçŸ¥ ä¼˜ç‚¹ï¼šä½è€¦åˆï¼Œå®ç°éš¾åº¦ä¸€èˆ¬ ç¼ºç‚¹ï¼šä¾èµ–mqçš„å¯é æ€§ æ–¹å¼ä¸‰ï¼šç›‘å¬binlog ä¼˜ç‚¹ï¼šå®Œå…¨è§£é™¤æœåŠ¡é—´è€¦åˆ ç¼ºç‚¹ï¼šå¼€å¯binlogå¢åŠ æ•°æ®åº“è´Ÿæ‹…ã€å®ç°å¤æ‚åº¦é«˜ 3.2.å®ç°æ•°æ®åŒæ­¥3.2.1.æ€è·¯åˆ©ç”¨è¯¾å‰èµ„æ–™æä¾›çš„hotel-adminé¡¹ç›®ä½œä¸ºé…’åº—ç®¡ç†çš„å¾®æœåŠ¡ã€‚å½“é…’åº—æ•°æ®å‘ç”Ÿå¢ã€åˆ ã€æ”¹æ—¶ï¼Œè¦æ±‚å¯¹elasticsearchä¸­æ•°æ®ä¹Ÿè¦å®Œæˆç›¸åŒæ“ä½œã€‚ æ­¥éª¤ï¼š å¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„hotel-adminé¡¹ç›®ï¼Œå¯åŠ¨å¹¶æµ‹è¯•é…’åº—æ•°æ®çš„CRUD å£°æ˜exchangeã€queueã€RoutingKey åœ¨hotel-adminä¸­çš„å¢ã€åˆ ã€æ”¹ä¸šåŠ¡ä¸­å®Œæˆæ¶ˆæ¯å‘é€ åœ¨hotel-demoä¸­å®Œæˆæ¶ˆæ¯ç›‘å¬ï¼Œå¹¶æ›´æ–°elasticsearchä¸­æ•°æ® å¯åŠ¨å¹¶æµ‹è¯•æ•°æ®åŒæ­¥åŠŸèƒ½ 3.2.2.å¯¼å…¥demoå¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„hotel-adminé¡¹ç›®ï¼š è¿è¡Œåï¼Œè®¿é—® http://localhost:8099 å…¶ä¸­åŒ…å«äº†é…’åº—çš„CRUDåŠŸèƒ½ï¼š 3.2.3.å£°æ˜äº¤æ¢æœºã€é˜Ÿåˆ—MQç»“æ„å¦‚å›¾ï¼š 1ï¼‰å¼•å…¥ä¾èµ–åœ¨hotel-adminã€hotel-demoä¸­å¼•å…¥rabbitmqçš„ä¾èµ–ï¼š 12345&lt;!--amqp--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt; 2ï¼‰å£°æ˜é˜Ÿåˆ—äº¤æ¢æœºåç§°åœ¨hotel-adminå’Œhotel-demoä¸­çš„cn.itcast.hotel.constatntsåŒ…ä¸‹æ–°å»ºä¸€ä¸ªç±»MqConstantsï¼š 123456789101112131415161718192021222324package cn.itcast.hotel.constatnts; public class MqConstants &#123; /** * äº¤æ¢æœº */ public final static String HOTEL_EXCHANGE = &quot;hotel.topic&quot;; /** * ç›‘å¬æ–°å¢å’Œä¿®æ”¹çš„é˜Ÿåˆ— */ public final static String HOTEL_INSERT_QUEUE = &quot;hotel.insert.queue&quot;; /** * ç›‘å¬åˆ é™¤çš„é˜Ÿåˆ— */ public final static String HOTEL_DELETE_QUEUE = &quot;hotel.delete.queue&quot;; /** * æ–°å¢æˆ–ä¿®æ”¹çš„RoutingKey */ public final static String HOTEL_INSERT_KEY = &quot;hotel.insert&quot;; /** * åˆ é™¤çš„RoutingKey */ public final static String HOTEL_DELETE_KEY = &quot;hotel.delete&quot;;&#125; 3ï¼‰å£°æ˜é˜Ÿåˆ—äº¤æ¢æœºåœ¨hotel-demoä¸­ï¼Œå®šä¹‰é…ç½®ç±»ï¼Œå£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºï¼š 12345678910111213141516171819202122232425262728293031323334353637package cn.itcast.hotel.config;import cn.itcast.hotel.constants.MqConstants;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.Queue;import org.springframework.amqp.core.TopicExchange;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;@Configurationpublic class MqConfig &#123; @Bean public TopicExchange topicExchange()&#123; return new TopicExchange(MqConstants.HOTEL_EXCHANGE, true, false); &#125; @Bean public Queue insertQueue()&#123; return new Queue(MqConstants.HOTEL_INSERT_QUEUE, true); &#125; @Bean public Queue deleteQueue()&#123; return new Queue(MqConstants.HOTEL_DELETE_QUEUE, true); &#125; @Bean public Binding insertQueueBinding()&#123; return BindingBuilder.bind(insertQueue()).to(topicExchange()).with(MqConstants.HOTEL_INSERT_KEY); &#125; @Bean public Binding deleteQueueBinding()&#123; return BindingBuilder.bind(deleteQueue()).to(topicExchange()).with(MqConstants.HOTEL_DELETE_KEY); &#125;&#125; 3.2.4.å‘é€MQæ¶ˆæ¯åœ¨hotel-adminä¸­çš„å¢ã€åˆ ã€æ”¹ä¸šåŠ¡ä¸­åˆ†åˆ«å‘é€MQæ¶ˆæ¯ï¼š 3.2.5.æ¥æ”¶MQæ¶ˆæ¯hotel-demoæ¥æ”¶åˆ°MQæ¶ˆæ¯è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š æ–°å¢æ¶ˆæ¯ï¼šæ ¹æ®ä¼ é€’çš„hotelçš„idæŸ¥è¯¢hotelä¿¡æ¯ï¼Œç„¶åæ–°å¢ä¸€æ¡æ•°æ®åˆ°ç´¢å¼•åº“ åˆ é™¤æ¶ˆæ¯ï¼šæ ¹æ®ä¼ é€’çš„hotelçš„idåˆ é™¤ç´¢å¼•åº“ä¸­çš„ä¸€æ¡æ•°æ® 1ï¼‰é¦–å…ˆåœ¨hotel-demoçš„cn.itcast.hotel.serviceåŒ…ä¸‹çš„IHotelServiceä¸­æ–°å¢æ–°å¢ã€åˆ é™¤ä¸šåŠ¡ 123void deleteById(Long id);void insertById(Long id); 2ï¼‰ç»™hotel-demoä¸­çš„cn.itcast.hotel.service.implåŒ…ä¸‹çš„HotelServiceä¸­å®ç°ä¸šåŠ¡ï¼š 123456789101112131415161718192021222324252627282930@Overridepublic void deleteById(Long id) &#123; try &#123; // 1.å‡†å¤‡Request DeleteRequest request = new DeleteRequest(&quot;hotel&quot;, id.toString()); // 2.å‘é€è¯·æ±‚ client.delete(request, RequestOptions.DEFAULT); &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125;&#125;@Overridepublic void insertById(Long id) &#123; try &#123; // 0.æ ¹æ®idæŸ¥è¯¢é…’åº—æ•°æ® Hotel hotel = getById(id); // è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹ HotelDoc hotelDoc = new HotelDoc(hotel); // 1.å‡†å¤‡Requestå¯¹è±¡ IndexRequest request = new IndexRequest(&quot;hotel&quot;).id(hotel.getId().toString()); // 2.å‡†å¤‡Jsonæ–‡æ¡£ request.source(JSON.toJSONString(hotelDoc), XContentType.JSON); // 3.å‘é€è¯·æ±‚ client.index(request, RequestOptions.DEFAULT); &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125;&#125; 3ï¼‰ç¼–å†™ç›‘å¬å™¨ åœ¨hotel-demoä¸­çš„cn.itcast.hotel.mqåŒ…æ–°å¢ä¸€ä¸ªç±»ï¼š 1234567891011121314151617181920212223242526272829303132package cn.itcast.hotel.mq;import cn.itcast.hotel.constants.MqConstants;import cn.itcast.hotel.service.IHotelService;import org.springframework.amqp.rabbit.annotation.RabbitListener;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;@Componentpublic class HotelListener &#123; @Autowired private IHotelService hotelService; /** * ç›‘å¬é…’åº—æ–°å¢æˆ–ä¿®æ”¹çš„ä¸šåŠ¡ * @param id é…’åº—id */ @RabbitListener(queues = MqConstants.HOTEL_INSERT_QUEUE) public void listenHotelInsertOrUpdate(Long id)&#123; hotelService.insertById(id); &#125; /** * ç›‘å¬é…’åº—åˆ é™¤çš„ä¸šåŠ¡ * @param id é…’åº—id */ @RabbitListener(queues = MqConstants.HOTEL_DELETE_QUEUE) public void listenHotelDelete(Long id)&#123; hotelService.deleteById(id); &#125;&#125;","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆåä¸€ï¼‰-è‡ªåŠ¨è¡¥å…¨","slug":"elk/elkï¼ˆåä¸€ï¼‰-è‡ªåŠ¨è¡¥å…¨","date":"2023-06-30T07:38:02.000Z","updated":"2023-06-30T07:45:15.947Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆåä¸€ï¼‰-è‡ªåŠ¨è¡¥å…¨/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89-%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8/","excerpt":"","text":"2.è‡ªåŠ¨è¡¥å…¨å½“ç”¨æˆ·åœ¨æœç´¢æ¡†è¾“å…¥å­—ç¬¦æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥æç¤ºå‡ºä¸è¯¥å­—ç¬¦æœ‰å…³çš„æœç´¢é¡¹ï¼Œå¦‚å›¾ï¼š è¿™ç§æ ¹æ®ç”¨æˆ·è¾“å…¥çš„å­—æ¯ï¼Œæç¤ºå®Œæ•´è¯æ¡çš„åŠŸèƒ½ï¼Œå°±æ˜¯è‡ªåŠ¨è¡¥å…¨äº†ã€‚ å› ä¸ºéœ€è¦æ ¹æ®æ‹¼éŸ³å­—æ¯æ¥æ¨æ–­ï¼Œå› æ­¤è¦ç”¨åˆ°æ‹¼éŸ³åˆ†è¯åŠŸèƒ½ã€‚ 2.1.æ‹¼éŸ³åˆ†è¯å™¨è¦å®ç°æ ¹æ®å­—æ¯åšè¡¥å…¨ï¼Œå°±å¿…é¡»å¯¹æ–‡æ¡£æŒ‰ç…§æ‹¼éŸ³åˆ†è¯ã€‚åœ¨GitHubä¸Šæ°å¥½æœ‰elasticsearchçš„æ‹¼éŸ³åˆ†è¯æ’ä»¶ã€‚åœ°å€ï¼šhttps://github.com/medcl/elasticsearch-analysis-pinyin è¯¾å‰èµ„æ–™ä¸­ä¹Ÿæä¾›äº†æ‹¼éŸ³åˆ†è¯å™¨çš„å®‰è£…åŒ…ï¼š å®‰è£…æ–¹å¼ä¸IKåˆ†è¯å™¨ä¸€æ ·ï¼Œåˆ†ä¸‰æ­¥ï¼š â€‹ â‘ è§£å‹ â€‹ â‘¡ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œelasticsearchçš„pluginç›®å½• â€‹ â‘¢é‡å¯elasticsearch â€‹ â‘£æµ‹è¯• è¯¦ç»†å®‰è£…æ­¥éª¤å¯ä»¥å‚è€ƒIKåˆ†è¯å™¨çš„å®‰è£…è¿‡ç¨‹ã€‚ æµ‹è¯•ç”¨æ³•å¦‚ä¸‹ï¼š 12345POST /_analyze&#123; &quot;text&quot;: &quot;å¦‚å®¶é…’åº—è¿˜ä¸é”™&quot;, &quot;analyzer&quot;: &quot;pinyin&quot;&#125; ç»“æœï¼š 2.2.è‡ªå®šä¹‰åˆ†è¯å™¨é»˜è®¤çš„æ‹¼éŸ³åˆ†è¯å™¨ä¼šå°†æ¯ä¸ªæ±‰å­—å•ç‹¬åˆ†ä¸ºæ‹¼éŸ³ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯æ¯ä¸ªè¯æ¡å½¢æˆä¸€ç»„æ‹¼éŸ³ï¼Œéœ€è¦å¯¹æ‹¼éŸ³åˆ†è¯å™¨åšä¸ªæ€§åŒ–å®šåˆ¶ï¼Œå½¢æˆè‡ªå®šä¹‰åˆ†è¯å™¨ã€‚ elasticsearchä¸­åˆ†è¯å™¨ï¼ˆanalyzerï¼‰çš„ç»„æˆåŒ…å«ä¸‰éƒ¨åˆ†ï¼š character filtersï¼šåœ¨tokenizerä¹‹å‰å¯¹æ–‡æœ¬è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚åˆ é™¤å­—ç¬¦ã€æ›¿æ¢å­—ç¬¦ tokenizerï¼šå°†æ–‡æœ¬æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ‡å‰²æˆè¯æ¡ï¼ˆtermï¼‰ã€‚ä¾‹å¦‚keywordï¼Œå°±æ˜¯ä¸åˆ†è¯ï¼›è¿˜æœ‰ik_smart tokenizer filterï¼šå°†tokenizerè¾“å‡ºçš„è¯æ¡åšè¿›ä¸€æ­¥å¤„ç†ã€‚ä¾‹å¦‚å¤§å°å†™è½¬æ¢ã€åŒä¹‰è¯å¤„ç†ã€æ‹¼éŸ³å¤„ç†ç­‰ æ–‡æ¡£åˆ†è¯æ—¶ä¼šä¾æ¬¡ç”±è¿™ä¸‰éƒ¨åˆ†æ¥å¤„ç†æ–‡æ¡£ï¼š å£°æ˜è‡ªå®šä¹‰åˆ†è¯å™¨çš„è¯­æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233PUT /test&#123; &quot;settings&quot;: &#123; &quot;analysis&quot;: &#123; &quot;analyzer&quot;: &#123; // è‡ªå®šä¹‰åˆ†è¯å™¨ &quot;my_analyzer&quot;: &#123; // åˆ†è¯å™¨åç§° &quot;tokenizer&quot;: &quot;ik_max_word&quot;, &quot;filter&quot;: &quot;py&quot; &#125; &#125;, &quot;filter&quot;: &#123; // è‡ªå®šä¹‰tokenizer filter &quot;py&quot;: &#123; // è¿‡æ»¤å™¨åç§° &quot;type&quot;: &quot;pinyin&quot;, // è¿‡æ»¤å™¨ç±»å‹ï¼Œè¿™é‡Œæ˜¯pinyin &quot;keep_full_pinyin&quot;: false, &quot;keep_joined_full_pinyin&quot;: true, &quot;keep_original&quot;: true, &quot;limit_first_letter_length&quot;: 16, &quot;remove_duplicated_term&quot;: true, &quot;none_chinese_pinyin_tokenize&quot;: false &#125; &#125; &#125; &#125;, &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;name&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;my_analyzer&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125; &#125; &#125;&#125; æµ‹è¯•ï¼š æ€»ç»“ï¼š å¦‚ä½•ä½¿ç”¨æ‹¼éŸ³åˆ†è¯å™¨ï¼Ÿ â‘ ä¸‹è½½pinyinåˆ†è¯å™¨ â‘¡è§£å‹å¹¶æ”¾åˆ°elasticsearchçš„pluginç›®å½• â‘¢é‡å¯å³å¯ å¦‚ä½•è‡ªå®šä¹‰åˆ†è¯å™¨ï¼Ÿ â‘ åˆ›å»ºç´¢å¼•åº“æ—¶ï¼Œåœ¨settingsä¸­é…ç½®ï¼Œå¯ä»¥åŒ…å«ä¸‰éƒ¨åˆ† â‘¡character filter â‘¢tokenizer â‘£filter æ‹¼éŸ³åˆ†è¯å™¨æ³¨æ„äº‹é¡¹ï¼Ÿ ä¸ºäº†é¿å…æœç´¢åˆ°åŒéŸ³å­—ï¼Œæœç´¢æ—¶ä¸è¦ä½¿ç”¨æ‹¼éŸ³åˆ†è¯å™¨ 2.3.è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢elasticsearchæä¾›äº†Completion SuggesteræŸ¥è¯¢æ¥å®ç°è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚è¿™ä¸ªæŸ¥è¯¢ä¼šåŒ¹é…ä»¥ç”¨æˆ·è¾“å…¥å†…å®¹å¼€å¤´çš„è¯æ¡å¹¶è¿”å›ã€‚ä¸ºäº†æé«˜è¡¥å…¨æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå¯¹äºæ–‡æ¡£ä¸­å­—æ®µçš„ç±»å‹æœ‰ä¸€äº›çº¦æŸï¼š å‚ä¸è¡¥å…¨æŸ¥è¯¢çš„å­—æ®µå¿…é¡»æ˜¯completionç±»å‹ã€‚ å­—æ®µçš„å†…å®¹ä¸€èˆ¬æ˜¯ç”¨æ¥è¡¥å…¨çš„å¤šä¸ªè¯æ¡å½¢æˆçš„æ•°ç»„ã€‚ æ¯”å¦‚ï¼Œä¸€ä¸ªè¿™æ ·çš„ç´¢å¼•åº“ï¼š 1234567891011// åˆ›å»ºç´¢å¼•åº“PUT test&#123; &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;title&quot;:&#123; &quot;type&quot;: &quot;completion&quot; &#125; &#125; &#125;&#125; ç„¶åæ’å…¥ä¸‹é¢çš„æ•°æ®ï¼š 12345678910111213// ç¤ºä¾‹æ•°æ®POST test/_doc&#123; &quot;title&quot;: [&quot;Sony&quot;, &quot;WH-1000XM3&quot;]&#125;POST test/_doc&#123; &quot;title&quot;: [&quot;SK-II&quot;, &quot;PITERA&quot;]&#125;POST test/_doc&#123; &quot;title&quot;: [&quot;Nintendo&quot;, &quot;switch&quot;]&#125; æŸ¥è¯¢çš„DSLè¯­å¥å¦‚ä¸‹ï¼š 1234567891011121314// è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢GET /test/_search&#123; &quot;suggest&quot;: &#123; &quot;title_suggest&quot;: &#123; &quot;text&quot;: &quot;s&quot;, // å…³é”®å­— &quot;completion&quot;: &#123; &quot;field&quot;: &quot;title&quot;, // è¡¥å…¨æŸ¥è¯¢çš„å­—æ®µ &quot;skip_duplicates&quot;: true, // è·³è¿‡é‡å¤çš„ &quot;size&quot;: 10 // è·å–å‰10æ¡ç»“æœ &#125; &#125; &#125;&#125; 2.4.å®ç°é…’åº—æœç´¢æ¡†è‡ªåŠ¨è¡¥å…¨ç°åœ¨ï¼Œæˆ‘ä»¬çš„hotelç´¢å¼•åº“è¿˜æ²¡æœ‰è®¾ç½®æ‹¼éŸ³åˆ†è¯å™¨ï¼Œéœ€è¦ä¿®æ”¹ç´¢å¼•åº“ä¸­çš„é…ç½®ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ç´¢å¼•åº“æ˜¯æ— æ³•ä¿®æ”¹çš„ï¼Œåªèƒ½åˆ é™¤ç„¶åé‡æ–°åˆ›å»ºã€‚ å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥åšè‡ªåŠ¨è¡¥å…¨ï¼Œå°†brandã€suggestionã€cityç­‰éƒ½æ”¾è¿›å»ï¼Œä½œä¸ºè‡ªåŠ¨è¡¥å…¨çš„æç¤ºã€‚ å› æ­¤ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š ä¿®æ”¹hotelç´¢å¼•åº“ç»“æ„ï¼Œè®¾ç½®è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨ ä¿®æ”¹ç´¢å¼•åº“çš„nameã€allå­—æ®µï¼Œä½¿ç”¨è‡ªå®šä¹‰åˆ†è¯å™¨ ç´¢å¼•åº“æ·»åŠ ä¸€ä¸ªæ–°å­—æ®µsuggestionï¼Œç±»å‹ä¸ºcompletionç±»å‹ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„åˆ†è¯å™¨ ç»™HotelDocç±»æ·»åŠ suggestionå­—æ®µï¼Œå†…å®¹åŒ…å«brandã€business é‡æ–°å¯¼å…¥æ•°æ®åˆ°hotelåº“ 2.4.1.ä¿®æ”¹é…’åº—æ˜ å°„ç»“æ„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182// é…’åº—æ•°æ®ç´¢å¼•åº“PUT /hotel&#123; &quot;settings&quot;: &#123; &quot;analysis&quot;: &#123; &quot;analyzer&quot;: &#123; &quot;text_anlyzer&quot;: &#123; &quot;tokenizer&quot;: &quot;ik_max_word&quot;, &quot;filter&quot;: &quot;py&quot; &#125;, &quot;completion_analyzer&quot;: &#123; &quot;tokenizer&quot;: &quot;keyword&quot;, &quot;filter&quot;: &quot;py&quot; &#125; &#125;, &quot;filter&quot;: &#123; &quot;py&quot;: &#123; &quot;type&quot;: &quot;pinyin&quot;, &quot;keep_full_pinyin&quot;: false, &quot;keep_joined_full_pinyin&quot;: true, &quot;keep_original&quot;: true, &quot;limit_first_letter_length&quot;: 16, &quot;remove_duplicated_term&quot;: true, &quot;none_chinese_pinyin_tokenize&quot;: false &#125; &#125; &#125; &#125;, &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;id&quot;:&#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;name&quot;:&#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;text_anlyzer&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot;, &quot;copy_to&quot;: &quot;all&quot; &#125;, &quot;address&quot;:&#123; &quot;type&quot;: &quot;keyword&quot;, &quot;index&quot;: false &#125;, &quot;price&quot;:&#123; &quot;type&quot;: &quot;integer&quot; &#125;, &quot;score&quot;:&#123; &quot;type&quot;: &quot;integer&quot; &#125;, &quot;brand&quot;:&#123; &quot;type&quot;: &quot;keyword&quot;, &quot;copy_to&quot;: &quot;all&quot; &#125;, &quot;city&quot;:&#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;starName&quot;:&#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;business&quot;:&#123; &quot;type&quot;: &quot;keyword&quot;, &quot;copy_to&quot;: &quot;all&quot; &#125;, &quot;location&quot;:&#123; &quot;type&quot;: &quot;geo_point&quot; &#125;, &quot;pic&quot;:&#123; &quot;type&quot;: &quot;keyword&quot;, &quot;index&quot;: false &#125;, &quot;all&quot;:&#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;text_anlyzer&quot;, &quot;search_analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;suggestion&quot;:&#123; &quot;type&quot;: &quot;completion&quot;, &quot;analyzer&quot;: &quot;completion_analyzer&quot; &#125; &#125; &#125;&#125; 2.4.2.ä¿®æ”¹HotelDocå®ä½“HotelDocä¸­è¦æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥åšè‡ªåŠ¨è¡¥å…¨ï¼Œå†…å®¹å¯ä»¥æ˜¯é…’åº—å“ç‰Œã€åŸå¸‚ã€å•†åœˆç­‰ä¿¡æ¯ã€‚æŒ‰ç…§è‡ªåŠ¨è¡¥å…¨å­—æ®µçš„è¦æ±‚ï¼Œæœ€å¥½æ˜¯è¿™äº›å­—æ®µçš„æ•°ç»„ã€‚ å› æ­¤æˆ‘ä»¬åœ¨HotelDocä¸­æ·»åŠ ä¸€ä¸ªsuggestionå­—æ®µï¼Œç±»å‹ä¸ºList&lt;String&gt;ï¼Œç„¶åå°†brandã€cityã€businessç­‰ä¿¡æ¯æ”¾åˆ°é‡Œé¢ã€‚ ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package cn.itcast.hotel.pojo;import lombok.Data;import lombok.NoArgsConstructor;import java.util.ArrayList;import java.util.Arrays;import java.util.Collections;import java.util.List;@Data@NoArgsConstructorpublic class HotelDoc &#123; private Long id; private String name; private String address; private Integer price; private Integer score; private String brand; private String city; private String starName; private String business; private String location; private String pic; private Object distance; private Boolean isAD; private List&lt;String&gt; suggestion; public HotelDoc(Hotel hotel) &#123; this.id = hotel.getId(); this.name = hotel.getName(); this.address = hotel.getAddress(); this.price = hotel.getPrice(); this.score = hotel.getScore(); this.brand = hotel.getBrand(); this.city = hotel.getCity(); this.starName = hotel.getStarName(); this.business = hotel.getBusiness(); this.location = hotel.getLatitude() + &quot;, &quot; + hotel.getLongitude(); this.pic = hotel.getPic(); // ç»„è£…suggestion if(this.business.contains(&quot;/&quot;))&#123; // businessæœ‰å¤šä¸ªå€¼ï¼Œéœ€è¦åˆ‡å‰² String[] arr = this.business.split(&quot;/&quot;); // æ·»åŠ å…ƒç´  this.suggestion = new ArrayList&lt;&gt;(); this.suggestion.add(this.brand); Collections.addAll(this.suggestion, arr); &#125;else &#123; this.suggestion = Arrays.asList(this.brand, this.business); &#125; &#125;&#125; 2.4.3.é‡æ–°å¯¼å…¥é‡æ–°æ‰§è¡Œä¹‹å‰ç¼–å†™çš„å¯¼å…¥æ•°æ®åŠŸèƒ½ï¼Œå¯ä»¥çœ‹åˆ°æ–°çš„é…’åº—æ•°æ®ä¸­åŒ…å«äº†suggestionï¼š 2.4.4.è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢çš„JavaAPIä¹‹å‰æˆ‘ä»¬å­¦ä¹ äº†è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢çš„DSLï¼Œè€Œæ²¡æœ‰å­¦ä¹ å¯¹åº”çš„JavaAPIï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªç¤ºä¾‹ï¼š è€Œè‡ªåŠ¨è¡¥å…¨çš„ç»“æœä¹Ÿæ¯”è¾ƒç‰¹æ®Šï¼Œè§£æçš„ä»£ç å¦‚ä¸‹ï¼š 2.4.5.å®ç°æœç´¢æ¡†è‡ªåŠ¨è¡¥å…¨æŸ¥çœ‹å‰ç«¯é¡µé¢ï¼Œå¯ä»¥å‘ç°å½“æˆ‘ä»¬åœ¨è¾“å…¥æ¡†é”®å…¥æ—¶ï¼Œå‰ç«¯ä¼šå‘èµ·ajaxè¯·æ±‚ï¼š è¿”å›å€¼æ˜¯è¡¥å…¨è¯æ¡çš„é›†åˆï¼Œç±»å‹ä¸ºList&lt;String&gt; 1ï¼‰åœ¨cn.itcast.hotel.webåŒ…ä¸‹çš„HotelControllerä¸­æ·»åŠ æ–°æ¥å£ï¼Œæ¥æ”¶æ–°çš„è¯·æ±‚ï¼š 1234@GetMapping(&quot;suggestion&quot;)public List&lt;String&gt; getSuggestions(@RequestParam(&quot;key&quot;) String prefix) &#123; return hotelService.getSuggestions(prefix);&#125; 2ï¼‰åœ¨cn.itcast.hotel.serviceåŒ…ä¸‹çš„IhotelServiceä¸­æ·»åŠ æ–¹æ³•ï¼š 1List&lt;String&gt; getSuggestions(String prefix); 3ï¼‰åœ¨cn.itcast.hotel.service.impl.HotelServiceä¸­å®ç°è¯¥æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132@Overridepublic List&lt;String&gt; getSuggestions(String prefix) &#123; try &#123; // 1.å‡†å¤‡Request SearchRequest request = new SearchRequest(&quot;hotel&quot;); // 2.å‡†å¤‡DSL request.source().suggest(new SuggestBuilder().addSuggestion( &quot;suggestions&quot;, SuggestBuilders.completionSuggestion(&quot;suggestion&quot;) .prefix(prefix) .skipDuplicates(true) .size(10) )); // 3.å‘èµ·è¯·æ±‚ SearchResponse response = client.search(request, RequestOptions.DEFAULT); // 4.è§£æç»“æœ Suggest suggest = response.getSuggest(); // 4.1.æ ¹æ®è¡¥å…¨æŸ¥è¯¢åç§°ï¼Œè·å–è¡¥å…¨ç»“æœ CompletionSuggestion suggestions = suggest.getSuggestion(&quot;suggestions&quot;); // 4.2.è·å–options List&lt;CompletionSuggestion.Entry.Option&gt; options = suggestions.getOptions(); // 4.3.éå† List&lt;String&gt; list = new ArrayList&lt;&gt;(options.size()); for (CompletionSuggestion.Entry.Option option : options) &#123; String text = option.getText().toString(); list.add(text); &#125; return list; &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125;&#125;","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆåï¼‰-æ•°æ®èšåˆ","slug":"elk/elkï¼ˆåï¼‰-æ•°æ®èšåˆ","date":"2023-06-30T07:36:37.000Z","updated":"2023-06-30T07:44:56.584Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆåï¼‰-æ•°æ®èšåˆ/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E5%8D%81%EF%BC%89-%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%88/","excerpt":"","text":"1.æ•°æ®èšåˆ**èšåˆï¼ˆaggregationsï¼‰**å¯ä»¥è®©æˆ‘ä»¬æå…¶æ–¹ä¾¿çš„å®ç°å¯¹æ•°æ®çš„ç»Ÿè®¡ã€åˆ†æã€è¿ç®—ã€‚ä¾‹å¦‚ï¼š ä»€ä¹ˆå“ç‰Œçš„æ‰‹æœºæœ€å—æ¬¢è¿ï¼Ÿ è¿™äº›æ‰‹æœºçš„å¹³å‡ä»·æ ¼ã€æœ€é«˜ä»·æ ¼ã€æœ€ä½ä»·æ ¼ï¼Ÿ è¿™äº›æ‰‹æœºæ¯æœˆçš„é”€å”®æƒ…å†µå¦‚ä½•ï¼Ÿ å®ç°è¿™äº›ç»Ÿè®¡åŠŸèƒ½çš„æ¯”æ•°æ®åº“çš„sqlè¦æ–¹ä¾¿çš„å¤šï¼Œè€Œä¸”æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«ï¼Œå¯ä»¥å®ç°è¿‘å®æ—¶æœç´¢æ•ˆæœã€‚ 1.1.èšåˆçš„ç§ç±»èšåˆå¸¸è§çš„æœ‰ä¸‰ç±»ï¼š æ¡¶ï¼ˆBucketï¼‰èšåˆï¼šç”¨æ¥å¯¹æ–‡æ¡£åšåˆ†ç»„ TermAggregationï¼šæŒ‰ç…§æ–‡æ¡£å­—æ®µå€¼åˆ†ç»„ï¼Œä¾‹å¦‚æŒ‰ç…§å“ç‰Œå€¼åˆ†ç»„ã€æŒ‰ç…§å›½å®¶åˆ†ç»„ Date Histogramï¼šæŒ‰ç…§æ—¥æœŸé˜¶æ¢¯åˆ†ç»„ï¼Œä¾‹å¦‚ä¸€å‘¨ä¸ºä¸€ç»„ï¼Œæˆ–è€…ä¸€æœˆä¸ºä¸€ç»„ åº¦é‡ï¼ˆMetricï¼‰èšåˆï¼šç”¨ä»¥è®¡ç®—ä¸€äº›å€¼ï¼Œæ¯”å¦‚ï¼šæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ç­‰ Avgï¼šæ±‚å¹³å‡å€¼ Maxï¼šæ±‚æœ€å¤§å€¼ Minï¼šæ±‚æœ€å°å€¼ Statsï¼šåŒæ—¶æ±‚maxã€minã€avgã€sumç­‰ ç®¡é“ï¼ˆpipelineï¼‰èšåˆï¼šå…¶å®ƒèšåˆçš„ç»“æœä¸ºåŸºç¡€åšèšåˆ æ³¨æ„ï¼šå‚åŠ èšåˆçš„å­—æ®µå¿…é¡»æ˜¯keywordã€æ—¥æœŸã€æ•°å€¼ã€å¸ƒå°”ç±»å‹ 1.2.DSLå®ç°èšåˆç°åœ¨ï¼Œæˆ‘ä»¬è¦ç»Ÿè®¡æ‰€æœ‰æ•°æ®ä¸­çš„é…’åº—å“ç‰Œæœ‰å‡ ç§ï¼Œå…¶å®å°±æ˜¯æŒ‰ç…§å“ç‰Œå¯¹æ•°æ®åˆ†ç»„ã€‚æ­¤æ—¶å¯ä»¥æ ¹æ®é…’åº—å“ç‰Œçš„åç§°åšèšåˆï¼Œä¹Ÿå°±æ˜¯Bucketèšåˆã€‚ 1.2.1.Bucketèšåˆè¯­æ³•è¯­æ³•å¦‚ä¸‹ï¼š 123456789101112GET /hotel/_search&#123; &quot;size&quot;: 0, // è®¾ç½®sizeä¸º0ï¼Œç»“æœä¸­ä¸åŒ…å«æ–‡æ¡£ï¼ŒåªåŒ…å«èšåˆç»“æœ &quot;aggs&quot;: &#123; // å®šä¹‰èšåˆ &quot;brandAgg&quot;: &#123; //ç»™èšåˆèµ·ä¸ªåå­— &quot;terms&quot;: &#123; // èšåˆçš„ç±»å‹ï¼ŒæŒ‰ç…§å“ç‰Œå€¼èšåˆï¼Œæ‰€ä»¥é€‰æ‹©term &quot;field&quot;: &quot;brand&quot;, // å‚ä¸èšåˆçš„å­—æ®µ &quot;size&quot;: 20 // å¸Œæœ›è·å–çš„èšåˆç»“æœæ•°é‡ &#125; &#125; &#125;&#125; ç»“æœå¦‚å›¾ï¼š 1.2.2.èšåˆç»“æœæ’åºé»˜è®¤æƒ…å†µä¸‹ï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åºã€‚ æˆ‘ä»¬å¯ä»¥æŒ‡å®šorderå±æ€§ï¼Œè‡ªå®šä¹‰èšåˆçš„æ’åºæ–¹å¼ï¼š 123456789101112131415GET /hotel/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;brandAgg&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;brand&quot;, &quot;order&quot;: &#123; &quot;_count&quot;: &quot;asc&quot; // æŒ‰ç…§_countå‡åºæ’åˆ— &#125;, &quot;size&quot;: 20 &#125; &#125; &#125;&#125; 1.2.3.é™å®šèšåˆèŒƒå›´é»˜è®¤æƒ…å†µä¸‹ï¼ŒBucketèšåˆæ˜¯å¯¹ç´¢å¼•åº“çš„æ‰€æœ‰æ–‡æ¡£åšèšåˆï¼Œä½†çœŸå®åœºæ™¯ä¸‹ï¼Œç”¨æˆ·ä¼šè¾“å…¥æœç´¢æ¡ä»¶ï¼Œå› æ­¤èšåˆå¿…é¡»æ˜¯å¯¹æœç´¢ç»“æœèšåˆã€‚é‚£ä¹ˆèšåˆå¿…é¡»æ·»åŠ é™å®šæ¡ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥é™å®šè¦èšåˆçš„æ–‡æ¡£èŒƒå›´ï¼Œåªè¦æ·»åŠ queryæ¡ä»¶å³å¯ï¼š 12345678910111213141516171819GET /hotel/_search&#123; &quot;query&quot;: &#123; &quot;range&quot;: &#123; &quot;price&quot;: &#123; &quot;lte&quot;: 200 // åªå¯¹200å…ƒä»¥ä¸‹çš„æ–‡æ¡£èšåˆ &#125; &#125; &#125;, &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;brandAgg&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;brand&quot;, &quot;size&quot;: 20 &#125; &#125; &#125;&#125; è¿™æ¬¡ï¼Œèšåˆå¾—åˆ°çš„å“ç‰Œæ˜æ˜¾å˜å°‘äº†ï¼š 1.2.4.Metricèšåˆè¯­æ³•ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬å¯¹é…’åº—æŒ‰ç…§å“ç‰Œåˆ†ç»„ï¼Œå½¢æˆäº†ä¸€ä¸ªä¸ªæ¡¶ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å¯¹æ¡¶å†…çš„é…’åº—åšè¿ç®—ï¼Œè·å–æ¯ä¸ªå“ç‰Œçš„ç”¨æˆ·è¯„åˆ†çš„minã€maxã€avgç­‰å€¼ã€‚ è¿™å°±è¦ç”¨åˆ°Metricèšåˆäº†ï¼Œä¾‹å¦‚statèšåˆï¼šå°±å¯ä»¥è·å–minã€maxã€avgç­‰ç»“æœã€‚ è¯­æ³•å¦‚ä¸‹ï¼š 12345678910111213141516171819GET /hotel/_search&#123; &quot;size&quot;: 0, &quot;aggs&quot;: &#123; &quot;brandAgg&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;brand&quot;, &quot;size&quot;: 20 &#125;, &quot;aggs&quot;: &#123; // æ˜¯brandsèšåˆçš„å­èšåˆï¼Œä¹Ÿå°±æ˜¯åˆ†ç»„åå¯¹æ¯ç»„åˆ†åˆ«è®¡ç®— &quot;score_stats&quot;: &#123; // èšåˆåç§° &quot;stats&quot;: &#123; // èšåˆç±»å‹ï¼Œè¿™é‡Œstatså¯ä»¥è®¡ç®—minã€maxã€avgç­‰ &quot;field&quot;: &quot;score&quot; // èšåˆå­—æ®µï¼Œè¿™é‡Œæ˜¯score &#125; &#125; &#125; &#125; &#125;&#125; è¿™æ¬¡çš„score_statsèšåˆæ˜¯åœ¨brandAggçš„èšåˆå†…éƒ¨åµŒå¥—çš„å­èšåˆã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªæ¡¶åˆ†åˆ«è®¡ç®—ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»™èšåˆç»“æœåšä¸ªæ’åºï¼Œä¾‹å¦‚æŒ‰ç…§æ¯ä¸ªæ¡¶çš„é…’åº—å¹³å‡åˆ†åšæ’åºï¼š 1.2.5.å°ç»“aggsä»£è¡¨èšåˆï¼Œä¸queryåŒçº§ï¼Œæ­¤æ—¶queryçš„ä½œç”¨æ˜¯ï¼Ÿ é™å®šèšåˆçš„çš„æ–‡æ¡£èŒƒå›´ èšåˆå¿…é¡»çš„ä¸‰è¦ç´ ï¼š èšåˆåç§° èšåˆç±»å‹ èšåˆå­—æ®µ èšåˆå¯é…ç½®å±æ€§æœ‰ï¼š sizeï¼šæŒ‡å®šèšåˆç»“æœæ•°é‡ orderï¼šæŒ‡å®šèšåˆç»“æœæ’åºæ–¹å¼ fieldï¼šæŒ‡å®šèšåˆå­—æ®µ 1.3.RestAPIå®ç°èšåˆ1.3.1.APIè¯­æ³•èšåˆæ¡ä»¶ä¸queryæ¡ä»¶åŒçº§åˆ«ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨request.source()æ¥æŒ‡å®šèšåˆæ¡ä»¶ã€‚ èšåˆæ¡ä»¶çš„è¯­æ³•ï¼š èšåˆçš„ç»“æœä¹Ÿä¸æŸ¥è¯¢ç»“æœä¸åŒï¼ŒAPIä¹Ÿæ¯”è¾ƒç‰¹æ®Šã€‚ä¸è¿‡åŒæ ·æ˜¯JSONé€å±‚è§£æï¼š 1.3.2.ä¸šåŠ¡éœ€æ±‚éœ€æ±‚ï¼šæœç´¢é¡µé¢çš„å“ç‰Œã€åŸå¸‚ç­‰ä¿¡æ¯ä¸åº”è¯¥æ˜¯åœ¨é¡µé¢å†™æ­»ï¼Œè€Œæ˜¯é€šè¿‡èšåˆç´¢å¼•åº“ä¸­çš„é…’åº—æ•°æ®å¾—æ¥çš„ï¼š åˆ†æï¼š ç›®å‰ï¼Œé¡µé¢çš„åŸå¸‚åˆ—è¡¨ã€æ˜Ÿçº§åˆ—è¡¨ã€å“ç‰Œåˆ—è¡¨éƒ½æ˜¯å†™æ­»çš„ï¼Œå¹¶ä¸ä¼šéšç€æœç´¢ç»“æœçš„å˜åŒ–è€Œå˜åŒ–ã€‚ä½†æ˜¯ç”¨æˆ·æœç´¢æ¡ä»¶æ”¹å˜æ—¶ï¼Œæœç´¢ç»“æœä¼šè·Ÿç€å˜åŒ–ã€‚ ä¾‹å¦‚ï¼šç”¨æˆ·æœç´¢â€œä¸œæ–¹æ˜ç â€ï¼Œé‚£æœç´¢çš„é…’åº—è‚¯å®šæ˜¯åœ¨ä¸Šæµ·ä¸œæ–¹æ˜ç é™„è¿‘ï¼Œå› æ­¤ï¼ŒåŸå¸‚åªèƒ½æ˜¯ä¸Šæµ·ï¼Œæ­¤æ—¶åŸå¸‚åˆ—è¡¨ä¸­å°±ä¸åº”è¯¥æ˜¾ç¤ºåŒ—äº¬ã€æ·±åœ³ã€æ­å·è¿™äº›ä¿¡æ¯äº†ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæœç´¢ç»“æœä¸­åŒ…å«å“ªäº›åŸå¸‚ï¼Œé¡µé¢å°±åº”è¯¥åˆ—å‡ºå“ªäº›åŸå¸‚ï¼›æœç´¢ç»“æœä¸­åŒ…å«å“ªäº›å“ç‰Œï¼Œé¡µé¢å°±åº”è¯¥åˆ—å‡ºå“ªäº›å“ç‰Œã€‚ å¦‚ä½•å¾—çŸ¥æœç´¢ç»“æœä¸­åŒ…å«å“ªäº›å“ç‰Œï¼Ÿå¦‚ä½•å¾—çŸ¥æœç´¢ç»“æœä¸­åŒ…å«å“ªäº›åŸå¸‚ï¼Ÿ ä½¿ç”¨èšåˆåŠŸèƒ½ï¼Œåˆ©ç”¨Bucketèšåˆï¼Œå¯¹æœç´¢ç»“æœä¸­çš„æ–‡æ¡£åŸºäºå“ç‰Œåˆ†ç»„ã€åŸºäºåŸå¸‚åˆ†ç»„ï¼Œå°±èƒ½å¾—çŸ¥åŒ…å«å“ªäº›å“ç‰Œã€å“ªäº›åŸå¸‚äº†ã€‚ å› ä¸ºæ˜¯å¯¹æœç´¢ç»“æœèšåˆï¼Œå› æ­¤èšåˆæ˜¯é™å®šèŒƒå›´çš„èšåˆï¼Œä¹Ÿå°±æ˜¯è¯´èšåˆçš„é™å®šæ¡ä»¶è·Ÿæœç´¢æ–‡æ¡£çš„æ¡ä»¶ä¸€è‡´ã€‚ æŸ¥çœ‹æµè§ˆå™¨å¯ä»¥å‘ç°ï¼Œå‰ç«¯å…¶å®å·²ç»å‘å‡ºäº†è¿™æ ·çš„ä¸€ä¸ªè¯·æ±‚ï¼š è¯·æ±‚å‚æ•°ä¸æœç´¢æ–‡æ¡£çš„å‚æ•°å®Œå…¨ä¸€è‡´ã€‚ è¿”å›å€¼ç±»å‹å°±æ˜¯é¡µé¢è¦å±•ç¤ºçš„æœ€ç»ˆç»“æœï¼š ç»“æœæ˜¯ä¸€ä¸ªMapç»“æ„ï¼š keyæ˜¯å­—ç¬¦ä¸²ï¼ŒåŸå¸‚ã€æ˜Ÿçº§ã€å“ç‰Œã€ä»·æ ¼ valueæ˜¯é›†åˆï¼Œä¾‹å¦‚å¤šä¸ªåŸå¸‚çš„åç§° 1.3.3.ä¸šåŠ¡å®ç°åœ¨cn.itcast.hotel.webåŒ…çš„HotelControllerä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œéµå¾ªä¸‹é¢çš„è¦æ±‚ï¼š è¯·æ±‚æ–¹å¼ï¼šPOST è¯·æ±‚è·¯å¾„ï¼š/hotel/filters è¯·æ±‚å‚æ•°ï¼šRequestParamsï¼Œä¸æœç´¢æ–‡æ¡£çš„å‚æ•°ä¸€è‡´ è¿”å›å€¼ç±»å‹ï¼šMap&lt;String, List&lt;String&gt;&gt; ä»£ç ï¼š 1234@PostMapping(&quot;filters&quot;)public Map&lt;String, List&lt;String&gt;&gt; getFilters(@RequestBody RequestParams params)&#123; return hotelService.getFilters(params);&#125; è¿™é‡Œè°ƒç”¨äº†IHotelServiceä¸­çš„getFiltersæ–¹æ³•ï¼Œå°šæœªå®ç°ã€‚ åœ¨cn.itcast.hotel.service.IHotelServiceä¸­å®šä¹‰æ–°æ–¹æ³•ï¼š 1Map&lt;String, List&lt;String&gt;&gt; filters(RequestParams params); åœ¨cn.itcast.hotel.service.impl.HotelServiceä¸­å®ç°è¯¥æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465@Overridepublic Map&lt;String, List&lt;String&gt;&gt; filters(RequestParams params) &#123; try &#123; // 1.å‡†å¤‡Request SearchRequest request = new SearchRequest(&quot;hotel&quot;); // 2.å‡†å¤‡DSL // 2.1.query buildBasicQuery(params, request); // 2.2.è®¾ç½®size request.source().size(0); // 2.3.èšåˆ buildAggregation(request); // 3.å‘å‡ºè¯·æ±‚ SearchResponse response = client.search(request, RequestOptions.DEFAULT); // 4.è§£æç»“æœ Map&lt;String, List&lt;String&gt;&gt; result = new HashMap&lt;&gt;(); Aggregations aggregations = response.getAggregations(); // 4.1.æ ¹æ®å“ç‰Œåç§°ï¼Œè·å–å“ç‰Œç»“æœ List&lt;String&gt; brandList = getAggByName(aggregations, &quot;brandAgg&quot;); result.put(&quot;å“ç‰Œ&quot;, brandList); // 4.2.æ ¹æ®å“ç‰Œåç§°ï¼Œè·å–å“ç‰Œç»“æœ List&lt;String&gt; cityList = getAggByName(aggregations, &quot;cityAgg&quot;); result.put(&quot;åŸå¸‚&quot;, cityList); // 4.3.æ ¹æ®å“ç‰Œåç§°ï¼Œè·å–å“ç‰Œç»“æœ List&lt;String&gt; starList = getAggByName(aggregations, &quot;starAgg&quot;); result.put(&quot;æ˜Ÿçº§&quot;, starList); return result; &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125;&#125;private void buildAggregation(SearchRequest request) &#123; request.source().aggregation(AggregationBuilders .terms(&quot;brandAgg&quot;) .field(&quot;brand&quot;) .size(100) ); request.source().aggregation(AggregationBuilders .terms(&quot;cityAgg&quot;) .field(&quot;city&quot;) .size(100) ); request.source().aggregation(AggregationBuilders .terms(&quot;starAgg&quot;) .field(&quot;starName&quot;) .size(100) );&#125;private List&lt;String&gt; getAggByName(Aggregations aggregations, String aggName) &#123; // 4.1.æ ¹æ®èšåˆåç§°è·å–èšåˆç»“æœ Terms brandTerms = aggregations.get(aggName); // 4.2.è·å–buckets List&lt;? extends Terms.Bucket&gt; buckets = brandTerms.getBuckets(); // 4.3.éå† List&lt;String&gt; brandList = new ArrayList&lt;&gt;(); for (Terms.Bucket bucket : buckets) &#123; // 4.4.è·å–key String key = bucket.getKeyAsString(); brandList.add(key); &#125; return brandList;&#125;","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆä¹ï¼‰-æ—…æ¸¸æ¡ˆä¾‹","slug":"elk/elkï¼ˆä¹ï¼‰-æ—…æ¸¸æ¡ˆä¾‹","date":"2023-06-30T07:31:22.000Z","updated":"2023-06-30T07:33:18.242Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆä¹ï¼‰-æ—…æ¸¸æ¡ˆä¾‹/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E4%B9%9D%EF%BC%89-%E6%97%85%E6%B8%B8%E6%A1%88%E4%BE%8B/","excerpt":"","text":"4.é»‘é©¬æ—…æ¸¸æ¡ˆä¾‹ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡é»‘é©¬æ—…æ¸¸çš„æ¡ˆä¾‹æ¥å®æˆ˜æ¼”ç»ƒä¸‹ä¹‹å‰å­¦ä¹ çš„çŸ¥è¯†ã€‚ æˆ‘ä»¬å®ç°å››éƒ¨åˆ†åŠŸèƒ½ï¼š é…’åº—æœç´¢å’Œåˆ†é¡µ é…’åº—ç»“æœè¿‡æ»¤ æˆ‘å‘¨è¾¹çš„é…’åº— é…’åº—ç«ä»·æ’å å¯åŠ¨æˆ‘ä»¬æä¾›çš„hotel-demoé¡¹ç›®ï¼Œå…¶é»˜è®¤ç«¯å£æ˜¯8089ï¼Œè®¿é—®http://localhost:8090ï¼Œå°±èƒ½çœ‹åˆ°é¡¹ç›®é¡µé¢äº†ï¼š 4.1.é…’åº—æœç´¢å’Œåˆ†é¡µæ¡ˆä¾‹éœ€æ±‚ï¼šå®ç°é»‘é©¬æ—…æ¸¸çš„é…’åº—æœç´¢åŠŸèƒ½ï¼Œå®Œæˆå…³é”®å­—æœç´¢å’Œåˆ†é¡µ 4.1.1.éœ€æ±‚åˆ†æåœ¨é¡¹ç›®çš„é¦–é¡µï¼Œæœ‰ä¸€ä¸ªå¤§å¤§çš„æœç´¢æ¡†ï¼Œè¿˜æœ‰åˆ†é¡µæŒ‰é’®ï¼š ç‚¹å‡»æœç´¢æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ§åˆ¶å°å‘å‡ºäº†è¯·æ±‚ï¼š è¯·æ±‚å‚æ•°å¦‚ä¸‹ï¼š ç”±æ­¤å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬è¿™ä¸ªè¯·æ±‚çš„ä¿¡æ¯å¦‚ä¸‹ï¼š è¯·æ±‚æ–¹å¼ï¼šPOST è¯·æ±‚è·¯å¾„ï¼š&#x2F;hotel&#x2F;list è¯·æ±‚å‚æ•°ï¼šJSONå¯¹è±¡ï¼ŒåŒ…å«4ä¸ªå­—æ®µï¼š keyï¼šæœç´¢å…³é”®å­— pageï¼šé¡µç  sizeï¼šæ¯é¡µå¤§å° sortByï¼šæ’åºï¼Œç›®å‰æš‚ä¸å®ç° è¿”å›å€¼ï¼šåˆ†é¡µæŸ¥è¯¢ï¼Œéœ€è¦è¿”å›åˆ†é¡µç»“æœPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§ï¼š totalï¼šæ€»æ¡æ•° List&lt;HotelDoc&gt;ï¼šå½“å‰é¡µçš„æ•°æ® å› æ­¤ï¼Œæˆ‘ä»¬å®ç°ä¸šåŠ¡çš„æµç¨‹å¦‚ä¸‹ï¼š æ­¥éª¤ä¸€ï¼šå®šä¹‰å®ä½“ç±»ï¼Œæ¥æ”¶è¯·æ±‚å‚æ•°çš„JSONå¯¹è±¡ æ­¥éª¤äºŒï¼šç¼–å†™controllerï¼Œæ¥æ”¶é¡µé¢çš„è¯·æ±‚ æ­¥éª¤ä¸‰ï¼šç¼–å†™ä¸šåŠ¡å®ç°ï¼Œåˆ©ç”¨RestHighLevelClientå®ç°æœç´¢ã€åˆ†é¡µ 4.1.2.å®šä¹‰å®ä½“ç±»å®ä½“ç±»æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å‰ç«¯çš„è¯·æ±‚å‚æ•°å®ä½“ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡ç«¯åº”è¯¥è¿”å›çš„å“åº”ç»“æœå®ä½“ã€‚ 1ï¼‰è¯·æ±‚å‚æ•° å‰ç«¯è¯·æ±‚çš„jsonç»“æ„å¦‚ä¸‹ï¼š 123456&#123; &quot;key&quot;: &quot;æœç´¢å…³é”®å­—&quot;, &quot;page&quot;: 1, &quot;size&quot;: 3, &quot;sortBy&quot;: &quot;default&quot;&#125; å› æ­¤ï¼Œæˆ‘ä»¬åœ¨cn.itcast.hotel.pojoåŒ…ä¸‹å®šä¹‰ä¸€ä¸ªå®ä½“ç±»ï¼š 1234567891011package cn.itcast.hotel.pojo;import lombok.Data;@Datapublic class RequestParams &#123; private String key; private Integer page; private Integer size; private String sortBy;&#125; 2ï¼‰è¿”å›å€¼ åˆ†é¡µæŸ¥è¯¢ï¼Œéœ€è¦è¿”å›åˆ†é¡µç»“æœPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§ï¼š totalï¼šæ€»æ¡æ•° List&lt;HotelDoc&gt;ï¼šå½“å‰é¡µçš„æ•°æ® å› æ­¤ï¼Œæˆ‘ä»¬åœ¨cn.itcast.hotel.pojoä¸­å®šä¹‰è¿”å›ç»“æœï¼š 12345678910111213141516171819package cn.itcast.hotel.pojo;import lombok.Data;import java.util.List;@Datapublic class PageResult &#123; private Long total; private List&lt;HotelDoc&gt; hotels; public PageResult() &#123; &#125; public PageResult(Long total, List&lt;HotelDoc&gt; hotels) &#123; this.total = total; this.hotels = hotels; &#125;&#125; 4.1.3.å®šä¹‰controllerå®šä¹‰ä¸€ä¸ªHotelControllerï¼Œå£°æ˜æŸ¥è¯¢æ¥å£ï¼Œæ»¡è¶³ä¸‹åˆ—è¦æ±‚ï¼š è¯·æ±‚æ–¹å¼ï¼šPost è¯·æ±‚è·¯å¾„ï¼š&#x2F;hotel&#x2F;list è¯·æ±‚å‚æ•°ï¼šå¯¹è±¡ï¼Œç±»å‹ä¸ºRequestParam è¿”å›å€¼ï¼šPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§ Long totalï¼šæ€»æ¡æ•° List&lt;HotelDoc&gt; hotelsï¼šé…’åº—æ•°æ® å› æ­¤ï¼Œæˆ‘ä»¬åœ¨cn.itcast.hotel.webä¸­å®šä¹‰HotelControllerï¼š 123456789101112@RestController@RequestMapping(&quot;/hotel&quot;)public class HotelController &#123; @Autowired private IHotelService hotelService; // æœç´¢é…’åº—æ•°æ® @PostMapping(&quot;/list&quot;) public PageResult search(@RequestBody RequestParams params)&#123; return hotelService.search(params); &#125;&#125; 4.1.4.å®ç°æœç´¢ä¸šåŠ¡æˆ‘ä»¬åœ¨controllerè°ƒç”¨äº†IHotelServiceï¼Œå¹¶æ²¡æœ‰å®ç°è¯¥æ–¹æ³•ï¼Œå› æ­¤ä¸‹é¢æˆ‘ä»¬å°±åœ¨IHotelServiceä¸­å®šä¹‰æ–¹æ³•ï¼Œå¹¶ä¸”å»å®ç°ä¸šåŠ¡é€»è¾‘ã€‚ 1ï¼‰åœ¨cn.itcast.hotel.serviceä¸­çš„IHotelServiceæ¥å£ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼š 123456/** * æ ¹æ®å…³é”®å­—æœç´¢é…’åº—ä¿¡æ¯ * @param params è¯·æ±‚å‚æ•°å¯¹è±¡ï¼ŒåŒ…å«ç”¨æˆ·è¾“å…¥çš„å…³é”®å­— * @return é…’åº—æ–‡æ¡£åˆ—è¡¨ */PageResult search(RequestParams params); 2ï¼‰å®ç°æœç´¢ä¸šåŠ¡ï¼Œè‚¯å®šç¦»ä¸å¼€RestHighLevelClientï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒæ³¨å†Œåˆ°Springä¸­ä½œä¸ºä¸€ä¸ªBeanã€‚åœ¨cn.itcast.hotelä¸­çš„HotelDemoApplicationä¸­å£°æ˜è¿™ä¸ªBeanï¼š 123456@Beanpublic RestHighLevelClient client()&#123; return new RestHighLevelClient(RestClient.builder( HttpHost.create(&quot;http://192.168.150.101:9200&quot;) ));&#125; 3ï¼‰åœ¨cn.itcast.hotel.service.implä¸­çš„HotelServiceä¸­å®ç°searchæ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849@Overridepublic PageResult search(RequestParams params) &#123; try &#123; // 1.å‡†å¤‡Request SearchRequest request = new SearchRequest(&quot;hotel&quot;); // 2.å‡†å¤‡DSL // 2.1.query String key = params.getKey(); if (key == null || &quot;&quot;.equals(key)) &#123; boolQuery.must(QueryBuilders.matchAllQuery()); &#125; else &#123; boolQuery.must(QueryBuilders.matchQuery(&quot;all&quot;, key)); &#125; // 2.2.åˆ†é¡µ int page = params.getPage(); int size = params.getSize(); request.source().from((page - 1) * size).size(size); // 3.å‘é€è¯·æ±‚ SearchResponse response = client.search(request, RequestOptions.DEFAULT); // 4.è§£æå“åº” return handleResponse(response); &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125;&#125;// ç»“æœè§£æprivate PageResult handleResponse(SearchResponse response) &#123; // 4.è§£æå“åº” SearchHits searchHits = response.getHits(); // 4.1.è·å–æ€»æ¡æ•° long total = searchHits.getTotalHits().value; // 4.2.æ–‡æ¡£æ•°ç»„ SearchHit[] hits = searchHits.getHits(); // 4.3.éå† List&lt;HotelDoc&gt; hotels = new ArrayList&lt;&gt;(); for (SearchHit hit : hits) &#123; // è·å–æ–‡æ¡£source String json = hit.getSourceAsString(); // ååºåˆ—åŒ– HotelDoc hotelDoc = JSON.parseObject(json, HotelDoc.class); // æ”¾å…¥é›†åˆ hotels.add(hotelDoc); &#125; // 4.4.å°è£…è¿”å› return new PageResult(total, hotels);&#125; 4.2.é…’åº—ç»“æœè¿‡æ»¤éœ€æ±‚ï¼šæ·»åŠ å“ç‰Œã€åŸå¸‚ã€æ˜Ÿçº§ã€ä»·æ ¼ç­‰è¿‡æ»¤åŠŸèƒ½ 4.2.1.éœ€æ±‚åˆ†æåœ¨é¡µé¢æœç´¢æ¡†ä¸‹é¢ï¼Œä¼šæœ‰ä¸€äº›è¿‡æ»¤é¡¹ï¼š ä¼ é€’çš„å‚æ•°å¦‚å›¾ï¼š åŒ…å«çš„è¿‡æ»¤æ¡ä»¶æœ‰ï¼š brandï¼šå“ç‰Œå€¼ cityï¼šåŸå¸‚ minPrice~maxPriceï¼šä»·æ ¼èŒƒå›´ starNameï¼šæ˜Ÿçº§ æˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼š ä¿®æ”¹è¯·æ±‚å‚æ•°çš„å¯¹è±¡RequestParamsï¼Œæ¥æ”¶ä¸Šè¿°å‚æ•° ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨æœç´¢æ¡ä»¶ä¹‹å¤–ï¼Œæ·»åŠ ä¸€äº›è¿‡æ»¤æ¡ä»¶ 4.2.2.ä¿®æ”¹å®ä½“ç±»ä¿®æ”¹åœ¨cn.itcast.hotel.pojoåŒ…ä¸‹çš„å®ä½“ç±»RequestParamsï¼š 12345678910111213@Datapublic class RequestParams &#123; private String key; private Integer page; private Integer size; private String sortBy; // ä¸‹é¢æ˜¯æ–°å¢çš„è¿‡æ»¤æ¡ä»¶å‚æ•° private String city; private String brand; private String starName; private Integer minPrice; private Integer maxPrice;&#125; 4.2.3.ä¿®æ”¹æœç´¢ä¸šåŠ¡åœ¨HotelServiceçš„searchæ–¹æ³•ä¸­ï¼Œåªæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ï¼šrequet.source().query( â€¦ )å…¶ä¸­çš„æŸ¥è¯¢æ¡ä»¶ã€‚ åœ¨ä¹‹å‰çš„ä¸šåŠ¡ä¸­ï¼Œåªæœ‰matchæŸ¥è¯¢ï¼Œæ ¹æ®å…³é”®å­—æœç´¢ï¼Œç°åœ¨è¦æ·»åŠ æ¡ä»¶è¿‡æ»¤ï¼ŒåŒ…æ‹¬ï¼š å“ç‰Œè¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢ æ˜Ÿçº§è¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢ ä»·æ ¼è¿‡æ»¤ï¼šæ˜¯æ•°å€¼ç±»å‹ï¼Œç”¨rangeæŸ¥è¯¢ åŸå¸‚è¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢ å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ç»„åˆï¼Œè‚¯å®šæ˜¯booleanæŸ¥è¯¢æ¥ç»„åˆï¼š å…³é”®å­—æœç´¢æ”¾åˆ°mustä¸­ï¼Œå‚ä¸ç®—åˆ† å…¶å®ƒè¿‡æ»¤æ¡ä»¶æ”¾åˆ°filterä¸­ï¼Œä¸å‚ä¸ç®—åˆ† å› ä¸ºæ¡ä»¶æ„å»ºçš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå…ˆå°è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼š buildBasicQueryçš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233private void buildBasicQuery(RequestParams params, SearchRequest request) &#123; // 1.æ„å»ºBooleanQuery BoolQueryBuilder boolQuery = QueryBuilders.boolQuery(); // 2.å…³é”®å­—æœç´¢ String key = params.getKey(); if (key == null || &quot;&quot;.equals(key)) &#123; boolQuery.must(QueryBuilders.matchAllQuery()); &#125; else &#123; boolQuery.must(QueryBuilders.matchQuery(&quot;all&quot;, key)); &#125; // 3.åŸå¸‚æ¡ä»¶ if (params.getCity() != null &amp;&amp; !params.getCity().equals(&quot;&quot;)) &#123; boolQuery.filter(QueryBuilders.termQuery(&quot;city&quot;, params.getCity())); &#125; // 4.å“ç‰Œæ¡ä»¶ if (params.getBrand() != null &amp;&amp; !params.getBrand().equals(&quot;&quot;)) &#123; boolQuery.filter(QueryBuilders.termQuery(&quot;brand&quot;, params.getBrand())); &#125; // 5.æ˜Ÿçº§æ¡ä»¶ if (params.getStarName() != null &amp;&amp; !params.getStarName().equals(&quot;&quot;)) &#123; boolQuery.filter(QueryBuilders.termQuery(&quot;starName&quot;, params.getStarName())); &#125; // 6.ä»·æ ¼ if (params.getMinPrice() != null &amp;&amp; params.getMaxPrice() != null) &#123; boolQuery.filter(QueryBuilders .rangeQuery(&quot;price&quot;) .gte(params.getMinPrice()) .lte(params.getMaxPrice()) ); &#125; // 7.æ”¾å…¥source request.source().query(boolQuery);&#125; 4.3.æˆ‘å‘¨è¾¹çš„é…’åº—éœ€æ±‚ï¼šæˆ‘é™„è¿‘çš„é…’åº— 4.3.1.éœ€æ±‚åˆ†æåœ¨é…’åº—åˆ—è¡¨é¡µçš„å³ä¾§ï¼Œæœ‰ä¸€ä¸ªå°åœ°å›¾ï¼Œç‚¹å‡»åœ°å›¾çš„å®šä½æŒ‰é’®ï¼Œåœ°å›¾ä¼šæ‰¾åˆ°ä½ æ‰€åœ¨çš„ä½ç½®ï¼š å¹¶ä¸”ï¼Œåœ¨å‰ç«¯ä¼šå‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œå°†ä½ çš„åæ ‡å‘é€åˆ°æœåŠ¡ç«¯ï¼š æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯åŸºäºè¿™ä¸ªlocationåæ ‡ï¼Œç„¶åæŒ‰ç…§è·ç¦»å¯¹å‘¨å›´é…’åº—æ’åºã€‚å®ç°æ€è·¯å¦‚ä¸‹ï¼š ä¿®æ”¹RequestParamså‚æ•°ï¼Œæ¥æ”¶locationå­—æ®µ ä¿®æ”¹searchæ–¹æ³•ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœlocationæœ‰å€¼ï¼Œæ·»åŠ æ ¹æ®geo_distanceæ’åºçš„åŠŸèƒ½ 4.3.2.ä¿®æ”¹å®ä½“ç±»ä¿®æ”¹åœ¨cn.itcast.hotel.pojoåŒ…ä¸‹çš„å®ä½“ç±»RequestParamsï¼š 12345678910111213141516171819package cn.itcast.hotel.pojo;import lombok.Data;@Datapublic class RequestParams &#123; private String key; private Integer page; private Integer size; private String sortBy; private String city; private String brand; private String starName; private Integer minPrice; private Integer maxPrice; // æˆ‘å½“å‰çš„åœ°ç†åæ ‡ private String location;&#125; 4.3.3.è·ç¦»æ’åºAPIæˆ‘ä»¬ä»¥å‰å­¦ä¹ è¿‡æ’åºåŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼š æ™®é€šå­—æ®µæ’åº åœ°ç†åæ ‡æ’åº æˆ‘ä»¬åªè®²äº†æ™®é€šå­—æ®µæ’åºå¯¹åº”çš„javaå†™æ³•ã€‚åœ°ç†åæ ‡æ’åºåªå­¦è¿‡DSLè¯­æ³•ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;, &quot;sort&quot;: [ &#123; &quot;price&quot;: &quot;asc&quot; &#125;, &#123; &quot;_geo_distance&quot; : &#123; &quot;FIELD&quot; : &quot;çº¬åº¦ï¼Œç»åº¦&quot;, &quot;order&quot; : &quot;asc&quot;, &quot;unit&quot; : &quot;km&quot; &#125; &#125; ]&#125; å¯¹åº”çš„javaä»£ç ç¤ºä¾‹ï¼š 4.3.4.æ·»åŠ è·ç¦»æ’åºåœ¨cn.itcast.hotel.service.implçš„HotelServiceçš„searchæ–¹æ³•ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ’åºåŠŸèƒ½ï¼š å®Œæ•´ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132@Overridepublic PageResult search(RequestParams params) &#123; try &#123; // 1.å‡†å¤‡Request SearchRequest request = new SearchRequest(&quot;hotel&quot;); // 2.å‡†å¤‡DSL // 2.1.query buildBasicQuery(params, request); // 2.2.åˆ†é¡µ int page = params.getPage(); int size = params.getSize(); request.source().from((page - 1) * size).size(size); // 2.3.æ’åº String location = params.getLocation(); if (location != null &amp;&amp; !location.equals(&quot;&quot;)) &#123; request.source().sort(SortBuilders .geoDistanceSort(&quot;location&quot;, new GeoPoint(location)) .order(SortOrder.ASC) .unit(DistanceUnit.KILOMETERS) ); &#125; // 3.å‘é€è¯·æ±‚ SearchResponse response = client.search(request, RequestOptions.DEFAULT); // 4.è§£æå“åº” return handleResponse(response); &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125;&#125; 4.3.5.æ’åºè·ç¦»æ˜¾ç¤ºé‡å¯æœåŠ¡åï¼Œæµ‹è¯•æˆ‘çš„é…’åº—åŠŸèƒ½ï¼š å‘ç°ç¡®å®å¯ä»¥å®ç°å¯¹æˆ‘é™„è¿‘é…’åº—çš„æ’åºï¼Œä¸è¿‡å¹¶æ²¡æœ‰çœ‹åˆ°é…’åº—åˆ°åº•è·ç¦»æˆ‘å¤šè¿œï¼Œè¿™è¯¥æ€ä¹ˆåŠï¼Ÿ æ’åºå®Œæˆåï¼Œé¡µé¢è¿˜è¦è·å–æˆ‘é™„è¿‘æ¯ä¸ªé…’åº—çš„å…·ä½“è·ç¦»å€¼ï¼Œè¿™ä¸ªå€¼åœ¨å“åº”ç»“æœä¸­æ˜¯ç‹¬ç«‹çš„ï¼š å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç»“æœè§£æé˜¶æ®µï¼Œé™¤äº†è§£æsourceéƒ¨åˆ†ä»¥å¤–ï¼Œè¿˜è¦å¾—åˆ°sortéƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æ’åºçš„è·ç¦»ï¼Œç„¶åæ”¾åˆ°å“åº”ç»“æœä¸­ã€‚ æˆ‘ä»¬è¦åšä¸¤ä»¶äº‹ï¼š ä¿®æ”¹HotelDocï¼Œæ·»åŠ æ’åºè·ç¦»å­—æ®µï¼Œç”¨äºé¡µé¢æ˜¾ç¤º ä¿®æ”¹HotelServiceç±»ä¸­çš„handleResponseæ–¹æ³•ï¼Œæ·»åŠ å¯¹sortå€¼çš„è·å– 1ï¼‰ä¿®æ”¹HotelDocç±»ï¼Œæ·»åŠ è·ç¦»å­—æ®µ 1234567891011121314151617181920212223242526272829303132333435363738package cn.itcast.hotel.pojo;import lombok.Data;import lombok.NoArgsConstructor;@Data@NoArgsConstructorpublic class HotelDoc &#123; private Long id; private String name; private String address; private Integer price; private Integer score; private String brand; private String city; private String starName; private String business; private String location; private String pic; // æ’åºæ—¶çš„ è·ç¦»å€¼ private Object distance; public HotelDoc(Hotel hotel) &#123; this.id = hotel.getId(); this.name = hotel.getName(); this.address = hotel.getAddress(); this.price = hotel.getPrice(); this.score = hotel.getScore(); this.brand = hotel.getBrand(); this.city = hotel.getCity(); this.starName = hotel.getStarName(); this.business = hotel.getBusiness(); this.location = hotel.getLatitude() + &quot;, &quot; + hotel.getLongitude(); this.pic = hotel.getPic(); &#125;&#125; 2ï¼‰ä¿®æ”¹HotelServiceä¸­çš„handleResponseæ–¹æ³• é‡å¯åæµ‹è¯•ï¼Œå‘ç°é¡µé¢èƒ½æˆåŠŸæ˜¾ç¤ºè·ç¦»äº†ï¼š 4.4.é…’åº—ç«ä»·æ’åéœ€æ±‚ï¼šè®©æŒ‡å®šçš„é…’åº—åœ¨æœç´¢ç»“æœä¸­æ’åç½®é¡¶ 4.4.1.éœ€æ±‚åˆ†æè¦è®©æŒ‡å®šé…’åº—åœ¨æœç´¢ç»“æœä¸­æ’åç½®é¡¶ï¼Œæ•ˆæœå¦‚å›¾ï¼š é¡µé¢ä¼šç»™æŒ‡å®šçš„é…’åº—æ·»åŠ å¹¿å‘Šæ ‡è®°ã€‚ é‚£æ€æ ·æ‰èƒ½è®©æŒ‡å®šçš„é…’åº—æ’åç½®é¡¶å‘¢ï¼Ÿ æˆ‘ä»¬ä¹‹å‰å­¦ä¹ è¿‡çš„function_scoreæŸ¥è¯¢å¯ä»¥å½±å“ç®—åˆ†ï¼Œç®—åˆ†é«˜äº†ï¼Œè‡ªç„¶æ’åä¹Ÿå°±é«˜äº†ã€‚è€Œfunction_scoreåŒ…å«3ä¸ªè¦ç´ ï¼š è¿‡æ»¤æ¡ä»¶ï¼šå“ªäº›æ–‡æ¡£è¦åŠ åˆ† ç®—åˆ†å‡½æ•°ï¼šå¦‚ä½•è®¡ç®—function score åŠ æƒæ–¹å¼ï¼šfunction score ä¸ query scoreå¦‚ä½•è¿ç®— è¿™é‡Œçš„éœ€æ±‚æ˜¯ï¼šè®©æŒ‡å®šé…’åº—æ’åé å‰ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ç»™è¿™äº›é…’åº—æ·»åŠ ä¸€ä¸ªæ ‡è®°ï¼Œè¿™æ ·åœ¨è¿‡æ»¤æ¡ä»¶ä¸­å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ ‡è®°æ¥åˆ¤æ–­ï¼Œæ˜¯å¦è¦æé«˜ç®—åˆ†ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»™é…’åº—æ·»åŠ ä¸€ä¸ªå­—æ®µï¼šisADï¼ŒBooleanç±»å‹ï¼š trueï¼šæ˜¯å¹¿å‘Š falseï¼šä¸æ˜¯å¹¿å‘Š è¿™æ ·function_scoreåŒ…å«3ä¸ªè¦ç´ å°±å¾ˆå¥½ç¡®å®šäº†ï¼š è¿‡æ»¤æ¡ä»¶ï¼šåˆ¤æ–­isAD æ˜¯å¦ä¸ºtrue ç®—åˆ†å‡½æ•°ï¼šæˆ‘ä»¬å¯ä»¥ç”¨æœ€ç®€å•æš´åŠ›çš„weightï¼Œå›ºå®šåŠ æƒå€¼ åŠ æƒæ–¹å¼ï¼šå¯ä»¥ç”¨é»˜è®¤çš„ç›¸ä¹˜ï¼Œå¤§å¤§æé«˜ç®—åˆ† å› æ­¤ï¼Œä¸šåŠ¡çš„å®ç°æ­¥éª¤åŒ…æ‹¬ï¼š ç»™HotelDocç±»æ·»åŠ isADå­—æ®µï¼ŒBooleanç±»å‹ æŒ‘é€‰å‡ ä¸ªä½ å–œæ¬¢çš„é…’åº—ï¼Œç»™å®ƒçš„æ–‡æ¡£æ•°æ®æ·»åŠ isADå­—æ®µï¼Œå€¼ä¸ºtrue ä¿®æ”¹searchæ–¹æ³•ï¼Œæ·»åŠ function scoreåŠŸèƒ½ï¼Œç»™isADå€¼ä¸ºtrueçš„é…’åº—å¢åŠ æƒé‡ 4.4.2.ä¿®æ”¹HotelDocå®ä½“ç»™cn.itcast.hotel.pojoåŒ…ä¸‹çš„HotelDocç±»æ·»åŠ isADå­—æ®µï¼š 4.4.3.æ·»åŠ å¹¿å‘Šæ ‡è®°æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‘å‡ ä¸ªé…’åº—ï¼Œæ·»åŠ isADå­—æ®µï¼Œè®¾ç½®ä¸ºtrueï¼š 123456789101112131415161718192021222324POST /hotel/_update/1902197537&#123; &quot;doc&quot;: &#123; &quot;isAD&quot;: true &#125;&#125;POST /hotel/_update/2056126831&#123; &quot;doc&quot;: &#123; &quot;isAD&quot;: true &#125;&#125;POST /hotel/_update/1989806195&#123; &quot;doc&quot;: &#123; &quot;isAD&quot;: true &#125;&#125;POST /hotel/_update/2056105938&#123; &quot;doc&quot;: &#123; &quot;isAD&quot;: true &#125;&#125; 4.4.4.æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦ä¿®æ”¹æŸ¥è¯¢æ¡ä»¶äº†ã€‚ä¹‹å‰æ˜¯ç”¨çš„boolean æŸ¥è¯¢ï¼Œç°åœ¨è¦æ”¹æˆfunction_socreæŸ¥è¯¢ã€‚ function_scoreæŸ¥è¯¢ç»“æ„å¦‚ä¸‹ï¼š å¯¹åº”çš„JavaAPIå¦‚ä¸‹ï¼š æˆ‘ä»¬å¯ä»¥å°†ä¹‹å‰å†™çš„booleanæŸ¥è¯¢ä½œä¸ºåŸå§‹æŸ¥è¯¢æ¡ä»¶æ”¾åˆ°queryä¸­ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ·»åŠ è¿‡æ»¤æ¡ä»¶ã€ç®—åˆ†å‡½æ•°ã€åŠ æƒæ¨¡å¼äº†ã€‚æ‰€ä»¥åŸæ¥çš„ä»£ç ä¾ç„¶å¯ä»¥æ²¿ç”¨ã€‚ ä¿®æ”¹cn.itcast.hotel.service.implåŒ…ä¸‹çš„HotelServiceç±»ä¸­çš„buildBasicQueryæ–¹æ³•ï¼Œæ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748private void buildBasicQuery(RequestParams params, SearchRequest request) &#123; // 1.æ„å»ºBooleanQuery BoolQueryBuilder boolQuery = QueryBuilders.boolQuery(); // å…³é”®å­—æœç´¢ String key = params.getKey(); if (key == null || &quot;&quot;.equals(key)) &#123; boolQuery.must(QueryBuilders.matchAllQuery()); &#125; else &#123; boolQuery.must(QueryBuilders.matchQuery(&quot;all&quot;, key)); &#125; // åŸå¸‚æ¡ä»¶ if (params.getCity() != null &amp;&amp; !params.getCity().equals(&quot;&quot;)) &#123; boolQuery.filter(QueryBuilders.termQuery(&quot;city&quot;, params.getCity())); &#125; // å“ç‰Œæ¡ä»¶ if (params.getBrand() != null &amp;&amp; !params.getBrand().equals(&quot;&quot;)) &#123; boolQuery.filter(QueryBuilders.termQuery(&quot;brand&quot;, params.getBrand())); &#125; // æ˜Ÿçº§æ¡ä»¶ if (params.getStarName() != null &amp;&amp; !params.getStarName().equals(&quot;&quot;)) &#123; boolQuery.filter(QueryBuilders.termQuery(&quot;starName&quot;, params.getStarName())); &#125; // ä»·æ ¼ if (params.getMinPrice() != null &amp;&amp; params.getMaxPrice() != null) &#123; boolQuery.filter(QueryBuilders .rangeQuery(&quot;price&quot;) .gte(params.getMinPrice()) .lte(params.getMaxPrice()) ); &#125; // 2.ç®—åˆ†æ§åˆ¶ FunctionScoreQueryBuilder functionScoreQuery = QueryBuilders.functionScoreQuery( // åŸå§‹æŸ¥è¯¢ï¼Œç›¸å…³æ€§ç®—åˆ†çš„æŸ¥è¯¢ boolQuery, // function scoreçš„æ•°ç»„ new FunctionScoreQueryBuilder.FilterFunctionBuilder[]&#123; // å…¶ä¸­çš„ä¸€ä¸ªfunction score å…ƒç´  new FunctionScoreQueryBuilder.FilterFunctionBuilder( // è¿‡æ»¤æ¡ä»¶ QueryBuilders.termQuery(&quot;isAD&quot;, true), // ç®—åˆ†å‡½æ•° ScoreFunctionBuilders.weightFactorFunction(10) ) &#125;); request.source().query(functionScoreQuery);&#125;","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆå…«ï¼‰-RestClentæŸ¥è¯¢æ–‡æ¡£","slug":"elk/elkï¼ˆå…«ï¼‰-RestClentæŸ¥è¯¢æ–‡æ¡£","date":"2023-06-30T07:29:13.000Z","updated":"2023-06-30T07:32:42.151Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆå…«ï¼‰-RestClentæŸ¥è¯¢æ–‡æ¡£/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E5%85%AB%EF%BC%89-RestClent%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3/","excerpt":"","text":"3.RestClientæŸ¥è¯¢ æ–‡æ¡£æ–‡æ¡£çš„æŸ¥è¯¢åŒæ ·é€‚ç”¨æ˜¨å¤©å­¦ä¹ çš„ RestHighLevelClientå¯¹è±¡ï¼ŒåŸºæœ¬æ­¥éª¤åŒ…æ‹¬ï¼š 1ï¼‰å‡†å¤‡Requestå¯¹è±¡ 2ï¼‰å‡†å¤‡è¯·æ±‚å‚æ•° 3ï¼‰å‘èµ·è¯·æ±‚ 4ï¼‰è§£æå“åº” 3.1.å¿«é€Ÿå…¥é—¨æˆ‘ä»¬ä»¥match_allæŸ¥è¯¢ä¸ºä¾‹ 3.1.1.å‘èµ·æŸ¥è¯¢è¯·æ±‚ ä»£ç è§£è¯»ï¼š ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºSearchRequestå¯¹è±¡ï¼ŒæŒ‡å®šç´¢å¼•åº“å ç¬¬äºŒæ­¥ï¼Œåˆ©ç”¨request.source()æ„å»ºDSLï¼ŒDSLä¸­å¯ä»¥åŒ…å«æŸ¥è¯¢ã€åˆ†é¡µã€æ’åºã€é«˜äº®ç­‰ query()ï¼šä»£è¡¨æŸ¥è¯¢æ¡ä»¶ï¼Œåˆ©ç”¨QueryBuilders.matchAllQuery()æ„å»ºä¸€ä¸ªmatch_allæŸ¥è¯¢çš„DSL ç¬¬ä¸‰æ­¥ï¼Œåˆ©ç”¨client.search()å‘é€è¯·æ±‚ï¼Œå¾—åˆ°å“åº” è¿™é‡Œå…³é”®çš„APIæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯request.source()ï¼Œå…¶ä¸­åŒ…å«äº†æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€é«˜äº®ç­‰æ‰€æœ‰åŠŸèƒ½ï¼š å¦ä¸€ä¸ªæ˜¯QueryBuildersï¼Œå…¶ä¸­åŒ…å«matchã€termã€function_scoreã€boolç­‰å„ç§æŸ¥è¯¢ï¼š 3.1.2.è§£æå“åº”å“åº”ç»“æœçš„è§£æï¼š elasticsearchè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œç»“æ„åŒ…å«ï¼š hitsï¼šå‘½ä¸­çš„ç»“æœ totalï¼šæ€»æ¡æ•°ï¼Œå…¶ä¸­çš„valueæ˜¯å…·ä½“çš„æ€»æ¡æ•°å€¼ max_scoreï¼šæ‰€æœ‰ç»“æœä¸­å¾—åˆ†æœ€é«˜çš„æ–‡æ¡£çš„ç›¸å…³æ€§ç®—åˆ† hitsï¼šæœç´¢ç»“æœçš„æ–‡æ¡£æ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯ä¸€ä¸ªjsonå¯¹è±¡ _sourceï¼šæ–‡æ¡£ä¸­çš„åŸå§‹æ•°æ®ï¼Œä¹Ÿæ˜¯jsonå¯¹è±¡ å› æ­¤ï¼Œæˆ‘ä»¬è§£æå“åº”ç»“æœï¼Œå°±æ˜¯é€å±‚è§£æJSONå­—ç¬¦ä¸²ï¼Œæµç¨‹å¦‚ä¸‹ï¼š SearchHitsï¼šé€šè¿‡response.getHits()è·å–ï¼Œå°±æ˜¯JSONä¸­çš„æœ€å¤–å±‚çš„hitsï¼Œä»£è¡¨å‘½ä¸­çš„ç»“æœ SearchHits#getTotalHits().valueï¼šè·å–æ€»æ¡æ•°ä¿¡æ¯ SearchHits#getHits()ï¼šè·å–SearchHitæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æ–‡æ¡£æ•°ç»„ SearchHit#getSourceAsString()ï¼šè·å–æ–‡æ¡£ç»“æœä¸­çš„_sourceï¼Œä¹Ÿå°±æ˜¯åŸå§‹çš„jsonæ–‡æ¡£æ•°æ® 3.1.3.å®Œæ•´ä»£ç å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031@Testvoid testMatchAll() throws IOException &#123; // 1.å‡†å¤‡Request SearchRequest request = new SearchRequest(&quot;hotel&quot;); // 2.å‡†å¤‡DSL request.source() .query(QueryBuilders.matchAllQuery()); // 3.å‘é€è¯·æ±‚ SearchResponse response = client.search(request, RequestOptions.DEFAULT); // 4.è§£æå“åº” handleResponse(response);&#125;private void handleResponse(SearchResponse response) &#123; // 4.è§£æå“åº” SearchHits searchHits = response.getHits(); // 4.1.è·å–æ€»æ¡æ•° long total = searchHits.getTotalHits().value; System.out.println(&quot;å…±æœç´¢åˆ°&quot; + total + &quot;æ¡æ•°æ®&quot;); // 4.2.æ–‡æ¡£æ•°ç»„ SearchHit[] hits = searchHits.getHits(); // 4.3.éå† for (SearchHit hit : hits) &#123; // è·å–æ–‡æ¡£source String json = hit.getSourceAsString(); // ååºåˆ—åŒ– HotelDoc hotelDoc = JSON.parseObject(json, HotelDoc.class); System.out.println(&quot;hotelDoc = &quot; + hotelDoc); &#125;&#125; 3.1.4.å°ç»“æŸ¥è¯¢çš„åŸºæœ¬æ­¥éª¤æ˜¯ï¼š åˆ›å»ºSearchRequestå¯¹è±¡ å‡†å¤‡Request.source()ï¼Œä¹Ÿå°±æ˜¯DSLã€‚ â‘  QueryBuildersæ¥æ„å»ºæŸ¥è¯¢æ¡ä»¶ â‘¡ ä¼ å…¥Request.source() çš„ query() æ–¹æ³• å‘é€è¯·æ±‚ï¼Œå¾—åˆ°ç»“æœ è§£æç»“æœï¼ˆå‚è€ƒJSONç»“æœï¼Œä»å¤–åˆ°å†…ï¼Œé€å±‚è§£æï¼‰ 3.2.matchæŸ¥è¯¢å…¨æ–‡æ£€ç´¢çš„matchå’Œmulti_matchæŸ¥è¯¢ä¸match_allçš„APIåŸºæœ¬ä¸€è‡´ã€‚å·®åˆ«æ˜¯æŸ¥è¯¢æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯queryçš„éƒ¨åˆ†ã€‚ å› æ­¤ï¼ŒJavaä»£ç ä¸Šçš„å·®å¼‚ä¸»è¦æ˜¯request.source().query()ä¸­çš„å‚æ•°äº†ã€‚åŒæ ·æ˜¯åˆ©ç”¨QueryBuildersæä¾›çš„æ–¹æ³•ï¼š è€Œç»“æœè§£æä»£ç åˆ™å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥æŠ½å–å¹¶å…±äº«ã€‚ å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 12345678910111213@Testvoid testMatch() throws IOException &#123; // 1.å‡†å¤‡Request SearchRequest request = new SearchRequest(&quot;hotel&quot;); // 2.å‡†å¤‡DSL request.source() .query(QueryBuilders.matchQuery(&quot;all&quot;, &quot;å¦‚å®¶&quot;)); // 3.å‘é€è¯·æ±‚ SearchResponse response = client.search(request, RequestOptions.DEFAULT); // 4.è§£æå“åº” handleResponse(response);&#125; 3.3.ç²¾ç¡®æŸ¥è¯¢ç²¾ç¡®æŸ¥è¯¢ä¸»è¦æ˜¯ä¸¤è€…ï¼š termï¼šè¯æ¡ç²¾ç¡®åŒ¹é… rangeï¼šèŒƒå›´æŸ¥è¯¢ ä¸ä¹‹å‰çš„æŸ¥è¯¢ç›¸æ¯”ï¼Œå·®å¼‚åŒæ ·åœ¨æŸ¥è¯¢æ¡ä»¶ï¼Œå…¶å®ƒéƒ½ä¸€æ ·ã€‚ æŸ¥è¯¢æ¡ä»¶æ„é€ çš„APIå¦‚ä¸‹ï¼š 3.4.å¸ƒå°”æŸ¥è¯¢å¸ƒå°”æŸ¥è¯¢æ˜¯ç”¨mustã€must_notã€filterç­‰æ–¹å¼ç»„åˆå…¶å®ƒæŸ¥è¯¢ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼ŒAPIä¸å…¶å®ƒæŸ¥è¯¢çš„å·®åˆ«åŒæ ·æ˜¯åœ¨æŸ¥è¯¢æ¡ä»¶çš„æ„å»ºï¼ŒQueryBuildersï¼Œç»“æœè§£æç­‰å…¶ä»–ä»£ç å®Œå…¨ä¸å˜ã€‚ å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819@Testvoid testBool() throws IOException &#123; // 1.å‡†å¤‡Request SearchRequest request = new SearchRequest(&quot;hotel&quot;); // 2.å‡†å¤‡DSL // 2.1.å‡†å¤‡BooleanQuery BoolQueryBuilder boolQuery = QueryBuilders.boolQuery(); // 2.2.æ·»åŠ term boolQuery.must(QueryBuilders.termQuery(&quot;city&quot;, &quot;æ­å·&quot;)); // 2.3.æ·»åŠ range boolQuery.filter(QueryBuilders.rangeQuery(&quot;price&quot;).lte(250)); request.source().query(boolQuery); // 3.å‘é€è¯·æ±‚ SearchResponse response = client.search(request, RequestOptions.DEFAULT); // 4.è§£æå“åº” handleResponse(response);&#125; 3.5.æ’åºã€åˆ†é¡µæœç´¢ç»“æœçš„æ’åºå’Œåˆ†é¡µæ˜¯ä¸queryåŒçº§çš„å‚æ•°ï¼Œå› æ­¤åŒæ ·æ˜¯ä½¿ç”¨request.source()æ¥è®¾ç½®ã€‚ å¯¹åº”çš„APIå¦‚ä¸‹ï¼š å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š 1234567891011121314151617181920@Testvoid testPageAndSort() throws IOException &#123; // é¡µç ï¼Œæ¯é¡µå¤§å° int page = 1, size = 5; // 1.å‡†å¤‡Request SearchRequest request = new SearchRequest(&quot;hotel&quot;); // 2.å‡†å¤‡DSL // 2.1.query request.source().query(QueryBuilders.matchAllQuery()); // 2.2.æ’åº sort request.source().sort(&quot;price&quot;, SortOrder.ASC); // 2.3.åˆ†é¡µ fromã€size request.source().from((page - 1) * size).size(5); // 3.å‘é€è¯·æ±‚ SearchResponse response = client.search(request, RequestOptions.DEFAULT); // 4.è§£æå“åº” handleResponse(response);&#125; 3.6.é«˜äº®é«˜äº®çš„ä»£ç ä¸ä¹‹å‰ä»£ç å·®å¼‚è¾ƒå¤§ï¼Œæœ‰ä¸¤ç‚¹ï¼š æŸ¥è¯¢çš„DSLï¼šå…¶ä¸­é™¤äº†æŸ¥è¯¢æ¡ä»¶ï¼Œè¿˜éœ€è¦æ·»åŠ é«˜äº®æ¡ä»¶ï¼ŒåŒæ ·æ˜¯ä¸queryåŒçº§ã€‚ ç»“æœè§£æï¼šç»“æœé™¤äº†è¦è§£æ_sourceæ–‡æ¡£æ•°æ®ï¼Œè¿˜è¦è§£æé«˜äº®ç»“æœ 3.6.1.é«˜äº®è¯·æ±‚æ„å»ºé«˜äº®è¯·æ±‚çš„æ„å»ºAPIå¦‚ä¸‹ï¼š ä¸Šè¿°ä»£ç çœç•¥äº†æŸ¥è¯¢æ¡ä»¶éƒ¨åˆ†ï¼Œä½†æ˜¯å¤§å®¶ä¸è¦å¿˜äº†ï¼šé«˜äº®æŸ¥è¯¢å¿…é¡»ä½¿ç”¨å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œå¹¶ä¸”è¦æœ‰æœç´¢å…³é”®å­—ï¼Œå°†æ¥æ‰å¯ä»¥å¯¹å…³é”®å­—é«˜äº®ã€‚ å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415@Testvoid testHighlight() throws IOException &#123; // 1.å‡†å¤‡Request SearchRequest request = new SearchRequest(&quot;hotel&quot;); // 2.å‡†å¤‡DSL // 2.1.query request.source().query(QueryBuilders.matchQuery(&quot;all&quot;, &quot;å¦‚å®¶&quot;)); // 2.2.é«˜äº® request.source().highlighter(new HighlightBuilder().field(&quot;name&quot;).requireFieldMatch(false)); // 3.å‘é€è¯·æ±‚ SearchResponse response = client.search(request, RequestOptions.DEFAULT); // 4.è§£æå“åº” handleResponse(response);&#125; 3.6.2.é«˜äº®ç»“æœè§£æé«˜äº®çš„ç»“æœä¸æŸ¥è¯¢çš„æ–‡æ¡£ç»“æœé»˜è®¤æ˜¯åˆ†ç¦»çš„ï¼Œå¹¶ä¸åœ¨ä¸€èµ·ã€‚ å› æ­¤è§£æé«˜äº®çš„ä»£ç éœ€è¦é¢å¤–å¤„ç†ï¼š ä»£ç è§£è¯»ï¼š ç¬¬ä¸€æ­¥ï¼šä»ç»“æœä¸­è·å–sourceã€‚hit.getSourceAsString()ï¼Œè¿™éƒ¨åˆ†æ˜¯éé«˜äº®ç»“æœï¼Œjsonå­—ç¬¦ä¸²ã€‚è¿˜éœ€è¦ååºåˆ—ä¸ºHotelDocå¯¹è±¡ ç¬¬äºŒæ­¥ï¼šè·å–é«˜äº®ç»“æœã€‚hit.getHighlightFields()ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªMapï¼Œkeyæ˜¯é«˜äº®å­—æ®µåç§°ï¼Œå€¼æ˜¯HighlightFieldå¯¹è±¡ï¼Œä»£è¡¨é«˜äº®å€¼ ç¬¬ä¸‰æ­¥ï¼šä»mapä¸­æ ¹æ®é«˜äº®å­—æ®µåç§°ï¼Œè·å–é«˜äº®å­—æ®µå€¼å¯¹è±¡HighlightField ç¬¬å››æ­¥ï¼šä»HighlightFieldä¸­è·å–Fragmentsï¼Œå¹¶ä¸”è½¬ä¸ºå­—ç¬¦ä¸²ã€‚è¿™éƒ¨åˆ†å°±æ˜¯çœŸæ­£çš„é«˜äº®å­—ç¬¦ä¸²äº† ç¬¬äº”æ­¥ï¼šç”¨é«˜äº®çš„ç»“æœæ›¿æ¢HotelDocä¸­çš„éé«˜äº®ç»“æœ å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829private void handleResponse(SearchResponse response) &#123; // 4.è§£æå“åº” SearchHits searchHits = response.getHits(); // 4.1.è·å–æ€»æ¡æ•° long total = searchHits.getTotalHits().value; System.out.println(&quot;å…±æœç´¢åˆ°&quot; + total + &quot;æ¡æ•°æ®&quot;); // 4.2.æ–‡æ¡£æ•°ç»„ SearchHit[] hits = searchHits.getHits(); // 4.3.éå† for (SearchHit hit : hits) &#123; // è·å–æ–‡æ¡£source String json = hit.getSourceAsString(); // ååºåˆ—åŒ– HotelDoc hotelDoc = JSON.parseObject(json, HotelDoc.class); // è·å–é«˜äº®ç»“æœ Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields(); if (!CollectionUtils.isEmpty(highlightFields)) &#123; // æ ¹æ®å­—æ®µåè·å–é«˜äº®ç»“æœ HighlightField highlightField = highlightFields.get(&quot;name&quot;); if (highlightField != null) &#123; // è·å–é«˜äº®å€¼ String name = highlightField.getFragments()[0].string(); // è¦†ç›–éé«˜äº®ç»“æœ hotelDoc.setName(name); &#125; &#125; System.out.println(&quot;hotelDoc = &quot; + hotelDoc); &#125;&#125;","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆä¸ƒï¼‰-æœç´¢ç»“æœå¤„ç†","slug":"elk/elkï¼ˆä¸ƒï¼‰-æœç´¢ç»“æœå¤„ç†","date":"2023-06-30T07:27:06.000Z","updated":"2023-06-30T07:33:37.640Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆä¸ƒï¼‰-æœç´¢ç»“æœå¤„ç†/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E4%B8%83%EF%BC%89-%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E5%A4%84%E7%90%86/","excerpt":"","text":"2.æœç´¢ç»“æœå¤„ç†æœç´¢çš„ç»“æœå¯ä»¥æŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„æ–¹å¼å»å¤„ç†æˆ–å±•ç¤ºã€‚ 2.1.æ’åºelasticsearché»˜è®¤æ˜¯æ ¹æ®ç›¸å…³åº¦ç®—åˆ†ï¼ˆ_scoreï¼‰æ¥æ’åºï¼Œä½†æ˜¯ä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ–¹å¼å¯¹æœç´¢ç»“æœæ’åºã€‚å¯ä»¥æ’åºå­—æ®µç±»å‹æœ‰ï¼škeywordç±»å‹ã€æ•°å€¼ç±»å‹ã€åœ°ç†åæ ‡ç±»å‹ã€æ—¥æœŸç±»å‹ç­‰ã€‚ 2.1.1.æ™®é€šå­—æ®µæ’åºkeywordã€æ•°å€¼ã€æ—¥æœŸç±»å‹æ’åºçš„è¯­æ³•åŸºæœ¬ä¸€è‡´ã€‚ è¯­æ³•ï¼š 1234567891011GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;, &quot;sort&quot;: [ &#123; &quot;FIELD&quot;: &quot;desc&quot; // æ’åºå­—æ®µã€æ’åºæ–¹å¼ASCã€DESC &#125; ]&#125; æ’åºæ¡ä»¶æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å†™å¤šä¸ªæ’åºæ¡ä»¶ã€‚æŒ‰ç…§å£°æ˜çš„é¡ºåºï¼Œå½“ç¬¬ä¸€ä¸ªæ¡ä»¶ç›¸ç­‰æ—¶ï¼Œå†æŒ‰ç…§ç¬¬äºŒä¸ªæ¡ä»¶æ’åºï¼Œä»¥æ­¤ç±»æ¨ ç¤ºä¾‹ï¼š éœ€æ±‚æè¿°ï¼šé…’åº—æ•°æ®æŒ‰ç…§ç”¨æˆ·è¯„ä»·ï¼ˆscore)é™åºæ’åºï¼Œè¯„ä»·ç›¸åŒçš„æŒ‰ç…§ä»·æ ¼(price)å‡åºæ’åº 2.1.2.åœ°ç†åæ ‡æ’åºåœ°ç†åæ ‡æ’åºç•¥æœ‰ä¸åŒã€‚ è¯­æ³•è¯´æ˜ï¼š 123456789101112131415GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;, &quot;sort&quot;: [ &#123; &quot;_geo_distance&quot; : &#123; &quot;FIELD&quot; : &quot;çº¬åº¦ï¼Œç»åº¦&quot;, // æ–‡æ¡£ä¸­geo_pointç±»å‹çš„å­—æ®µåã€ç›®æ ‡åæ ‡ç‚¹ &quot;order&quot; : &quot;asc&quot;, // æ’åºæ–¹å¼ &quot;unit&quot; : &quot;km&quot; // æ’åºçš„è·ç¦»å•ä½ &#125; &#125; ]&#125; è¿™ä¸ªæŸ¥è¯¢çš„å«ä¹‰æ˜¯ï¼š æŒ‡å®šä¸€ä¸ªåæ ‡ï¼Œä½œä¸ºç›®æ ‡ç‚¹ è®¡ç®—æ¯ä¸€ä¸ªæ–‡æ¡£ä¸­ï¼ŒæŒ‡å®šå­—æ®µï¼ˆå¿…é¡»æ˜¯geo_pointç±»å‹ï¼‰çš„åæ ‡ åˆ°ç›®æ ‡ç‚¹çš„è·ç¦»æ˜¯å¤šå°‘ æ ¹æ®è·ç¦»æ’åº ç¤ºä¾‹ï¼š éœ€æ±‚æè¿°ï¼šå®ç°å¯¹é…’åº—æ•°æ®æŒ‰ç…§åˆ°ä½ çš„ä½ç½®åæ ‡çš„è·ç¦»å‡åºæ’åº æç¤ºï¼šè·å–ä½ çš„ä½ç½®çš„ç»çº¬åº¦çš„æ–¹å¼ï¼šhttps://lbs.amap.com/demo/jsapi-v2/example/map/click-to-get-lnglat/ å‡è®¾æˆ‘çš„ä½ç½®æ˜¯ï¼š31.034661ï¼Œ121.612282ï¼Œå¯»æ‰¾æˆ‘å‘¨å›´è·ç¦»æœ€è¿‘çš„é…’åº—ã€‚ 2.2.åˆ†é¡µelasticsearch é»˜è®¤æƒ…å†µä¸‹åªè¿”å›top10çš„æ•°æ®ã€‚è€Œå¦‚æœè¦æŸ¥è¯¢æ›´å¤šæ•°æ®å°±éœ€è¦ä¿®æ”¹åˆ†é¡µå‚æ•°äº†ã€‚elasticsearchä¸­é€šè¿‡ä¿®æ”¹fromã€sizeå‚æ•°æ¥æ§åˆ¶è¦è¿”å›çš„åˆ†é¡µç»“æœï¼š fromï¼šä»ç¬¬å‡ ä¸ªæ–‡æ¡£å¼€å§‹ sizeï¼šæ€»å…±æŸ¥è¯¢å‡ ä¸ªæ–‡æ¡£ ç±»ä¼¼äºmysqlä¸­çš„limit ?, ? 2.2.1.åŸºæœ¬çš„åˆ†é¡µåˆ†é¡µçš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š 1234567891011GET /hotel/_search&#123; &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;, &quot;from&quot;: 0, // åˆ†é¡µå¼€å§‹çš„ä½ç½®ï¼Œé»˜è®¤ä¸º0 &quot;size&quot;: 10, // æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•° &quot;sort&quot;: [ &#123;&quot;price&quot;: &quot;asc&quot;&#125; ]&#125; 2.2.2.æ·±åº¦åˆ†é¡µé—®é¢˜ç°åœ¨ï¼Œæˆ‘è¦æŸ¥è¯¢990~1000çš„æ•°æ®ï¼ŒæŸ¥è¯¢é€»è¾‘è¦è¿™ä¹ˆå†™ï¼š 1234567891011GET /hotel/_search&#123; &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;, &quot;from&quot;: 990, // åˆ†é¡µå¼€å§‹çš„ä½ç½®ï¼Œé»˜è®¤ä¸º0 &quot;size&quot;: 10, // æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•° &quot;sort&quot;: [ &#123;&quot;price&quot;: &quot;asc&quot;&#125; ]&#125; è¿™é‡Œæ˜¯æŸ¥è¯¢990å¼€å§‹çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ ç¬¬990~ç¬¬1000æ¡ æ•°æ®ã€‚ ä¸è¿‡ï¼Œelasticsearchå†…éƒ¨åˆ†é¡µæ—¶ï¼Œå¿…é¡»å…ˆæŸ¥è¯¢ 0~1000æ¡ï¼Œç„¶åæˆªå–å…¶ä¸­çš„990 ~ 1000çš„è¿™10æ¡ï¼š æŸ¥è¯¢TOP1000ï¼Œå¦‚æœesæ˜¯å•ç‚¹æ¨¡å¼ï¼Œè¿™å¹¶æ— å¤ªå¤§å½±å“ã€‚ ä½†æ˜¯elasticsearchå°†æ¥ä¸€å®šæ˜¯é›†ç¾¤ï¼Œä¾‹å¦‚æˆ‘é›†ç¾¤æœ‰5ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘è¦æŸ¥è¯¢TOP1000çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹æŸ¥è¯¢200æ¡å°±å¯ä»¥äº†ã€‚ å› ä¸ºèŠ‚ç‚¹Açš„TOP200ï¼Œåœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½æ’åˆ°10000åä»¥å¤–äº†ã€‚ å› æ­¤è¦æƒ³è·å–æ•´ä¸ªé›†ç¾¤çš„TOP1000ï¼Œå¿…é¡»å…ˆæŸ¥è¯¢å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„TOP1000ï¼Œæ±‡æ€»ç»“æœåï¼Œé‡æ–°æ’åï¼Œé‡æ–°æˆªå–TOP1000ã€‚ é‚£å¦‚æœæˆ‘è¦æŸ¥è¯¢9900~10000çš„æ•°æ®å‘¢ï¼Ÿæ˜¯ä¸æ˜¯è¦å…ˆæŸ¥è¯¢TOP10000å‘¢ï¼Ÿé‚£æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦æŸ¥è¯¢10000æ¡ï¼Ÿæ±‡æ€»åˆ°å†…å­˜ä¸­ï¼Ÿ å½“æŸ¥è¯¢åˆ†é¡µæ·±åº¦è¾ƒå¤§æ—¶ï¼Œæ±‡æ€»æ•°æ®è¿‡å¤šï¼Œå¯¹å†…å­˜å’ŒCPUä¼šäº§ç”Ÿéå¸¸å¤§çš„å‹åŠ›ï¼Œå› æ­¤elasticsearchä¼šç¦æ­¢from+ size è¶…è¿‡10000çš„è¯·æ±‚ã€‚ é’ˆå¯¹æ·±åº¦åˆ†é¡µï¼ŒESæä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œå®˜æ–¹æ–‡æ¡£ï¼š search afterï¼šåˆ†é¡µæ—¶éœ€è¦æ’åºï¼ŒåŸç†æ˜¯ä»ä¸Šä¸€æ¬¡çš„æ’åºå€¼å¼€å§‹ï¼ŒæŸ¥è¯¢ä¸‹ä¸€é¡µæ•°æ®ã€‚å®˜æ–¹æ¨èä½¿ç”¨çš„æ–¹å¼ã€‚ scrollï¼šåŸç†å°†æ’åºåçš„æ–‡æ¡£idå½¢æˆå¿«ç…§ï¼Œä¿å­˜åœ¨å†…å­˜ã€‚å®˜æ–¹å·²ç»ä¸æ¨èä½¿ç”¨ã€‚ 2.2.3.å°ç»“åˆ†é¡µæŸ¥è¯¢çš„å¸¸è§å®ç°æ–¹æ¡ˆä»¥åŠä¼˜ç¼ºç‚¹ï¼š from + sizeï¼š ä¼˜ç‚¹ï¼šæ”¯æŒéšæœºç¿»é¡µ ç¼ºç‚¹ï¼šæ·±åº¦åˆ†é¡µé—®é¢˜ï¼Œé»˜è®¤æŸ¥è¯¢ä¸Šé™ï¼ˆfrom + sizeï¼‰æ˜¯10000 åœºæ™¯ï¼šç™¾åº¦ã€äº¬ä¸œã€è°·æ­Œã€æ·˜å®è¿™æ ·çš„éšæœºç¿»é¡µæœç´¢ after searchï¼š ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ï¼ˆå•æ¬¡æŸ¥è¯¢çš„sizeä¸è¶…è¿‡10000ï¼‰ ç¼ºç‚¹ï¼šåªèƒ½å‘åé€é¡µæŸ¥è¯¢ï¼Œä¸æ”¯æŒéšæœºç¿»é¡µ åœºæ™¯ï¼šæ²¡æœ‰éšæœºç¿»é¡µéœ€æ±‚çš„æœç´¢ï¼Œä¾‹å¦‚æ‰‹æœºå‘ä¸‹æ»šåŠ¨ç¿»é¡µ scrollï¼š ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ï¼ˆå•æ¬¡æŸ¥è¯¢çš„sizeä¸è¶…è¿‡10000ï¼‰ ç¼ºç‚¹ï¼šä¼šæœ‰é¢å¤–å†…å­˜æ¶ˆè€—ï¼Œå¹¶ä¸”æœç´¢ç»“æœæ˜¯éå®æ—¶çš„ åœºæ™¯ï¼šæµ·é‡æ•°æ®çš„è·å–å’Œè¿ç§»ã€‚ä»ES7.1å¼€å§‹ä¸æ¨èï¼Œå»ºè®®ç”¨ after searchæ–¹æ¡ˆã€‚ 2.3.é«˜äº®2.3.1.é«˜äº®åŸç†ä»€ä¹ˆæ˜¯é«˜äº®æ˜¾ç¤ºå‘¢ï¼Ÿ æˆ‘ä»¬åœ¨ç™¾åº¦ï¼Œäº¬ä¸œæœç´¢æ—¶ï¼Œå…³é”®å­—ä¼šå˜æˆçº¢è‰²ï¼Œæ¯”è¾ƒé†’ç›®ï¼Œè¿™å«é«˜äº®æ˜¾ç¤ºï¼š é«˜äº®æ˜¾ç¤ºçš„å®ç°åˆ†ä¸ºä¸¤æ­¥ï¼š 1ï¼‰ç»™æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…³é”®å­—éƒ½æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œä¾‹å¦‚&lt;em&gt;æ ‡ç­¾ 2ï¼‰é¡µé¢ç»™&lt;em&gt;æ ‡ç­¾ç¼–å†™CSSæ ·å¼ 2.3.2.å®ç°é«˜äº®é«˜äº®çš„è¯­æ³•ï¼š 12345678910111213141516GET /hotel/_search&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;FIELD&quot;: &quot;TEXT&quot; // æŸ¥è¯¢æ¡ä»¶ï¼Œé«˜äº®ä¸€å®šè¦ä½¿ç”¨å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ &#125; &#125;, &quot;highlight&quot;: &#123; &quot;fields&quot;: &#123; // æŒ‡å®šè¦é«˜äº®çš„å­—æ®µ &quot;FIELD&quot;: &#123; &quot;pre_tags&quot;: &quot;&lt;em&gt;&quot;, // ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„å‰ç½®æ ‡ç­¾ &quot;post_tags&quot;: &quot;&lt;/em&gt;&quot; // ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„åç½®æ ‡ç­¾ &#125; &#125; &#125;&#125; æ³¨æ„ï¼š é«˜äº®æ˜¯å¯¹å…³é”®å­—é«˜äº®ï¼Œå› æ­¤æœç´¢æ¡ä»¶å¿…é¡»å¸¦æœ‰å…³é”®å­—ï¼Œè€Œä¸èƒ½æ˜¯èŒƒå›´è¿™æ ·çš„æŸ¥è¯¢ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œé«˜äº®çš„å­—æ®µï¼Œå¿…é¡»ä¸æœç´¢æŒ‡å®šçš„å­—æ®µä¸€è‡´ï¼Œå¦åˆ™æ— æ³•é«˜äº® å¦‚æœè¦å¯¹éæœç´¢å­—æ®µé«˜äº®ï¼Œåˆ™éœ€è¦æ·»åŠ ä¸€ä¸ªå±æ€§ï¼šrequired_field_match&#x3D;false ç¤ºä¾‹ï¼š 2.4.æ€»ç»“æŸ¥è¯¢çš„DSLæ˜¯ä¸€ä¸ªå¤§çš„JSONå¯¹è±¡ï¼ŒåŒ…å«ä¸‹åˆ—å±æ€§ï¼š queryï¼šæŸ¥è¯¢æ¡ä»¶ fromå’Œsizeï¼šåˆ†é¡µæ¡ä»¶ sortï¼šæ’åºæ¡ä»¶ highlightï¼šé«˜äº®æ¡ä»¶ ç¤ºä¾‹ï¼š","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆå…­ï¼‰-DSLæŸ¥è¯¢æ–‡æ¡£","slug":"elk/elkï¼ˆå…­ï¼‰-DSLæŸ¥è¯¢æ–‡æ¡£","date":"2023-06-30T07:23:52.000Z","updated":"2023-06-30T07:33:31.810Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆå…­ï¼‰-DSLæŸ¥è¯¢æ–‡æ¡£/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E5%85%AD%EF%BC%89-DSL%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3/","excerpt":"","text":"1.DSLæŸ¥è¯¢æ–‡æ¡£elasticsearchçš„æŸ¥è¯¢ä¾ç„¶æ˜¯åŸºäºJSONé£æ ¼çš„DSLæ¥å®ç°çš„ã€‚ 1.1.DSLæŸ¥è¯¢åˆ†ç±»Elasticsearchæä¾›äº†åŸºäºJSONçš„DSLï¼ˆDomain Specific Languageï¼‰æ¥å®šä¹‰æŸ¥è¯¢ã€‚å¸¸è§çš„æŸ¥è¯¢ç±»å‹åŒ…æ‹¬ï¼š æŸ¥è¯¢æ‰€æœ‰ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ï¼Œä¸€èˆ¬æµ‹è¯•ç”¨ã€‚ä¾‹å¦‚ï¼šmatch_all å…¨æ–‡æ£€ç´¢ï¼ˆfull textï¼‰æŸ¥è¯¢ï¼šåˆ©ç”¨åˆ†è¯å™¨å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ï¼Œç„¶åå»å€’æ’ç´¢å¼•åº“ä¸­åŒ¹é…ã€‚ä¾‹å¦‚ï¼š match_query multi_match_query ç²¾ç¡®æŸ¥è¯¢ï¼šæ ¹æ®ç²¾ç¡®è¯æ¡å€¼æŸ¥æ‰¾æ•°æ®ï¼Œä¸€èˆ¬æ˜¯æŸ¥æ‰¾keywordã€æ•°å€¼ã€æ—¥æœŸã€booleanç­‰ç±»å‹å­—æ®µã€‚ä¾‹å¦‚ï¼š ids range term åœ°ç†ï¼ˆgeoï¼‰æŸ¥è¯¢ï¼šæ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼š geo_distance geo_bounding_box å¤åˆï¼ˆcompoundï¼‰æŸ¥è¯¢ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†ä¸Šè¿°å„ç§æŸ¥è¯¢æ¡ä»¶ç»„åˆèµ·æ¥ï¼Œåˆå¹¶æŸ¥è¯¢æ¡ä»¶ã€‚ä¾‹å¦‚ï¼š bool function_score æŸ¥è¯¢çš„è¯­æ³•åŸºæœ¬ä¸€è‡´ï¼š 12345678GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;æŸ¥è¯¢ç±»å‹&quot;: &#123; &quot;æŸ¥è¯¢æ¡ä»¶&quot;: &quot;æ¡ä»¶å€¼&quot; &#125; &#125;&#125; æˆ‘ä»¬ä»¥æŸ¥è¯¢æ‰€æœ‰ä¸ºä¾‹ï¼Œå…¶ä¸­ï¼š æŸ¥è¯¢ç±»å‹ä¸ºmatch_all æ²¡æœ‰æŸ¥è¯¢æ¡ä»¶ 12345678// æŸ¥è¯¢æ‰€æœ‰GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;match_all&quot;: &#123; &#125; &#125;&#125; å…¶å®ƒæŸ¥è¯¢æ— éå°±æ˜¯æŸ¥è¯¢ç±»å‹ã€æŸ¥è¯¢æ¡ä»¶çš„å˜åŒ–ã€‚ 1.2.å…¨æ–‡æ£€ç´¢æŸ¥è¯¢1.2.1.ä½¿ç”¨åœºæ™¯å…¨æ–‡æ£€ç´¢æŸ¥è¯¢çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š å¯¹ç”¨æˆ·æœç´¢çš„å†…å®¹åšåˆ†è¯ï¼Œå¾—åˆ°è¯æ¡ æ ¹æ®è¯æ¡å»å€’æ’ç´¢å¼•åº“ä¸­åŒ¹é…ï¼Œå¾—åˆ°æ–‡æ¡£id æ ¹æ®æ–‡æ¡£idæ‰¾åˆ°æ–‡æ¡£ï¼Œè¿”å›ç»™ç”¨æˆ· æ¯”è¾ƒå¸¸ç”¨çš„åœºæ™¯åŒ…æ‹¬ï¼š å•†åŸçš„è¾“å…¥æ¡†æœç´¢ ç™¾åº¦è¾“å…¥æ¡†æœç´¢ ä¾‹å¦‚äº¬ä¸œï¼š å› ä¸ºæ˜¯æ‹¿ç€è¯æ¡å»åŒ¹é…ï¼Œå› æ­¤å‚ä¸æœç´¢çš„å­—æ®µä¹Ÿå¿…é¡»æ˜¯å¯åˆ†è¯çš„textç±»å‹çš„å­—æ®µã€‚ 1.2.2.åŸºæœ¬è¯­æ³•å¸¸è§çš„å…¨æ–‡æ£€ç´¢æŸ¥è¯¢åŒ…æ‹¬ï¼š matchæŸ¥è¯¢ï¼šå•å­—æ®µæŸ¥è¯¢ multi_matchæŸ¥è¯¢ï¼šå¤šå­—æ®µæŸ¥è¯¢ï¼Œä»»æ„ä¸€ä¸ªå­—æ®µç¬¦åˆæ¡ä»¶å°±ç®—ç¬¦åˆæŸ¥è¯¢æ¡ä»¶ matchæŸ¥è¯¢è¯­æ³•å¦‚ä¸‹ï¼š 12345678GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;FIELD&quot;: &quot;TEXT&quot; &#125; &#125;&#125; mulit_matchè¯­æ³•å¦‚ä¸‹ï¼š 123456789GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;multi_match&quot;: &#123; &quot;query&quot;: &quot;TEXT&quot;, &quot;fields&quot;: [&quot;FIELD1&quot;, &quot; FIELD12&quot;] &#125; &#125;&#125; 1.2.3.ç¤ºä¾‹matchæŸ¥è¯¢ç¤ºä¾‹ï¼š multi_matchæŸ¥è¯¢ç¤ºä¾‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ç§æŸ¥è¯¢ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿ å› ä¸ºæˆ‘ä»¬å°†brandã€nameã€businesså€¼éƒ½åˆ©ç”¨copy_toå¤åˆ¶åˆ°äº†allå­—æ®µä¸­ã€‚å› æ­¤ä½ æ ¹æ®ä¸‰ä¸ªå­—æ®µæœç´¢ï¼Œå’Œæ ¹æ®allå­—æ®µæœç´¢æ•ˆæœå½“ç„¶ä¸€æ ·äº†ã€‚ ä½†æ˜¯ï¼Œæœç´¢å­—æ®µè¶Šå¤šï¼Œå¯¹æŸ¥è¯¢æ€§èƒ½å½±å“è¶Šå¤§ï¼Œå› æ­¤å»ºè®®é‡‡ç”¨copy_toï¼Œç„¶åå•å­—æ®µæŸ¥è¯¢çš„æ–¹å¼ã€‚ 1.2.4.æ€»ç»“matchå’Œmulti_matchçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ matchï¼šæ ¹æ®ä¸€ä¸ªå­—æ®µæŸ¥è¯¢ multi_matchï¼šæ ¹æ®å¤šä¸ªå­—æ®µæŸ¥è¯¢ï¼Œå‚ä¸æŸ¥è¯¢å­—æ®µè¶Šå¤šï¼ŒæŸ¥è¯¢æ€§èƒ½è¶Šå·® 1.3.ç²¾å‡†æŸ¥è¯¢ç²¾ç¡®æŸ¥è¯¢ä¸€èˆ¬æ˜¯æŸ¥æ‰¾keywordã€æ•°å€¼ã€æ—¥æœŸã€booleanç­‰ç±»å‹å­—æ®µã€‚æ‰€ä»¥ä¸ä¼šå¯¹æœç´¢æ¡ä»¶åˆ†è¯ã€‚å¸¸è§çš„æœ‰ï¼š termï¼šæ ¹æ®è¯æ¡ç²¾ç¡®å€¼æŸ¥è¯¢ rangeï¼šæ ¹æ®å€¼çš„èŒƒå›´æŸ¥è¯¢ 1.3.1.termæŸ¥è¯¢å› ä¸ºç²¾ç¡®æŸ¥è¯¢çš„å­—æ®µæœæ˜¯ä¸åˆ†è¯çš„å­—æ®µï¼Œå› æ­¤æŸ¥è¯¢çš„æ¡ä»¶ä¹Ÿå¿…é¡»æ˜¯ä¸åˆ†è¯çš„è¯æ¡ã€‚æŸ¥è¯¢æ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„å†…å®¹è·Ÿè‡ªåŠ¨å€¼å®Œå…¨åŒ¹é…æ—¶æ‰è®¤ä¸ºç¬¦åˆæ¡ä»¶ã€‚å¦‚æœç”¨æˆ·è¾“å…¥çš„å†…å®¹è¿‡å¤šï¼Œåè€Œæœç´¢ä¸åˆ°æ•°æ®ã€‚ è¯­æ³•è¯´æ˜ï¼š 1234567891011// termæŸ¥è¯¢GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;term&quot;: &#123; &quot;FIELD&quot;: &#123; &quot;value&quot;: &quot;VALUE&quot; &#125; &#125; &#125;&#125; ç¤ºä¾‹ï¼š å½“æˆ‘æœç´¢çš„æ˜¯ç²¾ç¡®è¯æ¡æ—¶ï¼Œèƒ½æ­£ç¡®æŸ¥è¯¢å‡ºç»“æœï¼š ä½†æ˜¯ï¼Œå½“æˆ‘æœç´¢çš„å†…å®¹ä¸æ˜¯è¯æ¡ï¼Œè€Œæ˜¯å¤šä¸ªè¯è¯­å½¢æˆçš„çŸ­è¯­æ—¶ï¼Œåè€Œæœç´¢ä¸åˆ°ï¼š 1.3.2.rangeæŸ¥è¯¢èŒƒå›´æŸ¥è¯¢ï¼Œä¸€èˆ¬åº”ç”¨åœ¨å¯¹æ•°å€¼ç±»å‹åšèŒƒå›´è¿‡æ»¤çš„æ—¶å€™ã€‚æ¯”å¦‚åšä»·æ ¼èŒƒå›´è¿‡æ»¤ã€‚ åŸºæœ¬è¯­æ³•ï¼š 123456789101112// rangeæŸ¥è¯¢GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;range&quot;: &#123; &quot;FIELD&quot;: &#123; &quot;gte&quot;: 10, // è¿™é‡Œçš„gteä»£è¡¨å¤§äºç­‰äºï¼Œgtåˆ™ä»£è¡¨å¤§äº &quot;lte&quot;: 20 // lteä»£è¡¨å°äºç­‰äºï¼Œltåˆ™ä»£è¡¨å°äº &#125; &#125; &#125;&#125; ç¤ºä¾‹ï¼š 1.3.3.æ€»ç»“ç²¾ç¡®æŸ¥è¯¢å¸¸è§çš„æœ‰å“ªäº›ï¼Ÿ termæŸ¥è¯¢ï¼šæ ¹æ®è¯æ¡ç²¾ç¡®åŒ¹é…ï¼Œä¸€èˆ¬æœç´¢keywordç±»å‹ã€æ•°å€¼ç±»å‹ã€å¸ƒå°”ç±»å‹ã€æ—¥æœŸç±»å‹å­—æ®µ rangeæŸ¥è¯¢ï¼šæ ¹æ®æ•°å€¼èŒƒå›´æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯æ•°å€¼ã€æ—¥æœŸçš„èŒƒå›´ 1.4.åœ°ç†åæ ‡æŸ¥è¯¢æ‰€è°“çš„åœ°ç†åæ ‡æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯æ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ï¼Œå®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/geo-queries.html å¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š æºç¨‹ï¼šæœç´¢æˆ‘é™„è¿‘çš„é…’åº— æ»´æ»´ï¼šæœç´¢æˆ‘é™„è¿‘çš„å‡ºç§Ÿè½¦ å¾®ä¿¡ï¼šæœç´¢æˆ‘é™„è¿‘çš„äºº é™„è¿‘çš„é…’åº—ï¼š é™„è¿‘çš„è½¦ï¼š 1.4.1.çŸ©å½¢èŒƒå›´æŸ¥è¯¢çŸ©å½¢èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯geo_bounding_boxæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åæ ‡è½åœ¨æŸä¸ªçŸ©å½¢èŒƒå›´çš„æ‰€æœ‰æ–‡æ¡£ï¼š æŸ¥è¯¢æ—¶ï¼Œéœ€è¦æŒ‡å®šçŸ©å½¢çš„å·¦ä¸Šã€å³ä¸‹ä¸¤ä¸ªç‚¹çš„åæ ‡ï¼Œç„¶åç”»å‡ºä¸€ä¸ªçŸ©å½¢ï¼Œè½åœ¨è¯¥çŸ©å½¢å†…çš„éƒ½æ˜¯ç¬¦åˆæ¡ä»¶çš„ç‚¹ã€‚ è¯­æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718// geo_bounding_boxæŸ¥è¯¢GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;geo_bounding_box&quot;: &#123; &quot;FIELD&quot;: &#123; &quot;top_left&quot;: &#123; // å·¦ä¸Šç‚¹ &quot;lat&quot;: 31.1, &quot;lon&quot;: 121.5 &#125;, &quot;bottom_right&quot;: &#123; // å³ä¸‹ç‚¹ &quot;lat&quot;: 30.9, &quot;lon&quot;: 121.7 &#125; &#125; &#125; &#125;&#125; è¿™ç§å¹¶ä¸ç¬¦åˆâ€œé™„è¿‘çš„äººâ€è¿™æ ·çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸åšäº†ã€‚ 1.4.2.é™„è¿‘æŸ¥è¯¢é™„è¿‘æŸ¥è¯¢ï¼Œä¹Ÿå«åšè·ç¦»æŸ¥è¯¢ï¼ˆgeo_distanceï¼‰ï¼šæŸ¥è¯¢åˆ°æŒ‡å®šä¸­å¿ƒç‚¹å°äºæŸä¸ªè·ç¦»å€¼çš„æ‰€æœ‰æ–‡æ¡£ã€‚ æ¢å¥è¯æ¥è¯´ï¼Œåœ¨åœ°å›¾ä¸Šæ‰¾ä¸€ä¸ªç‚¹ä½œä¸ºåœ†å¿ƒï¼Œä»¥æŒ‡å®šè·ç¦»ä¸ºåŠå¾„ï¼Œç”»ä¸€ä¸ªåœ†ï¼Œè½åœ¨åœ†å†…çš„åæ ‡éƒ½ç®—ç¬¦åˆæ¡ä»¶ï¼š è¯­æ³•è¯´æ˜ï¼š 12345678910// geo_distance æŸ¥è¯¢GET /indexName/_search&#123; &quot;query&quot;: &#123; &quot;geo_distance&quot;: &#123; &quot;distance&quot;: &quot;15km&quot;, // åŠå¾„ &quot;FIELD&quot;: &quot;31.21,121.5&quot; // åœ†å¿ƒ &#125; &#125;&#125; ç¤ºä¾‹ï¼š æˆ‘ä»¬å…ˆæœç´¢é™†å®¶å˜´é™„è¿‘15kmçš„é…’åº—ï¼š å‘ç°å…±æœ‰47å®¶é…’åº—ã€‚ ç„¶åæŠŠåŠå¾„ç¼©çŸ­åˆ°3å…¬é‡Œï¼š å¯ä»¥å‘ç°ï¼Œæœç´¢åˆ°çš„é…’åº—æ•°é‡å‡å°‘åˆ°äº†5å®¶ã€‚ 1.5.å¤åˆæŸ¥è¯¢å¤åˆï¼ˆcompoundï¼‰æŸ¥è¯¢ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†å…¶å®ƒç®€å•æŸ¥è¯¢ç»„åˆèµ·æ¥ï¼Œå®ç°æ›´å¤æ‚çš„æœç´¢é€»è¾‘ã€‚å¸¸è§çš„æœ‰ä¸¤ç§ï¼š fuction scoreï¼šç®—åˆ†å‡½æ•°æŸ¥è¯¢ï¼Œå¯ä»¥æ§åˆ¶æ–‡æ¡£ç›¸å…³æ€§ç®—åˆ†ï¼Œæ§åˆ¶æ–‡æ¡£æ’å bool queryï¼šå¸ƒå°”æŸ¥è¯¢ï¼Œåˆ©ç”¨é€»è¾‘å…³ç³»ç»„åˆå¤šä¸ªå…¶å®ƒçš„æŸ¥è¯¢ï¼Œå®ç°å¤æ‚æœç´¢ 1.5.1.ç›¸å…³æ€§ç®—åˆ†å½“æˆ‘ä»¬åˆ©ç”¨matchæŸ¥è¯¢æ—¶ï¼Œæ–‡æ¡£ç»“æœä¼šæ ¹æ®ä¸æœç´¢è¯æ¡çš„å…³è”åº¦æ‰“åˆ†ï¼ˆ_scoreï¼‰ï¼Œè¿”å›ç»“æœæ—¶æŒ‰ç…§åˆ†å€¼é™åºæ’åˆ—ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœç´¢ â€œè™¹æ¡¥å¦‚å®¶â€ï¼Œç»“æœå¦‚ä¸‹ï¼š 1234567891011121314151617181920[ &#123; &quot;_score&quot; : 17.850193, &quot;_source&quot; : &#123; &quot;name&quot; : &quot;è™¹æ¡¥å¦‚å®¶é…’åº—çœŸä¸é”™&quot;, &#125; &#125;, &#123; &quot;_score&quot; : 12.259849, &quot;_source&quot; : &#123; &quot;name&quot; : &quot;å¤–æ»©å¦‚å®¶é…’åº—çœŸä¸é”™&quot;, &#125; &#125;, &#123; &quot;_score&quot; : 11.91091, &quot;_source&quot; : &#123; &quot;name&quot; : &quot;è¿ªå£«å°¼å¦‚å®¶é…’åº—çœŸä¸é”™&quot;, &#125; &#125;] åœ¨elasticsearchä¸­ï¼Œæ—©æœŸä½¿ç”¨çš„æ‰“åˆ†ç®—æ³•æ˜¯TF-IDFç®—æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š åœ¨åæ¥çš„5.1ç‰ˆæœ¬å‡çº§ä¸­ï¼Œelasticsearchå°†ç®—æ³•æ”¹è¿›ä¸ºBM25ç®—æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š TF-IDFç®—æ³•æœ‰ä¸€å„ç¼ºé™·ï¼Œå°±æ˜¯è¯æ¡é¢‘ç‡è¶Šé«˜ï¼Œæ–‡æ¡£å¾—åˆ†ä¹Ÿä¼šè¶Šé«˜ï¼Œå•ä¸ªè¯æ¡å¯¹æ–‡æ¡£å½±å“è¾ƒå¤§ã€‚è€ŒBM25åˆ™ä¼šè®©å•ä¸ªè¯æ¡çš„ç®—åˆ†æœ‰ä¸€ä¸ªä¸Šé™ï¼Œæ›²çº¿æ›´åŠ å¹³æ»‘ï¼š å°ç»“ï¼šelasticsearchä¼šæ ¹æ®è¯æ¡å’Œæ–‡æ¡£çš„ç›¸å…³åº¦åšæ‰“åˆ†ï¼Œç®—æ³•ç”±ä¸¤ç§ï¼š TF-IDFç®—æ³• BM25ç®—æ³•ï¼Œelasticsearch5.1ç‰ˆæœ¬åé‡‡ç”¨çš„ç®—æ³• 1.5.2.ç®—åˆ†å‡½æ•°æŸ¥è¯¢æ ¹æ®ç›¸å…³åº¦æ‰“åˆ†æ˜¯æ¯”è¾ƒåˆç†çš„éœ€æ±‚ï¼Œä½†åˆç†çš„ä¸ä¸€å®šæ˜¯äº§å“ç»ç†éœ€è¦çš„ã€‚ ä»¥ç™¾åº¦ä¸ºä¾‹ï¼Œä½ æœç´¢çš„ç»“æœä¸­ï¼Œå¹¶ä¸æ˜¯ç›¸å…³åº¦è¶Šé«˜æ’åè¶Šé å‰ï¼Œè€Œæ˜¯è°æçš„é’±å¤šæ’åå°±è¶Šé å‰ã€‚å¦‚å›¾ï¼š è¦æƒ³è®¤ä¸ºæ§åˆ¶ç›¸å…³æ€§ç®—åˆ†ï¼Œå°±éœ€è¦åˆ©ç”¨elasticsearchä¸­çš„function score æŸ¥è¯¢äº†ã€‚ 1ï¼‰è¯­æ³•è¯´æ˜ function score æŸ¥è¯¢ä¸­åŒ…å«å››éƒ¨åˆ†å†…å®¹ï¼š åŸå§‹æŸ¥è¯¢æ¡ä»¶ï¼šqueryéƒ¨åˆ†ï¼ŒåŸºäºè¿™ä¸ªæ¡ä»¶æœç´¢æ–‡æ¡£ï¼Œå¹¶ä¸”åŸºäºBM25ç®—æ³•ç»™æ–‡æ¡£æ‰“åˆ†ï¼ŒåŸå§‹ç®—åˆ†ï¼ˆquery score) è¿‡æ»¤æ¡ä»¶ï¼šfilteréƒ¨åˆ†ï¼Œç¬¦åˆè¯¥æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šé‡æ–°ç®—åˆ† ç®—åˆ†å‡½æ•°ï¼šç¬¦åˆfilteræ¡ä»¶çš„æ–‡æ¡£è¦æ ¹æ®è¿™ä¸ªå‡½æ•°åšè¿ç®—ï¼Œå¾—åˆ°çš„å‡½æ•°ç®—åˆ†ï¼ˆfunction scoreï¼‰ï¼Œæœ‰å››ç§å‡½æ•° weightï¼šå‡½æ•°ç»“æœæ˜¯å¸¸é‡ field_value_factorï¼šä»¥æ–‡æ¡£ä¸­çš„æŸä¸ªå­—æ®µå€¼ä½œä¸ºå‡½æ•°ç»“æœ random_scoreï¼šä»¥éšæœºæ•°ä½œä¸ºå‡½æ•°ç»“æœ script_scoreï¼šè‡ªå®šä¹‰ç®—åˆ†å‡½æ•°ç®—æ³• è¿ç®—æ¨¡å¼ï¼šç®—åˆ†å‡½æ•°çš„ç»“æœã€åŸå§‹æŸ¥è¯¢çš„ç›¸å…³æ€§ç®—åˆ†ï¼Œä¸¤è€…ä¹‹é—´çš„è¿ç®—æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š multiplyï¼šç›¸ä¹˜ replaceï¼šç”¨function scoreæ›¿æ¢query score å…¶å®ƒï¼Œä¾‹å¦‚ï¼šsumã€avgã€maxã€min function scoreçš„è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š 1ï¼‰æ ¹æ®åŸå§‹æ¡ä»¶æŸ¥è¯¢æœç´¢æ–‡æ¡£ï¼Œå¹¶ä¸”è®¡ç®—ç›¸å…³æ€§ç®—åˆ†ï¼Œç§°ä¸ºåŸå§‹ç®—åˆ†ï¼ˆquery scoreï¼‰ 2ï¼‰æ ¹æ®è¿‡æ»¤æ¡ä»¶ï¼Œè¿‡æ»¤æ–‡æ¡£ 3ï¼‰ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£ï¼ŒåŸºäºç®—åˆ†å‡½æ•°è¿ç®—ï¼Œå¾—åˆ°å‡½æ•°ç®—åˆ†ï¼ˆfunction scoreï¼‰ 4ï¼‰å°†åŸå§‹ç®—åˆ†ï¼ˆquery scoreï¼‰å’Œå‡½æ•°ç®—åˆ†ï¼ˆfunction scoreï¼‰åŸºäºè¿ç®—æ¨¡å¼åšè¿ç®—ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœï¼Œä½œä¸ºç›¸å…³æ€§ç®—åˆ†ã€‚ å› æ­¤ï¼Œå…¶ä¸­çš„å…³é”®ç‚¹æ˜¯ï¼š è¿‡æ»¤æ¡ä»¶ï¼šå†³å®šå“ªäº›æ–‡æ¡£çš„ç®—åˆ†è¢«ä¿®æ”¹ ç®—åˆ†å‡½æ•°ï¼šå†³å®šå‡½æ•°ç®—åˆ†çš„ç®—æ³• è¿ç®—æ¨¡å¼ï¼šå†³å®šæœ€ç»ˆç®—åˆ†ç»“æœ 2ï¼‰ç¤ºä¾‹éœ€æ±‚ï¼šç»™â€œå¦‚å®¶â€è¿™ä¸ªå“ç‰Œçš„é…’åº—æ’åé å‰ä¸€äº› ç¿»è¯‘ä¸€ä¸‹è¿™ä¸ªéœ€æ±‚ï¼Œè½¬æ¢ä¸ºä¹‹å‰è¯´çš„å››ä¸ªè¦ç‚¹ï¼š åŸå§‹æ¡ä»¶ï¼šä¸ç¡®å®šï¼Œå¯ä»¥ä»»æ„å˜åŒ– è¿‡æ»¤æ¡ä»¶ï¼šbrand &#x3D; â€œå¦‚å®¶â€ ç®—åˆ†å‡½æ•°ï¼šå¯ä»¥ç®€å•ç²—æš´ï¼Œç›´æ¥ç»™å›ºå®šçš„ç®—åˆ†ç»“æœï¼Œweight è¿ç®—æ¨¡å¼ï¼šæ¯”å¦‚æ±‚å’Œ å› æ­¤æœ€ç»ˆçš„DSLè¯­å¥å¦‚ä¸‹ï¼š 12345678910111213141516171819GET /hotel/_search&#123; &quot;query&quot;: &#123; &quot;function_score&quot;: &#123; &quot;query&quot;: &#123; .... &#125;, // åŸå§‹æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯ä»»æ„æ¡ä»¶ &quot;functions&quot;: [ // ç®—åˆ†å‡½æ•° &#123; &quot;filter&quot;: &#123; // æ»¡è¶³çš„æ¡ä»¶ï¼Œå“ç‰Œå¿…é¡»æ˜¯å¦‚å®¶ &quot;term&quot;: &#123; &quot;brand&quot;: &quot;å¦‚å®¶&quot; &#125; &#125;, &quot;weight&quot;: 2 // ç®—åˆ†æƒé‡ä¸º2 &#125; ], &quot;boost_mode&quot;: &quot;sum&quot; // åŠ æƒæ¨¡å¼ï¼Œæ±‚å’Œ &#125; &#125;&#125; æµ‹è¯•ï¼Œåœ¨æœªæ·»åŠ ç®—åˆ†å‡½æ•°æ—¶ï¼Œå¦‚å®¶å¾—åˆ†å¦‚ä¸‹ï¼š æ·»åŠ äº†ç®—åˆ†å‡½æ•°åï¼Œå¦‚å®¶å¾—åˆ†å°±æå‡äº†ï¼š 3ï¼‰å°ç»“function score queryå®šä¹‰çš„ä¸‰è¦ç´ æ˜¯ä»€ä¹ˆï¼Ÿ è¿‡æ»¤æ¡ä»¶ï¼šå“ªäº›æ–‡æ¡£è¦åŠ åˆ† ç®—åˆ†å‡½æ•°ï¼šå¦‚ä½•è®¡ç®—function score åŠ æƒæ–¹å¼ï¼šfunction score ä¸ query scoreå¦‚ä½•è¿ç®— 1.5.3.å¸ƒå°”æŸ¥è¯¢å¸ƒå°”æŸ¥è¯¢æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢å­å¥çš„ç»„åˆï¼Œæ¯ä¸€ä¸ªå­å¥å°±æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢ã€‚å­æŸ¥è¯¢çš„ç»„åˆæ–¹å¼æœ‰ï¼š mustï¼šå¿…é¡»åŒ¹é…æ¯ä¸ªå­æŸ¥è¯¢ï¼Œç±»ä¼¼â€œä¸â€ shouldï¼šé€‰æ‹©æ€§åŒ¹é…å­æŸ¥è¯¢ï¼Œç±»ä¼¼â€œæˆ–â€ must_notï¼šå¿…é¡»ä¸åŒ¹é…ï¼Œä¸å‚ä¸ç®—åˆ†ï¼Œç±»ä¼¼â€œéâ€ filterï¼šå¿…é¡»åŒ¹é…ï¼Œä¸å‚ä¸ç®—åˆ† æ¯”å¦‚åœ¨æœç´¢é…’åº—æ—¶ï¼Œé™¤äº†å…³é”®å­—æœç´¢å¤–ï¼Œæˆ‘ä»¬è¿˜å¯èƒ½æ ¹æ®å“ç‰Œã€ä»·æ ¼ã€åŸå¸‚ç­‰å­—æ®µåšè¿‡æ»¤ï¼š æ¯ä¸€ä¸ªä¸åŒçš„å­—æ®µï¼Œå…¶æŸ¥è¯¢çš„æ¡ä»¶ã€æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œå¿…é¡»æ˜¯å¤šä¸ªä¸åŒçš„æŸ¥è¯¢ï¼Œè€Œè¦ç»„åˆè¿™äº›æŸ¥è¯¢ï¼Œå°±å¿…é¡»ç”¨boolæŸ¥è¯¢äº†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœç´¢æ—¶ï¼Œå‚ä¸æ‰“åˆ†çš„å­—æ®µè¶Šå¤šï¼ŒæŸ¥è¯¢çš„æ€§èƒ½ä¹Ÿè¶Šå·®ã€‚å› æ­¤è¿™ç§å¤šæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œå»ºè®®è¿™æ ·åšï¼š æœç´¢æ¡†çš„å…³é”®å­—æœç´¢ï¼Œæ˜¯å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œä½¿ç”¨mustæŸ¥è¯¢ï¼Œå‚ä¸ç®—åˆ† å…¶å®ƒè¿‡æ»¤æ¡ä»¶ï¼Œé‡‡ç”¨filteræŸ¥è¯¢ã€‚ä¸å‚ä¸ç®—åˆ† 1ï¼‰è¯­æ³•ç¤ºä¾‹ï¼š1234567891011121314151617181920GET /hotel/_search&#123; &quot;query&quot;: &#123; &quot;bool&quot;: &#123; &quot;must&quot;: [ &#123;&quot;term&quot;: &#123;&quot;city&quot;: &quot;ä¸Šæµ·&quot; &#125;&#125; ], &quot;should&quot;: [ &#123;&quot;term&quot;: &#123;&quot;brand&quot;: &quot;çš‡å† å‡æ—¥&quot; &#125;&#125;, &#123;&quot;term&quot;: &#123;&quot;brand&quot;: &quot;åç¾è¾¾&quot; &#125;&#125; ], &quot;must_not&quot;: [ &#123; &quot;range&quot;: &#123; &quot;price&quot;: &#123; &quot;lte&quot;: 500 &#125; &#125;&#125; ], &quot;filter&quot;: [ &#123; &quot;range&quot;: &#123;&quot;score&quot;: &#123; &quot;gte&quot;: 45 &#125; &#125;&#125; ] &#125; &#125;&#125; 2ï¼‰ç¤ºä¾‹éœ€æ±‚ï¼šæœç´¢åå­—åŒ…å«â€œå¦‚å®¶â€ï¼Œä»·æ ¼ä¸é«˜äº400ï¼Œåœ¨åæ ‡31.21,121.5å‘¨å›´10kmèŒƒå›´å†…çš„é…’åº—ã€‚ åˆ†æï¼š åç§°æœç´¢ï¼Œå±äºå…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œåº”è¯¥å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°mustä¸­ ä»·æ ¼ä¸é«˜äº400ï¼Œç”¨rangeæŸ¥è¯¢ï¼Œå±äºè¿‡æ»¤æ¡ä»¶ï¼Œä¸å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°must_notä¸­ å‘¨å›´10kmèŒƒå›´å†…ï¼Œç”¨geo_distanceæŸ¥è¯¢ï¼Œå±äºè¿‡æ»¤æ¡ä»¶ï¼Œä¸å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°filterä¸­ 3ï¼‰å°ç»“boolæŸ¥è¯¢æœ‰å‡ ç§é€»è¾‘å…³ç³»ï¼Ÿ mustï¼šå¿…é¡»åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œä¸â€ shouldï¼šé€‰æ‹©æ€§åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œæˆ–â€ must_notï¼šå¿…é¡»ä¸åŒ¹é…çš„æ¡ä»¶ï¼Œä¸å‚ä¸æ‰“åˆ† filterï¼šå¿…é¡»åŒ¹é…çš„æ¡ä»¶ï¼Œä¸å‚ä¸æ‰“åˆ†","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆäº”ï¼‰-RestClientæ“ä½œæ–‡æ¡£","slug":"elk/elkï¼ˆäº”ï¼‰-RestClientæ“ä½œæ–‡æ¡£","date":"2023-06-30T07:19:24.000Z","updated":"2023-06-30T07:21:01.598Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆäº”ï¼‰-RestClientæ“ä½œæ–‡æ¡£/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E4%BA%94%EF%BC%89-RestClient%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3/","excerpt":"","text":"5.RestClientæ“ä½œæ–‡æ¡£ä¸ºäº†ä¸ç´¢å¼•åº“æ“ä½œåˆ†ç¦»ï¼Œæˆ‘ä»¬å†æ¬¡å‚åŠ ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œåšä¸¤ä»¶äº‹æƒ…ï¼š åˆå§‹åŒ–RestHighLevelClient æˆ‘ä»¬çš„é…’åº—æ•°æ®åœ¨æ•°æ®åº“ï¼Œéœ€è¦åˆ©ç”¨IHotelServiceå»æŸ¥è¯¢ï¼Œæ‰€ä»¥æ³¨å…¥è¿™ä¸ªæ¥å£ 123456789101112131415161718192021222324252627282930313233package cn.itcast.hotel;import cn.itcast.hotel.pojo.Hotel;import cn.itcast.hotel.service.IHotelService;import org.junit.jupiter.api.AfterEach;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.Test;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.test.context.SpringBootTest;import java.io.IOException;import java.util.List;@SpringBootTestpublic class HotelDocumentTest &#123; @Autowired private IHotelService hotelService; private RestHighLevelClient client; @BeforeEach void setUp() &#123; this.client = new RestHighLevelClient(RestClient.builder( HttpHost.create(&quot;http://192.168.150.101:9200&quot;) )); &#125; @AfterEach void tearDown() throws IOException &#123; this.client.close(); &#125;&#125; 5.1.æ–°å¢æ–‡æ¡£æˆ‘ä»¬è¦å°†æ•°æ®åº“çš„é…’åº—æ•°æ®æŸ¥è¯¢å‡ºæ¥ï¼Œå†™å…¥elasticsearchä¸­ã€‚ 5.1.1.ç´¢å¼•åº“å®ä½“ç±»æ•°æ®åº“æŸ¥è¯¢åçš„ç»“æœæ˜¯ä¸€ä¸ªHotelç±»å‹çš„å¯¹è±¡ã€‚ç»“æ„å¦‚ä¸‹ï¼š 1234567891011121314151617@Data@TableName(&quot;tb_hotel&quot;)public class Hotel &#123; @TableId(type = IdType.INPUT) private Long id; private String name; private String address; private Integer price; private Integer score; private String brand; private String city; private String starName; private String business; private String longitude; private String latitude; private String pic;&#125; ä¸æˆ‘ä»¬çš„ç´¢å¼•åº“ç»“æ„å­˜åœ¨å·®å¼‚ï¼š longitudeå’Œlatitudeéœ€è¦åˆå¹¶ä¸ºlocation å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œä¸ç´¢å¼•åº“ç»“æ„å»åˆï¼š 1234567891011121314151617181920212223242526272829303132333435package cn.itcast.hotel.pojo;import lombok.Data;import lombok.NoArgsConstructor;@Data@NoArgsConstructorpublic class HotelDoc &#123; private Long id; private String name; private String address; private Integer price; private Integer score; private String brand; private String city; private String starName; private String business; private String location; private String pic; public HotelDoc(Hotel hotel) &#123; this.id = hotel.getId(); this.name = hotel.getName(); this.address = hotel.getAddress(); this.price = hotel.getPrice(); this.score = hotel.getScore(); this.brand = hotel.getBrand(); this.city = hotel.getCity(); this.starName = hotel.getStarName(); this.business = hotel.getBusiness(); this.location = hotel.getLatitude() + &quot;, &quot; + hotel.getLongitude(); this.pic = hotel.getPic(); &#125;&#125; 5.1.2.è¯­æ³•è¯´æ˜æ–°å¢æ–‡æ¡£çš„DSLè¯­å¥å¦‚ä¸‹ï¼š 12345POST /&#123;ç´¢å¼•åº“å&#125;/_doc/1&#123; &quot;name&quot;: &quot;Jack&quot;, &quot;age&quot;: 21&#125; å¯¹åº”çš„javaä»£ç å¦‚å›¾ï¼š å¯ä»¥çœ‹åˆ°ä¸åˆ›å»ºç´¢å¼•åº“ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯ä¸‰æ­¥èµ°ï¼š 1ï¼‰åˆ›å»ºRequestå¯¹è±¡ 2ï¼‰å‡†å¤‡è¯·æ±‚å‚æ•°ï¼Œä¹Ÿå°±æ˜¯DSLä¸­çš„JSONæ–‡æ¡£ 3ï¼‰å‘é€è¯·æ±‚ å˜åŒ–çš„åœ°æ–¹åœ¨äºï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨client.xxx()çš„APIï¼Œä¸å†éœ€è¦client.indices()äº†ã€‚ 5.1.3.å®Œæ•´ä»£ç æˆ‘ä»¬å¯¼å…¥é…’åº—æ•°æ®ï¼ŒåŸºæœ¬æµç¨‹ä¸€è‡´ï¼Œä½†æ˜¯éœ€è¦è€ƒè™‘å‡ ç‚¹å˜åŒ–ï¼š é…’åº—æ•°æ®æ¥è‡ªäºæ•°æ®åº“ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŸ¥è¯¢å‡ºæ¥ï¼Œå¾—åˆ°hotelå¯¹è±¡ hotelå¯¹è±¡éœ€è¦è½¬ä¸ºHotelDocå¯¹è±¡ HotelDocéœ€è¦åºåˆ—åŒ–ä¸ºjsonæ ¼å¼ å› æ­¤ï¼Œä»£ç æ•´ä½“æ­¥éª¤å¦‚ä¸‹ï¼š 1ï¼‰æ ¹æ®idæŸ¥è¯¢é…’åº—æ•°æ®Hotel 2ï¼‰å°†Hotelå°è£…ä¸ºHotelDoc 3ï¼‰å°†HotelDocåºåˆ—åŒ–ä¸ºJSON 4ï¼‰åˆ›å»ºIndexRequestï¼ŒæŒ‡å®šç´¢å¼•åº“åå’Œid 5ï¼‰å‡†å¤‡è¯·æ±‚å‚æ•°ï¼Œä¹Ÿå°±æ˜¯JSONæ–‡æ¡£ 6ï¼‰å‘é€è¯·æ±‚ åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š 12345678910111213141516@Testvoid testAddDocument() throws IOException &#123; // 1.æ ¹æ®idæŸ¥è¯¢é…’åº—æ•°æ® Hotel hotel = hotelService.getById(61083L); // 2.è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹ HotelDoc hotelDoc = new HotelDoc(hotel); // 3.å°†HotelDocè½¬json String json = JSON.toJSONString(hotelDoc); // 1.å‡†å¤‡Requestå¯¹è±¡ IndexRequest request = new IndexRequest(&quot;hotel&quot;).id(hotelDoc.getId().toString()); // 2.å‡†å¤‡Jsonæ–‡æ¡£ request.source(json, XContentType.JSON); // 3.å‘é€è¯·æ±‚ client.index(request, RequestOptions.DEFAULT);&#125; 5.2.æŸ¥è¯¢æ–‡æ¡£5.2.1.è¯­æ³•è¯´æ˜æŸ¥è¯¢çš„DSLè¯­å¥å¦‚ä¸‹ï¼š 1GET /hotel/_doc/&#123;id&#125; éå¸¸ç®€å•ï¼Œå› æ­¤ä»£ç å¤§æ¦‚åˆ†ä¸¤æ­¥ï¼š å‡†å¤‡Requestå¯¹è±¡ å‘é€è¯·æ±‚ ä¸è¿‡æŸ¥è¯¢çš„ç›®çš„æ˜¯å¾—åˆ°ç»“æœï¼Œè§£æä¸ºHotelDocï¼Œå› æ­¤éš¾ç‚¹æ˜¯ç»“æœçš„è§£æã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œç»“æœæ˜¯ä¸€ä¸ªJSONï¼Œå…¶ä¸­æ–‡æ¡£æ”¾åœ¨ä¸€ä¸ª_sourceå±æ€§ä¸­ï¼Œå› æ­¤è§£æå°±æ˜¯æ‹¿åˆ°_sourceï¼Œååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡å³å¯ã€‚ ä¸ä¹‹å‰ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸‰æ­¥èµ°ï¼š 1ï¼‰å‡†å¤‡Requestå¯¹è±¡ã€‚è¿™æ¬¡æ˜¯æŸ¥è¯¢ï¼Œæ‰€ä»¥æ˜¯GetRequest 2ï¼‰å‘é€è¯·æ±‚ï¼Œå¾—åˆ°ç»“æœã€‚å› ä¸ºæ˜¯æŸ¥è¯¢ï¼Œè¿™é‡Œè°ƒç”¨client.get()æ–¹æ³• 3ï¼‰è§£æç»“æœï¼Œå°±æ˜¯å¯¹JSONåšååºåˆ—åŒ– 5.2.2.å®Œæ•´ä»£ç åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š 123456789101112@Testvoid testGetDocumentById() throws IOException &#123; // 1.å‡†å¤‡Request GetRequest request = new GetRequest(&quot;hotel&quot;, &quot;61082&quot;); // 2.å‘é€è¯·æ±‚ï¼Œå¾—åˆ°å“åº” GetResponse response = client.get(request, RequestOptions.DEFAULT); // 3.è§£æå“åº”ç»“æœ String json = response.getSourceAsString(); HotelDoc hotelDoc = JSON.parseObject(json, HotelDoc.class); System.out.println(hotelDoc);&#125; 5.3.åˆ é™¤æ–‡æ¡£åˆ é™¤çš„DSLä¸ºæ˜¯è¿™æ ·çš„ï¼š 1DELETE /hotel/_doc/&#123;id&#125; ä¸æŸ¥è¯¢ç›¸æ¯”ï¼Œä»…ä»…æ˜¯è¯·æ±‚æ–¹å¼ä»DELETEå˜æˆGETï¼Œå¯ä»¥æƒ³è±¡Javaä»£ç åº”è¯¥ä¾ç„¶æ˜¯ä¸‰æ­¥èµ°ï¼š 1ï¼‰å‡†å¤‡Requestå¯¹è±¡ï¼Œå› ä¸ºæ˜¯åˆ é™¤ï¼Œè¿™æ¬¡æ˜¯DeleteRequestå¯¹è±¡ã€‚è¦æŒ‡å®šç´¢å¼•åº“åå’Œid 2ï¼‰å‡†å¤‡å‚æ•°ï¼Œæ— å‚ 3ï¼‰å‘é€è¯·æ±‚ã€‚å› ä¸ºæ˜¯åˆ é™¤ï¼Œæ‰€ä»¥æ˜¯client.delete()æ–¹æ³• åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š 1234567@Testvoid testDeleteDocument() throws IOException &#123; // 1.å‡†å¤‡Request DeleteRequest request = new DeleteRequest(&quot;hotel&quot;, &quot;61083&quot;); // 2.å‘é€è¯·æ±‚ client.delete(request, RequestOptions.DEFAULT);&#125; 5.4.ä¿®æ”¹æ–‡æ¡£5.4.1.è¯­æ³•è¯´æ˜ä¿®æ”¹æˆ‘ä»¬è®²è¿‡ä¸¤ç§æ–¹å¼ï¼š å…¨é‡ä¿®æ”¹ï¼šæœ¬è´¨æ˜¯å…ˆæ ¹æ®idåˆ é™¤ï¼Œå†æ–°å¢ å¢é‡ä¿®æ”¹ï¼šä¿®æ”¹æ–‡æ¡£ä¸­çš„æŒ‡å®šå­—æ®µå€¼ åœ¨RestClientçš„APIä¸­ï¼Œå…¨é‡ä¿®æ”¹ä¸æ–°å¢çš„APIå®Œå…¨ä¸€è‡´ï¼Œåˆ¤æ–­ä¾æ®æ˜¯IDï¼š å¦‚æœæ–°å¢æ—¶ï¼ŒIDå·²ç»å­˜åœ¨ï¼Œåˆ™ä¿®æ”¹ å¦‚æœæ–°å¢æ—¶ï¼ŒIDä¸å­˜åœ¨ï¼Œåˆ™æ–°å¢ è¿™é‡Œä¸å†èµ˜è¿°ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨å¢é‡ä¿®æ”¹ã€‚ ä»£ç ç¤ºä¾‹å¦‚å›¾ï¼š ä¸ä¹‹å‰ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸‰æ­¥èµ°ï¼š 1ï¼‰å‡†å¤‡Requestå¯¹è±¡ã€‚è¿™æ¬¡æ˜¯ä¿®æ”¹ï¼Œæ‰€ä»¥æ˜¯UpdateRequest 2ï¼‰å‡†å¤‡å‚æ•°ã€‚ä¹Ÿå°±æ˜¯JSONæ–‡æ¡£ï¼Œé‡Œé¢åŒ…å«è¦ä¿®æ”¹çš„å­—æ®µ 3ï¼‰æ›´æ–°æ–‡æ¡£ã€‚è¿™é‡Œè°ƒç”¨client.update()æ–¹æ³• 5.4.2.å®Œæ•´ä»£ç åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š 123456789101112@Testvoid testUpdateDocument() throws IOException &#123; // 1.å‡†å¤‡Request UpdateRequest request = new UpdateRequest(&quot;hotel&quot;, &quot;61083&quot;); // 2.å‡†å¤‡è¯·æ±‚å‚æ•° request.doc( &quot;price&quot;, &quot;952&quot;, &quot;starName&quot;, &quot;å››é’»&quot; ); // 3.å‘é€è¯·æ±‚ client.update(request, RequestOptions.DEFAULT);&#125; 5.5.æ‰¹é‡å¯¼å…¥æ–‡æ¡£æ¡ˆä¾‹éœ€æ±‚ï¼šåˆ©ç”¨BulkRequestæ‰¹é‡å°†æ•°æ®åº“æ•°æ®å¯¼å…¥åˆ°ç´¢å¼•åº“ä¸­ã€‚ æ­¥éª¤å¦‚ä¸‹ï¼š åˆ©ç”¨mybatis-plusæŸ¥è¯¢é…’åº—æ•°æ® å°†æŸ¥è¯¢åˆ°çš„é…’åº—æ•°æ®ï¼ˆHotelï¼‰è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹æ•°æ®ï¼ˆHotelDocï¼‰ åˆ©ç”¨JavaRestClientä¸­çš„BulkRequestæ‰¹å¤„ç†ï¼Œå®ç°æ‰¹é‡æ–°å¢æ–‡æ¡£ 5.5.1.è¯­æ³•è¯´æ˜æ‰¹é‡å¤„ç†BulkRequestï¼Œå…¶æœ¬è´¨å°±æ˜¯å°†å¤šä¸ªæ™®é€šçš„CRUDè¯·æ±‚ç»„åˆåœ¨ä¸€èµ·å‘é€ã€‚ å…¶ä¸­æä¾›äº†ä¸€ä¸ªaddæ–¹æ³•ï¼Œç”¨æ¥æ·»åŠ å…¶ä»–è¯·æ±‚ï¼š å¯ä»¥çœ‹åˆ°ï¼Œèƒ½æ·»åŠ çš„è¯·æ±‚åŒ…æ‹¬ï¼š IndexRequestï¼Œä¹Ÿå°±æ˜¯æ–°å¢ UpdateRequestï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹ DeleteRequestï¼Œä¹Ÿå°±æ˜¯åˆ é™¤ å› æ­¤Bulkä¸­æ·»åŠ äº†å¤šä¸ªIndexRequestï¼Œå°±æ˜¯æ‰¹é‡æ–°å¢åŠŸèƒ½äº†ã€‚ç¤ºä¾‹ï¼š å…¶å®è¿˜æ˜¯ä¸‰æ­¥èµ°ï¼š 1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚è¿™é‡Œæ˜¯BulkRequest 2ï¼‰å‡†å¤‡å‚æ•°ã€‚æ‰¹å¤„ç†çš„å‚æ•°ï¼Œå°±æ˜¯å…¶å®ƒRequestå¯¹è±¡ï¼Œè¿™é‡Œå°±æ˜¯å¤šä¸ªIndexRequest 3ï¼‰å‘èµ·è¯·æ±‚ã€‚è¿™é‡Œæ˜¯æ‰¹å¤„ç†ï¼Œè°ƒç”¨çš„æ–¹æ³•ä¸ºclient.bulk()æ–¹æ³• æˆ‘ä»¬åœ¨å¯¼å…¥é…’åº—æ•°æ®æ—¶ï¼Œå°†ä¸Šè¿°ä»£ç æ”¹é€ æˆforå¾ªç¯å¤„ç†å³å¯ã€‚ 5.5.2.å®Œæ•´ä»£ç åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š 12345678910111213141516171819@Testvoid testBulkRequest() throws IOException &#123; // æ‰¹é‡æŸ¥è¯¢é…’åº—æ•°æ® List&lt;Hotel&gt; hotels = hotelService.list(); // 1.åˆ›å»ºRequest BulkRequest request = new BulkRequest(); // 2.å‡†å¤‡å‚æ•°ï¼Œæ·»åŠ å¤šä¸ªæ–°å¢çš„Request for (Hotel hotel : hotels) &#123; // 2.1.è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹HotelDoc HotelDoc hotelDoc = new HotelDoc(hotel); // 2.2.åˆ›å»ºæ–°å¢æ–‡æ¡£çš„Requestå¯¹è±¡ request.add(new IndexRequest(&quot;hotel&quot;) .id(hotelDoc.getId().toString()) .source(JSON.toJSONString(hotelDoc), XContentType.JSON)); &#125; // 3.å‘é€è¯·æ±‚ client.bulk(request, RequestOptions.DEFAULT);&#125; 5.6.å°ç»“æ–‡æ¡£æ“ä½œçš„åŸºæœ¬æ­¥éª¤ï¼š åˆå§‹åŒ–RestHighLevelClient åˆ›å»ºXxxRequestã€‚XXXæ˜¯Indexã€Getã€Updateã€Deleteã€Bulk å‡†å¤‡å‚æ•°ï¼ˆIndexã€Updateã€Bulkæ—¶éœ€è¦ï¼‰ å‘é€è¯·æ±‚ã€‚è°ƒç”¨RestHighLevelClient#.xxx()æ–¹æ³•ï¼Œxxxæ˜¯indexã€getã€updateã€deleteã€bulk è§£æç»“æœï¼ˆGetæ—¶éœ€è¦ï¼‰","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆå››ï¼‰-RestAPI","slug":"elk/elkï¼ˆå››ï¼‰-RestAPI","date":"2023-06-30T07:17:46.000Z","updated":"2023-06-30T07:21:00.631Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆå››ï¼‰-RestAPI/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E5%9B%9B%EF%BC%89-RestAPI/","excerpt":"","text":"4.RestAPIESå®˜æ–¹æä¾›äº†å„ç§ä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œç”¨æ¥æ“ä½œESã€‚è¿™äº›å®¢æˆ·ç«¯çš„æœ¬è´¨å°±æ˜¯ç»„è£…DSLè¯­å¥ï¼Œé€šè¿‡httpè¯·æ±‚å‘é€ç»™ESã€‚å®˜æ–¹æ–‡æ¡£åœ°å€ï¼šhttps://www.elastic.co/guide/en/elasticsearch/client/index.html å…¶ä¸­çš„Java Rest ClientåˆåŒ…æ‹¬ä¸¤ç§ï¼š Java Low Level Rest Client Java High Level Rest Client æˆ‘ä»¬å­¦ä¹ çš„æ˜¯Java HighLevel Rest Clientå®¢æˆ·ç«¯API 4.0.å¯¼å…¥Demoå·¥ç¨‹4.0.1.å¯¼å…¥æ•°æ®é¦–å…ˆå¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„æ•°æ®åº“æ•°æ®ï¼š æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š 123456789101112131415CREATE TABLE `tb_hotel` ( `id` bigint(20) NOT NULL COMMENT &#x27;é…’åº—id&#x27;, `name` varchar(255) NOT NULL COMMENT &#x27;é…’åº—åç§°ï¼›ä¾‹ï¼š7å¤©é…’åº—&#x27;, `address` varchar(255) NOT NULL COMMENT &#x27;é…’åº—åœ°å€ï¼›ä¾‹ï¼šèˆªå¤´è·¯&#x27;, `price` int(10) NOT NULL COMMENT &#x27;é…’åº—ä»·æ ¼ï¼›ä¾‹ï¼š329&#x27;, `score` int(2) NOT NULL COMMENT &#x27;é…’åº—è¯„åˆ†ï¼›ä¾‹ï¼š45ï¼Œå°±æ˜¯4.5åˆ†&#x27;, `brand` varchar(32) NOT NULL COMMENT &#x27;é…’åº—å“ç‰Œï¼›ä¾‹ï¼šå¦‚å®¶&#x27;, `city` varchar(32) NOT NULL COMMENT &#x27;æ‰€åœ¨åŸå¸‚ï¼›ä¾‹ï¼šä¸Šæµ·&#x27;, `star_name` varchar(16) DEFAULT NULL COMMENT &#x27;é…’åº—æ˜Ÿçº§ï¼Œä»ä½åˆ°é«˜åˆ†åˆ«æ˜¯ï¼š1æ˜Ÿåˆ°5æ˜Ÿï¼Œ1é’»åˆ°5é’»&#x27;, `business` varchar(255) DEFAULT NULL COMMENT &#x27;å•†åœˆï¼›ä¾‹ï¼šè™¹æ¡¥&#x27;, `latitude` varchar(32) NOT NULL COMMENT &#x27;çº¬åº¦ï¼›ä¾‹ï¼š31.2497&#x27;, `longitude` varchar(32) NOT NULL COMMENT &#x27;ç»åº¦ï¼›ä¾‹ï¼š120.3925&#x27;, `pic` varchar(255) DEFAULT NULL COMMENT &#x27;é…’åº—å›¾ç‰‡ï¼›ä¾‹:/img/1.jpg&#x27;, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; 4.0.2.å¯¼å…¥é¡¹ç›®ç„¶åå¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„é¡¹ç›®: é¡¹ç›®ç»“æ„å¦‚å›¾ï¼š 4.0.3.mappingæ˜ å°„åˆ†æåˆ›å»ºç´¢å¼•åº“ï¼Œæœ€å…³é”®çš„æ˜¯mappingæ˜ å°„ï¼Œè€Œmappingæ˜ å°„è¦è€ƒè™‘çš„ä¿¡æ¯åŒ…æ‹¬ï¼š å­—æ®µå å­—æ®µæ•°æ®ç±»å‹ æ˜¯å¦å‚ä¸æœç´¢ æ˜¯å¦éœ€è¦åˆ†è¯ å¦‚æœåˆ†è¯ï¼Œåˆ†è¯å™¨æ˜¯ä»€ä¹ˆï¼Ÿ å…¶ä¸­ï¼š å­—æ®µåã€å­—æ®µæ•°æ®ç±»å‹ï¼Œå¯ä»¥å‚è€ƒæ•°æ®è¡¨ç»“æ„çš„åç§°å’Œç±»å‹ æ˜¯å¦å‚ä¸æœç´¢è¦åˆ†æä¸šåŠ¡æ¥åˆ¤æ–­ï¼Œä¾‹å¦‚å›¾ç‰‡åœ°å€ï¼Œå°±æ— éœ€å‚ä¸æœç´¢ æ˜¯å¦åˆ†è¯å‘¢è¦çœ‹å†…å®¹ï¼Œå†…å®¹å¦‚æœæ˜¯ä¸€ä¸ªæ•´ä½“å°±æ— éœ€åˆ†è¯ï¼Œåä¹‹åˆ™è¦åˆ†è¯ åˆ†è¯å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿä¸€ä½¿ç”¨ik_max_word æ¥çœ‹ä¸‹é…’åº—æ•°æ®çš„ç´¢å¼•åº“ç»“æ„: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950PUT /hotel&#123; &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;id&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;name&quot;:&#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;copy_to&quot;: &quot;all&quot; &#125;, &quot;address&quot;:&#123; &quot;type&quot;: &quot;keyword&quot;, &quot;index&quot;: false &#125;, &quot;price&quot;:&#123; &quot;type&quot;: &quot;integer&quot; &#125;, &quot;score&quot;:&#123; &quot;type&quot;: &quot;integer&quot; &#125;, &quot;brand&quot;:&#123; &quot;type&quot;: &quot;keyword&quot;, &quot;copy_to&quot;: &quot;all&quot; &#125;, &quot;city&quot;:&#123; &quot;type&quot;: &quot;keyword&quot;, &quot;copy_to&quot;: &quot;all&quot; &#125;, &quot;starName&quot;:&#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;business&quot;:&#123; &quot;type&quot;: &quot;keyword&quot; &#125;, &quot;location&quot;:&#123; &quot;type&quot;: &quot;geo_point&quot; &#125;, &quot;pic&quot;:&#123; &quot;type&quot;: &quot;keyword&quot;, &quot;index&quot;: false &#125;, &quot;all&quot;:&#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot; &#125; &#125; &#125;&#125; å‡ ä¸ªç‰¹æ®Šå­—æ®µè¯´æ˜ï¼š locationï¼šåœ°ç†åæ ‡ï¼Œé‡Œé¢åŒ…å«ç²¾åº¦ã€çº¬åº¦ allï¼šä¸€ä¸ªç»„åˆå­—æ®µï¼Œå…¶ç›®çš„æ˜¯å°†å¤šå­—æ®µçš„å€¼ åˆ©ç”¨copy_toåˆå¹¶ï¼Œæä¾›ç»™ç”¨æˆ·æœç´¢ åœ°ç†åæ ‡è¯´æ˜ï¼š copy_toè¯´æ˜ï¼š 4.0.4.åˆå§‹åŒ–RestClientåœ¨elasticsearchæä¾›çš„APIä¸­ï¼Œä¸elasticsearchä¸€åˆ‡äº¤äº’éƒ½å°è£…åœ¨ä¸€ä¸ªåä¸ºRestHighLevelClientçš„ç±»ä¸­ï¼Œå¿…é¡»å…ˆå®Œæˆè¿™ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œå»ºç«‹ä¸elasticsearchçš„è¿æ¥ã€‚ åˆ†ä¸ºä¸‰æ­¥ï¼š 1ï¼‰å¼•å…¥esçš„RestHighLevelClientä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;&lt;/dependency&gt; 2ï¼‰å› ä¸ºSpringBooté»˜è®¤çš„ESç‰ˆæœ¬æ˜¯7.6.2ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¦†ç›–é»˜è®¤çš„ESç‰ˆæœ¬ï¼š 1234&lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;elasticsearch.version&gt;7.12.1&lt;/elasticsearch.version&gt;&lt;/properties&gt; 3ï¼‰åˆå§‹åŒ–RestHighLevelClientï¼š åˆå§‹åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š 123RestHighLevelClient client = new RestHighLevelClient(RestClient.builder( HttpHost.create(&quot;http://192.168.150.101:9200&quot;))); è¿™é‡Œä¸ºäº†å•å…ƒæµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»HotelIndexTestï¼Œç„¶åå°†åˆå§‹åŒ–çš„ä»£ç ç¼–å†™åœ¨@BeforeEachæ–¹æ³•ä¸­ï¼š 12345678910111213141516171819202122232425package cn.itcast.hotel;import org.apache.http.HttpHost;import org.elasticsearch.client.RestHighLevelClient;import org.junit.jupiter.api.AfterEach;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.Test;import java.io.IOException;public class HotelIndexTest &#123; private RestHighLevelClient client; @BeforeEach void setUp() &#123; this.client = new RestHighLevelClient(RestClient.builder( HttpHost.create(&quot;http://192.168.150.101:9200&quot;) )); &#125; @AfterEach void tearDown() throws IOException &#123; this.client.close(); &#125;&#125; 4.1.åˆ›å»ºç´¢å¼•åº“4.1.1.ä»£ç è§£è¯»åˆ›å»ºç´¢å¼•åº“çš„APIå¦‚ä¸‹ï¼š ä»£ç åˆ†ä¸ºä¸‰æ­¥ï¼š 1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚å› ä¸ºæ˜¯åˆ›å»ºç´¢å¼•åº“çš„æ“ä½œï¼Œå› æ­¤Requestæ˜¯CreateIndexRequestã€‚ 2ï¼‰æ·»åŠ è¯·æ±‚å‚æ•°ï¼Œå…¶å®å°±æ˜¯DSLçš„JSONå‚æ•°éƒ¨åˆ†ã€‚å› ä¸ºjsonå­—ç¬¦ä¸²å¾ˆé•¿ï¼Œè¿™é‡Œæ˜¯å®šä¹‰äº†é™æ€å­—ç¬¦ä¸²å¸¸é‡MAPPING_TEMPLATEï¼Œè®©ä»£ç çœ‹èµ·æ¥æ›´åŠ ä¼˜é›…ã€‚ 3ï¼‰å‘é€è¯·æ±‚ï¼Œclient.indices()æ–¹æ³•çš„è¿”å›å€¼æ˜¯IndicesClientç±»å‹ï¼Œå°è£…äº†æ‰€æœ‰ä¸ç´¢å¼•åº“æ“ä½œæœ‰å…³çš„æ–¹æ³•ã€‚ 4.1.2.å®Œæ•´ç¤ºä¾‹åœ¨hotel-demoçš„cn.itcast.hotel.constantsåŒ…ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªç±»ï¼Œå®šä¹‰mappingæ˜ å°„çš„JSONå­—ç¬¦ä¸²å¸¸é‡ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package cn.itcast.hotel.constants;public class HotelConstants &#123; public static final String MAPPING_TEMPLATE = &quot;&#123;\\n&quot; + &quot; \\&quot;mappings\\&quot;: &#123;\\n&quot; + &quot; \\&quot;properties\\&quot;: &#123;\\n&quot; + &quot; \\&quot;id\\&quot;: &#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;keyword\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;name\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;text\\&quot;,\\n&quot; + &quot; \\&quot;analyzer\\&quot;: \\&quot;ik_max_word\\&quot;,\\n&quot; + &quot; \\&quot;copy_to\\&quot;: \\&quot;all\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;address\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;keyword\\&quot;,\\n&quot; + &quot; \\&quot;index\\&quot;: false\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;price\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;integer\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;score\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;integer\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;brand\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;keyword\\&quot;,\\n&quot; + &quot; \\&quot;copy_to\\&quot;: \\&quot;all\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;city\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;keyword\\&quot;,\\n&quot; + &quot; \\&quot;copy_to\\&quot;: \\&quot;all\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;starName\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;keyword\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;business\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;keyword\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;location\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;geo_point\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;pic\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;keyword\\&quot;,\\n&quot; + &quot; \\&quot;index\\&quot;: false\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;all\\&quot;:&#123;\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;text\\&quot;,\\n&quot; + &quot; \\&quot;analyzer\\&quot;: \\&quot;ik_max_word\\&quot;\\n&quot; + &quot; &#125;\\n&quot; + &quot; &#125;\\n&quot; + &quot; &#125;\\n&quot; + &quot;&#125;&quot;;&#125; åœ¨hotel-demoä¸­çš„HotelIndexTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼Œå®ç°åˆ›å»ºç´¢å¼•ï¼š 123456789@Testvoid createHotelIndex() throws IOException &#123; // 1.åˆ›å»ºRequestå¯¹è±¡ CreateIndexRequest request = new CreateIndexRequest(&quot;hotel&quot;); // 2.å‡†å¤‡è¯·æ±‚çš„å‚æ•°ï¼šDSLè¯­å¥ request.source(MAPPING_TEMPLATE, XContentType.JSON); // 3.å‘é€è¯·æ±‚ client.indices().create(request, RequestOptions.DEFAULT);&#125; 4.2.åˆ é™¤ç´¢å¼•åº“åˆ é™¤ç´¢å¼•åº“çš„DSLè¯­å¥éå¸¸ç®€å•ï¼š 1DELETE /hotel ä¸åˆ›å»ºç´¢å¼•åº“ç›¸æ¯”ï¼š è¯·æ±‚æ–¹å¼ä»PUTå˜ä¸ºDELTE è¯·æ±‚è·¯å¾„ä¸å˜ æ— è¯·æ±‚å‚æ•° æ‰€ä»¥ä»£ç çš„å·®å¼‚ï¼Œæ³¨æ„ä½“ç°åœ¨Requestå¯¹è±¡ä¸Šã€‚ä¾ç„¶æ˜¯ä¸‰æ­¥èµ°ï¼š 1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚è¿™æ¬¡æ˜¯DeleteIndexRequestå¯¹è±¡ 2ï¼‰å‡†å¤‡å‚æ•°ã€‚è¿™é‡Œæ˜¯æ— å‚ 3ï¼‰å‘é€è¯·æ±‚ã€‚æ”¹ç”¨deleteæ–¹æ³• åœ¨hotel-demoä¸­çš„HotelIndexTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼Œå®ç°åˆ é™¤ç´¢å¼•ï¼š 1234567@Testvoid testDeleteHotelIndex() throws IOException &#123; // 1.åˆ›å»ºRequestå¯¹è±¡ DeleteIndexRequest request = new DeleteIndexRequest(&quot;hotel&quot;); // 2.å‘é€è¯·æ±‚ client.indices().delete(request, RequestOptions.DEFAULT);&#125; 4.3.åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨ï¼Œæœ¬è´¨å°±æ˜¯æŸ¥è¯¢ï¼Œå¯¹åº”çš„DSLæ˜¯ï¼š 1GET /hotel å› æ­¤ä¸åˆ é™¤çš„Javaä»£ç æµç¨‹æ˜¯ç±»ä¼¼çš„ã€‚ä¾ç„¶æ˜¯ä¸‰æ­¥èµ°ï¼š 1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚è¿™æ¬¡æ˜¯GetIndexRequestå¯¹è±¡ 2ï¼‰å‡†å¤‡å‚æ•°ã€‚è¿™é‡Œæ˜¯æ— å‚ 3ï¼‰å‘é€è¯·æ±‚ã€‚æ”¹ç”¨existsæ–¹æ³• 123456789@Testvoid testExistsHotelIndex() throws IOException &#123; // 1.åˆ›å»ºRequestå¯¹è±¡ GetIndexRequest request = new GetIndexRequest(&quot;hotel&quot;); // 2.å‘é€è¯·æ±‚ boolean exists = client.indices().exists(request, RequestOptions.DEFAULT); // 3.è¾“å‡º System.err.println(exists ? &quot;ç´¢å¼•åº“å·²ç»å­˜åœ¨ï¼&quot; : &quot;ç´¢å¼•åº“ä¸å­˜åœ¨ï¼&quot;);&#125; 4.4.æ€»ç»“JavaRestClientæ“ä½œelasticsearchçš„æµç¨‹åŸºæœ¬ç±»ä¼¼ã€‚æ ¸å¿ƒæ˜¯client.indices()æ–¹æ³•æ¥è·å–ç´¢å¼•åº“çš„æ“ä½œå¯¹è±¡ã€‚ ç´¢å¼•åº“æ“ä½œçš„åŸºæœ¬æ­¥éª¤ï¼š åˆå§‹åŒ–RestHighLevelClient åˆ›å»ºXxxIndexRequestã€‚XXXæ˜¯Createã€Getã€Delete å‡†å¤‡DSLï¼ˆ Createæ—¶éœ€è¦ï¼Œå…¶å®ƒæ˜¯æ— å‚ï¼‰ å‘é€è¯·æ±‚ã€‚è°ƒç”¨RestHighLevelClient#indices().xxx()æ–¹æ³•ï¼Œxxxæ˜¯createã€existsã€delete","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆä¸‰ï¼‰-æ–‡æ¡£æ“ä½œ","slug":"elk/elkï¼ˆä¸‰ï¼‰-æ–‡æ¡£æ“ä½œ","date":"2023-06-30T07:16:09.000Z","updated":"2023-06-30T07:20:58.426Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆä¸‰ï¼‰-æ–‡æ¡£æ“ä½œ/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E4%B8%89%EF%BC%89-%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C/","excerpt":"","text":"3.æ–‡æ¡£æ“ä½œ3.1.æ–°å¢æ–‡æ¡£è¯­æ³•ï¼š 12345678910POST /ç´¢å¼•åº“å/_doc/æ–‡æ¡£id&#123; &quot;å­—æ®µ1&quot;: &quot;å€¼1&quot;, &quot;å­—æ®µ2&quot;: &quot;å€¼2&quot;, &quot;å­—æ®µ3&quot;: &#123; &quot;å­å±æ€§1&quot;: &quot;å€¼3&quot;, &quot;å­å±æ€§2&quot;: &quot;å€¼4&quot; &#125;, // ...&#125; ç¤ºä¾‹ï¼š 123456789POST /heima/_doc/1&#123; &quot;info&quot;: &quot;é»‘é©¬ç¨‹åºå‘˜Javaè®²å¸ˆ&quot;, &quot;email&quot;: &quot;zy@itcast.cn&quot;, &quot;name&quot;: &#123; &quot;firstName&quot;: &quot;äº‘&quot;, &quot;lastName&quot;: &quot;èµµ&quot; &#125;&#125; å“åº”ï¼š 3.2.æŸ¥è¯¢æ–‡æ¡£æ ¹æ®resté£æ ¼ï¼Œæ–°å¢æ˜¯postï¼ŒæŸ¥è¯¢åº”è¯¥æ˜¯getï¼Œä¸è¿‡æŸ¥è¯¢ä¸€èˆ¬éƒ½éœ€è¦æ¡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠæ–‡æ¡£idå¸¦ä¸Šã€‚ è¯­æ³•ï¼š 1GET /&#123;ç´¢å¼•åº“åç§°&#125;/_doc/&#123;id&#125; é€šè¿‡kibanaæŸ¥çœ‹æ•°æ®ï¼š 1GET /heima/_doc/1 æŸ¥çœ‹ç»“æœï¼š 3.3.åˆ é™¤æ–‡æ¡£åˆ é™¤ä½¿ç”¨DELETEè¯·æ±‚ï¼ŒåŒæ ·ï¼Œéœ€è¦æ ¹æ®idè¿›è¡Œåˆ é™¤ï¼š è¯­æ³•ï¼š 1DELETE /&#123;ç´¢å¼•åº“å&#125;/_doc/idå€¼ ç¤ºä¾‹ï¼š 12# æ ¹æ®idåˆ é™¤æ•°æ®DELETE /heima/_doc/1 ç»“æœï¼š 3.4.ä¿®æ”¹æ–‡æ¡£ä¿®æ”¹æœ‰ä¸¤ç§æ–¹å¼ï¼š å…¨é‡ä¿®æ”¹ï¼šç›´æ¥è¦†ç›–åŸæ¥çš„æ–‡æ¡£ å¢é‡ä¿®æ”¹ï¼šä¿®æ”¹æ–‡æ¡£ä¸­çš„éƒ¨åˆ†å­—æ®µ 3.4.1.å…¨é‡ä¿®æ”¹å…¨é‡ä¿®æ”¹æ˜¯è¦†ç›–åŸæ¥çš„æ–‡æ¡£ï¼Œå…¶æœ¬è´¨æ˜¯ï¼š æ ¹æ®æŒ‡å®šçš„idåˆ é™¤æ–‡æ¡£ æ–°å¢ä¸€ä¸ªç›¸åŒidçš„æ–‡æ¡£ æ³¨æ„ï¼šå¦‚æœæ ¹æ®idåˆ é™¤æ—¶ï¼Œidä¸å­˜åœ¨ï¼Œç¬¬äºŒæ­¥çš„æ–°å¢ä¹Ÿä¼šæ‰§è¡Œï¼Œä¹Ÿå°±ä»ä¿®æ”¹å˜æˆäº†æ–°å¢æ“ä½œäº†ã€‚ è¯­æ³•ï¼š 1234567PUT /&#123;ç´¢å¼•åº“å&#125;/_doc/æ–‡æ¡£id&#123; &quot;å­—æ®µ1&quot;: &quot;å€¼1&quot;, &quot;å­—æ®µ2&quot;: &quot;å€¼2&quot;, // ... ç•¥&#125; ç¤ºä¾‹ï¼š 123456789PUT /heima/_doc/1&#123; &quot;info&quot;: &quot;é»‘é©¬ç¨‹åºå‘˜é«˜çº§Javaè®²å¸ˆ&quot;, &quot;email&quot;: &quot;zy@itcast.cn&quot;, &quot;name&quot;: &#123; &quot;firstName&quot;: &quot;äº‘&quot;, &quot;lastName&quot;: &quot;èµµ&quot; &#125;&#125; 3.4.2.å¢é‡ä¿®æ”¹å¢é‡ä¿®æ”¹æ˜¯åªä¿®æ”¹æŒ‡å®šidåŒ¹é…çš„æ–‡æ¡£ä¸­çš„éƒ¨åˆ†å­—æ®µã€‚ è¯­æ³•ï¼š 123456POST /&#123;ç´¢å¼•åº“å&#125;/_update/æ–‡æ¡£id&#123; &quot;doc&quot;: &#123; &quot;å­—æ®µå&quot;: &quot;æ–°çš„å€¼&quot;, &#125;&#125; ç¤ºä¾‹ï¼š 123456POST /heima/_update/1&#123; &quot;doc&quot;: &#123; &quot;email&quot;: &quot;ZhaoYun@itcast.cn&quot; &#125;&#125; 3.5.æ€»ç»“æ–‡æ¡£æ“ä½œæœ‰å“ªäº›ï¼Ÿ åˆ›å»ºæ–‡æ¡£ï¼šPOST &#x2F;{ç´¢å¼•åº“å}&#x2F;_doc&#x2F;æ–‡æ¡£id { jsonæ–‡æ¡£ } æŸ¥è¯¢æ–‡æ¡£ï¼šGET &#x2F;{ç´¢å¼•åº“å}&#x2F;_doc&#x2F;æ–‡æ¡£id åˆ é™¤æ–‡æ¡£ï¼šDELETE &#x2F;{ç´¢å¼•åº“å}&#x2F;_doc&#x2F;æ–‡æ¡£id ä¿®æ”¹æ–‡æ¡£ï¼š å…¨é‡ä¿®æ”¹ï¼šPUT &#x2F;{ç´¢å¼•åº“å}&#x2F;_doc&#x2F;æ–‡æ¡£id { jsonæ–‡æ¡£ } å¢é‡ä¿®æ”¹ï¼šPOST &#x2F;{ç´¢å¼•åº“å}&#x2F;_update&#x2F;æ–‡æ¡£id { â€œdocâ€: {å­—æ®µ}}","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆäºŒï¼‰-ç´¢å¼•åº“æ“ä½œ","slug":"elk/elkï¼ˆäºŒï¼‰-ç´¢å¼•åº“æ“ä½œ","date":"2023-06-30T07:11:50.000Z","updated":"2023-06-30T07:14:23.935Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆäºŒï¼‰-ç´¢å¼•åº“æ“ä½œ/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E4%BA%8C%EF%BC%89-%E7%B4%A2%E5%BC%95%E5%BA%93%E6%93%8D%E4%BD%9C/","excerpt":"","text":"2.ç´¢å¼•åº“æ“ä½œç´¢å¼•åº“å°±ç±»ä¼¼æ•°æ®åº“è¡¨ï¼Œmappingæ˜ å°„å°±ç±»ä¼¼è¡¨çš„ç»“æ„ã€‚ æˆ‘ä»¬è¦å‘esä¸­å­˜å‚¨æ•°æ®ï¼Œå¿…é¡»å…ˆåˆ›å»ºâ€œåº“â€å’Œâ€œè¡¨â€ã€‚ 2.1.mappingæ˜ å°„å±æ€§mappingæ˜¯å¯¹ç´¢å¼•åº“ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œå¸¸è§çš„mappingå±æ€§åŒ…æ‹¬ï¼š typeï¼šå­—æ®µæ•°æ®ç±»å‹ï¼Œå¸¸è§çš„ç®€å•ç±»å‹æœ‰ï¼š å­—ç¬¦ä¸²ï¼štextï¼ˆå¯åˆ†è¯çš„æ–‡æœ¬ï¼‰ã€keywordï¼ˆç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ï¼šå“ç‰Œã€å›½å®¶ã€ipåœ°å€ï¼‰ æ•°å€¼ï¼šlongã€integerã€shortã€byteã€doubleã€floatã€ å¸ƒå°”ï¼šboolean æ—¥æœŸï¼šdate å¯¹è±¡ï¼šobject indexï¼šæ˜¯å¦åˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤ä¸ºtrue analyzerï¼šä½¿ç”¨å“ªç§åˆ†è¯å™¨ propertiesï¼šè¯¥å­—æ®µçš„å­å­—æ®µ ä¾‹å¦‚ä¸‹é¢çš„jsonæ–‡æ¡£ï¼š 123456789101112&#123; &quot;age&quot;: 21, &quot;weight&quot;: 52.1, &quot;isMarried&quot;: false, &quot;info&quot;: &quot;é»‘é©¬ç¨‹åºå‘˜Javaè®²å¸ˆ&quot;, &quot;email&quot;: &quot;zy@itcast.cn&quot;, &quot;score&quot;: [99.1, 99.5, 98.9], &quot;name&quot;: &#123; &quot;firstName&quot;: &quot;äº‘&quot;, &quot;lastName&quot;: &quot;èµµ&quot; &#125;&#125; å¯¹åº”çš„æ¯ä¸ªå­—æ®µæ˜ å°„ï¼ˆmappingï¼‰ï¼š ageï¼šç±»å‹ä¸º integerï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨ weightï¼šç±»å‹ä¸ºfloatï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨ isMarriedï¼šç±»å‹ä¸ºbooleanï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨ infoï¼šç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œéœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯textï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›åˆ†è¯å™¨å¯ä»¥ç”¨ik_smart emailï¼šç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸éœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯keywordï¼›ä¸å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºfalseï¼›æ— éœ€åˆ†è¯å™¨ scoreï¼šè™½ç„¶æ˜¯æ•°ç»„ï¼Œä½†æ˜¯æˆ‘ä»¬åªçœ‹å…ƒç´ çš„ç±»å‹ï¼Œç±»å‹ä¸ºfloatï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨ nameï¼šç±»å‹ä¸ºobjectï¼Œéœ€è¦å®šä¹‰å¤šä¸ªå­å±æ€§ name.firstNameï¼›ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸éœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯keywordï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨ name.lastNameï¼›ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸éœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯keywordï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨ 2.2.ç´¢å¼•åº“çš„CRUDè¿™é‡Œæˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨Kibanaç¼–å†™DSLçš„æ–¹å¼æ¥æ¼”ç¤ºã€‚ 2.2.1.åˆ›å»ºç´¢å¼•åº“å’Œæ˜ å°„åŸºæœ¬è¯­æ³•ï¼š è¯·æ±‚æ–¹å¼ï¼šPUT è¯·æ±‚è·¯å¾„ï¼š&#x2F;ç´¢å¼•åº“åï¼Œå¯ä»¥è‡ªå®šä¹‰ è¯·æ±‚å‚æ•°ï¼šmappingæ˜ å°„ æ ¼å¼ï¼š 1234567891011121314151617181920212223PUT /ç´¢å¼•åº“åç§°&#123; &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;å­—æ®µå&quot;:&#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;å­—æ®µå2&quot;:&#123; &quot;type&quot;: &quot;keyword&quot;, &quot;index&quot;: &quot;false&quot; &#125;, &quot;å­—æ®µå3&quot;:&#123; &quot;properties&quot;: &#123; &quot;å­å­—æ®µ&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125;, // ...ç•¥ &#125; &#125;&#125; ç¤ºä¾‹ï¼š1234567891011121314151617181920212223PUT /heima&#123; &quot;mappings&quot;: &#123; &quot;properties&quot;: &#123; &quot;info&quot;:&#123; &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_smart&quot; &#125;, &quot;email&quot;:&#123; &quot;type&quot;: &quot;keyword&quot;, &quot;index&quot;: &quot;falsae&quot; &#125;, &quot;name&quot;:&#123; &quot;properties&quot;: &#123; &quot;firstName&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125;, // ... ç•¥ &#125; &#125;&#125; 2.2.2.æŸ¥è¯¢ç´¢å¼•åº“åŸºæœ¬è¯­æ³•ï¼š è¯·æ±‚æ–¹å¼ï¼šGET è¯·æ±‚è·¯å¾„ï¼š&#x2F;ç´¢å¼•åº“å è¯·æ±‚å‚æ•°ï¼šæ—  æ ¼å¼ï¼š 1GET /ç´¢å¼•åº“å ç¤ºä¾‹ï¼š 2.2.3.ä¿®æ”¹ç´¢å¼•åº“å€’æ’ç´¢å¼•ç»“æ„è™½ç„¶ä¸å¤æ‚ï¼Œä½†æ˜¯ä¸€æ—¦æ•°æ®ç»“æ„æ”¹å˜ï¼ˆæ¯”å¦‚æ”¹å˜äº†åˆ†è¯å™¨ï¼‰ï¼Œå°±éœ€è¦é‡æ–°åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œè¿™ç®€ç›´æ˜¯ç¾éš¾ã€‚å› æ­¤ç´¢å¼•åº“ä¸€æ—¦åˆ›å»ºï¼Œæ— æ³•ä¿®æ”¹mappingã€‚ è™½ç„¶æ— æ³•ä¿®æ”¹mappingä¸­å·²æœ‰çš„å­—æ®µï¼Œä½†æ˜¯å´å…è®¸æ·»åŠ æ–°çš„å­—æ®µåˆ°mappingä¸­ï¼Œå› ä¸ºä¸ä¼šå¯¹å€’æ’ç´¢å¼•äº§ç”Ÿå½±å“ã€‚ è¯­æ³•è¯´æ˜ï¼š 12345678PUT /ç´¢å¼•åº“å/_mapping&#123; &quot;properties&quot;: &#123; &quot;æ–°å­—æ®µå&quot;:&#123; &quot;type&quot;: &quot;integer&quot; &#125; &#125;&#125; ç¤ºä¾‹ï¼š 2.2.4.åˆ é™¤ç´¢å¼•åº“è¯­æ³•ï¼š è¯·æ±‚æ–¹å¼ï¼šDELETE è¯·æ±‚è·¯å¾„ï¼š&#x2F;ç´¢å¼•åº“å è¯·æ±‚å‚æ•°ï¼šæ—  æ ¼å¼ï¼š 1DELETE /ç´¢å¼•åº“å åœ¨kibanaä¸­æµ‹è¯•ï¼š 2.2.5.æ€»ç»“ç´¢å¼•åº“æ“ä½œæœ‰å“ªäº›ï¼Ÿ åˆ›å»ºç´¢å¼•åº“ï¼šPUT &#x2F;ç´¢å¼•åº“å æŸ¥è¯¢ç´¢å¼•åº“ï¼šGET &#x2F;ç´¢å¼•åº“å åˆ é™¤ç´¢å¼•åº“ï¼šDELETE &#x2F;ç´¢å¼•åº“å æ·»åŠ å­—æ®µï¼šPUT &#x2F;ç´¢å¼•åº“å&#x2F;_mapping","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"elkï¼ˆä¸€ï¼‰-åˆè¯†elk","slug":"elk/elkï¼ˆä¸€ï¼‰-åˆè¯†elk","date":"2023-06-30T07:05:17.000Z","updated":"2023-06-30T07:08:29.975Z","comments":true,"path":"2023/06/30/elk/elkï¼ˆä¸€ï¼‰-åˆè¯†elk/","link":"","permalink":"http://example.com/2023/06/30/elk/elk%EF%BC%88%E4%B8%80%EF%BC%89-%E5%88%9D%E8%AF%86elk/","excerpt":"","text":"1.åˆè¯†elasticsearch1.1.äº†è§£ES1.1.1.elasticsearchçš„ä½œç”¨elasticsearchæ˜¯ä¸€æ¬¾éå¸¸å¼ºå¤§çš„å¼€æºæœç´¢å¼•æ“ï¼Œå…·å¤‡éå¸¸å¤šå¼ºå¤§åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»æµ·é‡æ•°æ®ä¸­å¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„å†…å®¹ ä¾‹å¦‚ï¼š åœ¨GitHubæœç´¢ä»£ç  åœ¨ç”µå•†ç½‘ç«™æœç´¢å•†å“ åœ¨ç™¾åº¦æœç´¢ç­”æ¡ˆ åœ¨æ‰“è½¦è½¯ä»¶æœç´¢é™„è¿‘çš„è½¦ 1.1.2.ELKæŠ€æœ¯æ ˆelasticsearchç»“åˆkibanaã€Logstashã€Beatsï¼Œä¹Ÿå°±æ˜¯elastic stackï¼ˆELKï¼‰ã€‚è¢«å¹¿æ³›åº”ç”¨åœ¨æ—¥å¿—æ•°æ®åˆ†æã€å®æ—¶ç›‘æ§ç­‰é¢†åŸŸï¼š è€Œelasticsearchæ˜¯elastic stackçš„æ ¸å¿ƒï¼Œè´Ÿè´£å­˜å‚¨ã€æœç´¢ã€åˆ†ææ•°æ®ã€‚ 1.1.3.elasticsearchå’Œluceneelasticsearchåº•å±‚æ˜¯åŸºäºluceneæ¥å®ç°çš„ã€‚ Luceneæ˜¯ä¸€ä¸ªJavaè¯­è¨€çš„æœç´¢å¼•æ“ç±»åº“ï¼Œæ˜¯Apacheå…¬å¸çš„é¡¶çº§é¡¹ç›®ï¼Œç”±DougCuttingäº1999å¹´ç ”å‘ã€‚å®˜ç½‘åœ°å€ï¼šhttps://lucene.apache.org/ ã€‚ elasticsearchçš„å‘å±•å†å²ï¼š 2004å¹´Shay BanonåŸºäºLuceneå¼€å‘äº†Compass 2010å¹´Shay Banon é‡å†™äº†Compassï¼Œå–åä¸ºElasticsearchã€‚ 1.1.4.ä¸ºä»€ä¹ˆä¸æ˜¯å…¶ä»–æœç´¢æŠ€æœ¯ï¼Ÿç›®å‰æ¯”è¾ƒçŸ¥åçš„æœç´¢å¼•æ“æŠ€æœ¯æ’åï¼š è™½ç„¶åœ¨æ—©æœŸï¼ŒApache Solræ˜¯æœ€ä¸»è¦çš„æœç´¢å¼•æ“æŠ€æœ¯ï¼Œä½†éšç€å‘å±•elasticsearchå·²ç»æ¸æ¸è¶…è¶Šäº†Solrï¼Œç‹¬å é³Œå¤´ï¼š 1.1.5.æ€»ç»“ä»€ä¹ˆæ˜¯elasticsearchï¼Ÿ ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œå¯ä»¥ç”¨æ¥å®ç°æœç´¢ã€æ—¥å¿—ç»Ÿè®¡ã€åˆ†æã€ç³»ç»Ÿç›‘æ§ç­‰åŠŸèƒ½ ä»€ä¹ˆæ˜¯elastic stackï¼ˆELKï¼‰ï¼Ÿ æ˜¯ä»¥elasticsearchä¸ºæ ¸å¿ƒçš„æŠ€æœ¯æ ˆï¼ŒåŒ…æ‹¬beatsã€Logstashã€kibanaã€elasticsearch ä»€ä¹ˆæ˜¯Luceneï¼Ÿ æ˜¯Apacheçš„å¼€æºæœç´¢å¼•æ“ç±»åº“ï¼Œæä¾›äº†æœç´¢å¼•æ“çš„æ ¸å¿ƒAPI","categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"}]},{"title":"tsï¼ˆäºŒï¼‰-é¢å‘å¯¹è±¡","slug":"vue3/typeScript/tsï¼ˆäºŒï¼‰-é¢å‘å¯¹è±¡","date":"2023-06-29T09:22:43.000Z","updated":"2023-06-29T09:23:23.438Z","comments":true,"path":"2023/06/29/vue3/typeScript/tsï¼ˆäºŒï¼‰-é¢å‘å¯¹è±¡/","link":"","permalink":"http://example.com/2023/06/29/vue3/typeScript/ts%EF%BC%88%E4%BA%8C%EF%BC%89-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/","excerpt":"","text":"ç¬¬äºŒç« ï¼šé¢å‘å¯¹è±¡é¢å‘å¯¹è±¡æ˜¯ç¨‹åºä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æ€æƒ³ï¼Œå®ƒè¢«å¾ˆå¤šåŒå­¦ç†è§£æˆäº†ä¸€ä¸ªæ¯”è¾ƒéš¾ï¼Œæ¯”è¾ƒæ·±å¥¥çš„é—®é¢˜ï¼Œå…¶å®ä¸ç„¶ã€‚é¢å‘å¯¹è±¡å¾ˆç®€å•ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ç¨‹åºä¹‹ä¸­æ‰€æœ‰çš„æ“ä½œéƒ½éœ€è¦é€šè¿‡å¯¹è±¡æ¥å®Œæˆã€‚ ä¸¾ä¾‹æ¥è¯´ï¼š æ“ä½œæµè§ˆå™¨è¦ä½¿ç”¨windowå¯¹è±¡ æ“ä½œç½‘é¡µè¦ä½¿ç”¨documentå¯¹è±¡ æ“ä½œæ§åˆ¶å°è¦ä½¿ç”¨consoleå¯¹è±¡ ä¸€åˆ‡æ“ä½œéƒ½è¦é€šè¿‡å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„é¢å‘å¯¹è±¡ï¼Œé‚£ä¹ˆå¯¹è±¡åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™å°±è¦å…ˆè¯´åˆ°ç¨‹åºæ˜¯ä»€ä¹ˆï¼Œè®¡ç®—æœºç¨‹åºçš„æœ¬è´¨å°±æ˜¯å¯¹ç°å®äº‹ç‰©çš„æŠ½è±¡ï¼ŒæŠ½è±¡çš„åä¹‰è¯æ˜¯å…·ä½“ï¼Œæ¯”å¦‚ï¼šç…§ç‰‡æ˜¯å¯¹ä¸€ä¸ªå…·ä½“çš„äººçš„æŠ½è±¡ï¼Œæ±½è½¦æ¨¡å‹æ˜¯å¯¹å…·ä½“æ±½è½¦çš„æŠ½è±¡ç­‰ç­‰ã€‚ç¨‹åºä¹Ÿæ˜¯å¯¹äº‹ç‰©çš„æŠ½è±¡ï¼Œåœ¨ç¨‹åºä¸­æˆ‘ä»¬å¯ä»¥è¡¨ç¤ºä¸€ä¸ªäººã€ä¸€æ¡ç‹—ã€ä¸€æŠŠæªã€ä¸€é¢—å­å¼¹ç­‰ç­‰æ‰€æœ‰çš„äº‹ç‰©ã€‚ä¸€ä¸ªäº‹ç‰©åˆ°äº†ç¨‹åºä¸­å°±å˜æˆäº†ä¸€ä¸ªå¯¹è±¡ã€‚ åœ¨ç¨‹åºä¸­æ‰€æœ‰çš„å¯¹è±¡éƒ½è¢«åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†æ•°æ®å’ŒåŠŸèƒ½ï¼Œä»¥äººä¸ºä¾‹ï¼Œäººçš„å§“åã€æ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ç­‰å±äºæ•°æ®ï¼Œäººå¯ä»¥è¯´è¯ã€èµ°è·¯ã€åƒé¥­ã€ç¡è§‰è¿™äº›å±äºäººçš„åŠŸèƒ½ã€‚æ•°æ®åœ¨å¯¹è±¡ä¸­è¢«æˆä¸ºå±æ€§ï¼Œè€ŒåŠŸèƒ½å°±è¢«ç§°ä¸ºæ–¹æ³•ã€‚æ‰€ä»¥ç®€è€Œè¨€ä¹‹ï¼Œåœ¨ç¨‹åºä¸­ä¸€åˆ‡çš†æ˜¯å¯¹è±¡ã€‚ 1ã€ç±»ï¼ˆclassï¼‰è¦æƒ³é¢å‘å¯¹è±¡ï¼Œæ“ä½œå¯¹è±¡ï¼Œé¦–å…ˆä¾¿è¦æ‹¥æœ‰å¯¹è±¡ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•åˆ›å»ºå¯¹è±¡ã€‚è¦åˆ›å»ºå¯¹è±¡ï¼Œå¿…é¡»è¦å…ˆå®šä¹‰ç±»ï¼Œæ‰€è°“çš„ç±»å¯ä»¥ç†è§£ä¸ºå¯¹è±¡çš„æ¨¡å‹ï¼Œç¨‹åºä¸­å¯ä»¥æ ¹æ®ç±»åˆ›å»ºæŒ‡å®šç±»å‹çš„å¯¹è±¡ï¼Œä¸¾ä¾‹æ¥è¯´ï¼šå¯ä»¥é€šè¿‡Personç±»æ¥åˆ›å»ºäººçš„å¯¹è±¡ï¼Œé€šè¿‡Dogç±»åˆ›å»ºç‹—çš„å¯¹è±¡ï¼Œé€šè¿‡Carç±»æ¥åˆ›å»ºæ±½è½¦çš„å¯¹è±¡ï¼Œä¸åŒçš„ç±»å¯ä»¥ç”¨æ¥åˆ›å»ºä¸åŒçš„å¯¹è±¡ã€‚ å®šä¹‰ç±»ï¼š class ç±»å &#123; å±æ€§å: ç±»å‹; constructor(å‚æ•°: ç±»å‹)&#123; this.å±æ€§å = å‚æ•°; &#125; æ–¹æ³•å()&#123; .... &#125; &#125; 1234567891011121314151617- ç¤ºä¾‹ï¼š - ```typescript class Person&#123; name: string; age: number; constructor(name: string, age: number)&#123; this.name = name; this.age = age; &#125; sayHello()&#123; console.log(`å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯$&#123;this.name&#125;`); &#125; &#125; ä½¿ç”¨ç±»ï¼š const p = new Person(&#39;å­™æ‚Ÿç©º&#39;, 18); p.sayHello(); 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647## 2ã€é¢å‘å¯¹è±¡çš„ç‰¹ç‚¹- å°è£… - å¯¹è±¡å®è´¨ä¸Šå°±æ˜¯å±æ€§å’Œæ–¹æ³•çš„å®¹å™¨ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯å­˜å‚¨å±æ€§å’Œæ–¹æ³•ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å°è£… - é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹è±¡çš„å±æ€§æ˜¯å¯ä»¥ä»»æ„çš„ä¿®æ”¹çš„ï¼Œä¸ºäº†ç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§ï¼Œåœ¨TSä¸­å¯ä»¥å¯¹å±æ€§çš„æƒé™è¿›è¡Œè®¾ç½® - åªè¯»å±æ€§ï¼ˆreadonlyï¼‰ï¼š - å¦‚æœåœ¨å£°æ˜å±æ€§æ—¶æ·»åŠ ä¸€ä¸ªreadonlyï¼Œåˆ™å±æ€§ä¾¿æˆäº†åªè¯»å±æ€§æ— æ³•ä¿®æ”¹ - TSä¸­å±æ€§å…·æœ‰ä¸‰ç§ä¿®é¥°ç¬¦ï¼š - publicï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œå¯ä»¥åœ¨ç±»ã€å­ç±»å’Œå¯¹è±¡ä¸­ä¿®æ”¹ - protected ï¼Œå¯ä»¥åœ¨ç±»ã€å­ç±»ä¸­ä¿®æ”¹ - private ï¼Œå¯ä»¥åœ¨ç±»ä¸­ä¿®æ”¹ - ç¤ºä¾‹ï¼š - public - ```typescript class Person&#123; public name: string; // å†™æˆ–ä»€ä¹ˆéƒ½ä¸å†™éƒ½æ˜¯public public age: number; constructor(name: string, age: number)&#123; this.name = name; // å¯ä»¥åœ¨ç±»ä¸­ä¿®æ”¹ this.age = age; &#125; sayHello()&#123; console.log(`å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯$&#123;this.name&#125;`); &#125; &#125; class Employee extends Person&#123; constructor(name: string, age: number)&#123; super(name, age); this.name = name; //å­ç±»ä¸­å¯ä»¥ä¿®æ”¹ &#125; &#125; const p = new Person(&#x27;å­™æ‚Ÿç©º&#x27;, 18); p.name = &#x27;çŒªå…«æˆ’&#x27;;// å¯ä»¥é€šè¿‡å¯¹è±¡ä¿®æ”¹ - protected - ```typescript class Person&#123; protected name: string; protected age: number; constructor(name: string, age: number)&#123; this.name = name; // å¯ä»¥ä¿®æ”¹ this.age = age; &#125; sayHello()&#123; console.log(`å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯$&#123;this.name&#125;`); &#125; &#125; class Employee extends Person&#123; constructor(name: string, age: number)&#123; super(name, age); this.name = name; //å­ç±»ä¸­å¯ä»¥ä¿®æ”¹ &#125; &#125; const p = new Person(&#39;å­™æ‚Ÿç©º&#39;, 18); p.name = &#39;çŒªå…«æˆ’&#39;;// ä¸èƒ½ä¿®æ”¹ 12345678910111213141516171819202122232425262728- private - ```typescript class Person&#123; private name: string; private age: number; constructor(name: string, age: number)&#123; this.name = name; // å¯ä»¥ä¿®æ”¹ this.age = age; &#125; sayHello()&#123; console.log(`å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯$&#123;this.name&#125;`); &#125; &#125; class Employee extends Person&#123; constructor(name: string, age: number)&#123; super(name, age); this.name = name; //å­ç±»ä¸­ä¸èƒ½ä¿®æ”¹ &#125; &#125; const p = new Person(&#x27;å­™æ‚Ÿç©º&#x27;, 18); p.name = &#x27;çŒªå…«æˆ’&#x27;;// ä¸èƒ½ä¿®æ”¹ å±æ€§å­˜å–å™¨ å¯¹äºä¸€äº›ä¸å¸Œæœ›è¢«ä»»æ„ä¿®æ”¹çš„å±æ€§ï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºprivate ç›´æ¥å°†å…¶è®¾ç½®ä¸ºprivateå°†å¯¼è‡´æ— æ³•å†é€šè¿‡å¯¹è±¡ä¿®æ”¹å…¶ä¸­çš„å±æ€§ æˆ‘ä»¬å¯ä»¥åœ¨ç±»ä¸­å®šä¹‰ä¸€ç»„è¯»å–ã€è®¾ç½®å±æ€§çš„æ–¹æ³•ï¼Œè¿™ç§å¯¹å±æ€§è¯»å–æˆ–è®¾ç½®çš„å±æ€§è¢«ç§°ä¸ºå±æ€§çš„å­˜å–å™¨ è¯»å–å±æ€§çš„æ–¹æ³•å«åšsetteræ–¹æ³•ï¼Œè®¾ç½®å±æ€§çš„æ–¹æ³•å«åšgetteræ–¹æ³• ç¤ºä¾‹ï¼š class Person&#123; private _name: string; constructor(name: string)&#123; this._name = name; &#125; get name()&#123; return this._name; &#125; set name(name: string)&#123; this._name = name; &#125; &#125; const p1 = new Person(&#39;å­™æ‚Ÿç©º&#39;); console.log(p1.name); // é€šè¿‡getterè¯»å–nameå±æ€§ p1.name = &#39;çŒªå…«æˆ’&#39;; // é€šè¿‡setterä¿®æ”¹nameå±æ€§ 1234567891011121314151617181920- é™æ€å±æ€§ - é™æ€å±æ€§ï¼ˆæ–¹æ³•ï¼‰ï¼Œä¹Ÿç§°ä¸ºç±»å±æ€§ã€‚ä½¿ç”¨é™æ€å±æ€§æ— éœ€åˆ›å»ºå®ä¾‹ï¼Œé€šè¿‡ç±»å³å¯ç›´æ¥ä½¿ç”¨ - é™æ€å±æ€§ï¼ˆæ–¹æ³•ï¼‰ä½¿ç”¨staticå¼€å¤´ - ç¤ºä¾‹ï¼š - ```typescript class Tools&#123; static PI = 3.1415926; static sum(num1: number, num2: number)&#123; return num1 + num2 &#125; &#125; console.log(Tools.PI); console.log(Tools.sum(123, 456)); this åœ¨ç±»ä¸­ï¼Œä½¿ç”¨thisè¡¨ç¤ºå½“å‰å¯¹è±¡ ç»§æ‰¿ ç»§æ‰¿æ—¶é¢å‘å¯¹è±¡ä¸­çš„åˆä¸€ä¸ªç‰¹æ€§ é€šè¿‡ç»§æ‰¿å¯ä»¥å°†å…¶ä»–ç±»ä¸­çš„å±æ€§å’Œæ–¹æ³•å¼•å…¥åˆ°å½“å‰ç±»ä¸­ ç¤ºä¾‹ï¼š class Animal&#123; name: string; age: number; constructor(name: string, age: number)&#123; this.name = name; this.age = age; &#125; &#125; class Dog extends Animal&#123; bark()&#123; console.log(`$&#123;this.name&#125;åœ¨æ±ªæ±ªå«ï¼`); &#125; &#125; const dog = new Dog(&#39;æ—ºè´¢&#39;, 4); dog.bark(); 12345678910111213141516171819202122232425262728293031323334353637- é€šè¿‡ç»§æ‰¿å¯ä»¥åœ¨ä¸ä¿®æ”¹ç±»çš„æƒ…å†µä¸‹å®Œæˆå¯¹ç±»çš„æ‰©å±•- é‡å†™ - å‘ç”Ÿç»§æ‰¿æ—¶ï¼Œå¦‚æœå­ç±»ä¸­çš„æ–¹æ³•ä¼šæ›¿æ¢æ‰çˆ¶ç±»ä¸­çš„åŒåæ–¹æ³•ï¼Œè¿™å°±ç§°ä¸ºæ–¹æ³•çš„é‡å†™ - ç¤ºä¾‹ï¼š - ```typescript class Animal&#123; name: string; age: number; constructor(name: string, age: number)&#123; this.name = name; this.age = age; &#125; run()&#123; console.log(`çˆ¶ç±»ä¸­çš„runæ–¹æ³•ï¼`); &#125; &#125; class Dog extends Animal&#123; bark()&#123; console.log(`$&#123;this.name&#125;åœ¨æ±ªæ±ªå«ï¼`); &#125; run()&#123; console.log(`å­ç±»ä¸­çš„runæ–¹æ³•ï¼Œä¼šé‡å†™çˆ¶ç±»ä¸­çš„runæ–¹æ³•ï¼`); &#125; &#125; const dog = new Dog(&#x27;æ—ºè´¢&#x27;, 4); dog.bark(); åœ¨å­ç±»ä¸­å¯ä»¥ä½¿ç”¨superæ¥å®Œæˆå¯¹çˆ¶ç±»çš„å¼•ç”¨ æŠ½è±¡ç±»ï¼ˆabstract classï¼‰ æŠ½è±¡ç±»æ˜¯ä¸“é—¨ç”¨æ¥è¢«å…¶ä»–ç±»æ‰€ç»§æ‰¿çš„ç±»ï¼Œå®ƒåªèƒ½è¢«å…¶ä»–ç±»æ‰€ç»§æ‰¿ä¸èƒ½ç”¨æ¥åˆ›å»ºå®ä¾‹ abstract class Animal&#123; abstract run(): void; bark()&#123; console.log(&#39;åŠ¨ç‰©åœ¨å«~&#39;); &#125; &#125; class Dog extends Animals&#123; run()&#123; console.log(&#39;ç‹—åœ¨è·‘~&#39;); &#125; &#125; 1234567891011121314151617181920212223 - ä½¿ç”¨abstractå¼€å¤´çš„æ–¹æ³•å«åšæŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä½“åªèƒ½å®šä¹‰åœ¨æŠ½è±¡ç±»ä¸­ï¼Œç»§æ‰¿æŠ½è±¡ç±»æ—¶æŠ½è±¡æ–¹æ³•å¿…é¡»è¦å®ç° ## 3ã€æ¥å£ï¼ˆInterfaceï¼‰æ¥å£çš„ä½œç”¨ç±»ä¼¼äºæŠ½è±¡ç±»ï¼Œä¸åŒç‚¹åœ¨äºæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•å’Œå±æ€§éƒ½æ˜¯æ²¡æœ‰å®å€¼çš„ï¼Œæ¢å¥è¯è¯´æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯æŠ½è±¡æ–¹æ³•ã€‚æ¥å£ä¸»è¦è´Ÿè´£å®šä¹‰ä¸€ä¸ªç±»çš„ç»“æ„ï¼Œæ¥å£å¯ä»¥å»é™åˆ¶ä¸€ä¸ªå¯¹è±¡çš„æ¥å£ï¼Œå¯¹è±¡åªæœ‰åŒ…å«æ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•æ—¶æ‰èƒ½åŒ¹é…æ¥å£ã€‚åŒæ—¶ï¼Œå¯ä»¥è®©ä¸€ä¸ªç±»å»å®ç°æ¥å£ï¼Œå®ç°æ¥å£æ—¶ç±»ä¸­è¦ä¿æŠ¤æ¥å£ä¸­çš„æ‰€æœ‰å±æ€§ã€‚- ç¤ºä¾‹ï¼ˆæ£€æŸ¥å¯¹è±¡ç±»å‹ï¼‰ï¼š - ```typescript interface Person&#123; name: string; sayHello():void; &#125; function fn(per: Person)&#123; per.sayHello(); &#125; fn(&#123;name:&#x27;å­™æ‚Ÿç©º&#x27;, sayHello() &#123;console.log(`Hello, æˆ‘æ˜¯ $&#123;this.name&#125;`)&#125;&#125;); ç¤ºä¾‹ï¼ˆå®ç°ï¼‰ interface Person&#123; name: string; sayHello():void; &#125; class Student implements Person&#123; constructor(public name: string) &#123; &#125; sayHello() &#123; console.log(&#39;å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯&#39;+this.name); &#125; &#125; 123456789101112131415 - ## 4ã€æ³›å‹ï¼ˆGenericï¼‰å®šä¹‰ä¸€ä¸ªå‡½æ•°æˆ–ç±»æ—¶ï¼Œæœ‰äº›æƒ…å†µä¸‹æ— æ³•ç¡®å®šå…¶ä¸­è¦ä½¿ç”¨çš„å…·ä½“ç±»å‹ï¼ˆè¿”å›å€¼ã€å‚æ•°ã€å±æ€§çš„ç±»å‹ä¸èƒ½ç¡®å®šï¼‰ï¼Œæ­¤æ—¶æ³›å‹ä¾¿èƒ½å¤Ÿå‘æŒ¥ä½œç”¨ã€‚- ä¸¾ä¸ªä¾‹å­ï¼š - ```typescript function test(arg: any): any&#123; return arg; &#125; ä¸Šä¾‹ä¸­ï¼Œtestå‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°ç±»å‹ä¸ç¡®å®šï¼Œä½†æ˜¯èƒ½ç¡®å®šçš„æ—¶å…¶è¿”å›å€¼çš„ç±»å‹å’Œå‚æ•°çš„ç±»å‹æ˜¯ç›¸åŒçš„ï¼Œç”±äºç±»å‹ä¸ç¡®å®šæ‰€ä»¥å‚æ•°å’Œè¿”å›å€¼å‡ä½¿ç”¨äº†anyï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾è¿™æ ·åšæ˜¯ä¸åˆé€‚çš„ï¼Œé¦–å…ˆä½¿ç”¨anyä¼šå…³é—­TSçš„ç±»å‹æ£€æŸ¥ï¼Œå…¶æ¬¡è¿™æ ·è®¾ç½®ä¹Ÿä¸èƒ½ä½“ç°å‡ºå‚æ•°å’Œè¿”å›å€¼æ˜¯ç›¸åŒçš„ç±»å‹ ä½¿ç”¨æ³›å‹ï¼š function test&lt;T&gt;(arg: T): T&#123; return arg; &#125; 123456789- è¿™é‡Œçš„```&lt;T&gt;```å°±æ˜¯æ³›å‹ï¼ŒTæ˜¯æˆ‘ä»¬ç»™è¿™ä¸ªç±»å‹èµ·çš„åå­—ï¼ˆä¸ä¸€å®šéå«Tï¼‰ï¼Œè®¾ç½®æ³›å‹åå³å¯åœ¨å‡½æ•°ä¸­ä½¿ç”¨Tæ¥è¡¨ç¤ºè¯¥ç±»å‹ã€‚æ‰€ä»¥æ³›å‹å…¶å®å¾ˆå¥½ç†è§£ï¼Œå°±è¡¨ç¤ºæŸä¸ªç±»å‹ã€‚- é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ä¸Šè¾¹çš„å‡½æ•°å‘¢ï¼Ÿ - æ–¹å¼ä¸€ï¼ˆç›´æ¥ä½¿ç”¨ï¼‰ï¼š - ```typescript test(10) - ä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥ä¼ é€’å‚æ•°ä½¿ç”¨ï¼Œç±»å‹ä¼šç”±TSè‡ªåŠ¨æ¨æ–­å‡ºæ¥ï¼Œä½†æœ‰æ—¶ç¼–è¯‘å™¨æ— æ³•è‡ªåŠ¨æ¨æ–­æ—¶è¿˜éœ€è¦ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ - æ–¹å¼äºŒï¼ˆæŒ‡å®šç±»å‹ï¼‰ï¼š - ```typescript test&lt;number&gt;(10) 1234567891011 - ä¹Ÿå¯ä»¥åœ¨å‡½æ•°åæ‰‹åŠ¨æŒ‡å®šæ³›å‹- å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæ³›å‹ï¼Œæ³›å‹é—´ä½¿ç”¨é€—å·éš”å¼€ï¼š - ```typescript function test&lt;T, K&gt;(a: T, b: K): K&#123; return b; &#125; test&lt;number, string&gt;(10, &quot;hello&quot;); - ä½¿ç”¨æ³›å‹æ—¶ï¼Œå®Œå…¨å¯ä»¥å°†æ³›å‹å½“æˆæ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»å»ä½¿ç”¨ ç±»ä¸­åŒæ ·å¯ä»¥ä½¿ç”¨æ³›å‹ï¼š class MyClass&lt;T&gt;&#123; prop: T; constructor(prop: T)&#123; this.prop = prop; &#125; &#125; 1234567891011- é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥å¯¹æ³›å‹çš„èŒƒå›´è¿›è¡Œçº¦æŸ - ```typescript interface MyInter&#123; length: number; &#125; function test&lt;T extends MyInter&gt;(arg: T): number&#123; return arg.length; &#125; ä½¿ç”¨T extends MyInterè¡¨ç¤ºæ³›å‹Tå¿…é¡»æ˜¯MyInterçš„å­ç±»ï¼Œä¸ä¸€å®šéè¦ä½¿ç”¨æ¥å£ç±»å’ŒæŠ½è±¡ç±»åŒæ ·é€‚ç”¨ã€‚","categories":[{"name":"ts","slug":"ts","permalink":"http://example.com/ts/"}],"tags":[{"name":"ts","slug":"ts","permalink":"http://example.com/tags/ts/"}]},{"title":"tsï¼ˆä¸€ï¼‰-å¿«é€Ÿå…¥é—¨","slug":"vue3/typeScript/tsï¼ˆä¸€ï¼‰-å¿«é€Ÿå…¥é—¨","date":"2023-06-29T09:21:11.000Z","updated":"2023-06-29T09:22:15.472Z","comments":true,"path":"2023/06/29/vue3/typeScript/tsï¼ˆä¸€ï¼‰-å¿«é€Ÿå…¥é—¨/","link":"","permalink":"http://example.com/2023/06/29/vue3/typeScript/ts%EF%BC%88%E4%B8%80%EF%BC%89-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/","excerpt":"","text":"ç¬¬ä¸€ç«  å¿«é€Ÿå…¥é—¨0ã€TypeScriptç®€ä»‹ TypeScriptæ˜¯JavaScriptçš„è¶…é›†ã€‚ å®ƒå¯¹JSè¿›è¡Œäº†æ‰©å±•ï¼Œå‘JSä¸­å¼•å…¥äº†ç±»å‹çš„æ¦‚å¿µï¼Œå¹¶æ·»åŠ äº†è®¸å¤šæ–°çš„ç‰¹æ€§ã€‚ TSä»£ç éœ€è¦é€šè¿‡ç¼–è¯‘å™¨ç¼–è¯‘ä¸ºJSï¼Œç„¶åå†äº¤ç”±JSè§£æå™¨æ‰§è¡Œã€‚ TSå®Œå…¨å…¼å®¹JSï¼Œæ¢è¨€ä¹‹ï¼Œä»»ä½•çš„JSä»£ç éƒ½å¯ä»¥ç›´æ¥å½“æˆJSä½¿ç”¨ã€‚ ç›¸è¾ƒäºJSè€Œè¨€ï¼ŒTSæ‹¥æœ‰äº†é™æ€ç±»å‹ï¼Œæ›´åŠ ä¸¥æ ¼çš„è¯­æ³•ï¼Œæ›´å¼ºå¤§çš„åŠŸèƒ½ï¼›TSå¯ä»¥åœ¨ä»£ç æ‰§è¡Œå‰å°±å®Œæˆä»£ç çš„æ£€æŸ¥ï¼Œå‡å°äº†è¿è¡Œæ—¶å¼‚å¸¸çš„å‡ºç°çš„å‡ ç‡ï¼›TSä»£ç å¯ä»¥ç¼–è¯‘ä¸ºä»»æ„ç‰ˆæœ¬çš„JSä»£ç ï¼Œå¯æœ‰æ•ˆè§£å†³ä¸åŒJSè¿è¡Œç¯å¢ƒçš„å…¼å®¹é—®é¢˜ï¼›åŒæ ·çš„åŠŸèƒ½ï¼ŒTSçš„ä»£ç é‡è¦å¤§äºJSï¼Œä½†ç”±äºTSçš„ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œå˜é‡ç±»å‹æ›´åŠ æ˜ç¡®ï¼Œåœ¨åæœŸä»£ç çš„ç»´æŠ¤ä¸­TSå´è¿œè¿œèƒœäºJSã€‚ 1ã€TypeScript å¼€å‘ç¯å¢ƒæ­å»º ä¸‹è½½Node.js 64ä½ï¼šhttps://nodejs.org/dist/v14.15.1/node-v14.15.1-x64.msi 32ä½ï¼šhttps://nodejs.org/dist/v14.15.1/node-v14.15.1-x86.msi å®‰è£…Node.js ä½¿ç”¨npmå…¨å±€å®‰è£…typescript è¿›å…¥å‘½ä»¤è¡Œ è¾“å…¥ï¼šnpm i -g typescript åˆ›å»ºä¸€ä¸ªtsæ–‡ä»¶ ä½¿ç”¨tscå¯¹tsæ–‡ä»¶è¿›è¡Œç¼–è¯‘ è¿›å…¥å‘½ä»¤è¡Œ è¿›å…¥tsæ–‡ä»¶æ‰€åœ¨ç›®å½• æ‰§è¡Œå‘½ä»¤ï¼štsc xxx.ts 2ã€åŸºæœ¬ç±»å‹ ç±»å‹å£°æ˜ ç±»å‹å£°æ˜æ˜¯TSéå¸¸é‡è¦çš„ä¸€ä¸ªç‰¹ç‚¹ é€šè¿‡ç±»å‹å£°æ˜å¯ä»¥æŒ‡å®šTSä¸­å˜é‡ï¼ˆå‚æ•°ã€å½¢å‚ï¼‰çš„ç±»å‹ æŒ‡å®šç±»å‹åï¼Œå½“ä¸ºå˜é‡èµ‹å€¼æ—¶ï¼ŒTSç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ£€æŸ¥å€¼æ˜¯å¦ç¬¦åˆç±»å‹å£°æ˜ï¼Œç¬¦åˆåˆ™èµ‹å€¼ï¼Œå¦åˆ™æŠ¥é”™ ç®€è€Œè¨€ä¹‹ï¼Œç±»å‹å£°æ˜ç»™å˜é‡è®¾ç½®äº†ç±»å‹ï¼Œä½¿å¾—å˜é‡åªèƒ½å­˜å‚¨æŸç§ç±»å‹çš„å€¼ è¯­æ³•ï¼š let å˜é‡: ç±»å‹; let å˜é‡: ç±»å‹ = å€¼; function fn(å‚æ•°: ç±»å‹, å‚æ•°: ç±»å‹): ç±»å‹&#123; ... &#125; 1234567891011121314151617181920212223242526272829303132- è‡ªåŠ¨ç±»å‹åˆ¤æ–­ - TSæ‹¥æœ‰è‡ªåŠ¨çš„ç±»å‹åˆ¤æ–­æœºåˆ¶ - å½“å¯¹å˜é‡çš„å£°æ˜å’Œèµ‹å€¼æ˜¯åŒæ—¶è¿›è¡Œçš„ï¼ŒTSç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åˆ¤æ–­å˜é‡çš„ç±»å‹ - æ‰€ä»¥å¦‚æœä½ çš„å˜é‡çš„å£°æ˜å’Œèµ‹å€¼æ—¶åŒæ—¶è¿›è¡Œçš„ï¼Œå¯ä»¥çœç•¥æ‰ç±»å‹å£°æ˜- ç±»å‹ï¼š | ç±»å‹ | ä¾‹å­ | æè¿° | | :-----: | :---------------: | :----------------------------: | | number | 1, -33, 2.5 | ä»»æ„æ•°å­— | | string | &#x27;hi&#x27;, &quot;hi&quot;, `hi` | ä»»æ„å­—ç¬¦ä¸² | | boolean | trueã€false | å¸ƒå°”å€¼trueæˆ–false | | å­—é¢é‡ | å…¶æœ¬èº« | é™åˆ¶å˜é‡çš„å€¼å°±æ˜¯è¯¥å­—é¢é‡çš„å€¼ | | any | * | ä»»æ„ç±»å‹ | | unknown | * | ç±»å‹å®‰å…¨çš„any | | void | ç©ºå€¼ï¼ˆundefinedï¼‰ | æ²¡æœ‰å€¼ï¼ˆæˆ–undefinedï¼‰ | | never | æ²¡æœ‰å€¼ | ä¸èƒ½æ˜¯ä»»ä½•å€¼ | | object | &#123;name:&#x27;å­™æ‚Ÿç©º&#x27;&#125; | ä»»æ„çš„JSå¯¹è±¡ | | array | [1,2,3] | ä»»æ„JSæ•°ç»„ | | tuple | [4,5] | å…ƒç´ ï¼ŒTSæ–°å¢ç±»å‹ï¼Œå›ºå®šé•¿åº¦æ•°ç»„ | | enum | enum&#123;A, B&#125; | æšä¸¾ï¼ŒTSä¸­æ–°å¢ç±»å‹ |- number - ```typescript let decimal: number = 6; let hex: number = 0xf00d; let binary: number = 0b1010; let octal: number = 0o744; let big: bigint = 100n; boolean let isDone: boolean = false; 123456789101112- string - ```typescript let color: string = &quot;blue&quot;; color = &#x27;red&#x27;; let fullName: string = `Bob Bobbington`; let age: number = 37; let sentence: string = `Hello, my name is $&#123;fullName&#125;. I&#x27;ll be $&#123;age + 1&#125; years old next month.`; å­—é¢é‡ ä¹Ÿå¯ä»¥ä½¿ç”¨å­—é¢é‡å»æŒ‡å®šå˜é‡çš„ç±»å‹ï¼Œé€šè¿‡å­—é¢é‡å¯ä»¥ç¡®å®šå˜é‡çš„å–å€¼èŒƒå›´ let color: &#39;red&#39; | &#39;blue&#39; | &#39;black&#39;; let num: 1 | 2 | 3 | 4 | 5; 1234567- any - ```typescript let d: any = 4; d = &#x27;hello&#x27;; d = true; unknown let notSure: unknown = 4; notSure = &#39;hello&#39;; 12345- void - ```typescript let unusable: void = undefined; never function error(message: string): never &#123; throw new Error(message); &#125; 12345- objectï¼ˆæ²¡å•¥ç”¨ï¼‰ - ```typescript let obj: object = &#123;&#125;; array let list: number[] = [1, 2, 3]; let list: Array&lt;number&gt; = [1, 2, 3]; 123456- tuple - ```typescript let x: [string, number]; x = [&quot;hello&quot;, 10]; enum enum Color &#123; Red, Green, Blue, &#125; let c: Color = Color.Green; enum Color &#123; Red = 1, Green, Blue, &#125; let c: Color = Color.Green; enum Color &#123; Red = 1, Green = 2, Blue = 4, &#125; let c: Color = Color.Green; 12345678910- ç±»å‹æ–­è¨€ - æœ‰äº›æƒ…å†µä¸‹ï¼Œå˜é‡çš„ç±»å‹å¯¹äºæˆ‘ä»¬æ¥è¯´æ˜¯å¾ˆæ˜ç¡®ï¼Œä½†æ˜¯TSç¼–è¯‘å™¨å´å¹¶ä¸æ¸…æ¥šï¼Œæ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡ç±»å‹æ–­è¨€æ¥å‘Šè¯‰ç¼–è¯‘å™¨å˜é‡çš„ç±»å‹ï¼Œæ–­è¨€æœ‰ä¸¤ç§å½¢å¼ï¼š - ç¬¬ä¸€ç§ - ```typescript let someValue: unknown = &quot;this is a string&quot;; let strLength: number = (someValue as string).length; - ç¬¬äºŒç§ - ```typescript let someValue: unknown = &quot;this is a string&quot;; let strLength: number = (&lt;string&gt;someValue).length; 12345678910111213 ## 3ã€ç¼–è¯‘é€‰é¡¹- è‡ªåŠ¨ç¼–è¯‘æ–‡ä»¶ - ç¼–è¯‘æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨ -w æŒ‡ä»¤åï¼ŒTSç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç›‘è§†æ–‡ä»¶çš„å˜åŒ–ï¼Œå¹¶åœ¨æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶å¯¹æ–‡ä»¶è¿›è¡Œé‡æ–°ç¼–è¯‘ã€‚ - ç¤ºä¾‹ï¼š - ```powershell tsc xxx.ts -w è‡ªåŠ¨ç¼–è¯‘æ•´ä¸ªé¡¹ç›® å¦‚æœç›´æ¥ä½¿ç”¨tscæŒ‡ä»¤ï¼Œåˆ™å¯ä»¥è‡ªåŠ¨å°†å½“å‰é¡¹ç›®ä¸‹çš„æ‰€æœ‰tsæ–‡ä»¶ç¼–è¯‘ä¸ºjsæ–‡ä»¶ã€‚ ä½†æ˜¯èƒ½ç›´æ¥ä½¿ç”¨tscå‘½ä»¤çš„å‰ææ—¶ï¼Œè¦å…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªtsçš„é…ç½®æ–‡ä»¶ tsconfig.json tsconfig.jsonæ˜¯ä¸€ä¸ªJSONæ–‡ä»¶ï¼Œæ·»åŠ é…ç½®æ–‡ä»¶åï¼Œåªéœ€åªéœ€ tsc å‘½ä»¤å³å¯å®Œæˆå¯¹æ•´ä¸ªé¡¹ç›®çš„ç¼–è¯‘ é…ç½®é€‰é¡¹ï¼š include å®šä¹‰å¸Œæœ›è¢«ç¼–è¯‘æ–‡ä»¶æ‰€åœ¨çš„ç›®å½• é»˜è®¤å€¼ï¼š[â€œ**&#x2F;*â€œ] ç¤ºä¾‹ï¼š &quot;include&quot;:[&quot;src/**/*&quot;, &quot;tests/**/*&quot;] 12345678910111213 - ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰srcç›®å½•å’Œtestsç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½ä¼šè¢«ç¼–è¯‘- exclude - å®šä¹‰éœ€è¦æ’é™¤åœ¨å¤–çš„ç›®å½• - é»˜è®¤å€¼ï¼š[&quot;node_modules&quot;, &quot;bower_components&quot;, &quot;jspm_packages&quot;] - ç¤ºä¾‹ï¼š - ```json &quot;exclude&quot;: [&quot;./src/hello/**/*&quot;] ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œsrcä¸‹helloç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½ä¸ä¼šè¢«ç¼–è¯‘ extends å®šä¹‰è¢«ç»§æ‰¿çš„é…ç½®æ–‡ä»¶ ç¤ºä¾‹ï¼š &quot;extends&quot;: &quot;./configs/base&quot; 123456789101112131415161718192021 - ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå½“å‰é…ç½®æ–‡ä»¶ä¸­ä¼šè‡ªåŠ¨åŒ…å«configç›®å½•ä¸‹base.jsonä¸­çš„æ‰€æœ‰é…ç½®ä¿¡æ¯- files - æŒ‡å®šè¢«ç¼–è¯‘æ–‡ä»¶çš„åˆ—è¡¨ï¼Œåªæœ‰éœ€è¦ç¼–è¯‘çš„æ–‡ä»¶å°‘æ—¶æ‰ä¼šç”¨åˆ° - ç¤ºä¾‹ï¼š - ```json &quot;files&quot;: [ &quot;core.ts&quot;, &quot;sys.ts&quot;, &quot;types.ts&quot;, &quot;scanner.ts&quot;, &quot;parser.ts&quot;, &quot;utilities.ts&quot;, &quot;binder.ts&quot;, &quot;checker.ts&quot;, &quot;tsc.ts&quot; ] åˆ—è¡¨ä¸­çš„æ–‡ä»¶éƒ½ä¼šè¢«TSç¼–è¯‘å™¨æ‰€ç¼–è¯‘ compilerOptions ç¼–è¯‘é€‰é¡¹æ˜¯é…ç½®æ–‡ä»¶ä¸­éå¸¸é‡è¦ä¹Ÿæ¯”è¾ƒå¤æ‚çš„é…ç½®é€‰é¡¹ åœ¨compilerOptionsä¸­åŒ…å«å¤šä¸ªå­é€‰é¡¹ï¼Œç”¨æ¥å®Œæˆå¯¹ç¼–è¯‘çš„é…ç½® é¡¹ç›®é€‰é¡¹ target è®¾ç½®tsä»£ç ç¼–è¯‘çš„ç›®æ ‡ç‰ˆæœ¬ å¯é€‰å€¼ï¼š ES3ï¼ˆé»˜è®¤ï¼‰ã€ES5ã€ES6&#x2F;ES2015ã€ES7&#x2F;ES2016ã€ES2017ã€ES2018ã€ES2019ã€ES2020ã€ESNext ç¤ºä¾‹ï¼š &quot;compilerOptions&quot;: &#123; &quot;target&quot;: &quot;ES6&quot; &#125; 1234567891011121314151617181920 - å¦‚ä¸Šè®¾ç½®ï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„tsä»£ç å°†ä¼šè¢«ç¼–è¯‘ä¸ºES6ç‰ˆæœ¬çš„jsä»£ç - lib - æŒ‡å®šä»£ç è¿è¡Œæ—¶æ‰€åŒ…å«çš„åº“ï¼ˆå®¿ä¸»ç¯å¢ƒï¼‰ - å¯é€‰å€¼ï¼š - ES5ã€ES6/ES2015ã€ES7/ES2016ã€ES2017ã€ES2018ã€ES2019ã€ES2020ã€ESNextã€DOMã€WebWorkerã€ScriptHost ...... - ç¤ºä¾‹ï¼š - ```json &quot;compilerOptions&quot;: &#123; &quot;target&quot;: &quot;ES6&quot;, &quot;lib&quot;: [&quot;ES6&quot;, &quot;DOM&quot;], &quot;outDir&quot;: &quot;dist&quot;, &quot;outFile&quot;: &quot;dist/aa.js&quot; &#125; module è®¾ç½®ç¼–è¯‘åä»£ç ä½¿ç”¨çš„æ¨¡å—åŒ–ç³»ç»Ÿ å¯é€‰å€¼ï¼š CommonJSã€UMDã€AMDã€Systemã€ES2020ã€ESNextã€None ç¤ºä¾‹ï¼š &quot;compilerOptions&quot;: &#123; &quot;module&quot;: &quot;CommonJS&quot; &#125; 12345678910111213- outDir - ç¼–è¯‘åæ–‡ä»¶çš„æ‰€åœ¨ç›®å½• - é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘åçš„jsæ–‡ä»¶ä¼šå’Œtsæ–‡ä»¶ä½äºç›¸åŒçš„ç›®å½•ï¼Œè®¾ç½®outDiråå¯ä»¥æ”¹å˜ç¼–è¯‘åæ–‡ä»¶çš„ä½ç½® - ç¤ºä¾‹ï¼š - ```json &quot;compilerOptions&quot;: &#123; &quot;outDir&quot;: &quot;dist&quot; &#125; è®¾ç½®åç¼–è¯‘åçš„jsæ–‡ä»¶å°†ä¼šç”Ÿæˆåˆ°distç›®å½• outFile å°†æ‰€æœ‰çš„æ–‡ä»¶ç¼–è¯‘ä¸ºä¸€ä¸ªjsæ–‡ä»¶ é»˜è®¤ä¼šå°†æ‰€æœ‰çš„ç¼–å†™åœ¨å…¨å±€ä½œç”¨åŸŸä¸­çš„ä»£ç åˆå¹¶ä¸ºä¸€ä¸ªjsæ–‡ä»¶ï¼Œå¦‚æœmoduleåˆ¶å®šäº†Noneã€Systemæˆ–AMDåˆ™ä¼šå°†æ¨¡å—ä¸€èµ·åˆå¹¶åˆ°æ–‡ä»¶ä¹‹ä¸­ ç¤ºä¾‹ï¼š &quot;compilerOptions&quot;: &#123; &quot;outFile&quot;: &quot;dist/app.js&quot; &#125; 1234567891011- rootDir - æŒ‡å®šä»£ç çš„æ ¹ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¼–è¯‘åæ–‡ä»¶çš„ç›®å½•ç»“æ„ä¼šä»¥æœ€é•¿çš„å…¬å…±ç›®å½•ä¸ºæ ¹ç›®å½•ï¼Œé€šè¿‡rootDirå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ ¹ç›®å½• - ç¤ºä¾‹ï¼š - ```json &quot;compilerOptions&quot;: &#123; &quot;rootDir&quot;: &quot;./src&quot; &#125; allowJs æ˜¯å¦å¯¹jsæ–‡ä»¶ç¼–è¯‘ checkJs æ˜¯å¦å¯¹jsæ–‡ä»¶è¿›è¡Œæ£€æŸ¥ ç¤ºä¾‹ï¼š &quot;compilerOptions&quot;: &#123; &quot;allowJs&quot;: true, &quot;checkJs&quot;: true &#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141 - removeComments - æ˜¯å¦åˆ é™¤æ³¨é‡Š - é»˜è®¤å€¼ï¼šfalse - noEmit - ä¸å¯¹ä»£ç è¿›è¡Œç¼–è¯‘ - é»˜è®¤å€¼ï¼šfalse - sourceMap - æ˜¯å¦ç”ŸæˆsourceMap - é»˜è®¤å€¼ï¼šfalse - ä¸¥æ ¼æ£€æŸ¥ - strict - å¯ç”¨æ‰€æœ‰çš„ä¸¥æ ¼æ£€æŸ¥ï¼Œé»˜è®¤å€¼ä¸ºtrueï¼Œè®¾ç½®åç›¸å½“äºå¼€å¯äº†æ‰€æœ‰çš„ä¸¥æ ¼æ£€æŸ¥ - alwaysStrict - æ€»æ˜¯ä»¥ä¸¥æ ¼æ¨¡å¼å¯¹ä»£ç è¿›è¡Œç¼–è¯‘ - noImplicitAny - ç¦æ­¢éšå¼çš„anyç±»å‹ - noImplicitThis - ç¦æ­¢ç±»å‹ä¸æ˜ç¡®çš„this - strictBindCallApply - ä¸¥æ ¼æ£€æŸ¥bindã€callå’Œapplyçš„å‚æ•°åˆ—è¡¨ - strictFunctionTypes - ä¸¥æ ¼æ£€æŸ¥å‡½æ•°çš„ç±»å‹ - strictNullChecks - ä¸¥æ ¼çš„ç©ºå€¼æ£€æŸ¥ - strictPropertyInitialization - ä¸¥æ ¼æ£€æŸ¥å±æ€§æ˜¯å¦åˆå§‹åŒ– - é¢å¤–æ£€æŸ¥ - noFallthroughCasesInSwitch - æ£€æŸ¥switchè¯­å¥åŒ…å«æ­£ç¡®çš„break - noImplicitReturns - æ£€æŸ¥å‡½æ•°æ²¡æœ‰éšå¼çš„è¿”å›å€¼ - noUnusedLocals - æ£€æŸ¥æœªä½¿ç”¨çš„å±€éƒ¨å˜é‡ - noUnusedParameters - æ£€æŸ¥æœªä½¿ç”¨çš„å‚æ•° - é«˜çº§ - allowUnreachableCode - æ£€æŸ¥ä¸å¯è¾¾ä»£ç  - å¯é€‰å€¼ï¼š - trueï¼Œå¿½ç•¥ä¸å¯è¾¾ä»£ç  - falseï¼Œä¸å¯è¾¾ä»£ç å°†å¼•èµ·é”™è¯¯ - noEmitOnError - æœ‰é”™è¯¯çš„æƒ…å†µä¸‹ä¸è¿›è¡Œç¼–è¯‘ - é»˜è®¤å€¼ï¼šfalse## 4ã€webpack- é€šå¸¸æƒ…å†µä¸‹ï¼Œå®é™…å¼€å‘ä¸­æˆ‘ä»¬éƒ½éœ€è¦ä½¿ç”¨æ„å»ºå·¥å…·å¯¹ä»£ç è¿›è¡Œæ‰“åŒ…ï¼ŒTSåŒæ ·ä¹Ÿå¯ä»¥ç»“åˆæ„å»ºå·¥å…·ä¸€èµ·ä½¿ç”¨ï¼Œä¸‹è¾¹ä»¥webpackä¸ºä¾‹ä»‹ç»ä¸€ä¸‹å¦‚ä½•ç»“åˆæ„å»ºå·¥å…·ä½¿ç”¨TSã€‚- æ­¥éª¤ï¼š 1. åˆå§‹åŒ–é¡¹ç›® - è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ ``` npm init -y``` - ä¸»è¦ä½œç”¨ï¼šåˆ›å»ºpackage.jsonæ–‡ä»¶ 2. ä¸‹è½½æ„å»ºå·¥å…· - ```npm i -D webpack webpack-cli webpack-dev-server typescript ts-loader clean-webpack-plugin``` - å…±å®‰è£…äº†7ä¸ªåŒ… - webpack - æ„å»ºå·¥å…·webpack - webpack-cli - webpackçš„å‘½ä»¤è¡Œå·¥å…· - webpack-dev-server - webpackçš„å¼€å‘æœåŠ¡å™¨ - typescript - tsç¼–è¯‘å™¨ - ts-loader - tsåŠ è½½å™¨ï¼Œç”¨äºåœ¨webpackä¸­ç¼–è¯‘tsæ–‡ä»¶ - html-webpack-plugin - webpackä¸­htmlæ’ä»¶ï¼Œç”¨æ¥è‡ªåŠ¨åˆ›å»ºhtmlæ–‡ä»¶ - clean-webpack-plugin - webpackä¸­çš„æ¸…é™¤æ’ä»¶ï¼Œæ¯æ¬¡æ„å»ºéƒ½ä¼šå…ˆæ¸…é™¤ç›®å½• 3. æ ¹ç›®å½•ä¸‹åˆ›å»ºwebpackçš„é…ç½®æ–‡ä»¶webpack.config.js - ```javascript const path = require(&quot;path&quot;); const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;); const &#123; CleanWebpackPlugin &#125; = require(&quot;clean-webpack-plugin&quot;); module.exports = &#123; optimization:&#123; minimize: false // å…³é—­ä»£ç å‹ç¼©ï¼Œå¯é€‰ &#125;, entry: &quot;./src/index.ts&quot;, devtool: &quot;inline-source-map&quot;, devServer: &#123; contentBase: &#x27;./dist&#x27; &#125;, output: &#123; path: path.resolve(__dirname, &quot;dist&quot;), filename: &quot;bundle.js&quot;, environment: &#123; arrowFunction: false // å…³é—­webpackçš„ç®­å¤´å‡½æ•°ï¼Œå¯é€‰ &#125; &#125;, resolve: &#123; extensions: [&quot;.ts&quot;, &quot;.js&quot;] &#125;, module: &#123; rules: [ &#123; test: /\\.ts$/, use: &#123; loader: &quot;ts-loader&quot; &#125;, exclude: /node_modules/ &#125; ] &#125;, plugins: [ new CleanWebpackPlugin(), new HtmlWebpackPlugin(&#123; title:&#x27;TSæµ‹è¯•&#x27; &#125;), ] &#125; æ ¹ç›®å½•ä¸‹åˆ›å»ºtsconfig.jsonï¼Œé…ç½®å¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦ &#123; &quot;compilerOptions&quot;: &#123; &quot;target&quot;: &quot;ES2015&quot;, &quot;module&quot;: &quot;ES2015&quot;, &quot;strict&quot;: true &#125; &#125; 123456789101112135. ä¿®æ”¹package.jsonæ·»åŠ å¦‚ä¸‹é…ç½® - ```json &#123; ...ç•¥... &quot;scripts&quot;: &#123; &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;, &quot;build&quot;: &quot;webpack&quot;, &quot;start&quot;: &quot;webpack serve --open chrome.exe&quot; &#125;, ...ç•¥... &#125; åœ¨srcä¸‹åˆ›å»ºtsæ–‡ä»¶ï¼Œå¹¶åœ¨å¹¶å‘½ä»¤è¡Œæ‰§è¡Œnpm run buildå¯¹ä»£ç è¿›è¡Œç¼–è¯‘ï¼Œæˆ–è€…æ‰§è¡Œnpm startæ¥å¯åŠ¨å¼€å‘æœåŠ¡å™¨ 5ã€Babel ç»è¿‡ä¸€ç³»åˆ—çš„é…ç½®ï¼Œä½¿å¾—TSå’Œwebpackå·²ç»ç»“åˆåˆ°äº†ä¸€èµ·ï¼Œé™¤äº†webpackï¼Œå¼€å‘ä¸­è¿˜ç»å¸¸éœ€è¦ç»“åˆbabelæ¥å¯¹ä»£ç è¿›è¡Œè½¬æ¢ä»¥ä½¿å…¶å¯ä»¥å…¼å®¹åˆ°æ›´å¤šçš„æµè§ˆå™¨ï¼Œåœ¨ä¸Šè¿°æ­¥éª¤çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤å†å°†babelå¼•å…¥åˆ°é¡¹ç›®ä¸­ã€‚ å®‰è£…ä¾èµ–åŒ…ï¼š npm i -D @babel/core @babel/preset-env babel-loader core-js å…±å®‰è£…äº†4ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯ï¼š @babel&#x2F;core babelçš„æ ¸å¿ƒå·¥å…· @babel&#x2F;preset-env babelçš„é¢„å®šä¹‰ç¯å¢ƒ @babel-loader babelåœ¨webpackä¸­çš„åŠ è½½å™¨ core-js core-jsç”¨æ¥ä½¿è€ç‰ˆæœ¬çš„æµè§ˆå™¨æ”¯æŒæ–°ç‰ˆESè¯­æ³• ä¿®æ”¹webpack.config.jsé…ç½®æ–‡ä»¶ ...ç•¥... module: &#123; rules: [ &#123; test: /\\.ts$/, use: [ &#123; loader: &quot;babel-loader&quot;, options:&#123; presets: [ [ &quot;@babel/preset-env&quot;, &#123; &quot;targets&quot;:&#123; &quot;chrome&quot;: &quot;58&quot;, &quot;ie&quot;: &quot;11&quot; &#125;, &quot;corejs&quot;:&quot;3&quot;, &quot;useBuiltIns&quot;: &quot;usage&quot; &#125; ] ] &#125; &#125;, &#123; loader: &quot;ts-loader&quot;, &#125; ], exclude: /node_modules/ &#125; ] &#125; ...ç•¥... å¦‚æ­¤ä¸€æ¥ï¼Œä½¿ç”¨tsç¼–è¯‘åçš„æ–‡ä»¶å°†ä¼šå†æ¬¡è¢«babelå¤„ç†ï¼Œä½¿å¾—ä»£ç å¯ä»¥åœ¨å¤§éƒ¨åˆ†æµè§ˆå™¨ä¸­ç›´æ¥ä½¿ç”¨ï¼Œå¯ä»¥åœ¨é…ç½®é€‰é¡¹çš„targetsä¸­æŒ‡å®šè¦å…¼å®¹çš„æµè§ˆå™¨ç‰ˆæœ¬ã€‚","categories":[{"name":"ts","slug":"ts","permalink":"http://example.com/ts/"}],"tags":[{"name":"ts","slug":"ts","permalink":"http://example.com/tags/ts/"}]},{"title":"CyclicBarrierDemo","slug":"juc/CyclicBarrierDemo","date":"2023-06-25T09:47:13.000Z","updated":"2023-06-25T09:52:13.091Z","comments":true,"path":"2023/06/25/juc/CyclicBarrierDemo/","link":"","permalink":"http://example.com/2023/06/25/juc/CyclicBarrierDemo/","excerpt":"","text":"åŠ›æ‰£22 ä¸‰ä¸ªçº¿ç¨‹å¾ªç¯æ‰“å°abcCyclicBarrierä½œç”¨æ˜¯è®©ä¸€ç»„çº¿ç¨‹ç›¸äº’ç­‰å¾…ï¼Œå½“è¾¾åˆ°ä¸€ä¸ªå…±åŒç‚¹æ—¶ï¼Œæ‰€æœ‰ä¹‹å‰ç­‰å¾…çš„çº¿ç¨‹å†ç»§ç»­æ‰§è¡Œ 1234567891011121314151617181920212223242526272829303132public class CyclicBarrierDemo &#123; private static int sharedCount; public static void main(String[] args) throws InterruptedException &#123; String printString = &quot;ABC&quot;; CyclicBarrier barrier = new CyclicBarrier(3, () -&gt; &#123; &#125;); Runnable runnable = new Runnable() &#123; @Override public void run() &#123; for (int i = 0; i &lt; printString.length(); i++) &#123; synchronized (this)&#123; sharedCount = sharedCount &gt; 2 ? 0 : sharedCount; System.out.println(printString.toCharArray()[sharedCount++]); &#125; try &#123; barrier.await(); &#125; catch (InterruptedException | BrokenBarrierException e) &#123; throw new RuntimeException(e); &#125; &#125; &#125; &#125;; new Thread(runnable).start(); new Thread(runnable).start(); new Thread(runnable).start(); &#125;&#125;","categories":[{"name":"juc","slug":"juc","permalink":"http://example.com/juc/"}],"tags":[{"name":"juc","slug":"juc","permalink":"http://example.com/tags/juc/"}]},{"title":"RocketMqï¼ˆäº”ï¼‰--é›†æˆspringboot","slug":"mq/RocketMq/RocketMqï¼ˆäº”ï¼‰-é›†æˆspringboot","date":"2023-06-19T02:38:02.000Z","updated":"2023-06-19T02:53:04.761Z","comments":true,"path":"2023/06/19/mq/RocketMq/RocketMqï¼ˆäº”ï¼‰-é›†æˆspringboot/","link":"","permalink":"http://example.com/2023/06/19/mq/RocketMq/RocketMq%EF%BC%88%E4%BA%94%EF%BC%89-%E9%9B%86%E6%88%90springboot/","excerpt":"","text":"Rocketmqé›†æˆSpringBootæ­å»ºrocketmq-producerï¼ˆæ¶ˆæ¯ç”Ÿäº§è€…ï¼‰ åˆ›å»ºé¡¹ç›®ï¼Œå®Œæ•´çš„pom.xml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115&lt;?*xml version=\\&quot;1.0\\&quot; encoding=\\&quot;UTF-8\\&quot;*?\\&gt; \\&lt;project xmlns=\\&quot;http://maven.apache.org/POM/4.0.0\\&quot; xmlns:xsi=\\&quot;http://www.w3.org/2001/XMLSchema-instance\\&quot; xsi:schemaLocation=\\&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\\&quot;\\&gt; \\&lt;modelVersion\\&gt;4.0.0\\&lt;/modelVersion\\&gt; \\&lt;parent\\&gt; \\&lt;groupId\\&gt;org.springframework.boot\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;spring-boot-starter-parent\\&lt;/artifactId\\&gt; \\&lt;version\\&gt;2.6.3\\&lt;/version\\&gt; \\&lt;relativePath/\\&gt; &lt;!\\-- lookup parent from repository \\--\\&gt; \\&lt;/parent\\&gt; \\&lt;groupId\\&gt;com.powernode\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;01-rocketmq-producer\\&lt;/artifactId\\&gt; \\&lt;version\\&gt;0.0.1-SNAPSHOT\\&lt;/version\\&gt; \\&lt;name\\&gt;rocketmq-producer\\&lt;/name\\&gt; \\&lt;description\\&gt;Demo project for Spring Boot\\&lt;/description\\&gt; \\&lt;properties\\&gt; \\&lt;java.version\\&gt;1.8\\&lt;/java.version\\&gt; \\&lt;/properties\\&gt; \\&lt;dependencies\\&gt; \\&lt;dependency\\&gt; \\&lt;groupId\\&gt;org.springframework.boot\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;spring-boot-starter-web\\&lt;/artifactId\\&gt; \\&lt;/dependency\\&gt; **&lt;!\\-- rocketmqçš„ä¾èµ– \\--\\&gt;** *&lt;dependency\\&gt;* *&lt;groupId\\&gt;org.apache.rocketmq\\&lt;/groupId\\&gt;* *&lt;artifactId\\&gt;rocketmq-spring-boot-starter\\&lt;/artifactId\\&gt;* *&lt;version\\&gt;2.0.2\\&lt;/version\\&gt;* *&lt;/dependency\\&gt;* \\&lt;dependency\\&gt; \\&lt;groupId\\&gt;org.projectlombok\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;lombok\\&lt;/artifactId\\&gt; \\&lt;optional\\&gt;true\\&lt;/optional\\&gt; \\&lt;/dependency\\&gt; \\&lt;dependency\\&gt; \\&lt;groupId\\&gt;org.springframework.boot\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;spring-boot-starter-test\\&lt;/artifactId\\&gt; \\&lt;scope\\&gt;test\\&lt;/scope\\&gt; \\&lt;/dependency\\&gt; \\&lt;/dependencies\\&gt; \\&lt;build\\&gt; \\&lt;plugins\\&gt; \\&lt;plugin\\&gt; \\&lt;groupId\\&gt;org.springframework.boot\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;spring-boot-maven-plugin\\&lt;/artifactId\\&gt; \\&lt;configuration\\&gt; \\&lt;excludes\\&gt; \\&lt;exclude\\&gt; \\&lt;groupId\\&gt;org.projectlombok\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;lombok\\&lt;/artifactId\\&gt; \\&lt;/exclude\\&gt; \\&lt;/excludes\\&gt; \\&lt;/configuration\\&gt; \\&lt;/plugin\\&gt; \\&lt;/plugins\\&gt; \\&lt;/build\\&gt; \\&lt;/project\\&gt; ä¿®æ”¹é…ç½®æ–‡ä»¶application.yml1234567891011121314151617181920spring: application: name: rocketmq-producer rocketmq: name-server: 127.0.0.1:9876 \\# rocketMqçš„nameServeråœ°å€ producer: group: powernode-group \\# ç”Ÿäº§è€…ç»„åˆ« send-message-timeout: 3000 \\# æ¶ˆæ¯å‘é€çš„è¶…æ—¶æ—¶é—´ retry-times-when-send-async-failed: 2 \\# å¼‚æ­¥æ¶ˆæ¯å‘é€å¤±è´¥é‡è¯•æ¬¡æ•° max-message-size: 4194304 \\# æ¶ˆæ¯çš„æœ€å¤§é•¿åº¦ æˆ‘ä»¬åœ¨æµ‹è¯•ç±»é‡Œé¢æµ‹è¯•å‘é€æ¶ˆæ¯å¾€powernodeä¸»é¢˜é‡Œé¢å‘é€ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²æ¶ˆæ¯ 12345678910111213141516171819202122232425262728293031323334353637383940/* \\* æ³¨å…¥rocketMQTemplateï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥æ“ä½œmq \\*/ @Autowired private RocketMQTemplate rocketMQTemplate; /* \\* æµ‹è¯•å‘é€ç®€å•çš„æ¶ˆæ¯ \\ \\* @throws Exception \\*/ @Test public void testSimpleMsg() throws Exception &#123; // å¾€powernodeçš„ä¸»é¢˜é‡Œé¢å‘é€ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²æ¶ˆæ¯ SendResult sendResult = rocketMQTemplate.syncSend(\\&quot;powernode\\&quot;, \\&quot;æˆ‘æ˜¯ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯\\&quot;); // æ‹¿åˆ°æ¶ˆæ¯çš„å‘é€çŠ¶æ€ System.*out*.println(sendResult.getSendStatus()); // æ‹¿åˆ°æ¶ˆæ¯çš„id System.*out*.println(sendResult.getMsgId()); &#125; è¿è¡ŒåæŸ¥çœ‹æ§åˆ¶å° æŸ¥çœ‹rocketMqçš„æ§åˆ¶å° æŸ¥çœ‹æ¶ˆæ¯ç»†èŠ‚ æ­å»ºrocketmq-consumerï¼ˆæ¶ˆæ¯æ¶ˆè´¹è€…ï¼‰ åˆ›å»ºé¡¹ç›®ï¼Œå®Œæ•´çš„pom.xml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115&lt;?*xml version=\\&quot;1.0\\&quot; encoding=\\&quot;UTF-8\\&quot;*?\\&gt; \\&lt;project xmlns=\\&quot;http://maven.apache.org/POM/4.0.0\\&quot; xmlns:xsi=\\&quot;http://www.w3.org/2001/XMLSchema-instance\\&quot; xsi:schemaLocation=\\&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\\&quot;\\&gt; \\&lt;modelVersion\\&gt;4.0.0\\&lt;/modelVersion\\&gt; \\&lt;parent\\&gt; \\&lt;groupId\\&gt;org.springframework.boot\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;spring-boot-starter-parent\\&lt;/artifactId\\&gt; *&lt;version\\&gt;2.6.3\\&lt;/version\\&gt;* \\&lt;relativePath/\\&gt; &lt;!\\-- lookup parent from repository \\--\\&gt; \\&lt;/parent\\&gt; \\&lt;groupId\\&gt;com.powernode\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;02-rocketmq-consumer\\&lt;/artifactId\\&gt; \\&lt;version\\&gt;0.0.1-SNAPSHOT\\&lt;/version\\&gt; \\&lt;name\\&gt;rocketmq-consumer\\&lt;/name\\&gt; \\&lt;description\\&gt;Demo project for Spring Boot\\&lt;/description\\&gt; \\&lt;properties\\&gt; \\&lt;java.version\\&gt;1.8\\&lt;/java.version\\&gt; \\&lt;/properties\\&gt; \\&lt;dependencies\\&gt; \\&lt;dependency\\&gt; \\&lt;groupId\\&gt;org.springframework.boot\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;spring-boot-starter-web\\&lt;/artifactId\\&gt; \\&lt;/dependency\\&gt; **&lt;!\\-- rocketmqçš„ä¾èµ– \\--\\&gt;** *&lt;dependency\\&gt;* *&lt;groupId\\&gt;org.apache.rocketmq\\&lt;/groupId\\&gt;* *&lt;artifactId\\&gt;rocketmq-spring-boot-starter\\&lt;/artifactId\\&gt;* *&lt;version\\&gt;2.0.2\\&lt;/version\\&gt;* *&lt;/dependency\\&gt;* \\&lt;dependency\\&gt; \\&lt;groupId\\&gt;org.projectlombok\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;lombok\\&lt;/artifactId\\&gt; \\&lt;optional\\&gt;true\\&lt;/optional\\&gt; \\&lt;/dependency\\&gt; \\&lt;dependency\\&gt; \\&lt;groupId\\&gt;org.springframework.boot\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;spring-boot-starter-test\\&lt;/artifactId\\&gt; \\&lt;scope\\&gt;test\\&lt;/scope\\&gt; \\&lt;/dependency\\&gt; \\&lt;/dependencies\\&gt; \\&lt;build\\&gt; \\&lt;plugins\\&gt; \\&lt;plugin\\&gt; \\&lt;groupId\\&gt;org.springframework.boot\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;spring-boot-maven-plugin\\&lt;/artifactId\\&gt; \\&lt;configuration\\&gt; \\&lt;excludes\\&gt; \\&lt;exclude\\&gt; \\&lt;groupId\\&gt;org.projectlombok\\&lt;/groupId\\&gt; \\&lt;artifactId\\&gt;lombok\\&lt;/artifactId\\&gt; \\&lt;/exclude\\&gt; \\&lt;/excludes\\&gt; \\&lt;/configuration\\&gt; \\&lt;/plugin\\&gt; \\&lt;/plugins\\&gt; \\&lt;/build\\&gt; \\&lt;/project\\&gt; ä¿®æ”¹é…ç½®æ–‡ä»¶application.yml123456789spring: application: name: rocketmq-consumer rocketmq: name-server: 127.0.0.1:9876 æ·»åŠ ä¸€ä¸ªç›‘å¬çš„ç±»SimpleMsgListener123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ¶ˆæ¯ï¼Œå°±æ·»åŠ ä¸€ä¸ªç›‘å¬ package com.powernode.listener; import org.apache.rocketmq.spring.annotation.MessageModel; import org.apache.rocketmq.spring.annotation.RocketMQMessageListener; import org.apache.rocketmq.spring.core.RocketMQListener; import org.springframework.stereotype.Component; /* * åˆ›å»ºä¸€ä¸ªç®€å•æ¶ˆæ¯çš„ç›‘å¬ * 1.ç±»ä¸Šæ·»åŠ æ³¨è§£@Componentå’Œ@RocketMQMessageListener * @RocketMQMessageListener(topic = \\&quot;powernode\\&quot;, consumerGroup = \\&quot;powernode-group\\&quot;) topicæŒ‡å®šæ¶ˆè´¹çš„ä¸»é¢˜ï¼ŒconsumerGroupæŒ‡å®šæ¶ˆè´¹ç»„ ,ä¸€ä¸ªä¸»é¢˜å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…ç»„,ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªä¸åŒçš„ç»„çš„æ¶ˆè´¹è€…éƒ½æ¶ˆè´¹* 2.å®ç°Rocket MQListeneræ¥å£ï¼Œ**æ³¨æ„æ³›å‹çš„ä½¿ç”¨ï¼Œå¯ä»¥ä¸ºå…·ä½“çš„ç±»å‹ï¼Œå¦‚æœæƒ³æ‹¿åˆ°æ¶ˆæ¯*** *** çš„å…¶ä»–å‚æ•°å¯ä»¥å†™æˆMessageExt** */ @Component @RocketMQMessageListener(topic = \\&quot;powernode\\&quot;, consumerGroup = \\&quot;powernode-group\\&quot;,messageModel = MessageModel.*CLUSTERING*) public class SimpleMsgListener implements RocketMQListener\\&lt;String\\&gt; &#123; /* * æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³• * * @param message */ @Override public void onMessage(String message) &#123; System.*out*.println(message); &#125; &#125; â€‹ å¯åŠ¨rocketmq-consumeræŸ¥çœ‹æ§åˆ¶å°ï¼Œå‘ç°æˆ‘ä»¬å·²ç»ç›‘å¬åˆ°æ¶ˆæ¯äº† RocketMQå‘é€å¯¹è±¡æ¶ˆæ¯å’Œé›†åˆæ¶ˆæ¯æˆ‘ä»¬æ¥ç€åœ¨ä¸Šé¢é¡¹ç›®é‡Œé¢åš å‘é€å¯¹è±¡æ¶ˆæ¯ä¸»è¦æ˜¯ç›‘å¬çš„æ—¶å€™æ³›å‹ä¸­å†™å¯¹è±¡çš„ç±»å‹å³å¯ ä¿®æ”¹rocketmq-produceræ·»åŠ ä¸€ä¸ªOrderç±»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465 package com.powernode.domain; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; import java.util.Date; /* \\* è®¢å•å¯¹è±¡ \\*/ @Data @AllArgsConstructor @NoArgsConstructor public class Order &#123; /* \\* è®¢å•å· \\*/ private String orderId; /* \\* è®¢å•åç§° \\*/ private String orderName; /* \\* è®¢å•ä»·æ ¼ \\*/ private Double price; /* \\* è®¢å•å·åˆ›å»ºæ—¶é—´ \\*/ private Date createTime; /* \\* è®¢å•æè¿° \\*/ private String desc; &#125; ä¿®æ”¹rocketmq-produceræ·»åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•12345678910111213141516171819202122232425262728293031/* * æµ‹è¯•å‘é€å¯¹è±¡æ¶ˆæ¯ * * @throws Exception */ @Test public void testObjectMsg() throws Exception &#123; Order order = new Order(); order.setOrderId(UUID.*randomUUID*().toString()); order.setOrderName(\\&quot;æˆ‘çš„è®¢å•\\&quot;); order.setPrice(998D); order.setCreateTime(new Date()); order.setDesc(\\&quot;åŠ æ€¥é…é€\\&quot;); // å¾€powernode-objä¸»é¢˜å‘é€ä¸€ä¸ªè®¢å•å¯¹è±¡ rocketMQTemplate.syncSend(\\&quot;powernode-obj\\&quot;, order); &#125; â€‹ å‘é€æ­¤æ¶ˆæ¯ä¿®æ”¹rocketmq-consumerä¹Ÿæ·»åŠ ä¸€ä¸ªOrderç±»ï¼ˆæ‹·è´è¿‡æ¥ï¼‰ä¿®æ”¹rocketmq-consumeræ·»åŠ ä¸€ä¸ªObjMsgListener1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.powernode.listener; import com.powernode.domain.Order; import org.apache.rocketmq.spring.annotation.RocketMQMessageListener; import org.apache.rocketmq.spring.core.RocketMQListener; import org.springframework.stereotype.Component; /* \\* åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¶ˆæ¯çš„ç›‘å¬ \\* 1.ç±»ä¸Šæ·»åŠ æ³¨è§£@Componentå’Œ@RocketMQMessageListener \\* 2.å®ç°RocketMQListeneræ¥å£ï¼Œæ³¨æ„æ³›å‹çš„ä½¿ç”¨ \\*/ @Component @RocketMQMessageListener(topic = \\&quot;powernode-obj\\&quot;, consumerGroup = \\&quot;powernode-obj-group\\&quot;) public class ObjMsgListener implements RocketMQListener\\&lt;**Order*&gt; &#123; /* \\* æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³• \\ \\* @param message \\*/ @Override public void onMessage(**Order** message) &#123; System.*out*.println(message); &#125; &#125; é‡å¯rocketmq-consumeråæŸ¥çœ‹æ§åˆ¶å°å¯¹è±¡æ¶ˆæ¯å·²ç»ç›‘å¬åˆ°äº† å‘é€é›†åˆæ¶ˆæ¯å’Œå¯¹è±¡æ¶ˆæ¯åŒç†ï¼Œåˆ›å»ºä¸€ä¸ªOrderçš„é›†åˆï¼Œå‘é€å‡ºå»ï¼Œç›‘å¬æ–¹æ³¨æ„ä¿®æ”¹æ³›å‹ä¸­çš„ç±»å‹ä¸ºObjectå³å¯ï¼Œè¿™é‡Œå°±ä¸åšé‡å¤æ¼”ç¤ºäº† RocketMQé›†æˆSpringBootå‘é€ä¸åŒæ¶ˆæ¯æ¨¡å¼å‘é€åŒæ­¥æ¶ˆæ¯ç†è§£ä¸ºï¼šæ¶ˆæ¯ç”±æ¶ˆè´¹è€…å‘é€åˆ°brokeråï¼Œä¼šå¾—åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œæ˜¯å…·æœ‰å¯é æ€§çš„ è¿™ç§å¯é æ€§åŒæ­¥åœ°å‘é€æ–¹å¼ä½¿ç”¨çš„æ¯”è¾ƒå¹¿æ³›ï¼Œæ¯”å¦‚ï¼šé‡è¦çš„æ¶ˆæ¯é€šçŸ¥ï¼ŒçŸ­ä¿¡é€šçŸ¥ç­‰ã€‚ æˆ‘ä»¬åœ¨ä¸Šé¢çš„å¿«é€Ÿå…¥é—¨ä¸­æ¼”ç¤ºçš„æ¶ˆæ¯ï¼Œå°±æ˜¯åŒæ­¥æ¶ˆæ¯ï¼Œå³ rocketMQTemplate.syncSend() rocketMQTemplate.send() rocketMQTemplate.convertAndSend() è¿™ä¸‰ç§å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œåº•å±‚éƒ½æ˜¯è°ƒç”¨syncSendï¼Œå‘é€çš„æ˜¯åŒæ­¥æ¶ˆæ¯ å‘é€å¼‚æ­¥æ¶ˆæ¯rocketMQTemplate.asyncSend() ä¿®æ”¹rocketmq-produceræ·»åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/* \\* æµ‹è¯•å¼‚æ­¥å‘é€æ¶ˆæ¯ \\ \\* @throws Exception \\*/ @Test public void testAsyncSend() throws Exception &#123; // å‘é€å¼‚æ­¥æ¶ˆæ¯ï¼Œå‘é€å®Œä»¥åä¼šæœ‰ä¸€ä¸ªå¼‚æ­¥é€šçŸ¥ rocketMQTemplate.**asyncSend**(\\&quot;powernode\\&quot;, \\&quot;å‘é€ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯\\&quot;, new SendCallback() &#123; /* \\* æˆåŠŸçš„å›è°ƒ \\* @param sendResult \\*/ @Override public void onSuccess(SendResult sendResult) &#123; System.*out*.println(\\&quot;å‘é€æˆåŠŸ\\&quot;); &#125; /* \\* å¤±è´¥çš„å›è°ƒ \\* @param throwable \\*/ @Override public void onException(Throwable throwable) &#123; System.*out*.println(\\&quot;å‘é€å¤±è´¥\\&quot;); &#125; &#125;); // æµ‹è¯•ä¸€ä¸‹å¼‚æ­¥çš„æ•ˆæœ System.*out*.println(\\&quot;è°å…ˆæ‰§è¡Œ\\&quot;); // æŒ‚èµ·jvm ä¸è®©æ–¹æ³•ç»“æŸ System.*in*.read(); &#125; è¿è¡ŒæŸ¥çœ‹æ§åˆ¶å°æ•ˆæœè°å…ˆå‘é€æ‰“å°åœ¨å‰é¢ å‘é€å•å‘æ¶ˆæ¯è¿™ç§æ–¹å¼ä¸»è¦ç”¨åœ¨ä¸å…³å¿ƒå‘é€ç»“æœçš„åœºæ™¯ï¼Œè¿™ç§æ–¹å¼ååé‡å¾ˆå¤§ï¼Œä½†æ˜¯å­˜åœ¨æ¶ˆæ¯ä¸¢å¤±çš„é£é™©ï¼Œä¾‹å¦‚æ—¥å¿—ä¿¡æ¯çš„å‘é€ ä¿®æ”¹rocketmq-produceræ·»åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•12345678910111213141516171819/* \\* æµ‹è¯•å•å‘æ¶ˆæ¯ \\ \\* @throws Exception \\*/ @Test public void testOnWay() throws Exception &#123; // å‘é€å•å‘æ¶ˆæ¯ï¼Œæ²¡æœ‰è¿”å›å€¼å’Œç»“æœ rocketMQTemplate.**sendOneWay**(\\&quot;powernode\\&quot;, \\&quot;è¿™æ˜¯ä¸€ä¸ªå•å‘æ¶ˆæ¯\\&quot;); &#125; å‘é€å»¶è¿Ÿæ¶ˆæ¯ä¿®æ”¹rocketmq-produceræ·»åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•123456789101112131415161718192021222324252627/* \\* æµ‹è¯•å»¶è¿Ÿæ¶ˆæ¯ \\ \\* @throws Exception \\*/ @Test public void testDelay() throws Exception &#123; // æ„å»ºæ¶ˆæ¯å¯¹è±¡ Message\\&lt;String\\&gt; message = MessageBuilder.*withPayload*(\\&quot;æˆ‘æ˜¯ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯\\&quot;).build(); // å‘é€ä¸€ä¸ªå»¶æ—¶æ¶ˆæ¯ï¼Œå»¶è¿Ÿç­‰çº§ä¸º4çº§ï¼Œä¹Ÿå°±æ˜¯30såè¢«ç›‘å¬æ¶ˆè´¹ SendResult sendResult = rocketMQTemplate.syncSend(\\&quot;powernode\\&quot;, message, 2000, 4); System.*out*.println(sendResult.getSendStatus()); &#125; è¿è¡Œåï¼ŒæŸ¥çœ‹æ¶ˆè´¹è€…ç«¯ï¼Œè¿‡äº†30sæ‰è¢«æ¶ˆè´¹è¿™é‡Œæ³¨æ„çš„æ˜¯RocketMQä¸æ”¯æŒä»»æ„æ—¶é—´çš„å»¶æ—¶ åªæ”¯æŒä»¥ä¸‹å‡ ä¸ªå›ºå®šçš„å»¶æ—¶ç­‰çº§ï¼Œç­‰çº§1å°±å¯¹åº”1sï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€é«˜æ”¯æŒ2hå»¶è¿Ÿ private String messageDelayLevel &#x3D; &quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m8m 9m 10m 20m 30m 1h 2h&quot;; å‘é€é¡ºåºæ¶ˆæ¯ä¿®æ”¹Orderè¡¨æ·»åŠ ä¸€ä¸ªé¡ºåºå­—æ®µ1234567/* \\* è®¢å•çš„æµç¨‹é¡ºåº \\*/ private Integer seq; ä¿®æ”¹rocketmq-produceræ·»åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455/* \\* æµ‹è¯•é¡ºåºæ¶ˆè´¹ \\* mqä¼šæ ¹æ®hashçš„å€¼æ¥å­˜æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢å» \\ \\* @throws Exception \\*/ @Test public void testOrderly() throws Exception &#123; List\\&lt;Order\\&gt; orders = Arrays.*asList*( new Order(UUID.*randomUUID*().toString().substring(0, 5), \\&quot;å¼ ä¸‰çš„ä¸‹è®¢å•\\&quot;, null, null, null, 1), new Order(UUID.*randomUUID*().toString().substring(0, 5), \\&quot;å¼ ä¸‰çš„å‘çŸ­ä¿¡\\&quot;, null, null, null, 1), new Order(UUID.*randomUUID*().toString().substring(0, 5), \\&quot;å¼ ä¸‰çš„ç‰©æµ\\&quot;, null, null, null, 1), new Order(UUID.*randomUUID*().toString().substring(0, 5), \\&quot;å¼ ä¸‰çš„ç­¾æ”¶\\&quot;, null, null, null, 1), new Order(UUID.*randomUUID*().toString().substring(0, 5), \\&quot;æå››çš„ä¸‹è®¢å•\\&quot;, null, null, null, 2), new Order(UUID.*randomUUID*().toString().substring(0, 5), \\&quot;æå››çš„å‘çŸ­ä¿¡\\&quot;, null, null, null, 2), new Order(UUID.*randomUUID*().toString().substring(0, 5), \\&quot;æå››çš„ç‰©æµ\\&quot;, null, null, null, 2), new Order(UUID.*randomUUID*().toString().substring(0, 5), \\&quot;æå››çš„ç­¾æ”¶\\&quot;, null, null, null, 2) ); // æˆ‘ä»¬æ§åˆ¶æµç¨‹ä¸º ä¸‹è®¢å•-\\&gt;å‘çŸ­ä¿¡-\\&gt;ç‰©æµ-\\&gt;ç­¾æ”¶ hashçš„å€¼ä¸ºseqï¼Œä¹Ÿå°±æ˜¯è¯´ seqç›¸åŒçš„ä¼šæ”¾åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢ï¼Œé¡ºåºæ¶ˆè´¹ orders.forEach(order -\\&gt; &#123; rocketMQTemplate.syncSendOrderly(\\&quot;powernode-obj\\&quot;, order, String.*valueOf*(order.getSeq())); &#125;); &#125; å‘é€æ¶ˆæ¯ä¿®æ”¹rocketmq-consumerçš„ObjMsgListener1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162 package com.powernode.listener; import com.powernode.domain.Order; import org.apache.rocketmq.spring.annotation.ConsumeMode; import org.apache.rocketmq.spring.annotation.RocketMQMessageListener; import org.apache.rocketmq.spring.core.RocketMQListener; import org.springframework.stereotype.Component; /* \\* @Author æ­¦æ±‰åŠ¨åŠ›èŠ‚ç‚¹ \\* åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¶ˆæ¯çš„ç›‘å¬ \\* 1.ç±»ä¸Šæ·»åŠ æ³¨è§£@Componentå’Œ@RocketMQMessageListener \\* 2.å®ç°RocketMQListeneræ¥å£ï¼Œæ³¨æ„æ³›å‹çš„ä½¿ç”¨ \\* consumeMode æŒ‡å®šæ¶ˆè´¹ç±»å‹ \\* CONCURRENTLY å¹¶å‘æ¶ˆè´¹ \\* ORDERLY é¡ºåºæ¶ˆè´¹ messages orderly. one queue, one thread \\*/ @Component @RocketMQMessageListener(topic = \\&quot;powernode-obj\\&quot;, consumerGroup = \\&quot;powernode-obj-group\\&quot;, **consumeMode = ConsumeMode.*ORDERLY** ) public class ObjMsgListener implements RocketMQListener\\&lt;Order\\&gt; &#123; /* \\* æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³• \\ \\* @param message \\*/ @Override public void onMessage(Order message) &#123; System.*out*.println(message); &#125; &#125; é‡å¯rocketmq-consumeræŸ¥çœ‹æ§åˆ¶å°ï¼Œæ¶ˆæ¯æŒ‰ç…§æˆ‘ä»¬çš„æ”¾å…¥é¡ºåºè¿›è¡Œæ¶ˆè´¹äº† å‘é€äº‹åŠ¡æ¶ˆæ¯ä¿®æ”¹rocketmq-produceræ·»åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•123456789101112131415161718192021222324252627282930313233343536373839404142/* \\* æµ‹è¯•äº‹åŠ¡æ¶ˆæ¯ \\* é»˜è®¤æ˜¯syncï¼ˆåŒæ­¥çš„ï¼‰ \\* äº‹åŠ¡æ¶ˆæ¯ä¼šæœ‰ç¡®è®¤å’Œå›æŸ¥æœºåˆ¶ \\ äº‹åŠ¡ æ¶ˆæ¯éƒ½ä¼šèµ°åˆ°åŒä¸€ä¸ªç›‘å¬å›è°ƒé‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨tagæˆ–è€…keyæ¥åŒºåˆ†è¿‡æ»¤ \\ \\* @throws Exception \\*/ @Test public void testTrans() throws Exception &#123; // æ„å»ºæ¶ˆæ¯ä½“ Message\\&lt;String\\&gt; message = MessageBuilder.*withPayload*(\\&quot;è¿™æ˜¯ä¸€ä¸ªäº‹åŠ¡æ¶ˆæ¯\\&quot;).build(); // å‘é€äº‹åŠ¡æ¶ˆæ¯ï¼ˆåŒæ­¥çš„ï¼‰ æœ€åä¸€ä¸ªå‚æ•°æ‰æ˜¯æ¶ˆæ¯ä¸»é¢˜ TransactionSendResult transaction = rocketMQTemplate.sendMessageInTransaction(\\&quot;powernode\\&quot;, message, \\&quot;æ¶ˆæ¯çš„å‚æ•°\\&quot;); // æ‹¿åˆ°æœ¬åœ°äº‹åŠ¡çŠ¶æ€ System.*out*.println(transaction.getLocalTransactionState()); // æŒ‚èµ·jvmï¼Œå› ä¸ºäº‹åŠ¡çš„å›æŸ¥éœ€è¦ä¸€äº›æ—¶é—´ System.*in*.read(); &#125; ä¿®æ”¹rocketmq-produceræ·»åŠ ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡æ¶ˆæ¯çš„ç›‘å¬ï¼ˆåŠæ¶ˆæ¯ï¼‰12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788/* * äº‹åŠ¡æ¶ˆæ¯çš„ç›‘å¬ä¸å›æŸ¥ * ç±»ä¸Šæ·»åŠ æ³¨è§£@RocketMQTransactionListener è¡¨ç¤ºè¿™ä¸ªç±»æ˜¯æœ¬åœ°äº‹åŠ¡æ¶ˆæ¯çš„ç›‘å¬ç±» * å®ç°RocketMQLocalTransactionListeneræ¥å£ * ä¸¤ä¸ªæ–¹æ³•ä¸ºæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œä¸å›æŸ¥æœ¬åœ°äº‹åŠ¡ */ @Component @RocketMQTransactionListener(corePoolSize = 4,maximumPoolSize = 8) public class TmMsgListener implements RocketMQLocalTransactionListener &#123; /* * æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œè¿™é‡Œå¯ä»¥æ‰§è¡Œä¸€äº›ä¸šåŠ¡ * æ¯”å¦‚æ“ä½œæ•°æ®åº“ï¼Œæ“ä½œæˆåŠŸå°±return RocketMQLocalTransactionState.COMMIT; * å¯ä»¥ä½¿ç”¨try catchæ¥æ§åˆ¶æˆåŠŸæˆ–è€…å¤±è´¥; * @param msg * @param arg * @return */ @Override public RocketMQLocalTransactionState executeLocalTransaction(Message msg, Object arg) &#123; // æ‹¿åˆ°æ¶ˆæ¯å‚æ•° System.*out*.println(arg); // æ‹¿åˆ°æ¶ˆæ¯å¤´ System.*out*.println(msg.getHeaders()); // è¿”å›çŠ¶æ€COMMIT,UNKNOWN return RocketMQLocalTransactionState.*UNKNOWN*; &#125; /* * å›æŸ¥æœ¬åœ°äº‹åŠ¡ï¼Œåªæœ‰ä¸Šé¢çš„æ‰§è¡Œæ–¹æ³•è¿”å›UNKNOWNæ—¶ï¼Œæ‰æ‰§è¡Œä¸‹é¢çš„æ–¹æ³• é»˜è®¤æ˜¯1minå›æŸ¥ * æ­¤æ–¹æ³•ä¸ºå›æŸ¥æ–¹æ³•ï¼Œæ‰§è¡Œéœ€è¦ç­‰å¾…ä¸€ä¼š * xxx.isSuccess() è¿™é‡Œå¯ä»¥æ‰§è¡Œä¸€äº›æ£€æŸ¥çš„æ–¹æ³• å¦‚æœè¿”å›COMMITï¼Œé‚£ä¹ˆæœ¬åœ°äº‹åŠ¡å°±ç®—æ˜¯æäº¤æˆåŠŸäº†ï¼Œæ¶ˆæ¯å°±ä¼šè¢«æ¶ˆè´¹è€…çœ‹åˆ° * * @param msg * @return */ @Override public RocketMQLocalTransactionState checkLocalTransaction(Message msg) &#123; System.*out*.println(msg); return RocketMQLocalTransactionState.*COMMIT*; &#125; &#125; æµ‹è¯•å‘é€äº‹åŠ¡ï¼Œå»ºè®®æ–­ç‚¹å¯åŠ¨ æ¶ˆæ¯ä¼šå…ˆåˆ°äº‹åŠ¡ç›‘å¬ç±»çš„æ‰§è¡Œæ–¹æ³•ï¼Œ å¦‚æœè¿”å›çŠ¶æ€ä¸ºCOMMITï¼Œåˆ™æ¶ˆè´¹è€…å¯ä»¥ç›´æ¥ç›‘å¬åˆ° å¦‚æœè¿”å›çŠ¶æ€ä¸ºROLLBACKï¼Œåˆ™æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œç›´æ¥å›æ»š å¦‚æœè¿”å›çŠ¶æ€ä¸ºUNKNOWï¼Œåˆ™è¿‡ä¸€ä¼šä¼šèµ°å›æŸ¥æ–¹æ³• å¦‚æœå›æŸ¥æ–¹æ³•è¿”å›çŠ¶æ€ä¸ºUNKNOWæˆ–è€…ROLLBACKï¼Œåˆ™æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œç›´æ¥å›æ»š å¦‚æœå›æŸ¥æ–¹æ³•è¿”å›çŠ¶æ€ä¸ºCOMMITï¼Œåˆ™æ¶ˆè´¹è€…å¯ä»¥ç›´æ¥ç›‘å¬åˆ° RocketMQé›†æˆSpringBootçš„æ¶ˆæ¯è¿‡æ»¤tagè¿‡æ»¤ï¼ˆå¸¸åœ¨æ¶ˆè´¹è€…ç«¯è¿‡æ»¤ï¼‰æˆ‘ä»¬ä»æºç æ³¨é‡Šå¾—çŸ¥ï¼Œtagå¸¦åœ¨ä¸»é¢˜åé¢ç”¨ï¼šæ¥æºå¸¦ï¼Œæ„Ÿè°¢æ³¨é‡Š æˆ‘ä»¬å¾€ä¸‹å»çœ‹æºç ï¼Œåœ¨ org.apache.rocketmq.spring.support.RocketMQUtilçš„getAndWrapMessageæ–¹æ³•é‡Œé¢çœ‹åˆ°äº†å…·ä½“ç»†èŠ‚ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“äº†keysåœ¨æ¶ˆæ¯å¤´é‡Œé¢æºå¸¦ ä¿®æ”¹rocketmq-produceræ·»åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•123456789101112131415161718192021/* \\* å‘é€ä¸€ä¸ªå¸¦tagçš„æ¶ˆæ¯ \\ \\* @throws Exception \\*/ @Test public void testTagMsg() throws Exception &#123; // å‘é€ä¸€ä¸ªtagä¸ºjavaçš„æ•°æ® rocketMQTemplate.syncSend(\\&quot;powernode-tag:java\\&quot;, \\&quot;æˆ‘æ˜¯ä¸€ä¸ªå¸¦tagçš„æ¶ˆæ¯\\&quot;); &#125; å‘é€æ¶ˆæ¯ä¿®æ”¹rocketmq-consumeræ·»åŠ ä¸€ä¸ªTagMsgListener1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162 package com.powernode.listener; import org.apache.rocketmq.spring.annotation.RocketMQMessageListener; import org.apache.rocketmq.spring.annotation.SelectorType; import org.apache.rocketmq.spring.core.RocketMQListener; import org.springframework.stereotype.Component; /* \\* @Author æ­¦æ±‰åŠ¨åŠ›èŠ‚ç‚¹ \\* åˆ›å»ºä¸€ä¸ªç®€å•çš„æ ‡ç­¾æ¶ˆæ¯çš„ç›‘å¬ \\* 1.ç±»ä¸Šæ·»åŠ æ³¨è§£@Componentå’Œ@RocketMQMessageListener \\* selectorType = SelectorType.TAG, æŒ‡å®šä½¿ç”¨tagè¿‡æ»¤ã€‚(ä¹Ÿå¯ä»¥ä½¿ç”¨sql92 éœ€è¦åœ¨é…ç½®æ–‡ä»¶broker.confä¸­å¼€å¯enbalePropertyFilter=true) \\* selectorExpression = \\&quot;java\\&quot; è¡¨è¾¾å¼ï¼Œé»˜è®¤æ˜¯\\*,æ”¯æŒ\\&quot;tag1 \\\\ tag2 \\\\ tag3\\&quot; \\* 2.å®ç°RocketMQListeneræ¥å£ï¼Œæ³¨æ„æ³›å‹çš„ä½¿ç”¨ \\*/ @Component @RocketMQMessageListener(topic = \\&quot;powernode-tag\\&quot;, consumerGroup = \\&quot;powernode-tag-group\\&quot;, selectorType = SelectorType.*TAG*, selectorExpression = \\&quot;java\\&quot; ) public class TagMsgListener implements RocketMQListener\\&lt;String\\&gt; &#123; /* \\* æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³• \\ \\* @param message \\*/ @Override public void onMessage(String message) &#123; System.*out*.println(message); &#125; &#125; é‡å¯rocketmq-consumeræŸ¥çœ‹æ§åˆ¶å° Keyè¿‡æ»¤ï¼ˆå¯ä»¥åœ¨äº‹åŠ¡ç›‘å¬çš„ç±»é‡Œé¢åŒºåˆ†ï¼‰ä¿®æ”¹rocketmq-produceræ·»åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•12345678910111213141516171819202122232425262728/* \\* å‘é€ä¸€ä¸ªå¸¦keyçš„æ¶ˆæ¯,æˆ‘ä»¬ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯ æ‰“æ–­ç‚¹æŸ¥çœ‹æ¶ˆæ¯å¤´ \\ \\* @throws Exception \\*/ @Test public void testKeyMsg() throws Exception &#123; // å‘é€ä¸€ä¸ªkeyä¸ºspringçš„äº‹åŠ¡æ¶ˆæ¯ Message\\&lt;String\\&gt; message = MessageBuilder.*withPayload*(\\&quot;æˆ‘æ˜¯ä¸€ä¸ªå¸¦keyçš„æ¶ˆæ¯\\&quot;) **.setHeader(RocketMQHeaders.*KEYS*, \\&quot;spring\\&quot;)* .build(); rocketMQTemplate.sendMessageInTransaction(\\&quot;powernode\\&quot;, message, \\&quot;æˆ‘æ˜¯ä¸€ä¸ªå¸¦keyçš„æ¶ˆæ¯\\&quot;); &#125; æ–­ç‚¹å‘é€è¿™ä¸ªæ¶ˆæ¯ï¼ŒæŸ¥çœ‹äº‹åŠ¡é‡Œé¢æ¶ˆæ¯å¤´ æˆ‘ä»¬åœ¨mqçš„æ§åˆ¶å°ä¹Ÿå¯ä»¥çœ‹åˆ° RocketMQé›†æˆSpringBootæ¶ˆæ¯æ¶ˆè´¹ä¸¤ç§æ¨¡å¼Rocketmqæ¶ˆæ¯æ¶ˆè´¹çš„æ¨¡å¼åˆ†ä¸ºä¸¤ç§ï¼šè´Ÿè½½å‡è¡¡æ¨¡å¼å’Œå¹¿æ’­æ¨¡å¼ è´Ÿè½½å‡è¡¡æ¨¡å¼è¡¨ç¤ºå¤šä¸ªæ¶ˆè´¹è€…äº¤æ›¿æ¶ˆè´¹åŒä¸€ä¸ªä¸»é¢˜é‡Œé¢çš„æ¶ˆæ¯ å¹¿æ’­æ¨¡å¼è¡¨ç¤ºæ¯ä¸ªæ¯ä¸ªæ¶ˆè´¹è€…éƒ½æ¶ˆè´¹ä¸€éè®¢é˜…çš„ä¸»é¢˜çš„æ¶ˆæ¯ å†æ­å»ºä¸€ä¸ªæ¶ˆè´¹è€…rocketmq-consumer-bï¼Œä¾èµ–å’Œé…ç½®æ–‡ä»¶å’Œrocketmq-consumerä¸€è‡´ï¼Œè®°ä½ç«¯å£ä¿®æ”¹ä¸€ä¸‹ï¼Œé¿å…å ç”¨rocketmq-consumer-bæ·»åŠ ä¸€ä¸ªç›‘å¬12345678910111213141516171819202122232425262728293031323334353637383940414243 package com.powernode.listener; import org.apache.rocketmq.spring.annotation.MessageModel; import org.apache.rocketmq.spring.annotation.RocketMQMessageListener; import org.apache.rocketmq.spring.core.RocketMQListener; import org.springframework.stereotype.Component; /* \\* messageModel æŒ‡å®šæ¶ˆæ¯æ¶ˆè´¹çš„æ¨¡å¼ \\* CLUSTERING ä¸ºè´Ÿè½½å‡è¡¡æ¨¡å¼ \\* BROADCASTING ä¸ºå¹¿æ’­æ¨¡å¼ \\*/ @Component @RocketMQMessageListener(topic = \\&quot;powernode\\&quot;, consumerGroup = \\&quot;powernode-group\\&quot;, **messageModel = MessageModel.*CLUSTERING** ) public class ConsumerBListener implements RocketMQListener\\&lt;String\\&gt; &#123; @Override public void onMessage(String message) &#123; System.*out*.println(message); &#125; &#125; ä¿®æ”¹rocketmq-consumerçš„SimpleMsgListener1234567891011121314151617181920212223242526272829303132333435363738394041/* * åˆ›å»ºä¸€ä¸ªç®€å•æ¶ˆæ¯çš„ç›‘å¬ * 1.ç±»ä¸Šæ·»åŠ æ³¨è§£@Componentå’Œ@RocketMQMessageListener * * @RocketMQMessageListener(topic = \\&quot;powernode\\&quot;, consumerGroup = \\&quot;powernode-group\\&quot;) topicæŒ‡å®šæ¶ˆè´¹çš„ä¸»é¢˜ï¼ŒconsumerGroupæŒ‡å®šæ¶ˆè´¹ç»„ ,ä¸€ä¸ªä¸»é¢˜å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…ç»„,ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªä¸åŒçš„ç»„çš„æ¶ˆè´¹è€…éƒ½æ¶ˆè´¹* * 2.å®ç°RocketMQListeneræ¥å£ï¼Œæ³¨æ„æ³›å‹çš„ä½¿ç”¨ */ @Component @RocketMQMessageListener(topic = \\&quot;powernode\\&quot;, consumerGroup = \\&quot;powernode-group\\&quot;, **messageModel = MessageModel.*CLUSTERING***) public class SimpleMsgListener implements RocketMQListener\\&lt;String\\&gt; &#123; @Override public void onMessage(String message) &#123; System.*out*.println(new Date()); System.*out*.println(message); &#125; &#125; å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…åœ¨ç”Ÿäº§è€…é‡Œé¢æ·»åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•å¹¶ä¸”è¿è¡Œ12345678910111213141516171819202122/* \\* æµ‹è¯•æ¶ˆæ¯æ¶ˆè´¹çš„æ¨¡å¼ \\ \\* @throws Exception \\*/ @Test public void testMsgModel() throws Exception &#123; for (int i = 0; i \\&lt; 10; i++) &#123; rocketMQTemplate.syncSend(\\&quot;powernode\\&quot;, \\&quot;æˆ‘æ˜¯æ¶ˆæ¯\\&quot; + i); &#125; &#125; æŸ¥çœ‹ä¸¤ä¸ªæ¶ˆè´¹è€…çš„æ§åˆ¶å°ï¼Œå‘ç°æ˜¯è´Ÿè½½å‡è¡¡çš„æ¨¡å¼ ä¿®æ”¹ä¸¤ä¸ªæ¶ˆè´¹è€…çš„æ¨¡å¼ä¸ºBROADCASTINGé‡å¯æµ‹è¯•ï¼Œç»“æœæ˜¯å¹¿æ’­æ¨¡å¼ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½æ¶ˆè´¹äº†è¿™äº›æ¶ˆæ¯ é¡¹ç›®ä¸­ ä¸€èˆ¬éƒ¨ç½²å¤šæ€æœºå™¨ æ¶ˆè´¹è€… 2 - 3 æ ¹æ®ä¸šåŠ¡å¯ä»¥é€‰æ‹©å…·ä½“çš„æ¨¡å¼æ¥é…ç½® é‡ç½®æ¶ˆè´¹ç‚¹ä½, å°†ä¸€ä¸ªç»„çš„æ¶ˆè´¹èŠ‚ç‚¹ è®¾ç½®åœ¨ä¹‹å‰çš„æŸä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šå»ä»è¿™ä¸ªæ—¶é—´ç‚¹å¼€å§‹å¾€åæ¶ˆè´¹ è·³è¿‡å †ç§¯ é€‰æ‹©ä¸€ä¸ªç»„ è·³è¿‡å †ç§¯ä»¥å è¿™ä¸ªç»„é‡Œé¢çš„çš„æ‰€æœ‰éƒ½ä¸ä¼šè¢«æ¶ˆè´¹äº† å¦‚ä½•è§£å†³æ¶ˆæ¯å †ç§¯é—®é¢˜ï¼Ÿä¸€èˆ¬è®¤ä¸ºå•æ¡é˜Ÿåˆ—æ¶ˆæ¯å·®å€¼&gt;&#x3D;10wæ—¶ ç®—å †ç§¯é—®é¢˜ ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°å †ç§¯ ç”Ÿäº§å¤ªå¿«äº† ç”Ÿäº§æ–¹å¯ä»¥åšä¸šåŠ¡é™æµ å¢åŠ æ¶ˆè´¹è€…æ•°é‡,ä½†æ˜¯æ¶ˆè´¹è€…æ•°é‡&lt;&#x3D;é˜Ÿåˆ—æ•°é‡,é€‚å½“çš„è®¾ç½®æœ€å¤§çš„æ¶ˆè´¹çº¿ç¨‹æ•°é‡(æ ¹æ®IO(2n)&#x2F;CPU(n+1)) åŠ¨æ€æ‰©å®¹é˜Ÿåˆ—æ•°é‡,ä»è€Œå¢åŠ æ¶ˆè´¹è€…æ•°é‡ æ¶ˆè´¹è€…æ¶ˆè´¹å‡ºç°é—®é¢˜ æ’æŸ¥æ¶ˆè´¹è€…ç¨‹åºçš„é—®é¢˜ å¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ ç”Ÿäº§è€…ä½¿ç”¨åŒæ­¥å‘é€æ¨¡å¼ ï¼Œæ”¶åˆ°mqçš„è¿”å›ç¡®è®¤ä»¥åé¡ºä¾¿å¾€è‡ªå·±çš„æ•°æ®åº“é‡Œé¢å†™ msgId status(0) time æ¶ˆè´¹è€…æ¶ˆè´¹ä»¥å ä¿®æ”¹æ•°æ®è¿™æ¡æ¶ˆæ¯çš„çŠ¶æ€ &#x3D; 1 å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ é—´éš”ä¸¤å¤©å»æŸ¥è¯¢æ•°æ® å¦‚æœæœ‰status &#x3D; 0 and time &lt; day-2 å°†mqçš„åˆ·ç›˜æœºåˆ¶è®¾ç½®ä¸ºåŒæ­¥åˆ·ç›˜ ä½¿ç”¨é›†ç¾¤æ¨¡å¼ ï¼Œæä¸»å¤‡æ¨¡å¼ï¼Œå°†æ¶ˆæ¯æŒä¹…åŒ–åœ¨ä¸åŒçš„ç¡¬ä»¶ä¸Š å¯ä»¥å¼€å¯mqçš„traceæœºåˆ¶ï¼Œæ¶ˆæ¯è·Ÿè¸ªæœºåˆ¶ 1.åœ¨broker.confä¸­å¼€å¯æ¶ˆæ¯è¿½è¸ª traceTopicEnable&#x3D;true 2.é‡å¯brokerå³å¯ 3.ç”Ÿäº§è€…é…ç½®æ–‡ä»¶å¼€å¯æ¶ˆæ¯è½¨è¿¹ enable-msg-trace: true 1&lt;!-- --&gt; æ¶ˆè´¹è€…å¼€å¯æ¶ˆæ¯è½¨è¿¹åŠŸèƒ½ï¼Œå¯ä»¥ç»™å•ç‹¬çš„æŸä¸€ä¸ªæ¶ˆè´¹è€…å¼€å¯ enableMsgTrace &#x3D; true åœ¨rocketmqçš„é¢æ¿ä¸­å¯ä»¥æŸ¥çœ‹æ¶ˆæ¯è½¨è¿¹ é»˜è®¤ä¼šå°†æ¶ˆæ¯è½¨è¿¹çš„æ•°æ®å­˜åœ¨ RMQ_SYS_TRACE_TOPIC ä¸»é¢˜é‡Œé¢ å®‰å…¨ å¼€å¯aclçš„æ§åˆ¶ åœ¨broker.confä¸­å¼€å¯aclEnable&#x3D;true é…ç½®è´¦å·å¯†ç  ä¿®æ”¹plain_acl.yml ä¿®æ”¹æ§åˆ¶é¢æ¿çš„é…ç½®æ–‡ä»¶ æ”¾å¼€52&#x2F;53è¡Œ æŠŠ49è¡Œæ”¹ä¸ºtrueä¸Šä¼ åˆ°æœåŠ¡å™¨çš„jaråŒ…å¹³çº§ç›®å½•ä¸‹å³å¯","categories":[{"name":"mq","slug":"mq","permalink":"http://example.com/mq/"}],"tags":[{"name":"mq","slug":"mq","permalink":"http://example.com/tags/mq/"}]},{"title":"RocketMqï¼ˆå››ï¼‰--æ¶ˆæ¯å‘é€","slug":"mq/RocketMq/RocketMqï¼ˆå››ï¼‰-æ¶ˆæ¯å‘é€","date":"2023-06-19T02:19:02.000Z","updated":"2023-06-19T02:34:16.798Z","comments":true,"path":"2023/06/19/mq/RocketMq/RocketMqï¼ˆå››ï¼‰-æ¶ˆæ¯å‘é€/","link":"","permalink":"http://example.com/2023/06/19/mq/RocketMq/RocketMq%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81/","excerpt":"","text":"æ¶ˆè´¹æ¨¡å¼MQçš„æ¶ˆè´¹æ¨¡å¼å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯æ¨Pushï¼Œä¸€ç§æ˜¯æ‹‰Pullã€‚ Pushæ˜¯æœåŠ¡ç«¯ã€MQã€‘ä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ï¼Œä¼˜ç‚¹æ˜¯åŠæ—¶æ€§è¾ƒå¥½ï¼Œä½†å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰åšå¥½æµæ§ï¼Œä¸€æ—¦æœåŠ¡ç«¯æ¨é€å¤§é‡æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯æ—¶ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯æ¶ˆæ¯å †ç§¯ç”šè‡³å´©æºƒã€‚ Pullæ˜¯å®¢æˆ·ç«¯éœ€è¦ä¸»åŠ¨åˆ°æœåŠ¡ç«¯å–æ•°æ®ï¼Œä¼˜ç‚¹æ˜¯å®¢æˆ·ç«¯å¯ä»¥ä¾æ®è‡ªå·±çš„æ¶ˆè´¹èƒ½åŠ›è¿›è¡Œæ¶ˆè´¹ï¼Œä½†æ‹‰å–çš„é¢‘ç‡ä¹Ÿéœ€è¦ç”¨æˆ·è‡ªå·±æ§åˆ¶ï¼Œæ‹‰å–é¢‘ç¹å®¹æ˜“é€ æˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å‹åŠ›ï¼Œæ‹‰å–é—´éš”é•¿åˆå®¹æ˜“é€ æˆæ¶ˆè´¹ä¸åŠæ—¶ã€‚ Pushæ¨¡å¼ä¹Ÿæ˜¯åŸºäºpullæ¨¡å¼çš„ï¼Œåªèƒ½å®¢æˆ·ç«¯å†…éƒ¨å°è£…äº†apiï¼Œä¸€èˆ¬åœºæ™¯ä¸‹ï¼Œä¸Šæ¸¸æ¶ˆæ¯ç”Ÿäº§é‡å°æˆ–è€…å‡é€Ÿçš„æ—¶å€™ï¼Œé€‰æ‹©pushæ¨¡å¼ã€‚åœ¨ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œä¾‹å¦‚ç”µå•†å¤§ä¿ƒï¼ŒæŠ¢ä¼˜æƒ åˆ¸ç­‰åœºæ™¯å¯ä»¥é€‰æ‹©pullæ¨¡å¼ RocketMQå‘é€åŒæ­¥æ¶ˆæ¯ä¸Šé¢çš„å¿«é€Ÿå…¥é—¨å°±æ˜¯å‘é€åŒæ­¥æ¶ˆæ¯ï¼Œå‘é€è¿‡åä¼šæœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯mqæœåŠ¡å™¨æ¥æ”¶åˆ°æ¶ˆæ¯åè¿”å›çš„ä¸€ä¸ªç¡®è®¤ï¼Œè¿™ç§æ–¹å¼éå¸¸å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½ä¸Šå¹¶æ²¡æœ‰è¿™ä¹ˆé«˜ï¼Œè€Œä¸”åœ¨mqé›†ç¾¤ä¸­ï¼Œä¹Ÿæ˜¯è¦ç­‰åˆ°æ‰€æœ‰çš„ä»æœºéƒ½å¤åˆ¶äº†æ¶ˆæ¯ä»¥åæ‰ä¼šè¿”å›ï¼Œæ‰€ä»¥é’ˆå¯¹é‡è¦çš„æ¶ˆæ¯å¯ä»¥é€‰æ‹©è¿™ç§æ–¹å¼ RocketMQå‘é€å¼‚æ­¥æ¶ˆæ¯å¼‚æ­¥æ¶ˆæ¯é€šå¸¸ç”¨åœ¨å¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ï¼Œå³å‘é€ç«¯ä¸èƒ½å®¹å¿é•¿æ—¶é—´åœ°ç­‰å¾…Brokerçš„å“åº”ã€‚å‘é€å®Œä»¥åä¼šæœ‰ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯é€šçŸ¥ å¼‚æ­¥æ¶ˆæ¯ç”Ÿäº§è€…1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950 @Test public void testAsyncProducer() throws Exception &#123; // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€…* DefaultMQProducer producer = new DefaultMQProducer(//&quot;test-group//&quot;); // è®¾ç½®nameServeråœ°å€* producer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // å¯åŠ¨å®ä¾‹* producer.start(); Message msg = new Message(//&quot;TopicTest//&quot;, (//&quot;å¼‚æ­¥æ¶ˆæ¯//&quot;).getBytes()); producer.send(msg, new SendCallback() &#123; @Override public void onSuccess(SendResult sendResult) &#123; System.out.println(//&quot;å‘é€æˆåŠŸ//&quot;); &#125; //@Override public void onException(Throwable e) &#123; System.*out*.println(//&quot;å‘é€å¤±è´¥//&quot;); &#125; &#125;); System.*out*.println(//&quot;çœ‹çœ‹è°å…ˆæ‰§è¡Œ//&quot;); // æŒ‚èµ·jvm å› ä¸ºå›è°ƒæ˜¯å¼‚æ­¥çš„ä¸ç„¶æµ‹è¯•ä¸å‡ºæ¥* System.*in*.read(); // å…³é—­å®ä¾‹* producer.shutdown(); &#125; å¼‚æ­¥æ¶ˆæ¯æ¶ˆè´¹è€…12345678910111213141516171819202122232425262728293031323334353637383940414243444546//@Test public void testAsyncConsumer() throws Exception &#123; // åˆ›å»ºé»˜è®¤æ¶ˆè´¹è€…ç»„* DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(//&quot;consumer-group//&quot;); // è®¾ç½®nameServeråœ°å€* consumer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ¥æ¶ˆè´¹//*è¡¨ç¤ºæ²¡æœ‰è¿‡æ»¤å‚æ•° è¡¨ç¤ºè¿™ä¸ªä¸»é¢˜çš„ä»»ä½•æ¶ˆæ¯* consumer.subscribe(//&quot;TopicTest//&quot;,//&quot;//*//&quot;); // æ³¨å†Œä¸€ä¸ªæ¶ˆè´¹ç›‘å¬ MessageListenerConcurrentlyæ˜¯å¹¶å‘æ¶ˆè´¹* // é»˜è®¤æ˜¯20ä¸ªçº¿ç¨‹ä¸€èµ·æ¶ˆè´¹ï¼Œå¯ä»¥å‚çœ‹ consumer.setConsumeThreadMax()* consumer.registerMessageListener(new MessageListenerConcurrently() &#123; //@Override public ConsumeConcurrentlyStatus consumeMessage(List//&lt;MessageExt//&gt; msgs, ConsumeConcurrentlyContext context) &#123; // è¿™é‡Œæ‰§è¡Œæ¶ˆè´¹çš„ä»£ç  é»˜è®¤æ˜¯å¤šçº¿ç¨‹æ¶ˆè´¹* System.*out*.println(Thread.*currentThread*().getName() + //&quot;//-//-//--//&quot; + msgs); return ConsumeConcurrentlyStatus.*CONSUME_SUCCESS*; &#125; &#125;); consumer.start(); System.*in*.read(); &#125; â€‹ RocketMQå‘é€å•å‘æ¶ˆæ¯è¿™ç§æ–¹å¼ä¸»è¦ç”¨åœ¨ä¸å…³å¿ƒå‘é€ç»“æœçš„åœºæ™¯ï¼Œè¿™ç§æ–¹å¼ååé‡å¾ˆå¤§ï¼Œä½†æ˜¯å­˜åœ¨æ¶ˆæ¯ä¸¢å¤±çš„é£é™©ï¼Œä¾‹å¦‚æ—¥å¿—ä¿¡æ¯çš„å‘é€ å•å‘æ¶ˆæ¯ç”Ÿäº§è€…123456789101112131415161718192021222324252627//@Test public void testOnewayProducer() throws Exception &#123; // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€…* DefaultMQProducer producer = new DefaultMQProducer(//&quot;test-group//&quot;); // è®¾ç½®nameServeråœ°å€* producer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // å¯åŠ¨å®ä¾‹* producer.start(); Message msg = new Message(//&quot;TopicTest//&quot;, (//&quot;å•å‘æ¶ˆæ¯//&quot;).getBytes()); // å‘é€å•å‘æ¶ˆæ¯* producer.sendOneway(msg); // å…³é—­å®ä¾‹* producer.shutdown(); &#125; â€‹ å•å‘æ¶ˆæ¯æ¶ˆè´¹è€…æ¶ˆè´¹è€…å’Œä¸Šé¢ä¸€æ · RocketMQå‘é€å»¶è¿Ÿæ¶ˆæ¯æ¶ˆæ¯æ”¾å…¥mqåï¼Œè¿‡ä¸€æ®µæ—¶é—´ï¼Œæ‰ä¼šè¢«ç›‘å¬åˆ°ï¼Œç„¶åæ¶ˆè´¹ æ¯”å¦‚ä¸‹è®¢å•ä¸šåŠ¡ï¼Œæäº¤äº†ä¸€ä¸ªè®¢å•å°±å¯ä»¥å‘é€ä¸€ä¸ªå»¶æ—¶æ¶ˆæ¯ï¼Œ30minåå»æ£€æŸ¥è¿™ä¸ªè®¢å•çš„çŠ¶æ€ï¼Œå¦‚æœè¿˜æ˜¯æœªä»˜æ¬¾å°±å–æ¶ˆè®¢å•é‡Šæ”¾åº“å­˜ã€‚ å»¶è¿Ÿæ¶ˆæ¯ç”Ÿäº§è€…123456789101112131415161718192021222324252627282930313233343536373839//@Test public void testDelayProducer() throws Exception &#123; // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€…* DefaultMQProducer producer = new DefaultMQProducer(//&quot;test-group//&quot;); // è®¾ç½®nameServeråœ°å€* producer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // å¯åŠ¨å®ä¾‹* producer.start(); Message msg = new Message(//&quot;TopicTest//&quot;, (//&quot;å»¶è¿Ÿæ¶ˆæ¯//&quot;).getBytes()); // ç»™è¿™ä¸ªæ¶ˆæ¯è®¾å®šä¸€ä¸ªå»¶è¿Ÿç­‰çº§* // messageDelayLevel =//&quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h* msg.setDelayTimeLevel(3); // å‘é€å•å‘æ¶ˆæ¯* producer.send(msg); // æ‰“å°æ—¶é—´* System.*out*.println(new Date()); // å…³é—­å®ä¾‹* producer.shutdown(); &#125; å»¶è¿Ÿæ¶ˆæ¯æ¶ˆè´¹è€…æ¶ˆè´¹è€…å’Œä¸Šé¢ä¸€æ · è¿™é‡Œæ³¨æ„çš„æ˜¯RocketMQä¸æ”¯æŒä»»æ„æ—¶é—´çš„å»¶æ—¶ åªæ”¯æŒä»¥ä¸‹å‡ ä¸ªå›ºå®šçš„å»¶æ—¶ç­‰çº§ï¼Œç­‰çº§1å°±å¯¹åº”1sï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€é«˜æ”¯æŒ2hå»¶è¿Ÿ private String messageDelayLevel &#x3D;&#x2F;&#x2F;â€œ1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m8m 9m 10m 20m 30m 1h 2h&#x2F;&#x2F;â€œ; RocketMQå‘é€é¡ºåºæ¶ˆæ¯æ¶ˆæ¯æœ‰åºæŒ‡çš„æ˜¯å¯ä»¥æŒ‰ç…§æ¶ˆæ¯çš„å‘é€é¡ºåºæ¥æ¶ˆè´¹(FIFO)ã€‚RocketMQå¯ä»¥ä¸¥æ ¼çš„ä¿è¯æ¶ˆæ¯æœ‰åºï¼Œå¯ä»¥åˆ†ä¸ºï¼šåˆ†åŒºæœ‰åºæˆ–è€…å…¨å±€æœ‰åºã€‚ å¯èƒ½å¤§å®¶ä¼šæœ‰ç–‘é—®ï¼Œmqä¸å°±æ˜¯FIFOå—ï¼Ÿ rocketMqçš„brokerçš„æœºåˆ¶ï¼Œå¯¼è‡´äº†rocketMqä¼šæœ‰è¿™ä¸ªé—®é¢˜ å› ä¸ºä¸€ä¸ªbrokerä¸­å¯¹åº”äº†å››ä¸ªqueue é¡ºåºæ¶ˆè´¹çš„åŸç†è§£æï¼Œåœ¨é»˜è®¤çš„æƒ…å†µä¸‹æ¶ˆæ¯å‘é€ä¼šé‡‡å–RoundRobinè½®è¯¢æ–¹å¼æŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„queue(åˆ†åŒºé˜Ÿåˆ—)ï¼›è€Œæ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ä»å¤šä¸ªqueueä¸Šæ‹‰å–æ¶ˆæ¯ï¼Œè¿™ç§æƒ…å†µå‘é€å’Œæ¶ˆè´¹æ˜¯ä¸èƒ½ä¿è¯é¡ºåºã€‚ä½†æ˜¯å¦‚æœæ§åˆ¶å‘é€çš„é¡ºåºæ¶ˆæ¯åªä¾æ¬¡å‘é€åˆ°åŒä¸€ä¸ªqueueä¸­ï¼Œæ¶ˆè´¹çš„æ—¶å€™åªä»è¿™ä¸ªqueueä¸Šä¾æ¬¡æ‹‰å–ï¼Œåˆ™å°±ä¿è¯äº†é¡ºåºã€‚å½“å‘é€å’Œæ¶ˆè´¹å‚ä¸çš„queueåªæœ‰ä¸€ä¸ªï¼Œåˆ™æ˜¯å…¨å±€æœ‰åºï¼›å¦‚æœå¤šä¸ªqueueå‚ä¸ï¼Œåˆ™ä¸ºåˆ†åŒºæœ‰åºï¼Œå³ç›¸å¯¹æ¯ä¸ªqueueï¼Œæ¶ˆæ¯éƒ½æ˜¯æœ‰åºçš„ã€‚ ä¸‹é¢ç”¨è®¢å•è¿›è¡Œåˆ†åŒºæœ‰åºçš„ç¤ºä¾‹ã€‚ä¸€ä¸ªè®¢å•çš„é¡ºåºæµç¨‹æ˜¯ï¼šä¸‹è®¢å•ã€å‘çŸ­ä¿¡é€šçŸ¥ã€ç‰©æµã€ç­¾æ”¶ã€‚è®¢å•é¡ºåºå·ç›¸åŒçš„æ¶ˆæ¯ä¼šè¢«å…ˆåå‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹æ—¶ï¼ŒåŒä¸€ä¸ªé¡ºåºè·å–åˆ°çš„è‚¯å®šæ˜¯åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚ åœºæ™¯åˆ†ææ¨¡æ‹Ÿä¸€ä¸ªè®¢å•çš„å‘é€æµç¨‹ï¼Œåˆ›å»ºä¸¤ä¸ªè®¢å•ï¼Œå‘é€çš„æ¶ˆæ¯åˆ†åˆ«æ˜¯ è®¢å•å·111 æ¶ˆæ¯æµç¨‹ ä¸‹è®¢å•-&#x2F;&#x2F;&gt;ç‰©æµ-&#x2F;&#x2F;&gt;ç­¾æ”¶ è®¢å•å·112 æ¶ˆæ¯æµç¨‹ ä¸‹è®¢å•-&#x2F;&#x2F;&gt;ç‰©æµ-&#x2F;&#x2F;&gt;æ‹’æ”¶ åˆ›å»ºä¸€ä¸ªè®¢å•å¯¹è±¡1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950//@Data //@AllArgsConstructor //@NoArgsConstructor public class Order &#123; *///*// *//* è®¢å•id* *//*/* private Integer orderId; *///*// *//* è®¢å•ç¼–å·* *//*/* private Integer orderNumber; *///*// *//* è®¢å•ä»·æ ¼* *//*/* private Double price; *///*// *//* è®¢å•å·åˆ›å»ºæ—¶é—´* *//*/* private Date createTime; *///*// *//* è®¢å•æè¿°* *//*/* private String desc; &#125; é¡ºåºæ¶ˆæ¯ç”Ÿäº§è€…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384//@Test public void testOrderlyProducer() throws Exception &#123; // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€…* DefaultMQProducer producer = new DefaultMQProducer(//&quot;test-group//&quot;); // è®¾ç½®nameServeråœ°å€* producer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // å¯åŠ¨å®ä¾‹* producer.start(); List//&lt;Order//&gt; orderList = Arrays.*asList*( new Order(1, 111, 59D, new Date(),//&quot;ä¸‹è®¢å•//&quot;), new Order(2, 111, 59D, new Date(),//&quot;ç‰©æµ//&quot;), new Order(3, 111, 59D, new Date(),//&quot;ç­¾æ”¶//&quot;), new Order(4, 112, 89D, new Date(),//&quot;ä¸‹è®¢å•//&quot;), new Order(5, 112, 89D, new Date(),//&quot;ç‰©æµ//&quot;), new Order(6, 112, 89D, new Date(),//&quot;æ‹’æ”¶//&quot;) ); // å¾ªç¯é›†åˆå¼€å§‹å‘é€* orderList.forEach(order -//&gt; &#123; Message message = new Message(//&quot;TopicTest//&quot;, order.toString().getBytes()); try &#123; // å‘é€çš„æ—¶å€™ ç›¸åŒçš„è®¢å•å·é€‰æ‹©åŒä¸€ä¸ªé˜Ÿåˆ—* producer.send(message, new MessageQueueSelector() &#123; //@Override public MessageQueue select(List//&lt;MessageQueue//&gt; mqs, Message msg, Object arg) &#123; // å½“å‰ä¸»é¢˜æœ‰å¤šå°‘ä¸ªé˜Ÿåˆ—* int queueNumber = mqs.size(); // è¿™ä¸ªargå°±æ˜¯åé¢ä¼ å…¥çš„ order.getOrderNumber()* Integer i = (Integer) arg; // ç”¨è¿™ä¸ªå€¼å»%é˜Ÿåˆ—çš„ä¸ªæ•°å¾—åˆ°ä¸€ä¸ªé˜Ÿåˆ—* int index = i % queueNumber; // è¿”å›é€‰æ‹©çš„è¿™ä¸ªé˜Ÿåˆ—å³å¯ ï¼Œé‚£ä¹ˆç›¸åŒçš„è®¢å•å· å°±ä¼šè¢«æ”¾åœ¨ç›¸åŒçš„é˜Ÿåˆ—é‡Œ å®ç°FIFOäº†* return mqs.get(index); &#125; &#125;, order.getOrderNumber()); &#125; catch (Exception e) &#123; System.*out*.println(//&quot;å‘é€å¼‚å¸¸//&quot;); &#125; &#125;); // å…³é—­å®ä¾‹* producer.shutdown(); &#125; â€‹ é¡ºåºæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œæµ‹è¯•æ—¶ä¸€ä¼šå³å¯æœ‰å»¶è¿Ÿ123456789101112131415161718192021222324252627282930313233343536373839404142//@Test public void testOrderlyConsumer() throws Exception &#123; // åˆ›å»ºé»˜è®¤æ¶ˆè´¹è€…ç»„* DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(//&quot;consumer-group//&quot;); // è®¾ç½®nameServeråœ°å€* consumer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ¥æ¶ˆè´¹//*è¡¨ç¤ºæ²¡æœ‰è¿‡æ»¤å‚æ•° è¡¨ç¤ºè¿™ä¸ªä¸»é¢˜çš„ä»»ä½•æ¶ˆæ¯* consumer.subscribe(//&quot;TopicTest//&quot;,//&quot;//*//&quot;); // æ³¨å†Œä¸€ä¸ªæ¶ˆè´¹ç›‘å¬ MessageListenerOrderly æ˜¯é¡ºåºæ¶ˆè´¹ å•çº¿ç¨‹æ¶ˆè´¹* consumer.registerMessageListener(**new MessageListenerOrderly()&#123; //@Override public ConsumeOrderlyStatus consumeMessage(List//&lt;MessageExt//&gt; msgs, ConsumeOrderlyContext context) &#123; MessageExt messageExt = msgs.get(0); System.*out*.println(new String(messageExt.getBody())); return ConsumeOrderlyStatus.*SUCCESS*; &#125; &#125;); consumer.start(); System.*in*.read(); &#125; RocketMQå‘é€æ‰¹é‡æ¶ˆæ¯Rocketmqå¯ä»¥ä¸€æ¬¡æ€§å‘é€ä¸€ç»„æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™ä¸€ç»„æ¶ˆæ¯ä¼šè¢«å½“åšä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹ æ‰¹é‡æ¶ˆæ¯ç”Ÿäº§è€…123456789101112131415161718192021222324252627282930313233343536//@Test public void testBatchProducer() throws Exception &#123; // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€…* DefaultMQProducer producer = new DefaultMQProducer(//&quot;test-group//&quot;); // è®¾ç½®nameServeråœ°å€* producer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // å¯åŠ¨å®ä¾‹* producer.start(); List//&lt;Message//&gt; msgs = Arrays.*asList*( new Message(//&quot;TopicTest//&quot;,//&quot;æˆ‘æ˜¯ä¸€ç»„æ¶ˆæ¯çš„Aæ¶ˆæ¯//&quot;.getBytes()), new Message(//&quot;TopicTest//&quot;,//&quot;æˆ‘æ˜¯ä¸€ç»„æ¶ˆæ¯çš„Bæ¶ˆæ¯//&quot;.getBytes()), new Message(//&quot;TopicTest//&quot;,//&quot;æˆ‘æ˜¯ä¸€ç»„æ¶ˆæ¯çš„Cæ¶ˆæ¯//&quot;.getBytes()) ); SendResult send = producer.send(msgs); System.*out*.println(send); // å…³é—­å®ä¾‹* producer.shutdown(); &#125; æ‰¹é‡æ¶ˆæ¯æ¶ˆè´¹è€…12345678910111213141516171819202122232425262728293031323334353637383940414243444546//@Test public void testBatchConsumer() throws Exception &#123; // åˆ›å»ºé»˜è®¤æ¶ˆè´¹è€…ç»„* DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(//&quot;consumer-group//&quot;); // è®¾ç½®nameServeråœ°å€* consumer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ¥æ¶ˆè´¹ è¡¨è¾¾å¼ï¼Œé»˜è®¤æ˜¯// consumer.subscribe(//&quot;TopicTest//&quot;,//&quot;//*//&quot;); // æ³¨å†Œä¸€ä¸ªæ¶ˆè´¹ç›‘å¬ MessageListenerConcurrentlyæ˜¯å¹¶å‘æ¶ˆè´¹* // é»˜è®¤æ˜¯20ä¸ªçº¿ç¨‹ä¸€èµ·æ¶ˆè´¹ï¼Œå¯ä»¥å‚çœ‹ consumer.setConsumeThreadMax()* consumer.registerMessageListener(new MessageListenerConcurrently() &#123; //@Override public ConsumeConcurrentlyStatus consumeMessage(List//&lt;MessageExt//&gt; msgs, ConsumeConcurrentlyContext context) &#123; // è¿™é‡Œæ‰§è¡Œæ¶ˆè´¹çš„ä»£ç  é»˜è®¤æ˜¯å¤šçº¿ç¨‹æ¶ˆè´¹* System.*out*.println(Thread.*currentThread*().getName() + //&quot;//-//-//--//&quot; + new String(msgs.get(0).getBody())); return ConsumeConcurrentlyStatus.*CONSUME_SUCCESS*; &#125; &#125;); consumer.start(); System.*in*.read(); &#125; RocketMQå‘é€äº‹åŠ¡æ¶ˆæ¯äº‹åŠ¡æ¶ˆæ¯çš„å‘é€æµç¨‹å®ƒå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªä¸¤é˜¶æ®µçš„æäº¤æ¶ˆæ¯å®ç°ï¼Œä»¥ç¡®ä¿åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€ç»ˆä¸€è‡´æ€§ã€‚äº‹åŠ¡æ€§æ¶ˆæ¯ç¡®ä¿æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œå’Œæ¶ˆæ¯çš„å‘é€å¯ä»¥åŸå­åœ°æ‰§è¡Œã€‚ ä¸Šå›¾è¯´æ˜äº†äº‹åŠ¡æ¶ˆæ¯çš„å¤§è‡´æ–¹æ¡ˆï¼Œå…¶ä¸­åˆ†ä¸ºä¸¤ä¸ªæµç¨‹ï¼šæ­£å¸¸äº‹åŠ¡æ¶ˆæ¯çš„å‘é€åŠæäº¤ã€äº‹åŠ¡æ¶ˆæ¯çš„è¡¥å¿æµç¨‹ã€‚ äº‹åŠ¡æ¶ˆæ¯å‘é€åŠæäº¤ å‘é€æ¶ˆæ¯ï¼ˆhalfæ¶ˆæ¯ï¼‰ã€‚ æœåŠ¡ç«¯å“åº”æ¶ˆæ¯å†™å…¥ç»“æœã€‚ æ ¹æ®å‘é€ç»“æœæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ˆå¦‚æœå†™å…¥å¤±è´¥ï¼Œæ­¤æ—¶halfæ¶ˆæ¯å¯¹ä¸šåŠ¡ä¸å¯è§ï¼Œæœ¬åœ°é€»è¾‘ä¸æ‰§è¡Œï¼‰ã€‚ æ ¹æ®æœ¬åœ°äº‹åŠ¡çŠ¶æ€æ‰§è¡ŒCommitæˆ–Rollbackï¼ˆCommitæ“ä½œç”Ÿæˆæ¶ˆæ¯ç´¢å¼•ï¼Œæ¶ˆæ¯å¯¹æ¶ˆè´¹è€…å¯è§ï¼‰ äº‹åŠ¡è¡¥å¿ å¯¹æ²¡æœ‰Commit&#x2F;Rollbackçš„äº‹åŠ¡æ¶ˆæ¯ï¼ˆpendingçŠ¶æ€çš„æ¶ˆæ¯ï¼‰ï¼Œä»æœåŠ¡ç«¯å‘èµ·ä¸€æ¬¡â€å›æŸ¥â€ Produceræ”¶åˆ°å›æŸ¥æ¶ˆæ¯ï¼Œæ£€æŸ¥å›æŸ¥æ¶ˆæ¯å¯¹åº”çš„æœ¬åœ°äº‹åŠ¡çš„çŠ¶æ€ æ ¹æ®æœ¬åœ°äº‹åŠ¡çŠ¶æ€ï¼Œé‡æ–°Commitæˆ–è€…Rollback å…¶ä¸­ï¼Œè¡¥å¿é˜¶æ®µç”¨äºè§£å†³æ¶ˆæ¯UNKNOWæˆ–è€…Rollbackå‘ç”Ÿè¶…æ—¶æˆ–è€…å¤±è´¥çš„æƒ…å†µã€‚ äº‹åŠ¡æ¶ˆæ¯çŠ¶æ€ äº‹åŠ¡æ¶ˆæ¯å…±æœ‰ä¸‰ç§çŠ¶æ€ï¼Œæäº¤çŠ¶æ€ã€å›æ»šçŠ¶æ€ã€ä¸­é—´çŠ¶æ€ï¼š TransactionStatus.CommitTransaction:æäº¤äº‹åŠ¡ï¼Œå®ƒå…è®¸æ¶ˆè´¹è€…æ¶ˆè´¹æ­¤æ¶ˆæ¯ã€‚ TransactionStatus.RollbackTransaction:å›æ»šäº‹åŠ¡ï¼Œå®ƒä»£è¡¨è¯¥æ¶ˆæ¯å°†è¢«åˆ é™¤ï¼Œä¸å…è®¸è¢«æ¶ˆè´¹ã€‚ TransactionStatus.Unknown:ä¸­é—´çŠ¶æ€ï¼Œå®ƒä»£è¡¨éœ€è¦æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—æ¥ç¡®å®šçŠ¶æ€ã€‚ äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109 *///*// *//* TransactionalMessageCheckServiceçš„æ£€æµ‹é¢‘ç‡é»˜è®¤1åˆ†é’Ÿï¼Œå¯é€šè¿‡åœ¨broker. confæ–‡ä»¶ä¸­è®¾ç½®transactionCheckIntervalçš„å€¼æ¥æ”¹å˜é»˜è®¤å€¼ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚* *//* ä»brokeré…ç½®æ–‡ä»¶ä¸­è·å–transactionTimeOutå‚æ•°å€¼ã€‚* *//* ä»brokeré…ç½®æ–‡ä»¶ä¸­è·å–transactionCheckMaxå‚æ•°å€¼ï¼Œè¡¨ç¤º äº‹åŠ¡çš„æœ€å¤§æ£€æµ‹æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡æ£€æµ‹æ¬¡æ•°ï¼Œæ¶ˆæ¯ä¼šé»˜è®¤ä¸ºä¸¢å¼ƒï¼Œå³å›æ»šæ¶ˆæ¯ã€‚* *// *//*//@throws Exception* *//*/* //@Test public void testTransactionProducer() throws Exception &#123; // åˆ›å»ºä¸€ä¸ªäº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…* TransactionMQProducer producer = new TransactionMQProducer(//&quot;test-group//&quot;); producer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // è®¾ç½®äº‹åŠ¡æ¶ˆæ¯ç›‘å¬å™¨* producer.setTransactionListener(new TransactionListener() &#123; // è¿™ä¸ªæ˜¯æ‰§è¡Œæœ¬åœ°ä¸šåŠ¡æ–¹æ³•* //@Override public LocalTransactionState executeLocalTransaction(Message msg, Object arg) &#123; System.*out*.println(new Date()); System.*out*.println(new String(msg.getBody())); // è¿™ä¸ªå¯ä»¥ä½¿ç”¨try catchå¯¹ä¸šåŠ¡ä»£ç è¿›è¡Œæ€§åŒ…è£¹* // COMMIT_MESSAGE è¡¨ç¤ºå…è®¸æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥æ¶ˆæ¯* // ROLLBACK_MESSAGE è¡¨ç¤ºè¯¥æ¶ˆæ¯å°†è¢«åˆ é™¤ï¼Œä¸å…è®¸æ¶ˆè´¹* // UNKNOWè¡¨ç¤ºéœ€è¦MQå›æŸ¥æ‰èƒ½ç¡®å®šçŠ¶æ€ é‚£ä¹ˆè¿‡ä¸€ä¼š ä»£ç ä¼šèµ°ä¸‹é¢çš„checkLocalTransaction(msg)æ–¹æ³•* return LocalTransactionState.*UNKNOW*; &#125; // è¿™é‡Œæ˜¯å›æŸ¥æ–¹æ³• å›æŸ¥ä¸æ˜¯å†æ¬¡æ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Œè€Œæ˜¯ç¡®è®¤ä¸Šé¢çš„æ“ä½œæ˜¯å¦æœ‰ç»“æœ* // é»˜è®¤æ˜¯1minå›æŸ¥ é»˜è®¤å›æŸ¥15æ¬¡ è¶…è¿‡æ¬¡æ•°åˆ™ä¸¢å¼ƒæ‰“å°æ—¥å¿— å¯ä»¥é€šè¿‡å‚æ•°è®¾ç½®* // transactionTimeOut è¶…æ—¶æ—¶é—´* // transactionCheckMax æœ€å¤§å›æŸ¥æ¬¡æ•°* // transactionCheckInterval å›æŸ¥é—´éš”æ—¶é—´å•ä½æ¯«ç§’* // è§¦å‘æ¡ä»¶* // 1.å½“ä¸Šé¢æ‰§è¡Œæœ¬åœ°äº‹åŠ¡è¿”å›ç»“æœUNKNOWæ—¶,æˆ–è€…ä¸‹é¢çš„å›æŸ¥æ–¹æ³•ä¹Ÿè¿”å›UNKNOWæ—¶ ä¼šè§¦å‘å›æŸ¥* // 2.å½“ ä¸Šé¢æ“ä½œè¶…è¿‡20sæ²¡æœ‰åšå‡ºä¸€ä¸ªç»“æœï¼Œä¹Ÿå°±æ˜¯è¶…æ—¶æˆ–è€…å¡ä¸»äº†ï¼Œä¹Ÿä¼šè¿›è¡Œå›æŸ¥* //@Override public LocalTransactionState checkLocalTransaction(MessageExt msg) &#123; System.*err*.println(new Date()); System.*err*.println(new String(msg.getBody())); // è¿™é‡Œ* return LocalTransactionState.*UNKNOW*; &#125; &#125;); producer.start(); Message message = new Message(//&quot;TopicTest2//&quot;, //&quot;æˆ‘æ˜¯ä¸€ä¸ªäº‹åŠ¡æ¶ˆæ¯//&quot;.getBytes()); // å‘é€æ¶ˆæ¯* producer.sendMessageInTransaction(message, null); System.*out*.println(new Date()); System.*in*.read(); &#125; äº‹åŠ¡æ¶ˆæ¯æ¶ˆè´¹è€…1234567891011121314151617181920212223242526272829303132333435363738394041424344454647//@Test public void testTransactionConsumer() throws Exception &#123; // åˆ›å»ºé»˜è®¤æ¶ˆè´¹è€…ç»„* DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(//&quot;consumer-group//&quot;); // è®¾ç½®nameServeråœ°å€* consumer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ¥æ¶ˆè´¹//*è¡¨ç¤ºæ²¡æœ‰è¿‡æ»¤å‚æ•° è¡¨ç¤ºè¿™ä¸ªä¸»é¢˜çš„ä»»ä½•æ¶ˆæ¯* consumer.subscribe(//&quot;TopicTest2//&quot;,//&quot;//*//&quot;); // æ³¨å†Œä¸€ä¸ªæ¶ˆè´¹ç›‘å¬ MessageListenerConcurrentlyæ˜¯å¹¶å‘æ¶ˆè´¹* // é»˜è®¤æ˜¯20ä¸ªçº¿ç¨‹ä¸€èµ·æ¶ˆè´¹ï¼Œå¯ä»¥å‚çœ‹ consumer.setConsumeThreadMax()* consumer.registerMessageListener(new MessageListenerConcurrently() &#123; //@Override public ConsumeConcurrentlyStatus consumeMessage(List//&lt;MessageExt//&gt; msgs, ConsumeConcurrentlyContext context) &#123; // è¿™é‡Œæ‰§è¡Œæ¶ˆè´¹çš„ä»£ç  é»˜è®¤æ˜¯å¤šçº¿ç¨‹æ¶ˆè´¹* System.*out*.println(Thread.*currentThread*().getName() + //&quot;//-//-//--//&quot; + new String(msgs.get(0).getBody())); return ConsumeConcurrentlyStatus.*CONSUME_SUCCESS*; &#125; &#125;); consumer.start(); System.*in*.read(); &#125; æµ‹è¯•ç»“æœ RocketMQå‘é€å¸¦æ ‡ç­¾çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯è¿‡æ»¤Rocketmqæä¾›æ¶ˆæ¯è¿‡æ»¤åŠŸèƒ½ï¼Œé€šè¿‡tagæˆ–è€…keyè¿›è¡ŒåŒºåˆ† æˆ‘ä»¬å¾€ä¸€ä¸ªä¸»é¢˜é‡Œé¢å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ ¹æ®ä¸šåŠ¡é€»è¾‘ï¼Œå¯èƒ½éœ€è¦åŒºåˆ†ï¼Œæ¯”å¦‚å¸¦æœ‰tagAæ ‡ç­¾çš„è¢«Aæ¶ˆè´¹ï¼Œå¸¦æœ‰tagBæ ‡ç­¾çš„è¢«Bæ¶ˆè´¹ï¼Œè¿˜æœ‰åœ¨äº‹åŠ¡ç›‘å¬çš„ç±»é‡Œé¢ï¼Œåªè¦æ˜¯äº‹åŠ¡æ¶ˆæ¯éƒ½è¦èµ°åŒä¸€ä¸ªç›‘å¬ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦é€šè¿‡è¿‡æ»¤æ‰åŒºåˆ«å¯¹å¾… æ ‡ç­¾æ¶ˆæ¯ç”Ÿäº§è€…12345678910111213141516171819202122232425262728//@Test public void testTagProducer() throws Exception &#123; // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€…* DefaultMQProducer producer = new DefaultMQProducer(//&quot;test-group//&quot;); // è®¾ç½®nameServeråœ°å€* producer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // å¯åŠ¨å®ä¾‹* producer.start(); Message msg = new Message(//&quot;TopicTest//&quot;,**//&quot;tagA//&quot;**, //&quot;æˆ‘æ˜¯ä¸€ä¸ªå¸¦æ ‡è®°çš„æ¶ˆæ¯//&quot;.getBytes()); SendResult send = producer.send(msg); System.*out*.println(send); // å…³é—­å®ä¾‹* producer.shutdown(); &#125; æ ‡ç­¾æ¶ˆæ¯æ¶ˆè´¹è€…12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849//@Test public void testTagConsumer() throws Exception &#123; // åˆ›å»ºé»˜è®¤æ¶ˆè´¹è€…ç»„* DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(//&quot;consumer-group//&quot;); // è®¾ç½®nameServeråœ°å€* consumer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ¥æ¶ˆè´¹ è¡¨è¾¾å¼ï¼Œé»˜è®¤æ˜¯//*,æ”¯æŒ//&quot;tagA//// tagB//// tagC//&quot; è¿™æ ·æˆ–è€…çš„å†™æ³• åªè¦æ˜¯ç¬¦åˆä»»ä½•ä¸€ä¸ªæ ‡ç­¾éƒ½å¯ä»¥æ¶ˆè´¹* consumer.subscribe(//&quot;TopicTest//&quot;,//&quot;tagA//// tagB//// tagC//&quot;); // æ³¨å†Œä¸€ä¸ªæ¶ˆè´¹ç›‘å¬ MessageListenerConcurrentlyæ˜¯å¹¶å‘æ¶ˆè´¹* // é»˜è®¤æ˜¯20ä¸ªçº¿ç¨‹ä¸€èµ·æ¶ˆè´¹ï¼Œå¯ä»¥å‚çœ‹ consumer.setConsumeThreadMax()* consumer.registerMessageListener(new MessageListenerConcurrently() &#123; //@Override public ConsumeConcurrentlyStatus consumeMessage(List//&lt;MessageExt//&gt; msgs, ConsumeConcurrentlyContext context) &#123; // è¿™é‡Œæ‰§è¡Œæ¶ˆè´¹çš„ä»£ç  é»˜è®¤æ˜¯å¤šçº¿ç¨‹æ¶ˆè´¹* System.*out*.println(Thread.*currentThread*().getName() + //&quot;//-//-//--//&quot; + new String(msgs.get(0).getBody())); System.*out*.println(msgs.get(0).getTags()); return ConsumeConcurrentlyStatus.*CONSUME_SUCCESS*; &#125; &#125;); consumer.start(); System.*in*.read(); &#125; ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ Topicï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç”¨ Tagï¼Ÿæ€»ç»“ï¼šä¸åŒçš„ä¸šåŠ¡åº”è¯¥ä½¿ç”¨ä¸åŒçš„Topicå¦‚æœæ˜¯ç›¸åŒçš„ä¸šåŠ¡é‡Œé¢æœ‰ä¸åŒè¡¨çš„è¡¨ç°å½¢å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨tagè¿›è¡ŒåŒºåˆ† å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œåˆ¤æ–­ï¼š 1.æ¶ˆæ¯ç±»å‹æ˜¯å¦ä¸€è‡´ï¼šå¦‚æ™®é€šæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ã€å®šæ—¶ï¼ˆå»¶æ—¶ï¼‰æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯ï¼Œä¸åŒçš„æ¶ˆæ¯ç±»å‹ä½¿ç”¨ä¸åŒçš„Topicï¼Œæ— æ³•é€šè¿‡ Tag è¿›è¡ŒåŒºåˆ†ã€‚ 2.ä¸šåŠ¡æ˜¯å¦ç›¸å…³è”ï¼šæ²¡æœ‰ç›´æ¥å…³è”çš„æ¶ˆæ¯ï¼Œå¦‚æ·˜å®äº¤æ˜“æ¶ˆæ¯ï¼Œäº¬ä¸œç‰©æµæ¶ˆæ¯ä½¿ç”¨ä¸åŒçš„Topicè¿›è¡ŒåŒºåˆ†ï¼›è€ŒåŒæ ·æ˜¯å¤©çŒ«äº¤æ˜“æ¶ˆæ¯ï¼Œç”µå™¨ç±»è®¢å•ã€å¥³è£…ç±»è®¢å•ã€åŒ–å¦†å“ç±»è®¢å•çš„æ¶ˆæ¯å¯ä»¥ç”¨Tag è¿›è¡ŒåŒºåˆ†ã€‚ 3.æ¶ˆæ¯ä¼˜å…ˆçº§æ˜¯å¦ä¸€è‡´ï¼šå¦‚åŒæ ·æ˜¯ç‰©æµæ¶ˆæ¯ï¼Œç›’é©¬å¿…é¡»å°æ—¶å†…é€è¾¾ï¼Œå¤©çŒ«è¶…å¸‚ 24å°æ—¶å†…é€è¾¾ï¼Œæ·˜å®ç‰©æµåˆ™ç›¸å¯¹ä¼šæ…¢ä¸€äº›ï¼Œä¸åŒä¼˜å…ˆçº§çš„æ¶ˆæ¯ç”¨ä¸åŒçš„ Topicè¿›è¡ŒåŒºåˆ†ã€‚ 4.æ¶ˆæ¯é‡çº§æ˜¯å¦ç›¸å½“ï¼šæœ‰äº›ä¸šåŠ¡æ¶ˆæ¯è™½ç„¶é‡å°ä½†æ˜¯å®æ—¶æ€§è¦æ±‚é«˜ï¼Œå¦‚æœè·ŸæŸäº›ä¸‡äº¿é‡çº§çš„æ¶ˆæ¯ä½¿ç”¨åŒä¸€ä¸ªTopicï¼Œåˆ™æœ‰å¯èƒ½ä¼šå› ä¸ºè¿‡é•¿çš„ç­‰å¾…æ—¶é—´è€Œâ€é¥¿æ­»â€ï¼Œæ­¤æ—¶éœ€è¦å°†ä¸åŒé‡çº§çš„æ¶ˆæ¯è¿›è¡Œæ‹†åˆ†ï¼Œä½¿ç”¨ä¸åŒçš„Topicã€‚ æ€»çš„æ¥è¯´ï¼Œé’ˆå¯¹æ¶ˆæ¯åˆ†ç±»ï¼Œæ‚¨å¯ä»¥é€‰æ‹©åˆ›å»ºå¤šä¸ª Topicï¼Œæˆ–è€…åœ¨åŒä¸€ä¸ª Topicä¸‹åˆ›å»ºå¤šä¸ª Tagã€‚ä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸åŒçš„ Topic ä¹‹é—´çš„æ¶ˆæ¯æ²¡æœ‰å¿…ç„¶çš„è”ç³»ï¼Œè€ŒTag åˆ™ç”¨æ¥åŒºåˆ†åŒä¸€ä¸ª Topicä¸‹ç›¸äº’å…³è”çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚å…¨é›†å’Œå­é›†çš„å…³ç³»ã€æµç¨‹å…ˆåçš„å…³ç³»ã€‚ RocketMQä¸­æ¶ˆæ¯çš„Keyåœ¨rocketmqä¸­çš„æ¶ˆæ¯ï¼Œé»˜è®¤ä¼šæœ‰ä¸€ä¸ªmessageIdå½“åšæ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™æ¶ˆæ¯æºå¸¦ä¸€ä¸ªkeyï¼Œç”¨ä½œå”¯ä¸€æ ‡è¯†æˆ–è€…ä¸šåŠ¡æ ‡è¯†ï¼ŒåŒ…æ‹¬åœ¨æ§åˆ¶é¢æ¿æŸ¥è¯¢çš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨messageIdæˆ–è€…keyæ¥è¿›è¡ŒæŸ¥è¯¢ å¸¦keyæ¶ˆæ¯ç”Ÿäº§è€…12345678910111213141516171819202122232425262728//@Test public void testKeyProducer() throws Exception &#123; // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€…* DefaultMQProducer producer = new DefaultMQProducer(//&quot;test-group//&quot;); // è®¾ç½®nameServeråœ°å€* producer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // å¯åŠ¨å®ä¾‹* producer.start(); Message msg = new Message(//&quot;TopicTest//&quot;,//&quot;tagA//&quot;,**//&quot;key//&quot;**, //&quot;æˆ‘æ˜¯ä¸€ä¸ªå¸¦æ ‡è®°å’Œkeyçš„æ¶ˆæ¯//&quot;.getBytes()); SendResult send = producer.send(msg); System.*out*.println(send); // å…³é—­å®ä¾‹* producer.shutdown(); &#125; å¸¦keyæ¶ˆæ¯æ¶ˆè´¹è€…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051//@Test public void testKeyConsumer() throws Exception &#123; // åˆ›å»ºé»˜è®¤æ¶ˆè´¹è€…ç»„* DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(//&quot;consumer-group//&quot;); // è®¾ç½®nameServeråœ°å€* consumer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ¥æ¶ˆè´¹ è¡¨è¾¾å¼ï¼Œé»˜è®¤æ˜¯//*,æ”¯æŒ//&quot;tagA//// tagB//// tagC//&quot; è¿™æ ·æˆ–è€…çš„å†™æ³• åªè¦æ˜¯ç¬¦åˆä»»ä½•ä¸€ä¸ªæ ‡ç­¾éƒ½å¯ä»¥æ¶ˆè´¹* consumer.subscribe(//&quot;TopicTest//&quot;,//&quot;tagA//// tagB//// tagC//&quot;); // æ³¨å†Œä¸€ä¸ªæ¶ˆè´¹ç›‘å¬ MessageListenerConcurrentlyæ˜¯å¹¶å‘æ¶ˆè´¹* // é»˜è®¤æ˜¯20ä¸ªçº¿ç¨‹ä¸€èµ·æ¶ˆè´¹ï¼Œå¯ä»¥å‚çœ‹ consumer.setConsumeThreadMax()* consumer.registerMessageListener(new MessageListenerConcurrently() &#123; //@Override public ConsumeConcurrentlyStatus consumeMessage(List//&lt;MessageExt//&gt; msgs, ConsumeConcurrentlyContext context) &#123; // è¿™é‡Œæ‰§è¡Œæ¶ˆè´¹çš„ä»£ç  é»˜è®¤æ˜¯å¤šçº¿ç¨‹æ¶ˆè´¹* System.*out*.println(Thread.*currentThread*().getName() + //&quot;//-//-//--//&quot; + new String(msgs.get(0).getBody())); System.*out*.println(msgs.get(0).getTags()); System.*out*.println(msgs.get(0).getKeys()); return ConsumeConcurrentlyStatus.*CONSUME_SUCCESS*; &#125; &#125;); consumer.start(); System.*in*.read(); &#125; RocketMQé‡è¯•æœºåˆ¶ç”Ÿäº§è€…é‡è¯•1234567// å¤±è´¥çš„æƒ…å†µé‡å‘3æ¬¡producer.setRetryTimesWhenSendFailed(3);// æ¶ˆæ¯åœ¨1Så†…æ²¡æœ‰å‘é€æˆåŠŸï¼Œå°±ä¼šé‡è¯•producer.send(msg, 1000); æ¶ˆè´¹è€…é‡è¯•åœ¨æ¶ˆè´¹è€…æ”¾returnConsumeConcurrentlyStatus.RECONSUME_LATER;åå°±ä¼šæ‰§è¡Œé‡è¯• ä¸Šå›¾ä»£ç ä¸­è¯´æ˜äº†ï¼Œæˆ‘ä»¬å†å®é™…ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬é‡è¯•3-5æ¬¡ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ¶ˆè´¹æˆåŠŸï¼Œåˆ™å¯ä»¥æŠŠæ¶ˆæ¯ç­¾æ”¶äº†ï¼Œé€šçŸ¥äººå·¥ç­‰å¤„ç† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384 *///*// *//* æµ‹è¯•æ¶ˆè´¹è€…* *// *//*//@throws Exception* *//*/* //@Test public void testConsumer() throws Exception &#123; // åˆ›å»ºé»˜è®¤æ¶ˆè´¹è€…ç»„* DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(//&quot;consumer-group//&quot;); // è®¾ç½®nameServeråœ°å€* consumer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ¥æ¶ˆè´¹//*è¡¨ç¤ºæ²¡æœ‰è¿‡æ»¤å‚æ•° è¡¨ç¤ºè¿™ä¸ªä¸»é¢˜çš„ä»»ä½•æ¶ˆæ¯* consumer.subscribe(//&quot;TopicTest//&quot;,//&quot;//*//&quot;); // æ³¨å†Œä¸€ä¸ªæ¶ˆè´¹ç›‘å¬* consumer.registerMessageListener(new MessageListenerConcurrently() &#123; //@Override public ConsumeConcurrentlyStatus consumeMessage(List//&lt;MessageExt//&gt; msgs, ConsumeConcurrentlyContext context) &#123; try &#123; // è¿™é‡Œæ‰§è¡Œæ¶ˆè´¹çš„ä»£ç * System.*out*.println(Thread.*currentThread*().getName() + //&quot;//-//-//--//&quot; + msgs); // è¿™é‡Œåˆ¶é€ ä¸€ä¸ªé”™è¯¯* int i = 10 / 0; &#125; catch (Exception e) &#123; // å‡ºç°é—®é¢˜ åˆ¤æ–­é‡è¯•çš„æ¬¡æ•°* MessageExt messageExt = msgs.get(0); // è·å–é‡è¯•çš„æ¬¡æ•° å¤±è´¥ä¸€æ¬¡æ¶ˆæ¯ä¸­çš„å¤±è´¥æ¬¡æ•°ä¼šç´¯åŠ ä¸€æ¬¡* int reconsumeTimes = messageExt.getReconsumeTimes(); if (reconsumeTimes//&gt;= 3) &#123; // åˆ™æŠŠæ¶ˆæ¯ç¡®è®¤äº†ï¼Œå¯ä»¥å°†è¿™æ¡æ¶ˆæ¯è®°å½•åˆ°æ—¥å¿—æˆ–è€…æ•°æ®åº“ é€šçŸ¥äººå·¥å¤„ç†* return ConsumeConcurrentlyStatus.*CONSUME_SUCCESS*; &#125; else &#123; return ConsumeConcurrentlyStatus.*RECONSUME_LATER*; &#125; &#125; return ConsumeConcurrentlyStatus.*CONSUME_SUCCESS*; &#125; &#125;); consumer.start(); System.*in*.read(); &#125; RocketMQæ­»ä¿¡æ¶ˆæ¯å½“æ¶ˆè´¹é‡è¯•åˆ°è¾¾é˜ˆå€¼ä»¥åï¼Œæ¶ˆæ¯ä¸ä¼šè¢«æŠ•é€’ç»™æ¶ˆè´¹è€…äº†ï¼Œè€Œæ˜¯è¿›å…¥äº†æ­»ä¿¡é˜Ÿåˆ— å½“ä¸€æ¡æ¶ˆæ¯åˆæ¬¡æ¶ˆè´¹å¤±è´¥ï¼ŒRocketMQä¼šè‡ªåŠ¨è¿›è¡Œæ¶ˆæ¯é‡è¯•ï¼Œè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œè‹¥æ¶ˆè´¹ä¾ç„¶å¤±è´¥ï¼Œåˆ™è¡¨æ˜æ¶ˆè´¹è€…åœ¨æ­£å¸¸æƒ…å†µä¸‹æ— æ³•æ­£ç¡®åœ°æ¶ˆè´¹è¯¥æ¶ˆæ¯ã€‚æ­¤æ—¶ï¼Œè¯¥æ¶ˆæ¯ä¸ä¼šç«‹åˆ»è¢«ä¸¢å¼ƒï¼Œè€Œæ˜¯å°†å…¶å‘é€åˆ°è¯¥æ¶ˆè´¹è€…å¯¹åº”çš„ç‰¹æ®Šé˜Ÿåˆ—ä¸­ï¼Œè¿™ç±»æ¶ˆæ¯ç§°ä¸ºæ­»ä¿¡æ¶ˆæ¯ï¼ˆDead-LetterMessageï¼‰ï¼Œå­˜å‚¨æ­»ä¿¡æ¶ˆæ¯çš„ç‰¹æ®Šé˜Ÿåˆ—ç§°ä¸ºæ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead-LetterQueueï¼‰ï¼Œæ­»ä¿¡é˜Ÿåˆ—æ˜¯æ­»ä¿¡Topicä¸‹åˆ†åŒºæ•°å”¯ä¸€çš„å•ç‹¬é˜Ÿåˆ—ã€‚å¦‚æœäº§ç”Ÿäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œé‚£å¯¹åº”çš„ConsumerGroupçš„æ­»ä¿¡Topicåç§°ä¸º%DLQ%ConsumerGroupNameï¼Œæ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆæ¯å°†ä¸ä¼šå†è¢«æ¶ˆè´¹ã€‚å¯ä»¥åˆ©ç”¨RocketMQAdminå·¥å…·æˆ–è€…RocketMQDashboardä¸ŠæŸ¥è¯¢åˆ°å¯¹åº”æ­»ä¿¡æ¶ˆæ¯çš„ä¿¡æ¯ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å»ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—ï¼Œç„¶åè¿›è¡Œè‡ªå·±çš„ä¸šåŠ¡ä¸Šçš„é€»è¾‘ æ¶ˆæ¯ç”Ÿäº§è€…123456789101112131415161718//@Test public void testDeadMsgProducer() throws Exception &#123; DefaultMQProducer producer = new DefaultMQProducer(//&quot;dead-group//&quot;); producer.setNamesrvAddr(//&quot;localhost:9876//&quot;); producer.start(); Message message = new Message(//&quot;dead-topic//&quot;, //&quot;æˆ‘æ˜¯ä¸€ä¸ªæ­»ä¿¡æ¶ˆæ¯//&quot;.getBytes()); producer.send(message); producer.shutdown(); &#125; â€‹ æ¶ˆæ¯æ¶ˆè´¹è€…12345678910111213141516171819202122232425262728293031323334353637//@Test public void testDeadMsgConsumer() throws Exception &#123; DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(//&quot;dead-group//&quot;); consumer.setNamesrvAddr(//&quot;localhost:9876//&quot;); consumer.subscribe(//&quot;dead-topic//&quot;,//&quot;//*//&quot;); // è®¾ç½®æœ€å¤§æ¶ˆè´¹é‡è¯•æ¬¡æ•° 2 æ¬¡* consumer.setMaxReconsumeTimes(2); consumer.registerMessageListener(new MessageListenerConcurrently() &#123; //@Override public ConsumeConcurrentlyStatus consumeMessage(List//&lt;MessageExt//&gt; msgs, ConsumeConcurrentlyContext context) &#123; System.*out*.println(msgs); // æµ‹è¯•æ¶ˆè´¹å¤±è´¥* return ConsumeConcurrentlyStatus.*RECONSUME_LATER*; &#125; &#125;); consumer.start(); System.*in*.read(); &#125; æ­»ä¿¡æ¶ˆè´¹è€…æ³¨æ„æƒé™é—®é¢˜ 123456789101112131415161718192021222324252627282930313233343536373839//@Test public void testDeadMq() throws Exception&#123; DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(//&quot;dead-group//&quot;); consumer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // æ¶ˆè´¹é‡è¯•åˆ°è¾¾é˜ˆå€¼ä»¥åï¼Œæ¶ˆæ¯ä¸ä¼šè¢«æŠ•é€’ç»™æ¶ˆè´¹è€…äº†ï¼Œè€Œæ˜¯è¿›å…¥äº†æ­»ä¿¡é˜Ÿåˆ—* // é˜Ÿåˆ—åç§° é»˜è®¤æ˜¯ %DLQ% + æ¶ˆè´¹è€…ç»„å* consumer.subscribe(//&quot;%DLQ%dead-group//&quot;,//&quot;//*//&quot;); consumer.registerMessageListener(new MessageListenerConcurrently() &#123; //@Override public ConsumeConcurrentlyStatus consumeMessage(List//&lt;MessageExt//&gt; msgs, ConsumeConcurrentlyContext context) &#123; System.*out*.println(msgs); // å¤„ç†æ¶ˆæ¯ ç­¾æ”¶äº†* return ConsumeConcurrentlyStatus.*CONSUME_SUCCESS*; &#125; &#125;); consumer.start(); System.*in*.read(); &#125; æ§åˆ¶å°æ˜¾ç¤º RocketMQæ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜ä¸ºä»€ä¹ˆä¼šå‡ºç°é‡å¤æ¶ˆè´¹é—®é¢˜å‘¢ï¼ŸBROADCASTING(å¹¿æ’­)æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰æ³¨å†Œçš„æ¶ˆè´¹è€…éƒ½ä¼šæ¶ˆè´¹ï¼Œè€Œè¿™äº›æ¶ˆè´¹è€…é€šå¸¸æ˜¯é›†ç¾¤éƒ¨ç½²çš„ä¸€ä¸ªä¸ªå¾®æœåŠ¡ï¼Œè¿™æ ·å°±ä¼šå¤šå°æœºå™¨é‡å¤æ¶ˆè´¹ï¼Œå½“ç„¶è¿™ä¸ªæ˜¯æ ¹æ®éœ€è¦æ¥é€‰æ‹©ã€‚ CLUSTERINGï¼ˆè´Ÿè½½å‡è¡¡ï¼‰æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸€ä¸ªtopicè¢«å¤šä¸ªconsumerGroupæ¶ˆè´¹ï¼Œä¹Ÿä¼šé‡å¤æ¶ˆè´¹ã€‚ å³ä½¿æ˜¯åœ¨CLUSTERINGæ¨¡å¼ä¸‹ï¼ŒåŒä¸€ä¸ªconsumerGroupä¸‹ï¼Œä¸€ä¸ªé˜Ÿåˆ—åªä¼šåˆ†é…ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œçœ‹èµ·æ¥å¥½åƒæ˜¯ä¸ä¼šé‡å¤æ¶ˆè´¹ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸ªç‰¹æ®Šæƒ…å†µï¼šä¸€ä¸ªæ¶ˆè´¹è€…æ–°ä¸Šçº¿åï¼ŒåŒç»„çš„æ‰€æœ‰æ¶ˆè´¹è€…è¦é‡æ–°è´Ÿè½½å‡è¡¡ï¼ˆåä¹‹ä¸€ä¸ªæ¶ˆè´¹è€…æ‰çº¿åï¼Œä¹Ÿä¸€æ ·ï¼‰ã€‚ä¸€ä¸ªé˜Ÿåˆ—æ‰€å¯¹åº”çš„æ–°çš„æ¶ˆè´¹è€…è¦è·å–ä¹‹å‰æ¶ˆè´¹çš„offsetï¼ˆåç§»é‡ï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯æ¶ˆè´¹çš„ç‚¹ä½ï¼‰ï¼Œæ­¤æ—¶ä¹‹å‰çš„æ¶ˆè´¹è€…å¯èƒ½å·²ç»æ¶ˆè´¹äº†ä¸€æ¡æ¶ˆæ¯ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æŠŠoffsetæäº¤ç»™brokerï¼Œé‚£ä¹ˆæ–°çš„æ¶ˆè´¹è€…å¯èƒ½ä¼šé‡æ–°æ¶ˆè´¹ä¸€æ¬¡ã€‚è™½ç„¶orderlyæ¨¡å¼æ˜¯å‰ä¸€ä¸ªæ¶ˆè´¹è€…å…ˆè§£é”ï¼Œåä¸€ä¸ªæ¶ˆè´¹è€…åŠ é”å†æ¶ˆè´¹çš„æ¨¡å¼ï¼Œæ¯”èµ·concurrentlyè¦ä¸¥æ ¼äº†ï¼Œä½†æ˜¯åŠ é”çš„çº¿ç¨‹å’Œæäº¤offsetçš„çº¿ç¨‹ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šå‡ºç°æç«¯æƒ…å†µä¸‹çš„é‡å¤æ¶ˆè´¹ã€‚ è¿˜æœ‰åœ¨å‘é€æ‰¹é‡æ¶ˆæ¯çš„æ—¶å€™ï¼Œä¼šè¢«å½“åšä¸€æ¡æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå¦‚æœæ‰¹é‡æ¶ˆæ¯ä¸­æœ‰ä¸€æ¡ä¸šåŠ¡å¤„ç†æˆåŠŸï¼Œå…¶ä»–å¤±è´¥äº†ï¼Œè¿˜æ˜¯ä¼šè¢«é‡æ–°æ¶ˆè´¹ä¸€æ¬¡ã€‚ é‚£ä¹ˆå¦‚æœåœ¨CLUSTERINGï¼ˆè´Ÿè½½å‡è¡¡ï¼‰æ¨¡å¼ä¸‹ï¼Œå¹¶ä¸”åœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œä¸å¸Œæœ›ä¸€æ¡æ¶ˆæ¯è¢«é‡å¤æ¶ˆè´¹ï¼Œæ”¹æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æƒ³åˆ°å»é‡æ“ä½œï¼Œæ‰¾åˆ°æ¶ˆæ¯å”¯ä¸€çš„æ ‡è¯†ï¼Œå¯ä»¥æ˜¯msgIdä¹Ÿå¯ä»¥æ˜¯ä½ è‡ªå®šä¹‰çš„å”¯ä¸€çš„keyï¼Œè¿™æ ·å°±å¯ä»¥å»é‡äº† è§£å†³æ–¹æ¡ˆä½¿ç”¨å»é‡æ–¹æ¡ˆè§£å†³ï¼Œä¾‹å¦‚å°†æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†å­˜èµ·æ¥ï¼Œç„¶åæ¯æ¬¡æ¶ˆè´¹ä¹‹å‰å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¸æ¶ˆè´¹ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ¶ˆè´¹ï¼Œå¹¶ä¸”æ¶ˆè´¹ä»¥åå°†è¿™ä¸ªæ ‡è®°ä¿å­˜ã€‚ æƒ³æ³•å¾ˆå¥½ï¼Œä½†æ˜¯æ¶ˆæ¯çš„ä½“é‡æ˜¯éå¸¸å¤§çš„ï¼Œå¯èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¼šåˆ°è¾¾ä¸Šåƒä¸‡ç”šè‡³ä¸Šäº¿æ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•é€‰æ‹©ä¸€ä¸ªå®¹å™¨æ¥ä¿å­˜æ‰€æœ‰æ¶ˆæ¯çš„æ ‡è¯†ï¼Œå¹¶ä¸”åˆå¯ä»¥å¿«é€Ÿçš„åˆ¤æ–­æ˜¯å¦å­˜åœ¨å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥é€‰æ‹©å¸ƒéš†è¿‡æ»¤å™¨(BloomFilter) å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloomFilterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½æ¯”ä¸€èˆ¬çš„ç®—æ³•è¦å¥½çš„å¤šï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚ åœ¨hutoolçš„å·¥å…·ä¸­æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå½“ç„¶ä½ è‡ªå·±ä½¿ç”¨redisçš„bitmapç±»å‹æ‰‹å†™ä¸€ä¸ªä¹Ÿæ˜¯å¯ä»¥çš„https://hutool.cn/docs/#/bloomFilter/%E6%A6%82%E8%BF%B0 æµ‹è¯•ç”Ÿäº§è€…12345678910111213141516171819202122232425262728293031323334//@Test public void testRepeatProducer() throws Exception &#123; // åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€…* DefaultMQProducer producer = new DefaultMQProducer(//&quot;test-group//&quot;); // è®¾ç½®nameServeråœ°å€* producer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // å¯åŠ¨å®ä¾‹* producer.start(); // æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰keyå½“åšå”¯ä¸€æ ‡è¯†* String keyId = UUID.*randomUUID*().toString(); System.*out*.println(keyId); Message msg = new Message(//&quot;TopicTest//&quot;,//&quot;tagA//&quot;, keyId, //&quot;æˆ‘æ˜¯ä¸€ä¸ªæµ‹è¯•æ¶ˆæ¯//&quot;.getBytes()); SendResult send = producer.send(msg); System.*out*.println(send); // å…³é—­å®ä¾‹* producer.shutdown(); &#125; æ·»åŠ hutoolçš„ä¾èµ–123456789//&lt;dependency//&gt; //&lt;groupId//&gt;cn.hutool//&lt;/groupId//&gt; //&lt;artifactId//&gt;hutool-all//&lt;/artifactId//&gt; //&lt;version//&gt;5.7.11//&lt;/version//&gt; //&lt;/dependency//&gt; â€‹ æµ‹è¯•æ¶ˆè´¹è€…1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374 *///*// *//* åœ¨booté¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨@Beanåœ¨æ•´ä¸ªå®¹å™¨ä¸­æ”¾ç½®ä¸€ä¸ªå•åˆ©å¯¹è±¡* *//*/* public static BitMapBloomFilter *bloomFilter* = new BitMapBloomFilter(100); //@Test public void testRepeatConsumer() throws Exception &#123; // åˆ›å»ºé»˜è®¤æ¶ˆè´¹è€…ç»„* DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(//&quot;consumer-group//&quot;); consumer.setMessageModel(MessageModel.*BROADCASTING*); // è®¾ç½®nameServeråœ°å€* consumer.setNamesrvAddr(//&quot;localhost:9876//&quot;); // è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ¥æ¶ˆè´¹ è¡¨è¾¾å¼ï¼Œé»˜è®¤æ˜¯// consumer.subscribe(//&quot;TopicTest//&quot;,//&quot;//*//&quot;); // æ³¨å†Œä¸€ä¸ªæ¶ˆè´¹ç›‘å¬ MessageListenerConcurrentlyæ˜¯å¹¶å‘æ¶ˆè´¹* // é»˜è®¤æ˜¯20ä¸ªçº¿ç¨‹ä¸€èµ·æ¶ˆè´¹ï¼Œå¯ä»¥å‚çœ‹ consumer.setConsumeThreadMax()* consumer.registerMessageListener(new MessageListenerConcurrently() &#123; //@Override public ConsumeConcurrentlyStatus consumeMessage(List//&lt;MessageExt//&gt; msgs, ConsumeConcurrentlyContext context) &#123; // æ‹¿åˆ°æ¶ˆæ¯çš„key* MessageExt messageExt = msgs.get(0); String keys = messageExt.getKeys(); // åˆ¤æ–­æ˜¯å¦å­˜åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­* if (*bloomFilter*.contains(keys)) &#123; // ç›´æ¥è¿”å›äº† ä¸å¾€ä¸‹å¤„ç†ä¸šåŠ¡* return ConsumeConcurrentlyStatus.*CONSUME_SUCCESS*; &#125; // è¿™ä¸ªå¤„ç†ä¸šåŠ¡ï¼Œç„¶åæ”¾å…¥è¿‡æ»¤å™¨ä¸­* // do sth//...* *bloomFilter*.add(keys); return ConsumeConcurrentlyStatus.*CONSUME_SUCCESS*; &#125; &#125;); consumer.start(); System.*in*.read(); &#125;","categories":[{"name":"mq","slug":"mq","permalink":"http://example.com/mq/"}],"tags":[{"name":"mq","slug":"mq","permalink":"http://example.com/tags/mq/"}]},{"title":"RocketMqï¼ˆä¸‰ï¼‰--å¿«é€Ÿå…¥é—¨","slug":"mq/RocketMq/RocketMqï¼ˆä¸‰ï¼‰-å¿«é€Ÿå…¥é—¨","date":"2023-06-19T02:09:19.000Z","updated":"2023-06-19T02:15:15.542Z","comments":true,"path":"2023/06/19/mq/RocketMq/RocketMqï¼ˆä¸‰ï¼‰-å¿«é€Ÿå…¥é—¨/","link":"","permalink":"http://example.com/2023/06/19/mq/RocketMq/RocketMq%EF%BC%88%E4%B8%89%EF%BC%89-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/","excerpt":"","text":"RocketMQå¿«é€Ÿå…¥é—¨RocketMQæä¾›äº†å‘é€å¤šç§å‘é€æ¶ˆæ¯çš„æ¨¡å¼ï¼Œä¾‹å¦‚åŒæ­¥æ¶ˆæ¯ï¼Œå¼‚æ­¥æ¶ˆæ¯ï¼Œé¡ºåºæ¶ˆæ¯ï¼Œå»¶è¿Ÿæ¶ˆæ¯ï¼Œäº‹åŠ¡æ¶ˆæ¯ç­‰ï¼Œæˆ‘ä»¬ä¸€ä¸€å­¦ä¹  æ¶ˆæ¯å‘é€å’Œç›‘å¬çš„æµç¨‹æˆ‘ä»¬å…ˆææ¸…æ¥šæ¶ˆæ¯å‘é€å’Œç›‘å¬çš„æµç¨‹ï¼Œç„¶åæˆ‘ä»¬åœ¨å¼€å§‹æ•²ä»£ç  æ¶ˆæ¯ç”Ÿäº§è€…12345678910111.åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§è€…producerï¼Œå¹¶åˆ¶å®šç”Ÿäº§è€…ç»„å 2.æŒ‡å®šNameserveråœ°å€ 3.å¯åŠ¨producer 4.åˆ›å»ºæ¶ˆæ¯å¯¹è±¡ï¼ŒæŒ‡å®šä¸»é¢˜Topicã€Tagå’Œæ¶ˆæ¯ä½“ç­‰ 5.å‘é€æ¶ˆæ¯ 6.å…³é—­ç”Ÿäº§è€…producer æ¶ˆæ¯æ¶ˆè´¹è€…123456789101.åˆ›å»ºæ¶ˆè´¹è€…consumerï¼Œåˆ¶å®šæ¶ˆè´¹è€…ç»„å 2.æŒ‡å®šNameserveråœ°å€ 3.åˆ›å»ºç›‘å¬è®¢é˜…ä¸»é¢˜Topicå’ŒTagç­‰ 4.å¤„ç†æ¶ˆæ¯ 5.å¯åŠ¨æ¶ˆè´¹è€…consumer æ­å»ºRocketmq-demoåŠ å…¥ä¾èµ–12345678910111213141516171819202122232425262728293031323334353637&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt; &lt;artifactId&gt;rocketmq-client&lt;/artifactId&gt; &lt;version&gt;4.9.2&lt;/version&gt; &lt;!--dockerçš„ç”¨ä¸‹é¢è¿™ä¸ªç‰ˆæœ¬--&gt; &lt;version&gt;4.4.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.22&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; ç¼–å†™ç”Ÿäº§è€…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748 */*** ** æµ‹è¯•ç”Ÿäº§è€…* *** **@throws Exception* **/* @Test public void testProducer() throws Exception &#123; *// åˆ›å»ºé»˜è®¤çš„ç”Ÿäº§è€…* DefaultMQProducer producer = new DefaultMQProducer(&quot;test-group&quot;); *// è®¾ç½®nameServeråœ°å€* producer.setNamesrvAddr(&quot;localhost:9876&quot;); *// å¯åŠ¨å®ä¾‹* producer.start(); for (int i = 0; i&lt; 10; i++) &#123; *// åˆ›å»ºæ¶ˆæ¯* *// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šä¸»é¢˜çš„åå­—* *// ç¬¬äºŒä¸ªå‚æ•°ï¼šæ¶ˆæ¯å†…å®¹* Message msg = new Message(&quot;TopicTest&quot;, (&quot;Hello RocketMQ&quot; + i).getBytes()); SendResult send = producer.send(msg); System.*out*.println(send); &#125; *// å…³é—­å®ä¾‹* producer.shutdown(); &#125; â€‹ ç¼–å†™æ¶ˆè´¹è€…12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667 */*** ** æµ‹è¯•æ¶ˆè´¹è€…* *** **@throws Exception* **/* @Test public void testConsumer() throws Exception &#123; *// åˆ›å»ºé»˜è®¤æ¶ˆè´¹è€…ç»„* DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(&quot;consumer-group&quot;); *// è®¾ç½®nameServeråœ°å€* consumer.setNamesrvAddr(&quot;localhost:9876&quot;); *// è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ¥æ¶ˆè´¹*è¡¨ç¤ºæ²¡æœ‰è¿‡æ»¤å‚æ•° è¡¨ç¤ºè¿™ä¸ªä¸»é¢˜çš„ä»»ä½•æ¶ˆæ¯* consumer.subscribe(&quot;TopicTest&quot;,&quot;*&quot;); *// æ³¨å†Œä¸€ä¸ªæ¶ˆè´¹ç›‘å¬ MessageListenerConcurrently æ˜¯å¤šçº¿ç¨‹æ¶ˆè´¹ï¼Œé»˜è®¤20ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥å‚çœ‹consumer.setConsumeThreadMax()* consumer.registerMessageListener(new MessageListenerConcurrently() &#123; @Override public ConsumeConcurrentlyStatus consumeMessage(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context) &#123; System.*out*.println(Thread.*currentThread*().getName() + &quot;----&quot; + msgs); *// è¿”å›æ¶ˆè´¹çš„çŠ¶æ€ å¦‚æœæ˜¯CONSUME_SUCCESS åˆ™æˆåŠŸï¼Œè‹¥ä¸ºRECONSUME_LATERåˆ™è¯¥æ¡æ¶ˆæ¯ä¼šè¢«é‡å›é˜Ÿåˆ—ï¼Œé‡æ–°è¢«æŠ•é€’* *// é‡è¯•çš„æ—¶é—´ä¸ºmessageDelayLevel =&quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h* *// ä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡1s ç¬¬äºŒæ¬¡5s ç¬¬ä¸‰æ¬¡10s.... å¦‚æœé‡è¯•äº†18æ¬¡ é‚£ä¹ˆè¿™ä¸ªæ¶ˆæ¯å°±ä¼šè¢«ç»ˆæ­¢å‘é€ç»™æ¶ˆè´¹è€…* *// return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;* return ConsumeConcurrentlyStatus.*RECONSUME_LATER*; &#125; &#125;); *// è¿™ä¸ªstartä¸€å®šè¦å†™åœ¨registerMessageListenerä¸‹é¢* consumer.start(); System.*in*.read(); &#125; æµ‹è¯•å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…è¿›è¡Œæµ‹è¯•","categories":[{"name":"mq","slug":"mq","permalink":"http://example.com/mq/"}],"tags":[{"name":"mq","slug":"mq","permalink":"http://example.com/tags/mq/"}]},{"title":"RocketMqï¼ˆäºŒï¼‰--å®‰è£…","slug":"mq/RocketMq/RocketMqï¼ˆäºŒï¼‰-å®‰è£…","date":"2023-06-19T01:57:39.000Z","updated":"2023-06-19T02:07:08.144Z","comments":true,"path":"2023/06/19/mq/RocketMq/RocketMqï¼ˆäºŒï¼‰-å®‰è£…/","link":"","permalink":"http://example.com/2023/06/19/mq/RocketMq/RocketMq%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%AE%89%E8%A3%85/","excerpt":"","text":"RocketMQå®‰è£…äº†è§£äº†mqçš„åŸºæœ¬æ¦‚å¿µå’Œè§’è‰²ä»¥åï¼Œæˆ‘ä»¬å¼€å§‹å®‰è£…rocketmqï¼Œå»ºè®®åœ¨linuxä¸Š ä¸‹è½½RocketMQä¸‹è½½åœ°å€ï¼š[https://rocketmq.apache.org/dowloading/releases/]{.underline} æ³¨æ„é€‰æ‹©ç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©4.9.2çš„ç‰ˆæœ¬ï¼Œåé¢ä½¿ç”¨alibabaæ—¶å¯¹åº” ä¸‹è½½åœ°å€ï¼š https://archive.apache.org/dist/rocketmq/4.9.2/rocketmq-all-4.9.2-bin-release.zip ä¸Šä¼ æœåŠ¡å™¨åœ¨rootç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹ mkdir rocketmq å°†ä¸‹è½½åçš„å‹ç¼©åŒ…ä¸Šä¼ åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨æˆ–è€…è™šæ‹Ÿæœºä¸­å» è§£å‹ unzip rocketmq-all-4.9.2-bin-release.zip å¦‚æœä½ çš„æœåŠ¡å™¨æ²¡æœ‰unzipå‘½ä»¤ï¼Œåˆ™ä¸‹è½½å®‰è£…ä¸€ä¸ª yum install unzip ç›®å½•åˆ†æ Benchmarkï¼šåŒ…å«ä¸€äº›æ€§èƒ½æµ‹è¯•çš„è„šæœ¬ï¼› Binï¼šå¯æ‰§è¡Œæ–‡ä»¶ç›®å½•ï¼› Confï¼šé…ç½®æ–‡ä»¶ç›®å½•ï¼› Libï¼šç¬¬ä¸‰æ–¹ä¾èµ–ï¼› LICENSEï¼šæˆæƒä¿¡æ¯; NOTICEï¼šç‰ˆæœ¬å…¬å‘Šï¼› é…ç½®ç¯å¢ƒå˜é‡ vim &#x2F;etc&#x2F;profile åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ  export NAMESRV_ADDR&#x3D;é˜¿é‡Œäº‘å…¬ç½‘IP:9876 ä¿®æ”¹nameServerçš„è¿è¡Œè„šæœ¬è¿›å…¥binç›®å½•ä¸‹ï¼Œä¿®æ”¹runserver.shæ–‡ä»¶,å°†71è¡Œå’Œ76è¡Œçš„Xmså’ŒXmxç­‰æ”¹å°ä¸€ç‚¹ vim runserver.sh ä¿å­˜é€€å‡º ä¿®æ”¹brokerçš„è¿è¡Œè„šæœ¬è¿›å…¥binç›®å½•ä¸‹ï¼Œä¿®æ”¹runbroker.shæ–‡ä»¶,ä¿®æ”¹67è¡Œ ä¿å­˜é€€å‡º ä¿®æ”¹brokerçš„é…ç½®æ–‡ä»¶è¿›å…¥confç›®å½•ä¸‹ï¼Œä¿®æ”¹broker.confæ–‡ä»¶ 12345678910111213141516171819brokerClusterName = DefaultCluster brokerName = broker-a brokerId = 0 deleteWhen = 04 fileReservedTime = 48 brokerRole = ASYNC_MASTER flushDiskType = ASYNC_FLUSH [namesrvAddr=localhost:9876] [autoCreateTopicEnable=true] [brokerIP1=é˜¿é‡Œäº‘å…¬ç½‘IP] [æ·»åŠ å‚æ•°è§£é‡Š] [namesrvAddrï¼šnameSrvåœ°å€å¯ä»¥å†™localhostå› ä¸ºnameSrvå’Œbrokeråœ¨ä¸€ä¸ªæœåŠ¡å™¨] [autoCreateTopicEnableï¼šè‡ªåŠ¨åˆ›å»ºä¸»é¢˜ï¼Œä¸ç„¶éœ€è¦æ‰‹åŠ¨åˆ›å»ºå‡ºæ¥] [brokerIP1ï¼šbrokerä¹Ÿéœ€è¦ä¸€ä¸ªå…¬ç½‘ipï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆæ˜¯é˜¿é‡Œäº‘çš„å†…ç½‘åœ°å€ï¼Œæˆ‘ä»¬å†æœ¬åœ°æ— æ³•è¿æ¥ä½¿ç”¨] å¯åŠ¨é¦–å…ˆåœ¨å®‰è£…ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªlogsæ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾æ—¥å¿— mkdir logs ä¸€æ¬¡è¿è¡Œä¸¤æ¡å‘½ä»¤ å¯åŠ¨nameSrv nohup sh bin&#x2F;mqnamesrv &gt; .&#x2F;logs&#x2F;namesrv.log &amp; å¯åŠ¨broker è¿™é‡Œçš„-cæ˜¯æŒ‡å®šä½¿ç”¨çš„é…ç½®æ–‡ä»¶ nohup sh bin&#x2F;mqbroker -c conf&#x2F;broker.conf &gt; .&#x2F;logs&#x2F;broker.log &amp; æŸ¥çœ‹å¯åŠ¨ç»“æœ RocketMQæ§åˆ¶å°çš„å®‰è£…RocketMQ-ConsoleRocketmq æ§åˆ¶å°å¯ä»¥å¯è§†åŒ–MQçš„æ¶ˆæ¯å‘é€ï¼ æ—§ç‰ˆæœ¬æºç æ˜¯åœ¨rocketmq-externalé‡Œçš„rocketmq-consoleï¼Œæ–°ç‰ˆæœ¬å·²ç»å•ç‹¬æ‹†åˆ†æˆdashboard ç½‘å€ï¼š[https://github.com/apache/rocketmq-dashboard]{.underline} ä¸‹è½½åœ°å€ï¼š https://github.com/apache/rocketmq-dashboard/archive/refs/tags/rocketmq-dashboard-1.0.0.zip ä¸‹è½½åè§£å‹å‡ºæ¥ï¼Œåœ¨è·Ÿç›®å½•ä¸‹æ‰§è¡Œ mvn clean package -Dmaven.test.skip&#x3D;true å°†jaråŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šå» ç„¶åè¿è¡Œ nohup java -jar .&#x2F;rocketmq-dashboard-1.0.0.jar rocketmq.config.namesrvAddr&#x3D;127.0.0.1:9876 &gt; .&#x2F;rocketmq-4.9.3&#x2F;logs&#x2F;dashboard.log &amp; å‘½ä»¤æ‹“å±•:--server.portæŒ‡å®šè¿è¡Œçš„ç«¯å£ --rocketmq.config.namesrvAddr&#x3D;127.0.0.1:9876 æŒ‡å®šnamesrvåœ°å€ è®¿é—®ï¼š http://localhost:8001 è¿è¡Œè®¿é—®ç«¯å£æ˜¯8001ï¼Œå¦‚æœä»å®˜ç½‘æ‹‰ä¸‹æ¥æ‰“åŒ…çš„è¯ï¼Œé»˜è®¤ç«¯å£æ˜¯8080 RocketMQå®‰è£…ä¹‹dockerä¸‹è½½RockerMQéœ€è¦çš„é•œåƒ+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“+ docker pull rocketmqinc&#x2F;rocketmq docker pull styletang&#x2F;rocketmq-console-ng+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“+ å¯åŠ¨NameServeræœåŠ¡åˆ›å»ºNameServeræ•°æ®å­˜å‚¨è·¯å¾„ mkdir -p &#x2F;home&#x2F;rocketmq&#x2F;data&#x2F;namesrv&#x2F;logs &#x2F;home&#x2F;rocketmq&#x2F;data&#x2F;namesrv&#x2F;store å¯åŠ¨NameServerå®¹å™¨ docker run -d --name rmqnamesrv -p 9876:9876 -v &#x2F;home&#x2F;rocketmq&#x2F;data&#x2F;namesrv&#x2F;logs:&#x2F;root&#x2F;logs -v &#x2F;home&#x2F;rocketmq&#x2F;data&#x2F;namesrv&#x2F;store:&#x2F;root&#x2F;store -e &quot;MAX_POSSIBLE_HEAP&#x3D;100000000&quot; rocketmqinc&#x2F;rocketmq sh mqnamesrv å¯åŠ¨BrokeræœåŠ¡åˆ›å»ºBrokeræ•°æ®å­˜å‚¨è·¯å¾„ mkdir -p &#x2F;home&#x2F;rocketmq&#x2F;data&#x2F;broker&#x2F;logs &#x2F;home&#x2F;rocketmq&#x2F;data&#x2F;broker&#x2F;store åˆ›å»ºconfé…ç½®æ–‡ä»¶ç›®å½• mkdir &#x2F;home&#x2F;rocketmq&#x2F;conf åœ¨é…ç½®æ–‡ä»¶ç›®å½•ä¸‹åˆ›å»ºbroker.confé…ç½®æ–‡ä»¶123456789101112131415161718192021222324252627282930313233+-----------------------------------------------------------------------+ # æ‰€å±é›†ç¾¤åç§°ï¼Œå¦‚æœèŠ‚ç‚¹è¾ƒå¤šå¯ä»¥é…ç½®å¤šä¸ª* brokerClusterName = DefaultCluster #brokeråç§°ï¼Œmasterå’Œslaveä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œè¡¨æ˜ä»–ä»¬çš„ä¸»ä»å…³ç³»* brokerName = broker-a #0è¡¨ç¤ºMasterï¼Œå¤§äº0è¡¨ç¤ºä¸åŒçš„slave* brokerId = 0 #è¡¨ç¤ºå‡ ç‚¹åšæ¶ˆæ¯åˆ é™¤åŠ¨ä½œï¼Œé»˜è®¤æ˜¯å‡Œæ™¨4ç‚¹* deleteWhen = 04 #åœ¨ç£ç›˜ä¸Šä¿ç•™æ¶ˆæ¯çš„æ—¶é•¿ï¼Œå•ä½æ˜¯å°æ—¶* fileReservedTime = 48 #æœ‰ä¸‰ä¸ªå€¼ï¼šSYNC_MASTERï¼Œ ASYNC_MASTERï¼ŒSLAVEï¼›åŒæ­¥å’Œå¼‚æ­¥è¡¨ç¤ºMasterå’ŒSlaveä¹‹é—´åŒæ­¥æ•°æ®çš„æœºåˆ¶ï¼›* brokerRole = ASYNC_MASTER #åˆ·ç›˜ç­–ç•¥ï¼Œå–å€¼ä¸ºï¼šASYNC_FLUSHï¼ŒSYNC_FLUSHè¡¨ç¤ºåŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ï¼›SYNC_FLUSHæ¶ˆæ¯å†™å…¥ç£ç›˜åæ‰è¿”å›æˆåŠŸçŠ¶æ€ï¼ŒASYNC_FLUSHä¸éœ€è¦ï¼›* flushDiskType = ASYNC_FLUSH # è®¾ç½®brokerèŠ‚ç‚¹æ‰€åœ¨æœåŠ¡å™¨çš„ipåœ°å€* brokerIP1 = ä½ æœåŠ¡å™¨å¤–ç½‘ip å¯åŠ¨Brokerå®¹å™¨ docker run -d --name rmqbroker --link rmqnamesrv:namesrv -p 10911:10911 -p 10909:10909 -v &#x2F;home&#x2F;rocketmq&#x2F;data&#x2F;broker&#x2F;logs:&#x2F;root&#x2F;logs -v &#x2F;home&#x2F;rocketmq&#x2F;data&#x2F;broker&#x2F;store:&#x2F;root&#x2F;store -v &#x2F;home&#x2F;rocketmq&#x2F;conf&#x2F;broker.conf:&#x2F;opt&#x2F;rocketmq-4.4.0&#x2F;conf&#x2F;broker.conf --privileged&#x3D;true -e &quot;NAMESRV_ADDR&#x3D;namesrv:9876&quot; -e &quot;MAX_POSSIBLE_HEAP&#x3D;200000000&quot; rocketmqinc&#x2F;rocketmq sh mqbroker -c &#x2F;opt&#x2F;rocketmq-4.4.0&#x2F;conf&#x2F;broker.conf å¯åŠ¨æ§åˆ¶å°1234567docker run -d \\--name rmqadmin -e \\&quot;JAVA_OPTS=-Drocketmq.namesrv.addr=ä½ çš„å¤–ç½‘åœ°å€:9876 \\\\ -Dcom.rocketmq.sendMessageWithVIPChannel=false \\\\ -Duser.timezone=\\&#x27;Asia/Shanghai\\&#x27;\\&quot; -v /etc/localtime:/etc/localtime -p 9999:8080 styletang/rocketmq-console-ng æ­£å¸¸å¯åŠ¨åçš„docker ps è®¿é—®æ§åˆ¶å° http:&#x2F;&#x2F;ä½ çš„æœåŠ¡å™¨å¤–ç½‘ip:9999&#x2F;","categories":[{"name":"mq","slug":"mq","permalink":"http://example.com/mq/"}],"tags":[{"name":"mq","slug":"mq","permalink":"http://example.com/tags/mq/"}]},{"title":"RocketMqï¼ˆä¸€ï¼‰--ç®€ä»‹","slug":"mq/RocketMq/RocketMqï¼ˆä¸€ï¼‰-ç®€ä»‹","date":"2023-06-19T01:50:01.000Z","updated":"2023-06-19T01:55:56.260Z","comments":true,"path":"2023/06/19/mq/RocketMq/RocketMqï¼ˆä¸€ï¼‰-ç®€ä»‹/","link":"","permalink":"http://example.com/2023/06/19/mq/RocketMq/RocketMq%EF%BC%88%E4%B8%80%EF%BC%89-%E7%AE%80%E4%BB%8B/","excerpt":"","text":"RocketMQç®€ä»‹MQ&#x3D;&#x3D;&#x3D;&#x3D;Message Queue å®˜ç½‘ï¼š[http://rocketmq.apache.org/]{.underline} RocketMQæ˜¯é˜¿é‡Œå·´å·´2016å¹´MQä¸­é—´ä»¶ï¼Œä½¿ç”¨Javaè¯­è¨€å¼€å‘ï¼ŒRocketMQæ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼ŒåŸºäºé«˜å¯ç”¨åˆ†å¸ƒå¼é›†ç¾¤æŠ€æœ¯ï¼Œæä¾›ä½å»¶æ—¶çš„ã€é«˜å¯é çš„æ¶ˆæ¯å‘å¸ƒä¸è®¢é˜…æœåŠ¡ã€‚åŒæ—¶ï¼Œå¹¿æ³›åº”ç”¨äºå¤šä¸ªé¢†åŸŸï¼ŒåŒ…æ‹¬å¼‚æ­¥é€šä¿¡è§£è€¦ã€ä¼ä¸šè§£å†³æ–¹æ¡ˆã€é‡‘èæ”¯ä»˜ã€ç”µä¿¡ã€ç”µå­å•†åŠ¡ã€å¿«é€’ç‰©æµã€å¹¿å‘Šè¥é”€ã€ç¤¾äº¤ã€å³æ—¶é€šä¿¡ã€ç§»åŠ¨åº”ç”¨ã€æ‰‹æ¸¸ã€è§†é¢‘ã€ç‰©è”ç½‘ã€è½¦è”ç½‘ç­‰ã€‚ å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š ï¬èƒ½å¤Ÿä¿è¯ä¸¥æ ¼çš„æ¶ˆæ¯é¡ºåº ï¬æä¾›ä¸°å¯Œçš„æ¶ˆæ¯æ‹‰å–æ¨¡å¼ ï¬é«˜æ•ˆçš„è®¢é˜…è€…æ°´å¹³æ‰©å±•èƒ½åŠ› ï¬å®æ—¶çš„æ¶ˆæ¯è®¢é˜…æœºåˆ¶ ï¬äº¿çº§æ¶ˆæ¯å †ç§¯èƒ½åŠ› ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MQ1ï¼Œè¦åšåˆ°ç³»ç»Ÿè§£è€¦ï¼Œå½“æ–°çš„æ¨¡å—è¿›æ¥æ—¶ï¼Œå¯ä»¥åšåˆ°ä»£ç æ”¹åŠ¨æœ€å°; èƒ½å¤Ÿè§£è€¦ 2ï¼Œè®¾ç½®æµç¨‹ç¼“å†²æ± ï¼Œå¯ä»¥è®©åç«¯ç³»ç»ŸæŒ‰è‡ªèº«ååèƒ½åŠ›è¿›è¡Œæ¶ˆè´¹ï¼Œä¸è¢«å†²å®; èƒ½å¤Ÿå‰Šå³°ï¼Œé™æµ 3ï¼Œå¼ºå¼±ä¾èµ–æ¢³ç†èƒ½æŠŠéå…³é”®è°ƒç”¨é“¾è·¯çš„æ“ä½œå¼‚æ­¥åŒ–å¹¶æå‡æ•´ä½“ç³»ç»Ÿçš„ååèƒ½åŠ›;èƒ½å¤Ÿå¼‚æ­¥ [Mqçš„ä½œç”¨ å‰Šå³°é™æµ å¼‚æ­¥ è§£è€¦åˆ]{.mark} å®šä¹‰ä¸­é—´ä»¶ï¼ˆç¼“å­˜ä¸­é—´ä»¶ redis memcache æ•°æ®åº“ä¸­é—´ä»¶ mycat canal æ¶ˆæ¯ä¸­é—´ä»¶mqï¼‰ é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶(message-oriented middleware)MOMèƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³ä»¥ä¸Šçš„é—®é¢˜ã€‚ æ˜¯æŒ‡åˆ©ç”¨é«˜æ•ˆå¯é çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶è¿›è¡Œä¸å¹³å°æ— å…³ï¼ˆè·¨å¹³å°ï¼‰çš„æ•°æ®äº¤æµï¼Œå¹¶åŸºäºæ•°æ®é€šä¿¡æ¥è¿›è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„é›†æˆã€‚ é€šè¿‡æä¾›æ¶ˆæ¯ä¼ é€’å’Œæ¶ˆæ¯æ’é˜Ÿæ¨¡å‹åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æä¾›åº”ç”¨è§£è€¦ï¼Œå¼¹æ€§ä¼¸ç¼©ï¼Œå†—ä½™å­˜å‚¨ï¼Œæµé‡å‰Šå³°ï¼Œå¼‚æ­¥é€šä¿¡ï¼Œæ•°æ®åŒæ­¥ç­‰ å¤§è‡´æµç¨‹ å‘é€è€…æŠŠæ¶ˆæ¯å‘ç»™æ¶ˆæ¯æœåŠ¡å™¨[MQ]ï¼Œæ¶ˆæ¯æœåŠ¡å™¨æŠŠæ¶ˆæ¯å­˜æ”¾åœ¨è‹¥å¹²é˜Ÿåˆ—&#x2F;ä¸»é¢˜ä¸­ï¼Œåœ¨åˆé€‚çš„æ—¶å€™ï¼Œæ¶ˆæ¯æœåŠ¡å™¨ä¼šæŠŠæ¶ˆæ¯è½¬å‘ç»™æ¥å—è€…ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå‘é€å’Œæ¥å—æ˜¯å¼‚æ­¥çš„,ä¹Ÿå°±æ˜¯å‘é€æ— éœ€ç­‰å¾…ï¼Œå‘é€è€…å’Œæ¥å—è€…çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿæ²¡æœ‰å¿…ç„¶å…³ç³»åœ¨å‘å¸ƒpub&#x2F;è®¢é˜…subæ¨¡å¼ä¸‹ï¼Œä¹Ÿå¯ä»¥å®Œæˆä¸€å¯¹å¤šçš„é€šä¿¡ï¼Œå¯ä»¥è®©ä¸€ä¸ªæ¶ˆæ¯æœ‰å¤šä¸ªæ¥å—è€…[å¾®ä¿¡è®¢é˜…å·å°±æ˜¯è¿™æ ·çš„] ç‰¹ç‚¹å¼‚æ­¥å¤„ç†æ¨¡å¼æ¶ˆæ¯å‘é€è€…å¯ä»¥å‘é€ä¸€ä¸ªæ¶ˆæ¯è€Œæ— éœ€ç­‰å¾…å“åº”ã€‚æ¶ˆæ¯å‘é€è€…æŠŠæ¶ˆæ¯å‘é€åˆ°ä¸€æ¡è™šæ‹Ÿçš„é€šé“(ä¸»é¢˜æˆ–é˜Ÿåˆ—)ä¸Š; æ¶ˆæ¯æ¥æ”¶è€…åˆ™è®¢é˜…æˆ–ç›‘å¬è¯¥é€šé“ã€‚ä¸€æ¡ä¿¡æ¯å¯èƒ½æœ€ç»ˆè½¬å‘ç»™ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯æ¥æ”¶è€…ï¼Œè¿™äº›æ¥æ”¶è€…éƒ½æ— éœ€å¯¹æ¶ˆæ¯å‘é€è€…åšå‡ºå›åº”ã€‚æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯å¼‚æ­¥çš„ã€‚ æ¡ˆä¾‹ï¼š ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªç³»ç»Ÿå’Œå¦ä¸€ä¸ªç³»ç»Ÿé—´è¿›è¡Œé€šä¿¡çš„æ—¶å€™ï¼Œå‡å¦‚ç³»ç»ŸAå¸Œæœ›å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™ç³»ç»ŸBï¼Œè®©å®ƒå»å¤„ç†ï¼Œä½†æ˜¯ç³»ç»ŸAä¸å…³æ³¨ç³»ç»ŸBåˆ°åº•æ€ä¹ˆå¤„ç†æˆ–è€…æœ‰æ²¡æœ‰å¤„ç†å¥½ï¼Œæ‰€ä»¥ç³»ç»ŸAæŠŠæ¶ˆæ¯å‘é€ç»™MQï¼Œç„¶åå°±ä¸ç®¡è¿™æ¡æ¶ˆæ¯çš„â€æ­»æ´»â€äº†ï¼Œæ¥ç€ç³»ç»ŸBä»MQé‡Œé¢æ¶ˆè´¹å‡ºæ¥å¤„ç†å³å¯ã€‚è‡³äºæ€ä¹ˆå¤„ç†ï¼Œæ˜¯å¦å¤„ç†å®Œæ¯•ï¼Œä»€ä¹ˆæ—¶å€™å¤„ç†ï¼Œéƒ½æ˜¯ç³»ç»ŸBçš„äº‹ï¼Œä¸ç³»ç»ŸAæ— å…³ã€‚ è¿™æ ·çš„ä¸€ç§é€šä¿¡æ–¹å¼ï¼Œå°±æ˜¯æ‰€è°“çš„â€å¼‚æ­¥â€é€šä¿¡æ–¹å¼ï¼Œå¯¹äºç³»ç»ŸAæ¥è¯´ï¼Œåªè¦æŠŠæ¶ˆæ¯å‘ç»™MQ,ç„¶åç³»ç»ŸBå°±ä¼šå¼‚æ­¥å¤„å»è¿›è¡Œå¤„ç†äº†ï¼Œç³»ç»ŸAä¸èƒ½â€åŒæ­¥â€çš„ç­‰å¾…ç³»ç»ŸBå¤„ç†å®Œã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè§£è€¦ åº”ç”¨ç³»ç»Ÿçš„è§£è€¦ å‘é€è€…å’Œæ¥æ”¶è€…ä¸å¿…äº†è§£å¯¹æ–¹ï¼Œåªéœ€è¦ç¡®è®¤æ¶ˆæ¯ å‘é€è€…å’Œæ¥æ”¶è€…ä¸å¿…åŒæ—¶åœ¨çº¿ ç°å®ä¸­çš„ä¸šåŠ¡ å„ä¸ªMQäº§å“çš„æ¯”è¾ƒ RocketMQé‡è¦æ¦‚å¿µã€é‡ç‚¹ã€‘Producerï¼šæ¶ˆæ¯çš„å‘é€è€…ï¼Œç”Ÿäº§è€…ï¼›ä¸¾ä¾‹ï¼šå‘ä»¶äºº Consumerï¼šæ¶ˆæ¯æ¥æ”¶è€…ï¼Œæ¶ˆè´¹è€…ï¼›ä¸¾ä¾‹ï¼šæ”¶ä»¶äºº Brokerï¼šæš‚å­˜å’Œä¼ è¾“æ¶ˆæ¯çš„é€šé“ï¼›ä¸¾ä¾‹ï¼šå¿«é€’ NameServerï¼šç®¡ç†Brokerï¼›ä¸¾ä¾‹ï¼šå„ä¸ªå¿«é€’å…¬å¸çš„ç®¡ç†æœºæ„ç›¸å½“äºbrokerçš„æ³¨å†Œä¸­å¿ƒï¼Œä¿ç•™äº†brokerçš„ä¿¡æ¯ Queueï¼šé˜Ÿåˆ—ï¼Œæ¶ˆæ¯å­˜æ”¾çš„ä½ç½®ï¼Œä¸€ä¸ªBrokerä¸­å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ— Topicï¼šä¸»é¢˜ï¼Œæ¶ˆæ¯çš„åˆ†ç±» ProducerGroupï¼šç”Ÿäº§è€…ç»„ ConsumerGroupï¼šæ¶ˆè´¹è€…ç»„ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥åŒæ—¶æ¶ˆè´¹ä¸€ä¸ªä¸»é¢˜çš„æ¶ˆæ¯ æ¶ˆæ¯å‘é€çš„æµç¨‹æ˜¯ï¼ŒProducerè¯¢é—®NameServerï¼ŒNameServeråˆ†é…ä¸€ä¸ªbrokerç„¶åConsumerä¹Ÿè¦è¯¢é—®NameServerï¼Œå¾—åˆ°ä¸€ä¸ªå…·ä½“çš„brokerï¼Œç„¶åæ¶ˆè´¹æ¶ˆæ¯ ç”Ÿäº§å’Œæ¶ˆè´¹ç†è§£ã€é‡ç‚¹ã€‘","categories":[{"name":"mq","slug":"mq","permalink":"http://example.com/mq/"}],"tags":[{"name":"mq","slug":"mq","permalink":"http://example.com/tags/mq/"}]},{"title":"spring-ioc-demo","slug":"spring/spring-ioc-demo","date":"2023-06-19T01:21:46.000Z","updated":"2023-06-19T01:26:12.520Z","comments":true,"path":"2023/06/19/spring/spring-ioc-demo/","link":"","permalink":"http://example.com/2023/06/19/spring/spring-ioc-demo/","excerpt":"","text":"éƒ¨åˆ†å…³äºspring-iocæºç ç®€å•æ‰‹å†™ giteeåœ°å€ï¼šhttps://gitee.com/zhangying17865151388/spring-ioc-demo.git","categories":[{"name":"spring","slug":"spring","permalink":"http://example.com/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"http://example.com/tags/spring/"}]},{"title":"è®¾è®¡æ¨¡å¼ï¼ˆå…­ï¼‰","slug":"è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆå…­ï¼‰","date":"2023-06-16T06:01:23.000Z","updated":"2023-06-16T06:02:38.035Z","comments":true,"path":"2023/06/16/è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆå…­ï¼‰/","link":"","permalink":"http://example.com/2023/06/16/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E5%85%AD%EF%BC%89/","excerpt":"","text":"6ï¼Œè¡Œä¸ºå‹æ¨¡å¼6.11 è§£é‡Šå™¨æ¨¡å¼6.11.1 æ¦‚è¿° å¦‚ä¸Šå›¾ï¼Œè®¾è®¡ä¸€ä¸ªè½¯ä»¶ç”¨æ¥è¿›è¡ŒåŠ å‡è®¡ç®—ã€‚æˆ‘ä»¬ç¬¬ä¸€æƒ³æ³•å°±æ˜¯ä½¿ç”¨å·¥å…·ç±»ï¼Œæä¾›å¯¹åº”çš„åŠ æ³•å’Œå‡æ³•çš„å·¥å…·æ–¹æ³•ã€‚ 123456789101112131415161718//ç”¨äºä¸¤ä¸ªæ•´æ•°ç›¸åŠ public static int add(int a,int b)&#123; return a + b;&#125;//ç”¨äºä¸¤ä¸ªæ•´æ•°ç›¸åŠ public static int add(int a,int b,int c)&#123; return a + b + c;&#125;//ç”¨äºnä¸ªæ•´æ•°ç›¸åŠ public static int add(Integer ... arr) &#123; int sum = 0; for (Integer i : arr) &#123; sum += i; &#125; return sum;&#125; ä¸Šé¢çš„å½¢å¼æ¯”è¾ƒå•ä¸€ã€æœ‰é™ï¼Œå¦‚æœå½¢å¼å˜åŒ–éå¸¸å¤šï¼Œè¿™å°±ä¸ç¬¦åˆè¦æ±‚ï¼Œå› ä¸ºåŠ æ³•å’Œå‡æ³•è¿ç®—ï¼Œä¸¤ä¸ªè¿ç®—ç¬¦ä¸æ•°å€¼å¯ä»¥æœ‰æ— é™ç§ç»„åˆæ–¹å¼ã€‚æ¯”å¦‚ 1+2+3+4+5ã€1+2+3-4ç­‰ç­‰ã€‚ æ˜¾ç„¶ï¼Œç°åœ¨éœ€è¦ä¸€ç§ç¿»è¯‘è¯†åˆ«æœºå™¨ï¼Œèƒ½å¤Ÿè§£æç”±æ•°å­—ä»¥åŠ + - ç¬¦å·æ„æˆçš„åˆæ³•çš„è¿ç®—åºåˆ—ã€‚å¦‚æœæŠŠè¿ç®—ç¬¦å’Œæ•°å­—éƒ½çœ‹ä½œèŠ‚ç‚¹çš„è¯ï¼Œèƒ½å¤Ÿé€ä¸ªèŠ‚ç‚¹çš„è¿›è¡Œè¯»å–è§£æè¿ç®—ï¼Œè¿™å°±æ˜¯è§£é‡Šå™¨æ¨¡å¼çš„æ€ç»´ã€‚ å®šä¹‰ï¼š ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥æ ‡è¯†æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚ åœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†å¾…è§£å†³çš„é—®é¢˜ï¼Œæå–å‡ºè§„åˆ™ï¼ŒæŠ½è±¡ä¸ºä¸€ç§â€œè¯­è¨€â€ã€‚æ¯”å¦‚åŠ å‡æ³•è¿ç®—ï¼Œè§„åˆ™ä¸ºï¼šç”±æ•°å€¼å’Œ+-ç¬¦å·ç»„æˆçš„åˆæ³•åºåˆ—ï¼Œâ€œ1+3-2â€ å°±æ˜¯è¿™ç§è¯­è¨€çš„å¥å­ã€‚ è§£é‡Šå™¨å°±æ˜¯è¦è§£æå‡ºæ¥è¯­å¥çš„å«ä¹‰ã€‚ä½†æ˜¯å¦‚ä½•æè¿°è§„åˆ™å‘¢ï¼Ÿ æ–‡æ³•ï¼ˆè¯­æ³•ï¼‰è§„åˆ™ï¼š æ–‡æ³•æ˜¯ç”¨äºæè¿°è¯­è¨€çš„è¯­æ³•ç»“æ„çš„å½¢å¼è§„åˆ™ã€‚ 1234expression ::= value | plus | minusplus ::= expression â€˜+â€™ expression minus ::= expression â€˜-â€™ expression value ::= integer æ³¨æ„ï¼š è¿™é‡Œçš„ç¬¦å·â€œ::&#x3D;â€è¡¨ç¤ºâ€œå®šä¹‰ä¸ºâ€çš„æ„æ€ï¼Œç«–çº¿ | è¡¨ç¤ºæˆ–ï¼Œå·¦å³çš„å…¶ä¸­ä¸€ä¸ªï¼Œå¼•å·å†…ä¸ºå­—ç¬¦æœ¬èº«ï¼Œå¼•å·å¤–ä¸ºè¯­æ³•ã€‚ ä¸Šé¢è§„åˆ™æè¿°ä¸º ï¼š è¡¨è¾¾å¼å¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯plusæˆ–è€…minusè¿ç®—ï¼Œè€Œpluså’Œminusåˆæ˜¯ç”±è¡¨è¾¾å¼ç»“åˆè¿ç®—ç¬¦æ„æˆï¼Œå€¼çš„ç±»å‹ä¸ºæ•´å‹æ•°ã€‚ æŠ½è±¡è¯­æ³•æ ‘ï¼š åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstractSyntaxTreeï¼ŒASTï¼‰ï¼Œæˆ–ç®€ç§°è¯­æ³•æ ‘ï¼ˆSyntax treeï¼‰ï¼Œæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚ ç”¨æ ‘å½¢æ¥è¡¨ç¤ºç¬¦åˆæ–‡æ³•è§„åˆ™çš„å¥å­ã€‚ 6.11.2 ç»“æ„è§£é‡Šå™¨æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚ æŠ½è±¡è¡¨è¾¾å¼ï¼ˆAbstract Expressionï¼‰è§’è‰²ï¼šå®šä¹‰è§£é‡Šå™¨çš„æ¥å£ï¼Œçº¦å®šè§£é‡Šå™¨çš„è§£é‡Šæ“ä½œï¼Œä¸»è¦åŒ…å«è§£é‡Šæ–¹æ³• interpret()ã€‚ ç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆTerminal Expressionï¼‰è§’è‰²ï¼šæ˜¯æŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸ç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯ä¸€ä¸ªç»ˆç»“ç¬¦éƒ½æœ‰ä¸€ä¸ªå…·ä½“ç»ˆç»“è¡¨è¾¾å¼ä¸ä¹‹ç›¸å¯¹åº”ã€‚ éç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆNonterminal Expressionï¼‰è§’è‰²ï¼šä¹Ÿæ˜¯æŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸éç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯æ¡è§„åˆ™éƒ½å¯¹åº”äºä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼ã€‚ ç¯å¢ƒï¼ˆContextï¼‰è§’è‰²ï¼šé€šå¸¸åŒ…å«å„ä¸ªè§£é‡Šå™¨éœ€è¦çš„æ•°æ®æˆ–æ˜¯å…¬å…±çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ç”¨æ¥ä¼ é€’è¢«æ‰€æœ‰è§£é‡Šå™¨å…±äº«çš„æ•°æ®ï¼Œåé¢çš„è§£é‡Šå™¨å¯ä»¥ä»è¿™é‡Œè·å–è¿™äº›å€¼ã€‚ å®¢æˆ·ç«¯ï¼ˆClientï¼‰ï¼šä¸»è¦ä»»åŠ¡æ˜¯å°†éœ€è¦åˆ†æçš„å¥å­æˆ–è¡¨è¾¾å¼è½¬æ¢æˆä½¿ç”¨è§£é‡Šå™¨å¯¹è±¡æè¿°çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œç„¶åè°ƒç”¨è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒè§’è‰²é—´æ¥è®¿é—®è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³•ã€‚ 6.11.3 æ¡ˆä¾‹å®ç°ã€ä¾‹ã€‘è®¾è®¡å®ç°åŠ å‡æ³•çš„è½¯ä»¶ ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122//æŠ½è±¡è§’è‰²AbstractExpressionpublic abstract class AbstractExpression &#123; public abstract int interpret(Context context);&#125;//ç»ˆç»“ç¬¦è¡¨è¾¾å¼è§’è‰²public class Value extends AbstractExpression &#123; private int value; public Value(int value) &#123; this.value = value; &#125; @Override public int interpret(Context context) &#123; return value; &#125; @Override public String toString() &#123; return new Integer(value).toString(); &#125;&#125;//éç»ˆç»“ç¬¦è¡¨è¾¾å¼è§’è‰² åŠ æ³•è¡¨è¾¾å¼public class Plus extends AbstractExpression &#123; private AbstractExpression left; private AbstractExpression right; public Plus(AbstractExpression left, AbstractExpression right) &#123; this.left = left; this.right = right; &#125; @Override public int interpret(Context context) &#123; return left.interpret(context) + right.interpret(context); &#125; @Override public String toString() &#123; return &quot;(&quot; + left.toString() + &quot; + &quot; + right.toString() + &quot;)&quot;; &#125;&#125;///éç»ˆç»“ç¬¦è¡¨è¾¾å¼è§’è‰² å‡æ³•è¡¨è¾¾å¼public class Minus extends AbstractExpression &#123; private AbstractExpression left; private AbstractExpression right; public Minus(AbstractExpression left, AbstractExpression right) &#123; this.left = left; this.right = right; &#125; @Override public int interpret(Context context) &#123; return left.interpret(context) - right.interpret(context); &#125; @Override public String toString() &#123; return &quot;(&quot; + left.toString() + &quot; - &quot; + right.toString() + &quot;)&quot;; &#125;&#125;//ç»ˆç»“ç¬¦è¡¨è¾¾å¼è§’è‰² å˜é‡è¡¨è¾¾å¼public class Variable extends AbstractExpression &#123; private String name; public Variable(String name) &#123; this.name = name; &#125; @Override public int interpret(Context ctx) &#123; return ctx.getValue(this); &#125; @Override public String toString() &#123; return name; &#125;&#125;//ç¯å¢ƒç±»public class Context &#123; private Map&lt;Variable, Integer&gt; map = new HashMap&lt;Variable, Integer&gt;(); public void assign(Variable var, Integer value) &#123; map.put(var, value); &#125; public int getValue(Variable var) &#123; Integer value = map.get(var); return value; &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; Context context = new Context(); Variable a = new Variable(&quot;a&quot;); Variable b = new Variable(&quot;b&quot;); Variable c = new Variable(&quot;c&quot;); Variable d = new Variable(&quot;d&quot;); Variable e = new Variable(&quot;e&quot;); //Value v = new Value(1); context.assign(a, 1); context.assign(b, 2); context.assign(c, 3); context.assign(d, 4); context.assign(e, 5); AbstractExpression expression = new Minus(new Plus(new Plus(new Plus(a, b), c), d), e); System.out.println(expression + &quot;= &quot; + expression.interpret(context)); &#125;&#125; 6.11.4 ä¼˜ç¼ºç‚¹1ï¼Œä¼˜ç‚¹ï¼š æ˜“äºæ”¹å˜å’Œæ‰©å±•æ–‡æ³•ã€‚ ç”±äºåœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ä½¿ç”¨ç±»æ¥è¡¨ç¤ºè¯­è¨€çš„æ–‡æ³•è§„åˆ™ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç»§æ‰¿ç­‰æœºåˆ¶æ¥æ”¹å˜æˆ–æ‰©å±•æ–‡æ³•ã€‚æ¯ä¸€æ¡æ–‡æ³•è§„åˆ™éƒ½å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªç±»ï¼Œå› æ­¤å¯ä»¥æ–¹ä¾¿åœ°å®ç°ä¸€ä¸ªç®€å•çš„è¯­è¨€ã€‚ å®ç°æ–‡æ³•è¾ƒä¸ºå®¹æ˜“ã€‚ åœ¨æŠ½è±¡è¯­æ³•æ ‘ä¸­æ¯ä¸€ä¸ªè¡¨è¾¾å¼èŠ‚ç‚¹ç±»çš„å®ç°æ–¹å¼éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œè¿™äº›ç±»çš„ä»£ç ç¼–å†™éƒ½ä¸ä¼šç‰¹åˆ«å¤æ‚ã€‚ å¢åŠ æ–°çš„è§£é‡Šè¡¨è¾¾å¼è¾ƒä¸ºæ–¹ä¾¿ã€‚ å¦‚æœç”¨æˆ·éœ€è¦å¢åŠ æ–°çš„è§£é‡Šè¡¨è¾¾å¼åªéœ€è¦å¯¹åº”å¢åŠ ä¸€ä¸ªæ–°çš„ç»ˆç»“ç¬¦è¡¨è¾¾å¼æˆ–éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»ï¼ŒåŸæœ‰è¡¨è¾¾å¼ç±»ä»£ç æ— é¡»ä¿®æ”¹ï¼Œç¬¦åˆ â€œå¼€é—­åŸåˆ™â€ã€‚ 2ï¼Œç¼ºç‚¹ï¼š å¯¹äºå¤æ‚æ–‡æ³•éš¾ä»¥ç»´æŠ¤ã€‚ åœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ï¼Œæ¯ä¸€æ¡è§„åˆ™è‡³å°‘éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå› æ­¤å¦‚æœä¸€ä¸ªè¯­è¨€åŒ…å«å¤ªå¤šæ–‡æ³•è§„åˆ™ï¼Œç±»çš„ä¸ªæ•°å°†ä¼šæ€¥å‰§å¢åŠ ï¼Œå¯¼è‡´ç³»ç»Ÿéš¾ä»¥ç®¡ç†å’Œç»´æŠ¤ã€‚ æ‰§è¡Œæ•ˆç‡è¾ƒä½ã€‚ ç”±äºåœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ä½¿ç”¨äº†å¤§é‡çš„å¾ªç¯å’Œé€’å½’è°ƒç”¨ï¼Œå› æ­¤åœ¨è§£é‡Šè¾ƒä¸ºå¤æ‚çš„å¥å­æ—¶å…¶é€Ÿåº¦å¾ˆæ…¢ï¼Œè€Œä¸”ä»£ç çš„è°ƒè¯•è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚ 6.11.5 ä½¿ç”¨åœºæ™¯ å½“è¯­è¨€çš„æ–‡æ³•è¾ƒä¸ºç®€å•ï¼Œä¸”æ‰§è¡Œæ•ˆç‡ä¸æ˜¯å…³é”®é—®é¢˜æ—¶ã€‚ å½“é—®é¢˜é‡å¤å‡ºç°ï¼Œä¸”å¯ä»¥ç”¨ä¸€ç§ç®€å•çš„è¯­è¨€æ¥è¿›è¡Œè¡¨è¾¾æ—¶ã€‚ å½“ä¸€ä¸ªè¯­è¨€éœ€è¦è§£é‡Šæ‰§è¡Œï¼Œå¹¶ä¸”è¯­è¨€ä¸­çš„å¥å­å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘çš„æ—¶å€™ã€‚ 7ï¼Œè‡ªå®šä¹‰Springæ¡†æ¶7.1 springä½¿ç”¨å›é¡¾è‡ªå®šä¹‰springæ¡†æ¶å‰ï¼Œå…ˆå›é¡¾ä¸€ä¸‹springæ¡†æ¶çš„ä½¿ç”¨ï¼Œä»è€Œåˆ†æspringçš„æ ¸å¿ƒï¼Œå¹¶å¯¹æ ¸å¿ƒåŠŸèƒ½è¿›è¡Œæ¨¡æ‹Ÿã€‚ æ•°æ®è®¿é—®å±‚ã€‚å®šä¹‰UserDaoæ¥å£åŠå…¶å­å®ç°ç±» 12345678910public interface UserDao &#123; public void add();&#125;public class UserDaoImpl implements UserDao &#123; public void add() &#123; System.out.println(&quot;userDaoImpl ....&quot;); &#125;&#125; ä¸šåŠ¡é€»è¾‘å±‚ã€‚å®šä¹‰UserServiceæ¥å£åŠå…¶å­å®ç°ç±» 1234567891011121314151617public interface UserService &#123; public void add();&#125;public class UserServiceImpl implements UserService &#123; private UserDao userDao; public void setUserDao(UserDao userDao) &#123; this.userDao = userDao; &#125; public void add() &#123; System.out.println(&quot;userServiceImpl ...&quot;); userDao.add(); &#125;&#125; å®šä¹‰UserControllerç±»ï¼Œä½¿ç”¨mainæ–¹æ³•æ¨¡æ‹Ÿcontrollerå±‚ 12345678910public class UserController &#123; public static void main(String[] args) &#123; //åˆ›å»ºspringå®¹å™¨å¯¹è±¡ ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;); //ä»IOCå®¹å™¨ä¸­è·å–UserServiceå¯¹è±¡ UserService userService = applicationContext.getBean(&quot;userService&quot;, UserService.class); //è°ƒç”¨UserServiceå¯¹è±¡çš„addæ–¹æ³• userService.add(); &#125;&#125; ç¼–å†™é…ç½®æ–‡ä»¶ã€‚åœ¨ç±»è·¯å¾„ä¸‹ç¼–å†™ä¸€ä¸ªåä¸ºApplicationContext.xmlçš„é…ç½®æ–‡ä»¶ 12345678910111213141516&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt; &lt;bean id=&quot;userService&quot; class=&quot;com.itheima.service.impl.UserServiceImpl&quot;&gt; &lt;property name=&quot;userDao&quot; ref=&quot;userDao&quot;&gt;&lt;/property&gt; &lt;/bean&gt; &lt;bean id=&quot;userDao&quot; class=&quot;com.itheima.dao.impl.UserDaoImpl&quot;&gt;&lt;/bean&gt;&lt;/beans&gt; ä»£ç è¿è¡Œç»“æœå¦‚ä¸‹ï¼š é€šè¿‡ä¸Šé¢ä»£ç åŠç»“æœå¯ä»¥çœ‹å‡ºï¼š userServiceå¯¹è±¡æ˜¯ä»applicationContextå®¹å™¨å¯¹è±¡è·å–åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯userServiceå¯¹è±¡äº¤ç”±springè¿›è¡Œç®¡ç†ã€‚ ä¸Šé¢ç»“æœå¯ä»¥çœ‹åˆ°è°ƒç”¨äº†UserDaoå¯¹è±¡ä¸­çš„addæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´UserDaoå­å®ç°ç±»å¯¹è±¡ä¹Ÿäº¤ç”±springç®¡ç†äº†ã€‚ UserServiceä¸­çš„userDaoå˜é‡æˆ‘ä»¬å¹¶æ²¡æœ‰è¿›è¡Œèµ‹å€¼ï¼Œä½†æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œè¯´æ˜springå·²ç»å°†UserDaoå¯¹è±¡èµ‹å€¼ç»™äº†userDaoå˜é‡ã€‚ ä¸Šé¢ä¸‰ç‚¹ä½“ç°äº†Springæ¡†æ¶çš„IOCï¼ˆInversion of Controlï¼‰å’ŒDIï¼ˆDependency Injection, DIï¼‰ 7.2 springæ ¸å¿ƒåŠŸèƒ½ç»“æ„Springå¤§çº¦æœ‰20ä¸ªæ¨¡å—ï¼Œç”±1300å¤šä¸ªä¸åŒçš„æ–‡ä»¶æ„æˆã€‚è¿™äº›æ¨¡å—å¯ä»¥åˆ†ä¸º: æ ¸å¿ƒå®¹å™¨ã€AOPå’Œè®¾å¤‡æ”¯æŒã€æ•°æ®è®¿é—®ä¸é›†æˆã€Webç»„ä»¶ã€é€šä¿¡æŠ¥æ–‡å’Œé›†æˆæµ‹è¯•ç­‰ï¼Œä¸‹é¢æ˜¯ Spring æ¡†æ¶çš„æ€»ä½“æ¶æ„å›¾ï¼š æ ¸å¿ƒå®¹å™¨ç”± beansã€coreã€context å’Œ expressionï¼ˆSpring Expression Languageï¼ŒSpELï¼‰4ä¸ªæ¨¡å—ç»„æˆã€‚ spring-beanså’Œspring-coreæ¨¡å—æ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…å«äº†æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼ŒIOCï¼‰å’Œä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼ŒDIï¼‰ã€‚BeanFactoryä½¿ç”¨æ§åˆ¶åè½¬å¯¹åº”ç”¨ç¨‹åºçš„é…ç½®å’Œä¾èµ–æ€§è§„èŒƒä¸å®é™…çš„åº”ç”¨ç¨‹åºä»£ç è¿›è¡Œäº†åˆ†ç¦»ã€‚BeanFactoryå±äºå»¶æ—¶åŠ è½½ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å®ä¾‹åŒ–å®¹å™¨å¯¹è±¡åå¹¶ä¸ä¼šè‡ªåŠ¨å®ä¾‹åŒ–Beanï¼Œåªæœ‰å½“Beanè¢«ä½¿ç”¨æ—¶ï¼ŒBeanFactoryæ‰ä¼šå¯¹è¯¥ Bean è¿›è¡Œå®ä¾‹åŒ–ä¸ä¾èµ–å…³ç³»çš„è£…é…ã€‚ spring-contextæ¨¡å—æ„æ¶äºæ ¸å¿ƒæ¨¡å—ä¹‹ä¸Šï¼Œæ‰©å±•äº†BeanFactoryï¼Œä¸ºå®ƒæ·»åŠ äº†Beanç”Ÿå‘½å‘¨æœŸæ§åˆ¶ã€æ¡†æ¶äº‹ä»¶ä½“ç³»åŠèµ„æºåŠ è½½é€æ˜åŒ–ç­‰åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œè¯¥æ¨¡å—è¿˜æä¾›äº†è®¸å¤šä¼ä¸šçº§æ”¯æŒï¼Œå¦‚é‚®ä»¶è®¿é—®ã€è¿œç¨‹è®¿é—®ã€ä»»åŠ¡è°ƒåº¦ç­‰ï¼ŒApplicationContext æ˜¯è¯¥æ¨¡å—çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒçš„è¶…ç±»æ˜¯ BeanFactoryã€‚ä¸BeanFactoryä¸åŒï¼ŒApplicationContextå®ä¾‹åŒ–åä¼šè‡ªåŠ¨å¯¹æ‰€æœ‰çš„å•å®ä¾‹Beanè¿›è¡Œå®ä¾‹åŒ–ä¸ä¾èµ–å…³ç³»çš„è£…é…ï¼Œä½¿ä¹‹å¤„äºå¾…ç”¨çŠ¶æ€ã€‚ spring-context-supportæ¨¡å—æ˜¯å¯¹Spring IoCå®¹å™¨åŠIoCå­å®¹å™¨çš„æ‰©å±•æ”¯æŒã€‚ spring-context-indexeræ¨¡å—æ˜¯Springçš„ç±»ç®¡ç†ç»„ä»¶å’ŒClasspathæ‰«æç»„ä»¶ã€‚ spring-expression æ¨¡å—æ˜¯ç»Ÿä¸€è¡¨è¾¾å¼è¯­è¨€ï¼ˆELï¼‰çš„æ‰©å±•æ¨¡å—ï¼Œå¯ä»¥æŸ¥è¯¢ã€ç®¡ç†è¿è¡Œä¸­çš„å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°è°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼Œä»¥åŠæ“ä½œæ•°ç»„ã€é›†åˆç­‰ã€‚å®ƒçš„è¯­æ³•ç±»ä¼¼äºä¼ ç»ŸELï¼Œä½†æä¾›äº†é¢å¤–çš„åŠŸèƒ½ï¼Œæœ€å‡ºè‰²çš„è¦æ•°å‡½æ•°è°ƒç”¨å’Œç®€å•å­—ç¬¦ä¸²çš„æ¨¡æ¿å‡½æ•°ã€‚ELçš„ç‰¹æ€§æ˜¯åŸºäºSpringäº§å“çš„éœ€æ±‚è€Œè®¾è®¡çš„ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°åŒSpring IoCè¿›è¡Œäº¤äº’ã€‚ 7.1.1 beanæ¦‚è¿°Spring å°±æ˜¯é¢å‘ Bean çš„ç¼–ç¨‹ï¼ˆBOP,Bean Oriented Programmingï¼‰ï¼ŒBean åœ¨ Spring ä¸­å¤„äºæ ¸å¿ƒåœ°ä½ã€‚Beanå¯¹äºSpringçš„æ„ä¹‰å°±åƒObjectå¯¹äºOOPçš„æ„ä¹‰ä¸€æ ·ï¼ŒSpringä¸­æ²¡æœ‰Beanä¹Ÿå°±æ²¡æœ‰Springå­˜åœ¨çš„æ„ä¹‰ã€‚Spring IoCå®¹å™¨é€šè¿‡é…ç½®æ–‡ä»¶æˆ–è€…æ³¨è§£çš„æ–¹å¼æ¥ç®¡ç†beanå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ springä¸­beanç”¨äºå¯¹ä¸€ä¸ªç±»è¿›è¡Œå°è£…ã€‚å¦‚ä¸‹é¢çš„é…ç½®ï¼š 1234&lt;bean id=&quot;userService&quot; class=&quot;com.itheima.service.impl.UserServiceImpl&quot;&gt; &lt;property name=&quot;userDao&quot; ref=&quot;userDao&quot;&gt;&lt;/property&gt;&lt;/bean&gt;&lt;bean id=&quot;userDao&quot; class=&quot;com.itheima.dao.impl.UserDaoImpl&quot;&gt;&lt;/bean&gt; ä¸ºä»€ä¹ˆBeanå¦‚æ­¤é‡è¦å‘¢ï¼Ÿ spring å°†beanå¯¹è±¡äº¤ç”±ä¸€ä¸ªå«IOCå®¹å™¨è¿›è¡Œç®¡ç†ã€‚ beanå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»åœ¨é…ç½®æ–‡ä»¶ä¸­ä½“ç°ï¼Œå¹¶ç”±springå®Œæˆã€‚ 7.3 Spring IOCç›¸å…³æ¥å£åˆ†æ7.3.1 BeanFactoryè§£æSpringä¸­Beançš„åˆ›å»ºæ˜¯å…¸å‹çš„å·¥å‚æ¨¡å¼ï¼Œè¿™ä¸€ç³»åˆ—çš„Beanå·¥å‚ï¼Œå³IoCå®¹å™¨ï¼Œä¸ºå¼€å‘è€…ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»æä¾›äº†å¾ˆå¤šä¾¿åˆ©å’ŒåŸºç¡€æœåŠ¡ï¼Œåœ¨Springä¸­æœ‰è®¸å¤šIoCå®¹å™¨çš„å®ç°ä¾›ç”¨æˆ·é€‰æ‹©ï¼Œå…¶ç›¸äº’å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å…¶ä¸­ï¼ŒBeanFactoryä½œä¸ºæœ€é¡¶å±‚çš„ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†IoCå®¹å™¨çš„åŸºæœ¬åŠŸèƒ½è§„èŒƒï¼ŒBeanFactoryæœ‰ä¸‰ä¸ªé‡è¦çš„å­æ¥å£ï¼šListableBeanFactoryã€HierarchicalBeanFactoryå’ŒAutowireCapableBeanFactoryã€‚ä½†æ˜¯ä»ç±»å›¾ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°æœ€ç»ˆçš„é»˜è®¤å®ç°ç±»æ˜¯DefaultListableBeanFactoryï¼Œå®ƒå®ç°äº†æ‰€æœ‰çš„æ¥å£ã€‚ é‚£ä¹ˆä¸ºä½•è¦å®šä¹‰è¿™ä¹ˆå¤šå±‚æ¬¡çš„æ¥å£å‘¢ï¼Ÿ æ¯ä¸ªæ¥å£éƒ½æœ‰å®ƒçš„ä½¿ç”¨åœºåˆï¼Œä¸»è¦æ˜¯ä¸ºäº†åŒºåˆ†åœ¨Springå†…éƒ¨æ“ä½œè¿‡ç¨‹ä¸­å¯¹è±¡çš„ä¼ é€’å’Œè½¬åŒ–ï¼Œå¯¹å¯¹è±¡çš„æ•°æ®è®¿é—®æ‰€åšçš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œ ListableBeanFactoryæ¥å£è¡¨ç¤ºè¿™äº›Beanå¯åˆ—è¡¨åŒ–ã€‚ HierarchicalBeanFactoryè¡¨ç¤ºè¿™äº›Bean æ˜¯æœ‰ç»§æ‰¿å…³ç³»çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª Bean å¯èƒ½æœ‰çˆ¶ Bean AutowireCapableBeanFactory æ¥å£å®šä¹‰Beançš„è‡ªåŠ¨è£…é…è§„åˆ™ã€‚ è¿™ä¸‰ä¸ªæ¥å£å…±åŒå®šä¹‰äº†Beançš„é›†åˆã€Beanä¹‹é—´çš„å…³ç³»åŠBeanè¡Œä¸ºã€‚æœ€åŸºæœ¬çš„IoCå®¹å™¨æ¥å£æ˜¯BeanFactoryï¼Œæ¥çœ‹ä¸€ä¸‹å®ƒçš„æºç ï¼š 1234567891011121314151617181920212223242526public interface BeanFactory &#123; String FACTORY_BEAN_PREFIX = &quot;&amp;&quot;; //æ ¹æ®beançš„åç§°è·å–IOCå®¹å™¨ä¸­çš„çš„beanå¯¹è±¡ Object getBean(String name) throws BeansException; //æ ¹æ®beançš„åç§°è·å–IOCå®¹å™¨ä¸­çš„çš„beanå¯¹è±¡ï¼Œå¹¶æŒ‡å®šè·å–åˆ°çš„beanå¯¹è±¡çš„ç±»å‹ï¼Œè¿™æ ·æˆ‘ä»¬ä½¿ç”¨æ—¶å°±ä¸éœ€è¦è¿›è¡Œç±»å‹å¼ºè½¬äº† &lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType) throws BeansException; Object getBean(String name, Object... args) throws BeansException; &lt;T&gt; T getBean(Class&lt;T&gt; requiredType) throws BeansException; &lt;T&gt; T getBean(Class&lt;T&gt; requiredType, Object... args) throws BeansException; &lt;T&gt; ObjectProvider&lt;T&gt; getBeanProvider(Class&lt;T&gt; requiredType); &lt;T&gt; ObjectProvider&lt;T&gt; getBeanProvider(ResolvableType requiredType); //åˆ¤æ–­å®¹å™¨ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šåç§°çš„beanå¯¹è±¡ boolean containsBean(String name); //æ ¹æ®beançš„åç§°åˆ¤æ–­æ˜¯å¦æ˜¯å•ä¾‹ boolean isSingleton(String name) throws NoSuchBeanDefinitionException; boolean isPrototype(String name) throws NoSuchBeanDefinitionException; boolean isTypeMatch(String name, ResolvableType typeToMatch) throws NoSuchBeanDefinitionException; boolean isTypeMatch(String name, Class&lt;?&gt; typeToMatch) throws NoSuchBeanDefinitionException; @Nullable Class&lt;?&gt; getType(String name) throws NoSuchBeanDefinitionException; String[] getAliases(String name);&#125; åœ¨BeanFactoryé‡Œåªå¯¹IoCå®¹å™¨çš„åŸºæœ¬è¡Œä¸ºåšäº†å®šä¹‰ï¼Œæ ¹æœ¬ä¸å…³å¿ƒä½ çš„Beanæ˜¯å¦‚ä½•å®šä¹‰åŠæ€æ ·åŠ è½½çš„ã€‚æ­£å¦‚æˆ‘ä»¬åªå…³å¿ƒèƒ½ä»å·¥å‚é‡Œå¾—åˆ°ä»€ä¹ˆäº§å“ï¼Œä¸å…³å¿ƒå·¥å‚æ˜¯æ€ä¹ˆç”Ÿäº§è¿™äº›äº§å“çš„ã€‚ BeanFactoryæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å­æ¥å£ï¼Œå°±æ˜¯ApplicationContextæ¥å£ï¼Œè¯¥æ¥å£ä¸»è¦æ¥è§„èŒƒå®¹å™¨ä¸­çš„beanå¯¹è±¡æ˜¯éå»¶æ—¶åŠ è½½ï¼Œå³åœ¨åˆ›å»ºå®¹å™¨å¯¹è±¡çš„æ—¶å€™å°±å¯¹è±¡beanè¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶å­˜å‚¨åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ã€‚ è¦çŸ¥é“å·¥å‚æ˜¯å¦‚ä½•äº§ç”Ÿå¯¹è±¡çš„ï¼Œæˆ‘ä»¬éœ€è¦çœ‹å…·ä½“çš„IoCå®¹å™¨å®ç°ï¼ŒSpringæä¾›äº†è®¸å¤šIoCå®¹å™¨å®ç°ï¼Œæ¯”å¦‚ï¼š ClasspathXmlApplicationContext : æ ¹æ®ç±»è·¯å¾„åŠ è½½xmlé…ç½®æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºIOCå®¹å™¨å¯¹è±¡ã€‚ FileSystemXmlApplicationContext ï¼šæ ¹æ®ç³»ç»Ÿè·¯å¾„åŠ è½½xmlé…ç½®æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºIOCå®¹å™¨å¯¹è±¡ã€‚ AnnotationConfigApplicationContext ï¼šåŠ è½½æ³¨è§£ç±»é…ç½®ï¼Œå¹¶åˆ›å»ºIOCå®¹å™¨ã€‚ 7.3.2 BeanDefinitionè§£æSpring IoCå®¹å™¨ç®¡ç†æˆ‘ä»¬å®šä¹‰çš„å„ç§Beanå¯¹è±¡åŠå…¶ç›¸äº’å…³ç³»ï¼Œè€ŒBeanå¯¹è±¡åœ¨Springå®ç°ä¸­æ˜¯ä»¥BeanDefinitionæ¥æè¿°çš„ï¼Œå¦‚ä¸‹é¢é…ç½®æ–‡ä»¶ 1234&lt;bean id=&quot;userDao&quot; class=&quot;com.itheima.dao.impl.UserDaoImpl&quot;&gt;&lt;/bean&gt;beanæ ‡ç­¾è¿˜æœ‰å¾ˆå¤šå±æ€§ï¼š scopeã€init-methodã€destory-methodç­‰ã€‚ å…¶ç»§æ‰¿ä½“ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 7.3.3 BeanDefinitionReaderè§£æBeançš„è§£æè¿‡ç¨‹éå¸¸å¤æ‚ï¼ŒåŠŸèƒ½è¢«åˆ†å¾—å¾ˆç»†ï¼Œå› ä¸ºè¿™é‡Œéœ€è¦è¢«æ‰©å±•çš„åœ°æ–¹å¾ˆå¤šï¼Œå¿…é¡»ä¿è¯è¶³å¤Ÿçš„çµæ´»æ€§ï¼Œä»¥åº”å¯¹å¯èƒ½çš„å˜åŒ–ã€‚Beançš„è§£æä¸»è¦å°±æ˜¯å¯¹Springé…ç½®æ–‡ä»¶çš„è§£æã€‚è¿™ä¸ªè§£æè¿‡ç¨‹ä¸»è¦é€šè¿‡BeanDefinitionReaderæ¥å®Œæˆï¼Œçœ‹çœ‹Springä¸­BeanDefinitionReaderçš„ç±»ç»“æ„å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ çœ‹çœ‹BeanDefinitionReaderæ¥å£å®šä¹‰çš„åŠŸèƒ½æ¥ç†è§£å®ƒå…·ä½“çš„ä½œç”¨ï¼š 123456789101112131415161718192021public interface BeanDefinitionReader &#123; //è·å–BeanDefinitionRegistryæ³¨å†Œå™¨å¯¹è±¡ BeanDefinitionRegistry getRegistry(); @Nullable ResourceLoader getResourceLoader(); @Nullable ClassLoader getBeanClassLoader(); BeanNameGenerator getBeanNameGenerator(); /* ä¸‹é¢çš„loadBeanDefinitionséƒ½æ˜¯åŠ è½½beanå®šä¹‰ï¼Œä»æŒ‡å®šçš„èµ„æºä¸­ */ int loadBeanDefinitions(Resource resource) throws BeanDefinitionStoreException; int loadBeanDefinitions(Resource... resources) throws BeanDefinitionStoreException; int loadBeanDefinitions(String location) throws BeanDefinitionStoreException; int loadBeanDefinitions(String... locations) throws BeanDefinitionStoreException;&#125; 7.3.4 BeanDefinitionRegistryè§£æBeanDefinitionReaderç”¨æ¥è§£æbeanå®šä¹‰ï¼Œå¹¶å°è£…BeanDefinitionå¯¹è±¡ï¼Œè€Œæˆ‘ä»¬å®šä¹‰çš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†å¾ˆå¤šbeanæ ‡ç­¾ï¼Œæ‰€ä»¥å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè§£æçš„BeanDefinitionå¯¹è±¡å­˜å‚¨åˆ°å“ªå„¿ï¼Ÿç­”æ¡ˆå°±æ˜¯BeanDefinitionçš„æ³¨å†Œä¸­å¿ƒï¼Œè€Œè¯¥æ³¨å†Œä¸­å¿ƒé¡¶å±‚æ¥å£å°±æ˜¯BeanDefinitionRegistryã€‚ 123456789101112131415161718192021public interface BeanDefinitionRegistry extends AliasRegistry &#123; //å¾€æ³¨å†Œè¡¨ä¸­æ³¨å†Œbean void registerBeanDefinition(String beanName, BeanDefinition beanDefinition) throws BeanDefinitionStoreException; //ä»æ³¨å†Œè¡¨ä¸­åˆ é™¤æŒ‡å®šåç§°çš„bean void removeBeanDefinition(String beanName) throws NoSuchBeanDefinitionException; //è·å–æ³¨å†Œè¡¨ä¸­æŒ‡å®šåç§°çš„bean BeanDefinition getBeanDefinition(String beanName) throws NoSuchBeanDefinitionException; //åˆ¤æ–­æ³¨å†Œè¡¨ä¸­æ˜¯å¦å·²ç»æ³¨å†Œäº†æŒ‡å®šåç§°çš„bean boolean containsBeanDefinition(String beanName); //è·å–æ³¨å†Œè¡¨ä¸­æ‰€æœ‰çš„beançš„åç§° String[] getBeanDefinitionNames(); int getBeanDefinitionCount(); boolean isBeanNameInUse(String beanName);&#125; ç»§æ‰¿ç»“æ„å›¾å¦‚ä¸‹ï¼š ä»ä¸Šé¢ç±»å›¾å¯ä»¥çœ‹åˆ°BeanDefinitionRegistryæ¥å£çš„å­å®ç°ç±»ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š DefaultListableBeanFactory åœ¨è¯¥ç±»ä¸­å®šä¹‰äº†å¦‚ä¸‹ä»£ç ï¼Œå°±æ˜¯ç”¨æ¥æ³¨å†Œbean 1private final Map&lt;String, BeanDefinition&gt; beanDefinitionMap = new ConcurrentHashMap&lt;&gt;(256); SimpleBeanDefinitionRegistry åœ¨è¯¥ç±»ä¸­å®šä¹‰äº†å¦‚ä¸‹ä»£ç ï¼Œå°±æ˜¯ç”¨æ¥æ³¨å†Œbean 1private final Map&lt;String, BeanDefinition&gt; beanDefinitionMap = new ConcurrentHashMap&lt;&gt;(64); 7.3.5 åˆ›å»ºå®¹å™¨ClassPathXmlApplicationContextå¯¹Beané…ç½®èµ„æºçš„è½½å…¥æ˜¯ä»refreshï¼ˆï¼‰æ–¹æ³•å¼€å§‹çš„ã€‚refreshï¼ˆï¼‰æ–¹æ³•æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œè§„å®šäº† IoC å®¹å™¨çš„å¯åŠ¨æµç¨‹ï¼Œæœ‰äº›é€»è¾‘è¦äº¤ç»™å…¶å­ç±»å®ç°ã€‚å®ƒå¯¹ Bean é…ç½®èµ„æºè¿›è¡Œè½½å…¥ï¼ŒClassPathXmlApplicationContexté€šè¿‡è°ƒç”¨å…¶çˆ¶ç±»AbstractApplicationContextçš„refreshï¼ˆï¼‰æ–¹æ³•å¯åŠ¨æ•´ä¸ªIoCå®¹å™¨å¯¹Beanå®šä¹‰çš„è½½å…¥è¿‡ç¨‹ã€‚ 7.4 è‡ªå®šä¹‰SpringIOCç°è¦å¯¹ä¸‹é¢çš„é…ç½®æ–‡ä»¶è¿›è¡Œè§£æï¼Œå¹¶è‡ªå®šä¹‰Springæ¡†æ¶çš„IOCå¯¹æ¶‰åŠåˆ°çš„å¯¹è±¡è¿›è¡Œç®¡ç†ã€‚ 1234567&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans&gt; &lt;bean id=&quot;userService&quot; class=&quot;com.itheima.service.impl.UserServiceImpl&quot;&gt; &lt;property name=&quot;userDao&quot; ref=&quot;userDao&quot;&gt;&lt;/property&gt; &lt;/bean&gt; &lt;bean id=&quot;userDao&quot; class=&quot;com.itheima.dao.impl.UserDaoImpl&quot;&gt;&lt;/bean&gt;&lt;/beans&gt; 7.4.1 å®šä¹‰beanç›¸å…³çš„pojoç±»7.4.1.1 PropertyValueç±»ç”¨äºå°è£…beançš„å±æ€§ï¼Œä½“ç°åˆ°ä¸Šé¢çš„é…ç½®æ–‡ä»¶å°±æ˜¯å°è£…beanæ ‡ç­¾çš„å­æ ‡ç­¾propertyæ ‡ç­¾æ•°æ®ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839public class PropertyValue &#123; private String name; private String ref; private String value; public PropertyValue() &#123; &#125; public PropertyValue(String name, String ref,String value) &#123; this.name = name; this.ref = ref; this.value = value; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getRef() &#123; return ref; &#125; public void setRef(String ref) &#123; this.ref = ref; &#125; public String getValue() &#123; return value; &#125; public void setValue(String value) &#123; this.value = value; &#125;&#125; 7.4.1.2 MutablePropertyValuesç±»ä¸€ä¸ªbeanæ ‡ç­¾å¯ä»¥æœ‰å¤šä¸ªpropertyå­æ ‡ç­¾ï¼Œæ‰€ä»¥å†å®šä¹‰ä¸€ä¸ªMutablePropertyValuesç±»ï¼Œç”¨æ¥å­˜å‚¨å¹¶ç®¡ç†å¤šä¸ªPropertyValueå¯¹è±¡ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public class MutablePropertyValues implements Iterable&lt;PropertyValue&gt; &#123; private final List&lt;PropertyValue&gt; propertyValueList; public MutablePropertyValues() &#123; this.propertyValueList = new ArrayList&lt;PropertyValue&gt;(); &#125; public MutablePropertyValues(List&lt;PropertyValue&gt; propertyValueList) &#123; this.propertyValueList = (propertyValueList != null ? propertyValueList : new ArrayList&lt;PropertyValue&gt;()); &#125; public PropertyValue[] getPropertyValues() &#123; return this.propertyValueList.toArray(new PropertyValue[0]); &#125; public PropertyValue getPropertyValue(String propertyName) &#123; for (PropertyValue pv : this.propertyValueList) &#123; if (pv.getName().equals(propertyName)) &#123; return pv; &#125; &#125; return null; &#125; @Override public Iterator&lt;PropertyValue&gt; iterator() &#123; return propertyValueList.iterator(); &#125; public boolean isEmpty() &#123; return this.propertyValueList.isEmpty(); &#125; public MutablePropertyValues addPropertyValue(PropertyValue pv) &#123; for (int i = 0; i &lt; this.propertyValueList.size(); i++) &#123; PropertyValue currentPv = this.propertyValueList.get(i); if (currentPv.getName().equals(pv.getName())) &#123; this.propertyValueList.set(i, new PropertyValue(pv.getName(),pv.getRef(), pv.getValue())); return this; &#125; &#125; this.propertyValueList.add(pv); return this; &#125; public boolean contains(String propertyName) &#123; return getPropertyValue(propertyName) != null; &#125;&#125; 7.4.1.3 BeanDefinitionç±»BeanDefinitionç±»ç”¨æ¥å°è£…beanä¿¡æ¯çš„ï¼Œä¸»è¦åŒ…å«idï¼ˆå³beanå¯¹è±¡çš„åç§°ï¼‰ã€classï¼ˆéœ€è¦äº¤ç”±springç®¡ç†çš„ç±»çš„å…¨ç±»åï¼‰åŠå­æ ‡ç­¾propertyæ•°æ®ã€‚ 12345678910111213141516171819202122232425262728293031323334public class BeanDefinition &#123; private String id; private String className; private MutablePropertyValues propertyValues; public BeanDefinition() &#123; propertyValues = new MutablePropertyValues(); &#125; public String getId() &#123; return id; &#125; public void setId(String id) &#123; this.id = id; &#125; public String getClassName() &#123; return className; &#125; public void setClassName(String className) &#123; this.className = className; &#125; public void setPropertyValues(MutablePropertyValues propertyValues) &#123; this.propertyValues = propertyValues; &#125; public MutablePropertyValues getPropertyValues() &#123; return propertyValues; &#125;&#125; 7.4.2 å®šä¹‰æ³¨å†Œè¡¨ç›¸å…³ç±»7.4.2.1 BeanDefinitionRegistryæ¥å£BeanDefinitionRegistryæ¥å£å®šä¹‰äº†æ³¨å†Œè¡¨çš„ç›¸å…³æ“ä½œï¼Œå®šä¹‰å¦‚ä¸‹åŠŸèƒ½ï¼š æ³¨å†ŒBeanDefinitionå¯¹è±¡åˆ°æ³¨å†Œè¡¨ä¸­ ä»æ³¨å†Œè¡¨ä¸­åˆ é™¤æŒ‡å®šåç§°çš„BeanDefinitionå¯¹è±¡ æ ¹æ®åç§°ä»æ³¨å†Œè¡¨ä¸­è·å–BeanDefinitionå¯¹è±¡ åˆ¤æ–­æ³¨å†Œè¡¨ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šåç§°çš„BeanDefinitionå¯¹è±¡ è·å–æ³¨å†Œè¡¨ä¸­BeanDefinitionå¯¹è±¡çš„ä¸ªæ•° è·å–æ³¨å†Œè¡¨ä¸­æ‰€æœ‰çš„BeanDefinitionçš„åç§° 1234567891011121314151617public interface BeanDefinitionRegistry &#123; //æ³¨å†ŒBeanDefinitionå¯¹è±¡åˆ°æ³¨å†Œè¡¨ä¸­ void registerBeanDefinition(String beanName, BeanDefinition beanDefinition); //ä»æ³¨å†Œè¡¨ä¸­åˆ é™¤æŒ‡å®šåç§°çš„BeanDefinitionå¯¹è±¡ void removeBeanDefinition(String beanName) throws Exception; //æ ¹æ®åç§°ä»æ³¨å†Œè¡¨ä¸­è·å–BeanDefinitionå¯¹è±¡ BeanDefinition getBeanDefinition(String beanName) throws Exception; boolean containsBeanDefinition(String beanName); int getBeanDefinitionCount(); String[] getBeanDefinitionNames();&#125; 7.4.2.2 SimpleBeanDefinitionRegistryç±»è¯¥ç±»å®ç°äº†BeanDefinitionRegistryæ¥å£ï¼Œå®šä¹‰äº†Mapé›†åˆä½œä¸ºæ³¨å†Œè¡¨å®¹å™¨ã€‚ 12345678910111213141516171819202122232425262728293031323334public class SimpleBeanDefinitionRegistry implements BeanDefinitionRegistry &#123; private Map&lt;String, BeanDefinition&gt; beanDefinitionMap = new HashMap&lt;String, BeanDefinition&gt;(); @Override public void registerBeanDefinition(String beanName, BeanDefinition beanDefinition) &#123; beanDefinitionMap.put(beanName,beanDefinition); &#125; @Override public void removeBeanDefinition(String beanName) throws Exception &#123; beanDefinitionMap.remove(beanName); &#125; @Override public BeanDefinition getBeanDefinition(String beanName) throws Exception &#123; return beanDefinitionMap.get(beanName); &#125; @Override public boolean containsBeanDefinition(String beanName) &#123; return beanDefinitionMap.containsKey(beanName); &#125; @Override public int getBeanDefinitionCount() &#123; return beanDefinitionMap.size(); &#125; @Override public String[] getBeanDefinitionNames() &#123; return beanDefinitionMap.keySet().toArray(new String[1]); &#125;&#125; 7.4.3 å®šä¹‰è§£æå™¨ç›¸å…³ç±»7.4.3.1 BeanDefinitionReaderæ¥å£BeanDefinitionReaderæ˜¯ç”¨æ¥è§£æé…ç½®æ–‡ä»¶å¹¶åœ¨æ³¨å†Œè¡¨ä¸­æ³¨å†Œbeançš„ä¿¡æ¯ã€‚å®šä¹‰äº†ä¸¤ä¸ªè§„èŒƒï¼š è·å–æ³¨å†Œè¡¨çš„åŠŸèƒ½ï¼Œè®©å¤–ç•Œå¯ä»¥é€šè¿‡è¯¥å¯¹è±¡è·å–æ³¨å†Œè¡¨å¯¹è±¡ã€‚ åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¹¶æ³¨å†Œbeanæ•°æ®ã€‚ 1234567public interface BeanDefinitionReader &#123; //è·å–æ³¨å†Œè¡¨å¯¹è±¡ BeanDefinitionRegistry getRegistry(); //åŠ è½½é…ç½®æ–‡ä»¶å¹¶åœ¨æ³¨å†Œè¡¨ä¸­è¿›è¡Œæ³¨å†Œ void loadBeanDefinitions(String configLocation) throws Exception;&#125; 7.4.3.2 XmlBeanDefinitionReaderç±»XmlBeanDefinitionReaderç±»æ˜¯ä¸“é—¨ç”¨æ¥è§£æxmlé…ç½®æ–‡ä»¶çš„ã€‚è¯¥ç±»å®ç°BeanDefinitionReaderæ¥å£å¹¶å®ç°æ¥å£ä¸­çš„ä¸¤ä¸ªåŠŸèƒ½ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class XmlBeanDefinitionReader implements BeanDefinitionReader &#123; private BeanDefinitionRegistry registry; public XmlBeanDefinitionReader() &#123; this.registry = new SimpleBeanDefinitionRegistry(); &#125; @Override public BeanDefinitionRegistry getRegistry() &#123; return registry; &#125; @Override public void loadBeanDefinitions(String configLocation) throws Exception &#123; InputStream is = this.getClass().getClassLoader().getResourceAsStream(configLocation); SAXReader reader = new SAXReader(); Document document = reader.read(is); Element rootElement = document.getRootElement(); //è§£æbeanæ ‡ç­¾ parseBean(rootElement); &#125; private void parseBean(Element rootElement) &#123; List&lt;Element&gt; elements = rootElement.elements(); for (Element element : elements) &#123; String id = element.attributeValue(&quot;id&quot;); String className = element.attributeValue(&quot;class&quot;); BeanDefinition beanDefinition = new BeanDefinition(); beanDefinition.setId(id); beanDefinition.setClassName(className); List&lt;Element&gt; list = element.elements(&quot;property&quot;); MutablePropertyValues mutablePropertyValues = new MutablePropertyValues(); for (Element element1 : list) &#123; String name = element1.attributeValue(&quot;name&quot;); String ref = element1.attributeValue(&quot;ref&quot;); String value = element1.attributeValue(&quot;value&quot;); PropertyValue propertyValue = new PropertyValue(name,ref,value); mutablePropertyValues.addPropertyValue(propertyValue); &#125; beanDefinition.setPropertyValues(mutablePropertyValues); registry.registerBeanDefinition(id,beanDefinition); &#125; &#125;&#125; 7.4.4 IOCå®¹å™¨ç›¸å…³ç±»7.4.4.1 BeanFactoryæ¥å£åœ¨è¯¥æ¥å£ä¸­å®šä¹‰IOCå®¹å™¨çš„ç»Ÿä¸€è§„èŒƒå³è·å–beanå¯¹è±¡ã€‚ 123456public interface BeanFactory &#123; //æ ¹æ®beanå¯¹è±¡çš„åç§°è·å–beanå¯¹è±¡ Object getBean(String name) throws Exception; //æ ¹æ®beanå¯¹è±¡çš„åç§°è·å–beanå¯¹è±¡ï¼Œå¹¶è¿›è¡Œç±»å‹è½¬æ¢ &lt;T&gt; T getBean(String name, Class&lt;? extends T&gt; clazz) throws Exception;&#125; 7.4.4.2 ApplicationContextæ¥å£è¯¥æ¥å£çš„æ‰€ä»¥çš„å­å®ç°ç±»å¯¹beanå¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯éå»¶æ—¶çš„ï¼Œæ‰€ä»¥åœ¨è¯¥æ¥å£ä¸­å®šä¹‰ refresh() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸»è¦å®Œæˆä»¥ä¸‹ä¸¤ä¸ªåŠŸèƒ½ï¼š åŠ è½½é…ç½®æ–‡ä»¶ã€‚ æ ¹æ®æ³¨å†Œè¡¨ä¸­çš„BeanDefinitionå¯¹è±¡å°è£…çš„æ•°æ®è¿›è¡Œbeanå¯¹è±¡çš„åˆ›å»ºã€‚ 1234public interface ApplicationContext extends BeanFactory &#123; //è¿›è¡Œé…ç½®æ–‡ä»¶åŠ è½½å¹¶è¿›è¡Œå¯¹è±¡åˆ›å»º void refresh() throws IllegalStateException, Exception;&#125; 7.4.4.3 AbstractApplicationContextç±» ä½œä¸ºApplicationContextæ¥å£çš„å­ç±»ï¼Œæ‰€ä»¥è¯¥ç±»ä¹Ÿæ˜¯éå»¶æ—¶åŠ è½½ï¼Œæ‰€ä»¥éœ€è¦åœ¨è¯¥ç±»ä¸­å®šä¹‰ä¸€ä¸ªMapé›†åˆï¼Œä½œä¸ºbeanå¯¹è±¡å­˜å‚¨çš„å®¹å™¨ã€‚ å£°æ˜BeanDefinitionReaderç±»å‹çš„å˜é‡ï¼Œç”¨æ¥è¿›è¡Œxmlé…ç½®æ–‡ä»¶çš„è§£æï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚ BeanDefinitionReaderç±»å‹çš„å¯¹è±¡åˆ›å»ºäº¤ç”±å­ç±»å®ç°ï¼Œå› ä¸ºåªæœ‰å­ç±»æ˜ç¡®åˆ°åº•åˆ›å»ºBeanDefinitionReaderå“ªå„¿ä¸ªå­å®ç°ç±»å¯¹è±¡ã€‚ 1234567891011121314151617181920212223242526272829public abstract class AbstractApplicationContext implements ApplicationContext &#123; protected BeanDefinitionReader beanDefinitionReader; //ç”¨æ¥å­˜å‚¨beanå¯¹è±¡çš„å®¹å™¨ keyå­˜å‚¨çš„æ˜¯beançš„idå€¼ï¼Œvalueå­˜å‚¨çš„æ˜¯beanå¯¹è±¡ protected Map&lt;String, Object&gt; singletonObjects = new HashMap&lt;String, Object&gt;(); //å­˜å‚¨é…ç½®æ–‡ä»¶çš„è·¯å¾„ protected String configLocation; public void refresh() throws IllegalStateException, Exception &#123; //åŠ è½½BeanDefinition beanDefinitionReader.loadBeanDefinitions(configLocation); //åˆå§‹åŒ–bean finishBeanInitialization(); &#125; //beançš„åˆå§‹åŒ– private void finishBeanInitialization() throws Exception &#123; BeanDefinitionRegistry registry = beanDefinitionReader.getRegistry(); String[] beanNames = registry.getBeanDefinitionNames(); for (String beanName : beanNames) &#123; BeanDefinition beanDefinition = registry.getBeanDefinition(beanName); getBean(beanName); &#125; &#125;&#125; æ³¨æ„ï¼šè¯¥ç±»finishBeanInitialization()æ–¹æ³•ä¸­è°ƒç”¨getBean()æ–¹æ³•ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚ 7.4.4.4 ClassPathXmlApplicationContextç±»è¯¥ç±»ä¸»è¦æ˜¯åŠ è½½ç±»è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œbeanå¯¹è±¡çš„åˆ›å»ºï¼Œä¸»è¦å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œåˆ›å»ºBeanDefinitionReaderå¯¹è±¡ã€‚ åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œè°ƒç”¨refresh()æ–¹æ³•ï¼Œç”¨äºè¿›è¡Œé…ç½®æ–‡ä»¶åŠ è½½ã€åˆ›å»ºbeanå¯¹è±¡å¹¶å­˜å‚¨åˆ°å®¹å™¨ä¸­ã€‚ é‡å†™çˆ¶æ¥å£ä¸­çš„getBean()æ–¹æ³•ï¼Œå¹¶å®ç°ä¾èµ–æ³¨å…¥æ“ä½œã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667public class ClassPathXmlApplicationContext extends AbstractApplicationContext&#123; public ClassPathXmlApplicationContext(String configLocation) &#123; this.configLocation = configLocation; //æ„å»ºXmlBeanDefinitionReaderå¯¹è±¡ beanDefinitionReader = new XmlBeanDefinitionReader(); try &#123; this.refresh(); &#125; catch (Exception e) &#123; &#125; &#125; //æ ¹æ®beançš„idå±æ€§å€¼è·å–beanå¯¹è±¡ @Override public Object getBean(String name) throws Exception &#123; //return singletonObjects.get(name); Object obj = singletonObjects.get(name); if(obj != null) &#123; return obj; &#125; BeanDefinitionRegistry registry = beanDefinitionReader.getRegistry(); BeanDefinition beanDefinition = registry.getBeanDefinition(name); if(beanDefinition == null) &#123; return null; &#125; String className = beanDefinition.getClassName(); Class&lt;?&gt; clazz = Class.forName(className); Object beanObj = clazz.newInstance(); MutablePropertyValues propertyValues = beanDefinition.getPropertyValues(); for (PropertyValue propertyValue : propertyValues) &#123; String propertyName = propertyValue.getName(); String value = propertyValue.getValue(); String ref = propertyValue.getRef(); if(ref != null &amp;&amp; !&quot;&quot;.equals(ref)) &#123; Object bean = getBean(ref); String methodName = StringUtils.getSetterMethodNameByFieldName(propertyName); Method[] methods = clazz.getMethods(); for (Method method : methods) &#123; if(method.getName().equals(methodName)) &#123; method.invoke(beanObj,bean); &#125; &#125; &#125; if(value != null &amp;&amp; !&quot;&quot;.equals(value)) &#123; String methodName = StringUtils.getSetterMethodNameByFieldName(propertyName); Method method = clazz.getMethod(methodName, String.class); method.invoke(beanObj,value); &#125; &#125; singletonObjects.put(name,beanObj); return beanObj; &#125; @Override public &lt;T&gt; T getBean(String name, Class&lt;? extends T&gt; clazz) throws Exception &#123; Object bean = getBean(name); if(bean != null) &#123; return clazz.cast(bean); &#125; return null; &#125;&#125; 7.4.5 è‡ªå®šä¹‰Spring IOCæ€»ç»“7.4.5.1 ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ å·¥å‚æ¨¡å¼ã€‚è¿™ä¸ªä½¿ç”¨å·¥å‚æ¨¡å¼ + é…ç½®æ–‡ä»¶çš„æ–¹å¼ã€‚ å•ä¾‹æ¨¡å¼ã€‚Spring IOCç®¡ç†çš„beanå¯¹è±¡éƒ½æ˜¯å•ä¾‹çš„ï¼Œæ­¤å¤„çš„å•ä¾‹ä¸æ˜¯é€šè¿‡æ„é€ å™¨è¿›è¡Œå•ä¾‹çš„æ§åˆ¶çš„ï¼Œè€Œæ˜¯springæ¡†æ¶å¯¹æ¯ä¸€ä¸ªbeanåªåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚AbstractApplicationContextç±»ä¸­çš„finishBeanInitialization()æ–¹æ³•è°ƒç”¨äº†å­ç±»çš„getBean()æ–¹æ³•ï¼Œå› ä¸ºgetBean()çš„å®ç°å’Œç¯å¢ƒæ¯æ¯ç›¸å…³ã€‚ è¿­ä»£å™¨æ¨¡å¼ã€‚å¯¹äºMutablePropertyValuesç±»å®šä¹‰ä½¿ç”¨åˆ°äº†è¿­ä»£å™¨æ¨¡å¼ï¼Œå› ä¸ºæ­¤ç±»å­˜å‚¨å¹¶ç®¡ç†PropertyValueå¯¹è±¡ï¼Œä¹Ÿå±äºä¸€ä¸ªå®¹å™¨ï¼Œæ‰€ä»¥ç»™è¯¥å®¹å™¨æä¾›ä¸€ä¸ªéå†æ–¹å¼ã€‚ springæ¡†æ¶å…¶å®ä½¿ç”¨åˆ°äº†å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œå¦‚AOPä½¿ç”¨åˆ°äº†ä»£ç†æ¨¡å¼ï¼Œé€‰æ‹©JDKä»£ç†æˆ–è€…CGLIBä»£ç†ä½¿ç”¨åˆ°äº†ç­–ç•¥æ¨¡å¼ï¼Œè¿˜æœ‰é€‚é…å™¨æ¨¡å¼ï¼Œè£…é¥°è€…æ¨¡å¼ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ç­‰ã€‚ 7.4.5.2 ç¬¦åˆå¤§éƒ¨åˆ†è®¾è®¡åŸåˆ™7.4.5.3 æ•´ä¸ªè®¾è®¡å’ŒSpringçš„è®¾è®¡è¿˜æ˜¯æœ‰ä¸€å®šçš„å‡ºå…¥springæ¡†æ¶åº•å±‚æ˜¯å¾ˆå¤æ‚çš„ï¼Œè¿›è¡Œäº†å¾ˆæ·±å…¥çš„å°è£…ï¼Œå¹¶å¯¹å¤–æä¾›äº†å¾ˆå¥½çš„æ‰©å±•æ€§ã€‚è€Œæˆ‘ä»¬è‡ªå®šä¹‰SpringIOCæœ‰ä»¥ä¸‹å‡ ä¸ªç›®çš„ï¼š äº†è§£Springåº•å±‚å¯¹å¯¹è±¡çš„å¤§ä½“ç®¡ç†æœºåˆ¶ã€‚ äº†è§£è®¾è®¡æ¨¡å¼åœ¨å…·ä½“çš„å¼€å‘ä¸­çš„ä½¿ç”¨ã€‚ ä»¥åå­¦ä¹ springæºç ï¼Œé€šè¿‡è¯¥æ¡ˆä¾‹çš„å®ç°ï¼Œå¯ä»¥é™ä½springå­¦ä¹ çš„å…¥é—¨æˆæœ¬ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è®¾è®¡æ¨¡å¼ï¼ˆäº”ï¼‰","slug":"è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆäº”ï¼‰","date":"2023-06-16T06:00:14.000Z","updated":"2023-06-16T06:01:14.344Z","comments":true,"path":"2023/06/16/è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆäº”ï¼‰/","link":"","permalink":"http://example.com/2023/06/16/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%BA%94%EF%BC%89/","excerpt":"","text":"6ï¼Œè¡Œä¸ºå‹æ¨¡å¼6.5 çŠ¶æ€æ¨¡å¼6.5.1 æ¦‚è¿°ã€ä¾‹ã€‘é€šè¿‡æŒ‰é’®æ¥æ§åˆ¶ä¸€ä¸ªç”µæ¢¯çš„çŠ¶æ€ï¼Œä¸€ä¸ªç”µæ¢¯æœ‰å¼€é—¨çŠ¶æ€ï¼Œå…³é—¨çŠ¶æ€ï¼Œåœæ­¢çŠ¶æ€ï¼Œè¿è¡ŒçŠ¶æ€ã€‚æ¯ä¸€ç§çŠ¶æ€æ”¹å˜ï¼Œéƒ½æœ‰å¯èƒ½è¦æ ¹æ®å…¶ä»–çŠ¶æ€æ¥æ›´æ–°å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”µæ¢¯é—¨ç°åœ¨å¤„äºè¿è¡Œæ—¶çŠ¶æ€ï¼Œå°±ä¸èƒ½è¿›è¡Œå¼€é—¨æ“ä½œï¼Œè€Œå¦‚æœç”µæ¢¯é—¨æ˜¯åœæ­¢çŠ¶æ€ï¼Œå°±å¯ä»¥æ‰§è¡Œå¼€é—¨æ“ä½œã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123public interface ILift &#123; //ç”µæ¢¯çš„4ä¸ªçŠ¶æ€ //å¼€é—¨çŠ¶æ€ public final static int OPENING_STATE = 1; //å…³é—¨çŠ¶æ€ public final static int CLOSING_STATE = 2; //è¿è¡ŒçŠ¶æ€ public final static int RUNNING_STATE = 3; //åœæ­¢çŠ¶æ€ public final static int STOPPING_STATE = 4; //è®¾ç½®ç”µæ¢¯çš„çŠ¶æ€ public void setState(int state); //ç”µæ¢¯çš„åŠ¨ä½œ public void open(); public void close(); public void run(); public void stop();&#125;public class Lift implements ILift &#123; private int state; @Override public void setState(int state) &#123; this.state = state; &#125; //æ‰§è¡Œå…³é—¨åŠ¨ä½œ @Override public void close() &#123; switch (this.state) &#123; case OPENING_STATE: System.out.println(&quot;ç”µæ¢¯å…³é—¨äº†ã€‚ã€‚ã€‚&quot;);//åªæœ‰å¼€é—¨çŠ¶æ€å¯ä»¥å…³é—­ç”µæ¢¯é—¨ï¼Œå¯ä»¥å¯¹åº”ç”µæ¢¯çŠ¶æ€è¡¨æ¥çœ‹ this.setState(CLOSING_STATE);//å…³é—¨ä¹‹åç”µæ¢¯å°±æ˜¯å…³é—­çŠ¶æ€äº† break; case CLOSING_STATE: //do nothing //å·²ç»æ˜¯å…³é—¨çŠ¶æ€ï¼Œä¸èƒ½å…³é—¨ break; case RUNNING_STATE: //do nothing //è¿è¡Œæ—¶ç”µæ¢¯é—¨æ˜¯å…³ç€çš„ï¼Œä¸èƒ½å…³é—¨ break; case STOPPING_STATE: //do nothing //åœæ­¢æ—¶ç”µæ¢¯ä¹Ÿæ˜¯å…³ç€çš„ï¼Œä¸èƒ½å…³é—¨ break; &#125; &#125; //æ‰§è¡Œå¼€é—¨åŠ¨ä½œ @Override public void open() &#123; switch (this.state) &#123; case OPENING_STATE://é—¨å·²ç»å¼€äº†ï¼Œä¸èƒ½å†å¼€é—¨äº† //do nothing break; case CLOSING_STATE://å…³é—¨çŠ¶æ€ï¼Œé—¨æ‰“å¼€: System.out.println(&quot;ç”µæ¢¯é—¨æ‰“å¼€äº†ã€‚ã€‚ã€‚&quot;); this.setState(OPENING_STATE); break; case RUNNING_STATE: //do nothing è¿è¡Œæ—¶ç”µæ¢¯ä¸èƒ½å¼€é—¨ break; case STOPPING_STATE: System.out.println(&quot;ç”µæ¢¯é—¨å¼€äº†ã€‚ã€‚ã€‚&quot;);//ç”µæ¢¯åœäº†ï¼Œå¯ä»¥å¼€é—¨äº† this.setState(OPENING_STATE); break; &#125; &#125; //æ‰§è¡Œè¿è¡ŒåŠ¨ä½œ @Override public void run() &#123; switch (this.state) &#123; case OPENING_STATE://ç”µæ¢¯ä¸èƒ½å¼€ç€é—¨å°±èµ° //do nothing break; case CLOSING_STATE://é—¨å…³äº†ï¼Œå¯ä»¥è¿è¡Œäº† System.out.println(&quot;ç”µæ¢¯å¼€å§‹è¿è¡Œäº†ã€‚ã€‚ã€‚&quot;); this.setState(RUNNING_STATE);//ç°åœ¨æ˜¯è¿è¡ŒçŠ¶æ€ break; case RUNNING_STATE: //do nothing å·²ç»æ˜¯è¿è¡ŒçŠ¶æ€äº† break; case STOPPING_STATE: System.out.println(&quot;ç”µæ¢¯å¼€å§‹è¿è¡Œäº†ã€‚ã€‚ã€‚&quot;); this.setState(RUNNING_STATE); break; &#125; &#125; //æ‰§è¡Œåœæ­¢åŠ¨ä½œ @Override public void stop() &#123; switch (this.state) &#123; case OPENING_STATE: //å¼€é—¨çš„ç”µæ¢¯å·²ç»æ˜¯æ˜¯åœæ­¢çš„äº†(æ­£å¸¸æƒ…å†µä¸‹) //do nothing break; case CLOSING_STATE://å…³é—¨æ—¶æ‰å¯ä»¥åœæ­¢ System.out.println(&quot;ç”µæ¢¯åœæ­¢äº†ã€‚ã€‚ã€‚&quot;); this.setState(STOPPING_STATE); break; case RUNNING_STATE://è¿è¡Œæ—¶å½“ç„¶å¯ä»¥åœæ­¢äº† System.out.println(&quot;ç”µæ¢¯åœæ­¢äº†ã€‚ã€‚ã€‚&quot;); this.setState(STOPPING_STATE); break; case STOPPING_STATE: //do nothing break; &#125; &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; Lift lift = new Lift(); lift.setState(ILift.STOPPING_STATE);//ç”µæ¢¯æ˜¯åœæ­¢çš„ lift.open();//å¼€é—¨ lift.close();//å…³é—¨ lift.run();//è¿è¡Œ lift.stop();//åœæ­¢ &#125;&#125; é—®é¢˜åˆ†æï¼š ä½¿ç”¨äº†å¤§é‡çš„switchâ€¦caseè¿™æ ·çš„åˆ¤æ–­ï¼ˆifâ€¦elseä¹Ÿæ˜¯ä¸€æ ·)ï¼Œä½¿ç¨‹åºçš„å¯é˜…è¯»æ€§å˜å·®ã€‚ æ‰©å±•æ€§å¾ˆå·®ã€‚å¦‚æœæ–°åŠ äº†æ–­ç”µçš„çŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸Šé¢åˆ¤æ–­é€»è¾‘ å®šä¹‰ï¼š å¯¹æœ‰çŠ¶æ€çš„å¯¹è±¡ï¼ŒæŠŠå¤æ‚çš„â€œåˆ¤æ–­é€»è¾‘â€æå–åˆ°ä¸åŒçš„çŠ¶æ€å¯¹è±¡ä¸­ï¼Œå…è®¸çŠ¶æ€å¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸ºã€‚ 6.5.2 ç»“æ„çŠ¶æ€æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚ ç¯å¢ƒï¼ˆContextï¼‰è§’è‰²ï¼šä¹Ÿç§°ä¸ºä¸Šä¸‹æ–‡ï¼Œå®ƒå®šä¹‰äº†å®¢æˆ·ç¨‹åºéœ€è¦çš„æ¥å£ï¼Œç»´æŠ¤ä¸€ä¸ªå½“å‰çŠ¶æ€ï¼Œå¹¶å°†ä¸çŠ¶æ€ç›¸å…³çš„æ“ä½œå§”æ‰˜ç»™å½“å‰çŠ¶æ€å¯¹è±¡æ¥å¤„ç†ã€‚ æŠ½è±¡çŠ¶æ€ï¼ˆStateï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨ä»¥å°è£…ç¯å¢ƒå¯¹è±¡ä¸­çš„ç‰¹å®šçŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºã€‚ å…·ä½“çŠ¶æ€ï¼ˆConcrete Stateï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡çŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºã€‚ 6.5.3 æ¡ˆä¾‹å®ç°å¯¹ä¸Šè¿°ç”µæ¢¯çš„æ¡ˆä¾‹ä½¿ç”¨çŠ¶æ€æ¨¡å¼è¿›è¡Œæ”¹è¿›ã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201//æŠ½è±¡çŠ¶æ€ç±»public abstract class LiftState &#123; //å®šä¹‰ä¸€ä¸ªç¯å¢ƒè§’è‰²ï¼Œä¹Ÿå°±æ˜¯å°è£…çŠ¶æ€çš„å˜åŒ–å¼•èµ·çš„åŠŸèƒ½å˜åŒ– protected Context context; public void setContext(Context context) &#123; this.context = context; &#125; //ç”µæ¢¯å¼€é—¨åŠ¨ä½œ public abstract void open(); //ç”µæ¢¯å…³é—¨åŠ¨ä½œ public abstract void close(); //ç”µæ¢¯è¿è¡ŒåŠ¨ä½œ public abstract void run(); //ç”µæ¢¯åœæ­¢åŠ¨ä½œ public abstract void stop();&#125;//å¼€å¯çŠ¶æ€public class OpenningState extends LiftState &#123; //å¼€å¯å½“ç„¶å¯ä»¥å…³é—­äº†ï¼Œæˆ‘å°±æƒ³æµ‹è¯•ä¸€ä¸‹ç”µæ¢¯é—¨å¼€å…³åŠŸèƒ½ @Override public void open() &#123; System.out.println(&quot;ç”µæ¢¯é—¨å¼€å¯...&quot;); &#125; @Override public void close() &#123; //çŠ¶æ€ä¿®æ”¹ super.context.setLiftState(Context.closeingState); //åŠ¨ä½œå§”æ‰˜ä¸ºCloseStateæ¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å§”æ‰˜ç»™äº†ClosingStateå­ç±»æ‰§è¡Œè¿™ä¸ªåŠ¨ä½œ super.context.getLiftState().close(); &#125; //ç”µæ¢¯é—¨ä¸èƒ½å¼€ç€å°±è·‘ï¼Œè¿™é‡Œä»€ä¹ˆä¹Ÿä¸åš @Override public void run() &#123; //do nothing &#125; //å¼€é—¨çŠ¶æ€å·²ç»æ˜¯åœæ­¢çš„äº† @Override public void stop() &#123; //do nothing &#125;&#125;//è¿è¡ŒçŠ¶æ€public class RunningState extends LiftState &#123; //è¿è¡Œçš„æ—¶å€™å¼€ç”µæ¢¯é—¨ï¼Ÿä½ ç–¯äº†ï¼ç”µæ¢¯ä¸ä¼šç»™ä½ å¼€çš„ @Override public void open() &#123; //do nothing &#125; //ç”µæ¢¯é—¨å…³é—­ï¼Ÿè¿™æ˜¯è‚¯å®šäº† @Override public void close() &#123;//è™½ç„¶å¯ä»¥å…³é—¨ï¼Œä½†è¿™ä¸ªåŠ¨ä½œä¸å½’æˆ‘æ‰§è¡Œ //do nothing &#125; //è¿™æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸‹è¦å®ç°çš„æ–¹æ³• @Override public void run() &#123; System.out.println(&quot;ç”µæ¢¯æ­£åœ¨è¿è¡Œ...&quot;); &#125; //è¿™ä¸ªäº‹ç»å¯¹æ˜¯åˆç†çš„ï¼Œå…‰è¿è¡Œä¸åœæ­¢è¿˜æœ‰è°æ•¢åšè¿™ä¸ªç”µæ¢¯ï¼Ÿï¼ä¼°è®¡åªæœ‰ä¸Šå¸äº† @Override public void stop() &#123; super.context.setLiftState(Context.stoppingState); super.context.stop(); &#125;&#125;//åœæ­¢çŠ¶æ€public class StoppingState extends LiftState &#123; //åœæ­¢çŠ¶æ€ï¼Œå¼€é—¨ï¼Œé‚£æ˜¯è¦çš„ï¼ @Override public void open() &#123; //çŠ¶æ€ä¿®æ”¹ super.context.setLiftState(Context.openningState); //åŠ¨ä½œå§”æ‰˜ä¸ºCloseStateæ¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å§”æ‰˜ç»™äº†ClosingStateå­ç±»æ‰§è¡Œè¿™ä¸ªåŠ¨ä½œ super.context.getLiftState().open(); &#125; @Override public void close() &#123;//è™½ç„¶å¯ä»¥å…³é—¨ï¼Œä½†è¿™ä¸ªåŠ¨ä½œä¸å½’æˆ‘æ‰§è¡Œ //çŠ¶æ€ä¿®æ”¹ super.context.setLiftState(Context.closeingState); //åŠ¨ä½œå§”æ‰˜ä¸ºCloseStateæ¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å§”æ‰˜ç»™äº†ClosingStateå­ç±»æ‰§è¡Œè¿™ä¸ªåŠ¨ä½œ super.context.getLiftState().close(); &#125; //åœæ­¢çŠ¶æ€å†è·‘èµ·æ¥ï¼Œæ­£å¸¸çš„å¾ˆ @Override public void run() &#123; //çŠ¶æ€ä¿®æ”¹ super.context.setLiftState(Context.runningState); //åŠ¨ä½œå§”æ‰˜ä¸ºCloseStateæ¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å§”æ‰˜ç»™äº†ClosingStateå­ç±»æ‰§è¡Œè¿™ä¸ªåŠ¨ä½œ super.context.getLiftState().run(); &#125; //åœæ­¢çŠ¶æ€æ˜¯æ€ä¹ˆå‘ç”Ÿçš„å‘¢ï¼Ÿå½“ç„¶æ˜¯åœæ­¢æ–¹æ³•æ‰§è¡Œäº† @Override public void stop() &#123; System.out.println(&quot;ç”µæ¢¯åœæ­¢äº†...&quot;); &#125;&#125;//å…³é—­çŠ¶æ€public class ClosingState extends LiftState &#123; @Override //ç”µæ¢¯é—¨å…³é—­ï¼Œè¿™æ˜¯å…³é—­çŠ¶æ€è¦å®ç°çš„åŠ¨ä½œ public void close() &#123; System.out.println(&quot;ç”µæ¢¯é—¨å…³é—­...&quot;); &#125; //ç”µæ¢¯é—¨å…³äº†å†æ‰“å¼€ï¼Œé€—ä½ ç©å‘¢ï¼Œé‚£è¿™ä¸ªå…è®¸å‘€ @Override public void open() &#123; super.context.setLiftState(Context.openningState); super.context.open(); &#125; //ç”µæ¢¯é—¨å…³äº†å°±è·‘ï¼Œè¿™æ˜¯å†æ­£å¸¸ä¸è¿‡äº† @Override public void run() &#123; super.context.setLiftState(Context.runningState); super.context.run(); &#125; //ç”µæ¢¯é—¨å…³ç€ï¼Œæˆ‘å°±ä¸æŒ‰æ¥¼å±‚ @Override public void stop() &#123; super.context.setLiftState(Context.stoppingState); super.context.stop(); &#125;&#125;//ç¯å¢ƒè§’è‰²public class Context &#123; //å®šä¹‰å‡ºæ‰€æœ‰çš„ç”µæ¢¯çŠ¶æ€ public final static OpenningState openningState = new OpenningState();//å¼€é—¨çŠ¶æ€ï¼Œè¿™æ—¶å€™ç”µæ¢¯åªèƒ½å…³é—­ public final static ClosingState closeingState = new ClosingState();//å…³é—­çŠ¶æ€ï¼Œè¿™æ—¶å€™ç”µæ¢¯å¯ä»¥è¿è¡Œã€åœæ­¢å’Œå¼€é—¨ public final static RunningState runningState = new RunningState();//è¿è¡ŒçŠ¶æ€ï¼Œè¿™æ—¶å€™ç”µæ¢¯åªèƒ½åœæ­¢ public final static StoppingState stoppingState = new StoppingState();//åœæ­¢çŠ¶æ€ï¼Œè¿™æ—¶å€™ç”µæ¢¯å¯ä»¥å¼€é—¨ã€è¿è¡Œ //å®šä¹‰ä¸€ä¸ªå½“å‰ç”µæ¢¯çŠ¶æ€ private LiftState liftState; public LiftState getLiftState() &#123; return this.liftState; &#125; public void setLiftState(LiftState liftState) &#123; //å½“å‰ç¯å¢ƒæ”¹å˜ this.liftState = liftState; //æŠŠå½“å‰çš„ç¯å¢ƒé€šçŸ¥åˆ°å„ä¸ªå®ç°ç±»ä¸­ this.liftState.setContext(this); &#125; public void open() &#123; this.liftState.open(); &#125; public void close() &#123; this.liftState.close(); &#125; public void run() &#123; this.liftState.run(); &#125; public void stop() &#123; this.liftState.stop(); &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; Context context = new Context(); context.setLiftState(new ClosingState()); context.open(); context.close(); context.run(); context.stop(); &#125;&#125; 6.5.4 ä¼˜ç¼ºç‚¹1ï¼Œä¼˜ç‚¹ï¼š å°†æ‰€æœ‰ä¸æŸä¸ªçŠ¶æ€æœ‰å…³çš„è¡Œä¸ºæ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°å¢åŠ æ–°çš„çŠ¶æ€ï¼Œåªéœ€è¦æ”¹å˜å¯¹è±¡çŠ¶æ€å³å¯æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚ å…è®¸çŠ¶æ€è½¬æ¢é€»è¾‘ä¸çŠ¶æ€å¯¹è±¡åˆæˆä¸€ä½“ï¼Œè€Œä¸æ˜¯æŸä¸€ä¸ªå·¨å¤§çš„æ¡ä»¶è¯­å¥å—ã€‚ 2ï¼Œç¼ºç‚¹ï¼š çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿç±»å’Œå¯¹è±¡çš„ä¸ªæ•°ã€‚ çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“å°†å¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚ çŠ¶æ€æ¨¡å¼å¯¹â€å¼€é—­åŸåˆ™â€çš„æ”¯æŒå¹¶ä¸å¤ªå¥½ã€‚ 6.5.5 ä½¿ç”¨åœºæ™¯ å½“ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸ºå–å†³äºå®ƒçš„çŠ¶æ€ï¼Œå¹¶ä¸”å®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶æ ¹æ®çŠ¶æ€æ”¹å˜å®ƒçš„è¡Œä¸ºæ—¶ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨çŠ¶æ€æ¨¡å¼ã€‚ ä¸€ä¸ªæ“ä½œä¸­å«æœ‰åºå¤§çš„åˆ†æ”¯ç»“æ„ï¼Œå¹¶ä¸”è¿™äº›åˆ†æ”¯å†³å®šäºå¯¹è±¡çš„çŠ¶æ€æ—¶ã€‚ 6.6 è§‚å¯Ÿè€…æ¨¡å¼6.6.1 æ¦‚è¿°å®šä¹‰ï¼š åˆè¢«ç§°ä¸ºå‘å¸ƒ-è®¢é˜…ï¼ˆPublish&#x2F;Subscribeï¼‰æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ã€‚è¿™ä¸ªä¸»é¢˜å¯¹è±¡åœ¨çŠ¶æ€å˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°è‡ªå·±ã€‚ 6.6.2 ç»“æ„åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­æœ‰å¦‚ä¸‹è§’è‰²ï¼š Subjectï¼šæŠ½è±¡ä¸»é¢˜ï¼ˆæŠ½è±¡è¢«è§‚å¯Ÿè€…ï¼‰ï¼ŒæŠ½è±¡ä¸»é¢˜è§’è‰²æŠŠæ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ä¿å­˜åœ¨ä¸€ä¸ªé›†åˆé‡Œï¼Œæ¯ä¸ªä¸»é¢˜éƒ½å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„è§‚å¯Ÿè€…ï¼ŒæŠ½è±¡ä¸»é¢˜æä¾›ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡ã€‚ ConcreteSubjectï¼šå…·ä½“ä¸»é¢˜ï¼ˆå…·ä½“è¢«è§‚å¯Ÿè€…ï¼‰ï¼Œè¯¥è§’è‰²å°†æœ‰å…³çŠ¶æ€å­˜å…¥å…·ä½“è§‚å¯Ÿè€…å¯¹è±¡ï¼Œåœ¨å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç»™æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å‘é€é€šçŸ¥ã€‚ Observerï¼šæŠ½è±¡è§‚å¯Ÿè€…ï¼Œæ˜¯è§‚å¯Ÿè€…çš„æŠ½è±¡ç±»ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæ›´æ–°æ¥å£ï¼Œä½¿å¾—åœ¨å¾—åˆ°ä¸»é¢˜æ›´æ”¹é€šçŸ¥æ—¶æ›´æ–°è‡ªå·±ã€‚ ConcrereObserverï¼šå…·ä½“è§‚å¯Ÿè€…ï¼Œå®ç°æŠ½è±¡è§‚å¯Ÿè€…å®šä¹‰çš„æ›´æ–°æ¥å£ï¼Œä»¥ä¾¿åœ¨å¾—åˆ°ä¸»é¢˜æ›´æ”¹é€šçŸ¥æ—¶æ›´æ–°è‡ªèº«çš„çŠ¶æ€ã€‚ 6.6.3 æ¡ˆä¾‹å®ç°ã€ä¾‹ã€‘å¾®ä¿¡å…¬ä¼—å· åœ¨ä½¿ç”¨å¾®ä¿¡å…¬ä¼—å·æ—¶ï¼Œå¤§å®¶éƒ½ä¼šæœ‰è¿™æ ·çš„ä½“éªŒï¼Œå½“ä½ å…³æ³¨çš„å…¬ä¼—å·ä¸­æœ‰æ–°å†…å®¹æ›´æ–°çš„è¯ï¼Œå®ƒå°±ä¼šæ¨é€ç»™å…³æ³¨å…¬ä¼—å·çš„å¾®ä¿¡ç”¨æˆ·ç«¯ã€‚æˆ‘ä»¬ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥æ¨¡æ‹Ÿè¿™æ ·çš„åœºæ™¯ï¼Œå¾®ä¿¡ç”¨æˆ·å°±æ˜¯è§‚å¯Ÿè€…ï¼Œå¾®ä¿¡å…¬ä¼—å·æ˜¯è¢«è§‚å¯Ÿè€…ï¼Œæœ‰å¤šä¸ªçš„å¾®ä¿¡ç”¨æˆ·å…³æ³¨äº†ç¨‹åºçŒ¿è¿™ä¸ªå…¬ä¼—å·ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š å®šä¹‰æŠ½è±¡è§‚å¯Ÿè€…ç±»ï¼Œé‡Œé¢å®šä¹‰ä¸€ä¸ªæ›´æ–°çš„æ–¹æ³• 123public interface Observer &#123; void update(String message);&#125; å®šä¹‰å…·ä½“è§‚å¯Ÿè€…ç±»ï¼Œå¾®ä¿¡ç”¨æˆ·æ˜¯è§‚å¯Ÿè€…ï¼Œé‡Œé¢å®ç°äº†æ›´æ–°çš„æ–¹æ³• 123456789101112public class WeixinUser implements Observer &#123; // å¾®ä¿¡ç”¨æˆ·å private String name; public WeixinUser(String name) &#123; this.name = name; &#125; @Override public void update(String message) &#123; System.out.println(name + &quot;-&quot; + message); &#125;&#125; å®šä¹‰æŠ½è±¡ä¸»é¢˜ç±»ï¼Œæä¾›äº†attachã€detachã€notifyä¸‰ä¸ªæ–¹æ³• 1234567891011public interface Subject &#123; //å¢åŠ è®¢é˜…è€… public void attach(Observer observer); //åˆ é™¤è®¢é˜…è€… public void detach(Observer observer); //é€šçŸ¥è®¢é˜…è€…æ›´æ–°æ¶ˆæ¯ public void notify(String message);&#125; å¾®ä¿¡å…¬ä¼—å·æ˜¯å…·ä½“ä¸»é¢˜ï¼ˆå…·ä½“è¢«è§‚å¯Ÿè€…ï¼‰ï¼Œé‡Œé¢å­˜å‚¨äº†è®¢é˜…è¯¥å…¬ä¼—å·çš„å¾®ä¿¡ç”¨æˆ·ï¼Œå¹¶å®ç°äº†æŠ½è±¡ä¸»é¢˜ä¸­çš„æ–¹æ³• 123456789101112131415161718192021public class SubscriptionSubject implements Subject &#123; //å‚¨å­˜è®¢é˜…å…¬ä¼—å·çš„å¾®ä¿¡ç”¨æˆ· private List&lt;Observer&gt; weixinUserlist = new ArrayList&lt;Observer&gt;(); @Override public void attach(Observer observer) &#123; weixinUserlist.add(observer); &#125; @Override public void detach(Observer observer) &#123; weixinUserlist.remove(observer); &#125; @Override public void notify(String message) &#123; for (Observer observer : weixinUserlist) &#123; observer.update(message); &#125; &#125;&#125; å®¢æˆ·ç«¯ç¨‹åº 12345678910111213141516public class Client &#123; public static void main(String[] args) &#123; SubscriptionSubject mSubscriptionSubject=new SubscriptionSubject(); //åˆ›å»ºå¾®ä¿¡ç”¨æˆ· WeixinUser user1=new WeixinUser(&quot;å­™æ‚Ÿç©º&quot;); WeixinUser user2=new WeixinUser(&quot;çŒªæ‚Ÿèƒ½&quot;); WeixinUser user3=new WeixinUser(&quot;æ²™æ‚Ÿå‡€&quot;); //è®¢é˜…å…¬ä¼—å· mSubscriptionSubject.attach(user1); mSubscriptionSubject.attach(user2); mSubscriptionSubject.attach(user3); //å…¬ä¼—å·æ›´æ–°å‘å‡ºæ¶ˆæ¯ç»™è®¢é˜…çš„å¾®ä¿¡ç”¨æˆ· mSubscriptionSubject.notify(&quot;ä¼ æ™ºé»‘é©¬çš„ä¸“æ æ›´æ–°äº†&quot;); &#125;&#125; 6.6.4 ä¼˜ç¼ºç‚¹1ï¼Œä¼˜ç‚¹ï¼š é™ä½äº†ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä¸¤è€…ä¹‹é—´æ˜¯æŠ½è±¡è€¦åˆå…³ç³»ã€‚ è¢«è§‚å¯Ÿè€…å‘é€é€šçŸ¥ï¼Œæ‰€æœ‰æ³¨å†Œçš„è§‚å¯Ÿè€…éƒ½ä¼šæ”¶åˆ°ä¿¡æ¯ã€å¯ä»¥å®ç°å¹¿æ’­æœºåˆ¶ã€‘ 2ï¼Œç¼ºç‚¹ï¼š å¦‚æœè§‚å¯Ÿè€…éå¸¸å¤šçš„è¯ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è§‚å¯Ÿè€…æ”¶åˆ°è¢«è§‚å¯Ÿè€…å‘é€çš„é€šçŸ¥ä¼šè€—æ—¶ å¦‚æœè¢«è§‚å¯Ÿè€…æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œé‚£ä¹ˆè¢«è§‚å¯Ÿè€…å‘é€é€šçŸ¥ä¼šä½¿è§‚å¯Ÿè€…å¾ªç¯è°ƒç”¨ï¼Œä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒ 6.6.5 ä½¿ç”¨åœºæ™¯ å¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ä¼šå½±å“å…¶ä»–å¯¹è±¡ã€‚ å½“ä¸€ä¸ªæŠ½è±¡æ¨¡å‹æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹é¢ä¾èµ–äºå¦ä¸€æ–¹é¢æ—¶ã€‚ 6.6.6 JDKä¸­æä¾›çš„å®ç°åœ¨ Java ä¸­ï¼Œé€šè¿‡ java.util.Observable ç±»å’Œ java.util.Observer æ¥å£å®šä¹‰äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œåªè¦å®ç°å®ƒä»¬çš„å­ç±»å°±å¯ä»¥ç¼–å†™è§‚å¯Ÿè€…æ¨¡å¼å®ä¾‹ã€‚ 1ï¼ŒObservableç±» Observable ç±»æ˜¯æŠ½è±¡ç›®æ ‡ç±»ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ï¼Œå®ƒæœ‰ä¸€ä¸ª Vector é›†åˆæˆå‘˜å˜é‡ï¼Œç”¨äºä¿å­˜æ‰€æœ‰è¦é€šçŸ¥çš„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä¸‹é¢æ¥ä»‹ç»å®ƒæœ€é‡è¦çš„ 3 ä¸ªæ–¹æ³•ã€‚ void addObserver(Observer o) æ–¹æ³•ï¼šç”¨äºå°†æ–°çš„è§‚å¯Ÿè€…å¯¹è±¡æ·»åŠ åˆ°é›†åˆä¸­ã€‚ void notifyObservers(Object arg) æ–¹æ³•ï¼šè°ƒç”¨é›†åˆä¸­çš„æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡çš„ updateæ–¹æ³•ï¼Œé€šçŸ¥å®ƒä»¬æ•°æ®å‘ç”Ÿæ”¹å˜ã€‚é€šå¸¸è¶Šæ™šåŠ å…¥é›†åˆçš„è§‚å¯Ÿè€…è¶Šå…ˆå¾—åˆ°é€šçŸ¥ã€‚ void setChange() æ–¹æ³•ï¼šç”¨æ¥è®¾ç½®ä¸€ä¸ª boolean ç±»å‹çš„å†…éƒ¨æ ‡å¿—ï¼Œæ³¨æ˜ç›®æ ‡å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–ã€‚å½“å®ƒä¸ºtrueæ—¶ï¼ŒnotifyObservers() æ‰ä¼šé€šçŸ¥è§‚å¯Ÿè€…ã€‚ 2ï¼ŒObserver æ¥å£ Observer æ¥å£æ˜¯æŠ½è±¡è§‚å¯Ÿè€…ï¼Œå®ƒç›‘è§†ç›®æ ‡å¯¹è±¡çš„å˜åŒ–ï¼Œå½“ç›®æ ‡å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§‚å¯Ÿè€…å¾—åˆ°é€šçŸ¥ï¼Œå¹¶è°ƒç”¨ update æ–¹æ³•ï¼Œè¿›è¡Œç›¸åº”çš„å·¥ä½œã€‚ ã€ä¾‹ã€‘è­¦å¯ŸæŠ“å°å· è­¦å¯ŸæŠ“å°å·ä¹Ÿå¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°ï¼Œè­¦å¯Ÿæ˜¯è§‚å¯Ÿè€…ï¼Œå°å·æ˜¯è¢«è§‚å¯Ÿè€…ã€‚ä»£ç å¦‚ä¸‹ï¼š å°å·æ˜¯ä¸€ä¸ªè¢«è§‚å¯Ÿè€…ï¼Œæ‰€ä»¥éœ€è¦ç»§æ‰¿Observableç±» 1234567891011121314151617181920212223public class Thief extends Observable &#123; private String name; public Thief(String name) &#123; this.name = name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getName() &#123; return name; &#125; public void steal() &#123; System.out.println(&quot;å°å·ï¼šæˆ‘å·ä¸œè¥¿äº†ï¼Œæœ‰æ²¡æœ‰äººæ¥æŠ“æˆ‘ï¼ï¼ï¼&quot;); super.setChanged(); //changed = true super.notifyObservers(); &#125;&#125; è­¦å¯Ÿæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œæ‰€ä»¥éœ€è¦è®©å…¶å®ç°Observeræ¥å£ 1234567891011121314151617181920public class Policemen implements Observer &#123; private String name; public Policemen(String name) &#123; this.name = name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getName() &#123; return name; &#125; @Override public void update(Observable o, Object arg) &#123; System.out.println(&quot;è­¦å¯Ÿï¼š&quot; + ((Thief) o).getName() + &quot;ï¼Œæˆ‘å·²ç»ç›¯ä½ å¾ˆä¹…äº†ï¼Œä½ å¯ä»¥ä¿æŒæ²‰é»˜ï¼Œä½†ä½ æ‰€è¯´çš„å°†æˆä¸ºå‘ˆå ‚è¯ä¾›ï¼ï¼ï¼&quot;); &#125;&#125; å®¢æˆ·ç«¯ä»£ç  123456789101112public class Client &#123; public static void main(String[] args) &#123; //åˆ›å»ºå°å·å¯¹è±¡ Thief t = new Thief(&quot;éš”å£è€ç‹&quot;); //åˆ›å»ºè­¦å¯Ÿå¯¹è±¡ Policemen p = new Policemen(&quot;å°æ&quot;); //è®©è­¦å¯Ÿç›¯ç€å°å· t.addObserver(p); //å°å·å·ä¸œè¥¿ t.steal(); &#125;&#125; 6.7 ä¸­ä»‹è€…æ¨¡å¼6.7.1 æ¦‚è¿°ä¸€èˆ¬æ¥è¯´ï¼ŒåŒäº‹ç±»ä¹‹é—´çš„å…³ç³»æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå¤šä¸ªåŒäº‹ç±»ä¹‹é—´äº’ç›¸å…³è”æ—¶ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»ä¼šå‘ˆç°ä¸ºå¤æ‚çš„ç½‘çŠ¶ç»“æ„ï¼Œè¿™æ˜¯ä¸€ç§è¿‡åº¦è€¦åˆçš„æ¶æ„ï¼Œå³ä¸åˆ©äºç±»çš„å¤ç”¨ï¼Œä¹Ÿä¸ç¨³å®šã€‚ä¾‹å¦‚åœ¨ä¸‹å·¦å›¾ä¸­ï¼Œæœ‰å…­ä¸ªåŒäº‹ç±»å¯¹è±¡ï¼Œå‡å¦‚å¯¹è±¡1å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå°†ä¼šæœ‰4ä¸ªå¯¹è±¡å—åˆ°å½±å“ã€‚å¦‚æœå¯¹è±¡2å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå°†ä¼šæœ‰5ä¸ªå¯¹è±¡å—åˆ°å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒäº‹ç±»ä¹‹é—´ç›´æ¥å…³è”çš„è®¾è®¡æ˜¯ä¸å¥½çš„ã€‚ å¦‚æœå¼•å…¥ä¸­ä»‹è€…æ¨¡å¼ï¼Œé‚£ä¹ˆåŒäº‹ç±»ä¹‹é—´çš„å…³ç³»å°†å˜ä¸ºæ˜Ÿå‹ç»“æ„ï¼Œä»ä¸‹å³å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä»»ä½•ä¸€ä¸ªç±»çš„å˜åŠ¨ï¼Œåªä¼šå½±å“çš„ç±»æœ¬èº«ï¼Œä»¥åŠä¸­ä»‹è€…ï¼Œè¿™æ ·å°±å‡å°äº†ç³»ç»Ÿçš„è€¦åˆã€‚ä¸€ä¸ªå¥½çš„è®¾è®¡ï¼Œå¿…å®šä¸ä¼šæŠŠæ‰€æœ‰çš„å¯¹è±¡å…³ç³»å¤„ç†é€»è¾‘å°è£…åœ¨æœ¬ç±»ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„ç±»æ¥ç®¡ç†é‚£äº›ä¸å±äºè‡ªå·±çš„è¡Œä¸ºã€‚ å®šä¹‰ï¼š åˆå«è°ƒåœæ¨¡å¼ï¼Œå®šä¹‰ä¸€ä¸ªä¸­ä»‹è§’è‰²æ¥å°è£…ä¸€ç³»åˆ—å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œä½¿åŸæœ‰å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ¾æ•£ï¼Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ 6.7.2 ç»“æ„ä¸­ä»‹è€…æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š æŠ½è±¡ä¸­ä»‹è€…ï¼ˆMediatorï¼‰è§’è‰²ï¼šå®ƒæ˜¯ä¸­ä»‹è€…çš„æ¥å£ï¼Œæä¾›äº†åŒäº‹å¯¹è±¡æ³¨å†Œä¸è½¬å‘åŒäº‹å¯¹è±¡ä¿¡æ¯çš„æŠ½è±¡æ–¹æ³•ã€‚ å…·ä½“ä¸­ä»‹è€…ï¼ˆConcreteMediatorï¼‰è§’è‰²ï¼šå®ç°ä¸­ä»‹è€…æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ª List æ¥ç®¡ç†åŒäº‹å¯¹è±¡ï¼Œåè°ƒå„ä¸ªåŒäº‹è§’è‰²ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œå› æ­¤å®ƒä¾èµ–äºåŒäº‹è§’è‰²ã€‚ æŠ½è±¡åŒäº‹ç±»ï¼ˆColleagueï¼‰è§’è‰²ï¼šå®šä¹‰åŒäº‹ç±»çš„æ¥å£ï¼Œä¿å­˜ä¸­ä»‹è€…å¯¹è±¡ï¼Œæä¾›åŒäº‹å¯¹è±¡äº¤äº’çš„æŠ½è±¡æ–¹æ³•ï¼Œå®ç°æ‰€æœ‰ç›¸äº’å½±å“çš„åŒäº‹ç±»çš„å…¬å…±åŠŸèƒ½ã€‚ å…·ä½“åŒäº‹ç±»ï¼ˆConcrete Colleagueï¼‰è§’è‰²ï¼šæ˜¯æŠ½è±¡åŒäº‹ç±»çš„å®ç°è€…ï¼Œå½“éœ€è¦ä¸å…¶ä»–åŒäº‹å¯¹è±¡äº¤äº’æ—¶ï¼Œç”±ä¸­ä»‹è€…å¯¹è±¡è´Ÿè´£åç»­çš„äº¤äº’ã€‚ 6.7.3 æ¡ˆä¾‹å®ç°ã€ä¾‹ã€‘ç§Ÿæˆ¿ ç°åœ¨ç§Ÿæˆ¿åŸºæœ¬éƒ½æ˜¯é€šè¿‡æˆ¿å±‹ä¸­ä»‹ï¼Œæˆ¿ä¸»å°†æˆ¿å±‹æ‰˜ç®¡ç»™æˆ¿å±‹ä¸­ä»‹ï¼Œè€Œç§Ÿæˆ¿è€…ä»æˆ¿å±‹ä¸­ä»‹è·å–æˆ¿å±‹ä¿¡æ¯ã€‚æˆ¿å±‹ä¸­ä»‹å……å½“ç§Ÿæˆ¿è€…ä¸æˆ¿å±‹æ‰€æœ‰è€…ä¹‹é—´çš„ä¸­ä»‹è€…ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101//æŠ½è±¡ä¸­ä»‹è€…public abstract class Mediator &#123; //ç”³æ˜ä¸€ä¸ªè”ç»œæ–¹æ³• public abstract void constact(String message,Person person);&#125;//æŠ½è±¡åŒäº‹ç±»public abstract class Person &#123; protected String name; protected Mediator mediator; public Person(String name,Mediator mediator)&#123; this.name = name; this.mediator = mediator; &#125;&#125;//å…·ä½“åŒäº‹ç±» æˆ¿å±‹æ‹¥æœ‰è€…public class HouseOwner extends Person &#123; public HouseOwner(String name, Mediator mediator) &#123; super(name, mediator); &#125; //ä¸ä¸­ä»‹è€…è”ç³» public void constact(String message)&#123; mediator.constact(message, this); &#125; //è·å–ä¿¡æ¯ public void getMessage(String message)&#123; System.out.println(&quot;æˆ¿ä¸»&quot; + name +&quot;è·å–åˆ°çš„ä¿¡æ¯ï¼š&quot; + message); &#125;&#125;//å…·ä½“åŒäº‹ç±» æ‰¿ç§Ÿäººpublic class Tenant extends Person &#123; public Tenant(String name, Mediator mediator) &#123; super(name, mediator); &#125; //ä¸ä¸­ä»‹è€…è”ç³» public void constact(String message)&#123; mediator.constact(message, this); &#125; //è·å–ä¿¡æ¯ public void getMessage(String message)&#123; System.out.println(&quot;ç§Ÿæˆ¿è€…&quot; + name +&quot;è·å–åˆ°çš„ä¿¡æ¯ï¼š&quot; + message); &#125;&#125;//ä¸­ä»‹æœºæ„public class MediatorStructure extends Mediator &#123; //é¦–å…ˆä¸­ä»‹ç»“æ„å¿…é¡»çŸ¥é“æ‰€æœ‰æˆ¿ä¸»å’Œç§Ÿæˆ¿è€…çš„ä¿¡æ¯ private HouseOwner houseOwner; private Tenant tenant; public HouseOwner getHouseOwner() &#123; return houseOwner; &#125; public void setHouseOwner(HouseOwner houseOwner) &#123; this.houseOwner = houseOwner; &#125; public Tenant getTenant() &#123; return tenant; &#125; public void setTenant(Tenant tenant) &#123; this.tenant = tenant; &#125; public void constact(String message, Person person) &#123; if (person == houseOwner) &#123; //å¦‚æœæ˜¯æˆ¿ä¸»ï¼Œåˆ™ç§Ÿæˆ¿è€…è·å¾—ä¿¡æ¯ tenant.getMessage(message); &#125; else &#123; //åæ­£åˆ™æ˜¯æˆ¿ä¸»è·å¾—ä¿¡æ¯ houseOwner.getMessage(message); &#125; &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; //ä¸€ä¸ªæˆ¿ä¸»ã€ä¸€ä¸ªç§Ÿæˆ¿è€…ã€ä¸€ä¸ªä¸­ä»‹æœºæ„ MediatorStructure mediator = new MediatorStructure(); //æˆ¿ä¸»å’Œç§Ÿæˆ¿è€…åªéœ€è¦çŸ¥é“ä¸­ä»‹æœºæ„å³å¯ HouseOwner houseOwner = new HouseOwner(&quot;å¼ ä¸‰&quot;, mediator); Tenant tenant = new Tenant(&quot;æå››&quot;, mediator); //ä¸­ä»‹ç»“æ„è¦çŸ¥é“æˆ¿ä¸»å’Œç§Ÿæˆ¿è€… mediator.setHouseOwner(houseOwner); mediator.setTenant(tenant); tenant.constact(&quot;éœ€è¦ç§Ÿä¸‰å®¤çš„æˆ¿å­&quot;); houseOwner.constact(&quot;æˆ‘è¿™æœ‰ä¸‰å®¤çš„æˆ¿å­ï¼Œä½ éœ€è¦ç§Ÿå—ï¼Ÿ&quot;); &#125;&#125; 6.7.4 ä¼˜ç¼ºç‚¹1ï¼Œä¼˜ç‚¹ï¼š æ¾æ•£è€¦åˆ ä¸­ä»‹è€…æ¨¡å¼é€šè¿‡æŠŠå¤šä¸ªåŒäº‹å¯¹è±¡ä¹‹é—´çš„äº¤äº’å°è£…åˆ°ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢ï¼Œä»è€Œä½¿å¾—åŒäº‹å¯¹è±¡ä¹‹é—´æ¾æ•£è€¦åˆï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åšåˆ°äº’è¡¥ä¾èµ–ã€‚è¿™æ ·ä¸€æ¥ï¼ŒåŒäº‹å¯¹è±¡å°±å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–å’Œå¤ç”¨ï¼Œè€Œä¸å†åƒä»¥å‰é‚£æ ·â€œç‰µä¸€å¤„è€ŒåŠ¨å…¨èº«â€äº†ã€‚ é›†ä¸­æ§åˆ¶äº¤äº’ å¤šä¸ªåŒäº‹å¯¹è±¡çš„äº¤äº’ï¼Œè¢«å°è£…åœ¨ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢é›†ä¸­ç®¡ç†ï¼Œä½¿å¾—è¿™äº›äº¤äº’è¡Œä¸ºå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œåªéœ€è¦ä¿®æ”¹ä¸­ä»‹è€…å¯¹è±¡å°±å¯ä»¥äº†ï¼Œå½“ç„¶å¦‚æœæ˜¯å·²ç»åšå¥½çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆå°±æ‰©å±•ä¸­ä»‹è€…å¯¹è±¡ï¼Œè€Œå„ä¸ªåŒäº‹ç±»ä¸éœ€è¦åšä¿®æ”¹ã€‚ ä¸€å¯¹å¤šå…³è”è½¬å˜ä¸ºä¸€å¯¹ä¸€çš„å…³è” æ²¡æœ‰ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼çš„æ—¶å€™ï¼ŒåŒäº‹å¯¹è±¡ä¹‹é—´çš„å…³ç³»é€šå¸¸æ˜¯ä¸€å¯¹å¤šçš„ï¼Œå¼•å…¥ä¸­ä»‹è€…å¯¹è±¡ä»¥åï¼Œä¸­ä»‹è€…å¯¹è±¡å’ŒåŒäº‹å¯¹è±¡çš„å…³ç³»é€šå¸¸å˜æˆåŒå‘çš„ä¸€å¯¹ä¸€ï¼Œè¿™ä¼šè®©å¯¹è±¡çš„å…³ç³»æ›´å®¹æ˜“ç†è§£å’Œå®ç°ã€‚ 2ï¼Œç¼ºç‚¹ï¼š å½“åŒäº‹ç±»å¤ªå¤šæ—¶ï¼Œä¸­ä»‹è€…çš„èŒè´£å°†å¾ˆå¤§ï¼Œå®ƒä¼šå˜å¾—å¤æ‚è€Œåºå¤§ï¼Œä»¥è‡³äºç³»ç»Ÿéš¾ä»¥ç»´æŠ¤ã€‚ 6.7.5 ä½¿ç”¨åœºæ™¯ ç³»ç»Ÿä¸­å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤æ‚çš„å¼•ç”¨å…³ç³»ï¼Œç³»ç»Ÿç»“æ„æ··ä¹±ä¸”éš¾ä»¥ç†è§£ã€‚ å½“æƒ³åˆ›å»ºä¸€ä¸ªè¿è¡Œäºå¤šä¸ªç±»ä¹‹é—´çš„å¯¹è±¡ï¼Œåˆä¸æƒ³ç”Ÿæˆæ–°çš„å­ç±»æ—¶ã€‚ 6.8 è¿­ä»£å™¨æ¨¡å¼6.8.1 æ¦‚è¿°å®šä¹‰ï¼š æä¾›ä¸€ä¸ªå¯¹è±¡æ¥é¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­çš„ä¸€ç³»åˆ—æ•°æ®ï¼Œè€Œä¸æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚ 6.8.2 ç»“æ„è¿­ä»£å™¨æ¨¡å¼ä¸»è¦åŒ…å«ä»¥ä¸‹è§’è‰²ï¼š æŠ½è±¡èšåˆï¼ˆAggregateï¼‰è§’è‰²ï¼šå®šä¹‰å­˜å‚¨ã€æ·»åŠ ã€åˆ é™¤èšåˆå…ƒç´ ä»¥åŠåˆ›å»ºè¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ã€‚ å…·ä½“èšåˆï¼ˆConcreteAggregateï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡èšåˆç±»ï¼Œè¿”å›ä¸€ä¸ªå…·ä½“è¿­ä»£å™¨çš„å®ä¾‹ã€‚ æŠ½è±¡è¿­ä»£å™¨ï¼ˆIteratorï¼‰è§’è‰²ï¼šå®šä¹‰è®¿é—®å’Œéå†èšåˆå…ƒç´ çš„æ¥å£ï¼Œé€šå¸¸åŒ…å« hasNext()ã€next() ç­‰æ–¹æ³•ã€‚ å…·ä½“è¿­ä»£å™¨ï¼ˆConcretelteratorï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡è¿­ä»£å™¨æ¥å£ä¸­æ‰€å®šä¹‰çš„æ–¹æ³•ï¼Œå®Œæˆå¯¹èšåˆå¯¹è±¡çš„éå†ï¼Œè®°å½•éå†çš„å½“å‰ä½ç½®ã€‚ 6.8.3 æ¡ˆä¾‹å®ç°ã€ä¾‹ã€‘å®šä¹‰ä¸€ä¸ªå¯ä»¥å­˜å‚¨å­¦ç”Ÿå¯¹è±¡çš„å®¹å™¨å¯¹è±¡ï¼Œå°†éå†è¯¥å®¹å™¨çš„åŠŸèƒ½äº¤ç”±è¿­ä»£å™¨å®ç°ï¼Œæ¶‰åŠåˆ°çš„ç±»å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š å®šä¹‰è¿­ä»£å™¨æ¥å£ï¼Œå£°æ˜hasNextã€nextæ–¹æ³• 1234public interface StudentIterator &#123; boolean hasNext(); Student next();&#125; å®šä¹‰å…·ä½“çš„è¿­ä»£å™¨ç±»ï¼Œé‡å†™æ‰€æœ‰çš„æŠ½è±¡æ–¹æ³• 1234567891011121314151617181920public class StudentIteratorImpl implements StudentIterator &#123; private List&lt;Student&gt; list; private int position = 0; public StudentIteratorImpl(List&lt;Student&gt; list) &#123; this.list = list; &#125; @Override public boolean hasNext() &#123; return position &lt; list.size(); &#125; @Override public Student next() &#123; Student currentStudent = list.get(position); position ++; return currentStudent; &#125;&#125; å®šä¹‰æŠ½è±¡å®¹å™¨ç±»ï¼ŒåŒ…å«æ·»åŠ å…ƒç´ ï¼Œåˆ é™¤å…ƒç´ ï¼Œè·å–è¿­ä»£å™¨å¯¹è±¡çš„æ–¹æ³• 1234567public interface StudentAggregate &#123; void addStudent(Student student); void removeStudent(Student student); StudentIterator getStudentIterator();&#125; å®šä¹‰å…·ä½“çš„å®¹å™¨ç±»ï¼Œé‡å†™æ‰€æœ‰çš„æ–¹æ³• 12345678910111213141516171819public class StudentAggregateImpl implements StudentAggregate &#123; private List&lt;Student&gt; list = new ArrayList&lt;Student&gt;(); // å­¦ç”Ÿåˆ—è¡¨ @Override public void addStudent(Student student) &#123; this.list.add(student); &#125; @Override public void removeStudent(Student student) &#123; this.list.remove(student); &#125; @Override public StudentIterator getStudentIterator() &#123; return new StudentIteratorImpl(list); &#125;&#125; 6.8.4 ä¼˜ç¼ºç‚¹1ï¼Œä¼˜ç‚¹ï¼š å®ƒæ”¯æŒä»¥ä¸åŒçš„æ–¹å¼éå†ä¸€ä¸ªèšåˆå¯¹è±¡ï¼Œåœ¨åŒä¸€ä¸ªèšåˆå¯¹è±¡ä¸Šå¯ä»¥å®šä¹‰å¤šç§éå†æ–¹å¼ã€‚åœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­åªéœ€è¦ç”¨ä¸€ä¸ªä¸åŒçš„è¿­ä»£å™¨æ¥æ›¿æ¢åŸæœ‰è¿­ä»£å™¨å³å¯æ”¹å˜éå†ç®—æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰è¿­ä»£å™¨çš„å­ç±»ä»¥æ”¯æŒæ–°çš„éå†æ–¹å¼ã€‚ è¿­ä»£å™¨ç®€åŒ–äº†èšåˆç±»ã€‚ç”±äºå¼•å…¥äº†è¿­ä»£å™¨ï¼Œåœ¨åŸæœ‰çš„èšåˆå¯¹è±¡ä¸­ä¸éœ€è¦å†è‡ªè¡Œæä¾›æ•°æ®éå†ç­‰æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–èšåˆç±»çš„è®¾è®¡ã€‚ åœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­ï¼Œç”±äºå¼•å…¥äº†æŠ½è±¡å±‚ï¼Œå¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ï¼Œæ»¡è¶³ â€œå¼€é—­åŸåˆ™â€ çš„è¦æ±‚ã€‚ 2ï¼Œç¼ºç‚¹ï¼š å¢åŠ äº†ç±»çš„ä¸ªæ•°ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚ 6.8.5 ä½¿ç”¨åœºæ™¯ å½“éœ€è¦ä¸ºèšåˆå¯¹è±¡æä¾›å¤šç§éå†æ–¹å¼æ—¶ã€‚ å½“éœ€è¦ä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ—¶ã€‚ å½“è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— é¡»æš´éœ²å…¶å†…éƒ¨ç»†èŠ‚çš„è¡¨ç¤ºæ—¶ã€‚ 6.8.6 JDKæºç è§£æè¿­ä»£å™¨æ¨¡å¼åœ¨JAVAçš„å¾ˆå¤šé›†åˆç±»ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹JAVAæºç ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼çš„ã€‚ 12345List&lt;String&gt; list = new ArrayList&lt;&gt;();Iterator&lt;String&gt; iterator = list.iterator(); //list.iterator()æ–¹æ³•è¿”å›çš„è‚¯å®šæ˜¯Iteratoræ¥å£çš„å­å®ç°ç±»å¯¹è±¡while (iterator.hasNext()) &#123; System.out.println(iterator.next());&#125; çœ‹å®Œè¿™æ®µä»£ç æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä¸æˆ‘ä»¬ä¸Šé¢ä»£ç åŸºæœ¬ç±»ä¼¼ã€‚å•åˆ—é›†åˆéƒ½ä½¿ç”¨åˆ°äº†è¿­ä»£å™¨ï¼Œæˆ‘ä»¬ä»¥ArrayListä¸¾ä¾‹æ¥è¯´æ˜ Listï¼šæŠ½è±¡èšåˆç±» ArrayListï¼šå…·ä½“çš„èšåˆç±» Iteratorï¼šæŠ½è±¡è¿­ä»£å™¨ list.iterator()ï¼šè¿”å›çš„æ˜¯å®ç°äº† Iterator æ¥å£çš„å…·ä½“è¿­ä»£å™¨å¯¹è±¡ å…·ä½“çš„æ¥çœ‹çœ‹ ArrayListçš„ä»£ç å®ç° 123456789101112131415161718192021222324252627282930313233public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable &#123; public Iterator&lt;E&gt; iterator() &#123; return new Itr(); &#125; private class Itr implements Iterator&lt;E&gt; &#123; int cursor; // ä¸‹ä¸€ä¸ªè¦è¿”å›å…ƒç´ çš„ç´¢å¼• int lastRet = -1; // ä¸Šä¸€ä¸ªè¿”å›å…ƒç´ çš„ç´¢å¼• int expectedModCount = modCount; Itr() &#123;&#125; //åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å…ƒç´  public boolean hasNext() &#123; return cursor != size; &#125; //è·å–ä¸‹ä¸€ä¸ªå…ƒç´  public E next() &#123; checkForComodification(); int i = cursor; if (i &gt;= size) throw new NoSuchElementException(); Object[] elementData = ArrayList.this.elementData; if (i &gt;= elementData.length) throw new ConcurrentModificationException(); cursor = i + 1; return (E) elementData[lastRet = i]; &#125; ...&#125; è¿™éƒ¨åˆ†ä»£ç è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œå¤§è‡´å°±æ˜¯åœ¨ iterator æ–¹æ³•ä¸­è¿”å›äº†ä¸€ä¸ªå®ä¾‹åŒ–çš„ Iterator å¯¹è±¡ã€‚Itræ˜¯ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ƒå®ç°äº† Iterator æ¥å£å¹¶é‡å†™äº†å…¶ä¸­çš„æŠ½è±¡æ–¹æ³•ã€‚ æ³¨æ„ï¼š â€‹ å½“æˆ‘ä»¬åœ¨ä½¿ç”¨JAVAå¼€å‘çš„æ—¶å€™ï¼Œæƒ³ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼çš„è¯ï¼Œåªè¦è®©æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å®¹å™¨ç±»å®ç°java.util.Iterableå¹¶å®ç°å…¶ä¸­çš„iterator()æ–¹æ³•ä½¿å…¶è¿”å›ä¸€ä¸ª java.util.Iterator çš„å®ç°ç±»å°±å¯ä»¥äº†ã€‚ 6.9 è®¿é—®è€…æ¨¡å¼6.9.1 æ¦‚è¿°å®šä¹‰ï¼š å°è£…ä¸€äº›ä½œç”¨äºæŸç§æ•°æ®ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œï¼Œå®ƒå¯ä»¥åœ¨ä¸æ”¹å˜è¿™ä¸ªæ•°æ®ç»“æ„çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œã€‚ 6.9.2 ç»“æ„è®¿é—®è€…æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²: æŠ½è±¡è®¿é—®è€…ï¼ˆVisitorï¼‰è§’è‰²ï¼šå®šä¹‰äº†å¯¹æ¯ä¸€ä¸ªå…ƒç´ ï¼ˆElementï¼‰è®¿é—®çš„è¡Œä¸ºï¼Œå®ƒçš„å‚æ•°å°±æ˜¯å¯ä»¥è®¿é—®çš„å…ƒç´ ï¼Œå®ƒçš„æ–¹æ³•ä¸ªæ•°ç†è®ºä¸Šæ¥è®²ä¸å…ƒç´ ç±»ä¸ªæ•°ï¼ˆElementçš„å®ç°ç±»ä¸ªæ•°ï¼‰æ˜¯ä¸€æ ·çš„ï¼Œä»è¿™ç‚¹ä¸éš¾çœ‹å‡ºï¼Œè®¿é—®è€…æ¨¡å¼è¦æ±‚å…ƒç´ ç±»çš„ä¸ªæ•°ä¸èƒ½æ”¹å˜ã€‚ å…·ä½“è®¿é—®è€…ï¼ˆConcreteVisitorï¼‰è§’è‰²ï¼šç»™å‡ºå¯¹æ¯ä¸€ä¸ªå…ƒç´ ç±»è®¿é—®æ—¶æ‰€äº§ç”Ÿçš„å…·ä½“è¡Œä¸ºã€‚ æŠ½è±¡å…ƒç´ ï¼ˆElementï¼‰è§’è‰²ï¼šå®šä¹‰äº†ä¸€ä¸ªæ¥å—è®¿é—®è€…çš„æ–¹æ³•ï¼ˆacceptï¼‰ï¼Œå…¶æ„ä¹‰æ˜¯æŒ‡ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½è¦å¯ä»¥è¢«è®¿é—®è€…è®¿é—®ã€‚ å…·ä½“å…ƒç´ ï¼ˆConcreteElementï¼‰è§’è‰²ï¼š æä¾›æ¥å—è®¿é—®æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œè€Œè¿™ä¸ªå…·ä½“çš„å®ç°ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ä½¿ç”¨è®¿é—®è€…æä¾›çš„è®¿é—®è¯¥å…ƒç´ ç±»çš„æ–¹æ³•ã€‚ å¯¹è±¡ç»“æ„ï¼ˆObject Structureï¼‰è§’è‰²ï¼šå®šä¹‰å½“ä¸­æ‰€æåˆ°çš„å¯¹è±¡ç»“æ„ï¼Œå¯¹è±¡ç»“æ„æ˜¯ä¸€ä¸ªæŠ½è±¡è¡¨è¿°ï¼Œå…·ä½“ç‚¹å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå…·æœ‰å®¹å™¨æ€§è´¨æˆ–è€…å¤åˆå¯¹è±¡ç‰¹æ€§çš„ç±»ï¼Œå®ƒä¼šå«æœ‰ä¸€ç»„å…ƒç´ ï¼ˆElementï¼‰ï¼Œå¹¶ä¸”å¯ä»¥è¿­ä»£è¿™äº›å…ƒç´ ï¼Œä¾›è®¿é—®è€…è®¿é—®ã€‚ 6.9.3 æ¡ˆä¾‹å®ç°ã€ä¾‹ã€‘ç»™å® ç‰©å–‚é£Ÿ ç°åœ¨å…»å® ç‰©çš„äººç‰¹åˆ«å¤šï¼Œæˆ‘ä»¬å°±ä»¥è¿™ä¸ªä¸ºä¾‹ï¼Œå½“ç„¶å® ç‰©è¿˜åˆ†ä¸ºç‹—ï¼ŒçŒ«ç­‰ï¼Œè¦ç»™å® ç‰©å–‚é£Ÿçš„è¯ï¼Œä¸»äººå¯ä»¥å–‚ï¼Œå…¶ä»–äººä¹Ÿå¯ä»¥å–‚é£Ÿã€‚ è®¿é—®è€…è§’è‰²ï¼šç»™å® ç‰©å–‚é£Ÿçš„äºº å…·ä½“è®¿é—®è€…è§’è‰²ï¼šä¸»äººã€å…¶ä»–äºº æŠ½è±¡å…ƒç´ è§’è‰²ï¼šåŠ¨ç‰©æŠ½è±¡ç±» å…·ä½“å…ƒç´ è§’è‰²ï¼šå® ç‰©ç‹—ã€å® ç‰©çŒ« ç»“æ„å¯¹è±¡è§’è‰²ï¼šä¸»äººå®¶ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š åˆ›å»ºæŠ½è±¡è®¿é—®è€…æ¥å£ 12345public interface Person &#123; void feed(Cat cat); void feed(Dog dog);&#125; åˆ›å»ºä¸åŒçš„å…·ä½“è®¿é—®è€…è§’è‰²ï¼ˆä¸»äººå’Œå…¶ä»–äººï¼‰ï¼Œéƒ½éœ€è¦å®ç° Personæ¥å£ 123456789101112131415161718192021222324public class Owner implements Person &#123; @Override public void feed(Cat cat) &#123; System.out.println(&quot;ä¸»äººå–‚é£ŸçŒ«&quot;); &#125; @Override public void feed(Dog dog) &#123; System.out.println(&quot;ä¸»äººå–‚é£Ÿç‹—&quot;); &#125;&#125;public class Someone implements Person &#123; @Override public void feed(Cat cat) &#123; System.out.println(&quot;å…¶ä»–äººå–‚é£ŸçŒ«&quot;); &#125; @Override public void feed(Dog dog) &#123; System.out.println(&quot;å…¶ä»–äººå–‚é£Ÿç‹—&quot;); &#125;&#125; å®šä¹‰æŠ½è±¡èŠ‚ç‚¹ â€“ å® ç‰© 123public interface Animal &#123; void accept(Person person);&#125; å®šä¹‰å®ç°Animalæ¥å£çš„ å…·ä½“èŠ‚ç‚¹ï¼ˆå…ƒç´ ï¼‰ 1234567891011121314151617public class Dog implements Animal &#123; @Override public void accept(Person person) &#123; person.feed(this); System.out.println(&quot;å¥½å¥½åƒï¼Œæ±ªæ±ªæ±ªï¼ï¼ï¼&quot;); &#125;&#125;public class Cat implements Animal &#123; @Override public void accept(Person person) &#123; person.feed(this); System.out.println(&quot;å¥½å¥½åƒï¼Œå–µå–µå–µï¼ï¼ï¼&quot;); &#125;&#125; å®šä¹‰å¯¹è±¡ç»“æ„ï¼Œæ­¤æ¡ˆä¾‹ä¸­å°±æ˜¯ä¸»äººçš„å®¶ 123456789101112131415public class Home &#123; private List&lt;Animal&gt; nodeList = new ArrayList&lt;Animal&gt;(); public void action(Person person) &#123; for (Animal node : nodeList) &#123; node.accept(person); &#125; &#125; //æ·»åŠ æ“ä½œ public void add(Animal animal) &#123; nodeList.add(animal); &#125;&#125; æµ‹è¯•ç±» 12345678910111213public class Client &#123; public static void main(String[] args) &#123; Home home = new Home(); home.add(new Dog()); home.add(new Cat()); Owner owner = new Owner(); home.action(owner); Someone someone = new Someone(); home.action(someone); &#125;&#125; 6.9.4 ä¼˜ç¼ºç‚¹1ï¼Œä¼˜ç‚¹ï¼š æ‰©å±•æ€§å¥½ åœ¨ä¸ä¿®æ”¹å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚ å¤ç”¨æ€§å¥½ é€šè¿‡è®¿é—®è€…æ¥å®šä¹‰æ•´ä¸ªå¯¹è±¡ç»“æ„é€šç”¨çš„åŠŸèƒ½ï¼Œä»è€Œæé«˜å¤ç”¨ç¨‹åº¦ã€‚ åˆ†ç¦»æ— å…³è¡Œä¸º é€šè¿‡è®¿é—®è€…æ¥åˆ†ç¦»æ— å…³çš„è¡Œä¸ºï¼ŒæŠŠç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªè®¿é—®è€…ï¼Œè¿™æ ·æ¯ä¸€ä¸ªè®¿é—®è€…çš„åŠŸèƒ½éƒ½æ¯”è¾ƒå•ä¸€ã€‚ 2ï¼Œç¼ºç‚¹ï¼š å¯¹è±¡ç»“æ„å˜åŒ–å¾ˆå›°éš¾ åœ¨è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œæ¯å¢åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ç±»ï¼Œéƒ½è¦åœ¨æ¯ä¸€ä¸ªå…·ä½“è®¿é—®è€…ç±»ä¸­å¢åŠ ç›¸åº”çš„å…·ä½“æ“ä½œï¼Œè¿™è¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚ è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ è®¿é—®è€…æ¨¡å¼ä¾èµ–äº†å…·ä½“ç±»ï¼Œè€Œæ²¡æœ‰ä¾èµ–æŠ½è±¡ç±»ã€‚ 6.9.5 ä½¿ç”¨åœºæ™¯ å¯¹è±¡ç»“æ„ç›¸å¯¹ç¨³å®šï¼Œä½†å…¶æ“ä½œç®—æ³•ç»å¸¸å˜åŒ–çš„ç¨‹åºã€‚ å¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡éœ€è¦æä¾›å¤šç§ä¸åŒä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œä¸”è¦é¿å…è®©è¿™äº›æ“ä½œçš„å˜åŒ–å½±å“å¯¹è±¡çš„ç»“æ„ã€‚ 6.9.6 æ‰©å±•è®¿é—®è€…æ¨¡å¼ç”¨åˆ°äº†ä¸€ç§åŒåˆ†æ´¾çš„æŠ€æœ¯ã€‚ 1ï¼Œåˆ†æ´¾ï¼š å˜é‡è¢«å£°æ˜æ—¶çš„ç±»å‹å«åšå˜é‡çš„é™æ€ç±»å‹ï¼Œæœ‰äº›äººåˆæŠŠé™æ€ç±»å‹å«åšæ˜æ˜¾ç±»å‹ï¼›è€Œå˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡çš„çœŸå®ç±»å‹åˆå«åšå˜é‡çš„å®é™…ç±»å‹ã€‚æ¯”å¦‚ Map map = new HashMap() ï¼Œmapå˜é‡çš„é™æ€ç±»å‹æ˜¯ Map ï¼Œå®é™…ç±»å‹æ˜¯ HashMap ã€‚æ ¹æ®å¯¹è±¡çš„ç±»å‹è€Œå¯¹æ–¹æ³•è¿›è¡Œçš„é€‰æ‹©ï¼Œå°±æ˜¯åˆ†æ´¾(Dispatch)ï¼Œåˆ†æ´¾(Dispatch)åˆåˆ†ä¸ºä¸¤ç§ï¼Œå³é™æ€åˆ†æ´¾å’ŒåŠ¨æ€åˆ†æ´¾ã€‚ é™æ€åˆ†æ´¾(Static Dispatch) å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶æœŸï¼Œåˆ†æ´¾æ ¹æ®é™æ€ç±»å‹ä¿¡æ¯å‘ç”Ÿã€‚é™æ€åˆ†æ´¾å¯¹äºæˆ‘ä»¬æ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œæ–¹æ³•é‡è½½å°±æ˜¯é™æ€åˆ†æ´¾ã€‚ åŠ¨æ€åˆ†æ´¾(Dynamic Dispatch) å‘ç”Ÿåœ¨è¿è¡Œæ—¶æœŸï¼ŒåŠ¨æ€åˆ†æ´¾åŠ¨æ€åœ°ç½®æ¢æ‰æŸä¸ªæ–¹æ³•ã€‚Javaé€šè¿‡æ–¹æ³•çš„é‡å†™æ”¯æŒåŠ¨æ€åˆ†æ´¾ã€‚ 2ï¼ŒåŠ¨æ€åˆ†æ´¾ï¼š é€šè¿‡æ–¹æ³•çš„é‡å†™æ”¯æŒåŠ¨æ€åˆ†æ´¾ã€‚ 1234567891011121314151617181920212223242526272829public class Animal &#123; public void execute() &#123; System.out.println(&quot;Animal&quot;); &#125;&#125;public class Dog extends Animal &#123; @Override public void execute() &#123; System.out.println(&quot;dog&quot;); &#125;&#125;public class Cat extends Animal &#123; @Override public void execute() &#123; System.out.println(&quot;cat&quot;); &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; Animal a = new Dog(); a.execute(); Animal a1 = new Cat(); a1.execute(); &#125;&#125; ä¸Šé¢ä»£ç çš„ç»“æœå¤§å®¶åº”è¯¥ç›´æ¥å¯ä»¥è¯´å‡ºæ¥ï¼Œè¿™ä¸å°±æ˜¯å¤šæ€å—ï¼è¿è¡Œæ‰§è¡Œçš„æ˜¯å­ç±»ä¸­çš„æ–¹æ³•ã€‚ Javaç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æœŸå¹¶ä¸æ€»æ˜¯çŸ¥é“å“ªäº›ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºç¼–è¯‘å™¨ä»…ä»…çŸ¥é“å¯¹è±¡çš„é™æ€ç±»å‹ï¼Œè€Œä¸çŸ¥é“å¯¹è±¡çš„çœŸå®ç±»å‹ï¼›è€Œæ–¹æ³•çš„è°ƒç”¨åˆ™æ˜¯æ ¹æ®å¯¹è±¡çš„çœŸå®ç±»å‹ï¼Œè€Œä¸æ˜¯é™æ€ç±»å‹ã€‚ 3ï¼Œé™æ€åˆ†æ´¾ï¼š é€šè¿‡æ–¹æ³•é‡è½½æ”¯æŒé™æ€åˆ†æ´¾ã€‚ 1234567891011121314151617181920212223242526272829303132333435public class Animal &#123;&#125;public class Dog extends Animal &#123;&#125;public class Cat extends Animal &#123;&#125;public class Execute &#123; public void execute(Animal a) &#123; System.out.println(&quot;Animal&quot;); &#125; public void execute(Dog d) &#123; System.out.println(&quot;dog&quot;); &#125; public void execute(Cat c) &#123; System.out.println(&quot;cat&quot;); &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; Animal a = new Animal(); Animal a1 = new Dog(); Animal a2 = new Cat(); Execute exe = new Execute(); exe.execute(a); exe.execute(a1); exe.execute(a2); &#125;&#125; è¿è¡Œç»“æœï¼š è¿™ä¸ªç»“æœå¯èƒ½å‡ºä¹ä¸€äº›äººçš„æ„æ–™äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ é‡è½½æ–¹æ³•çš„åˆ†æ´¾æ˜¯æ ¹æ®é™æ€ç±»å‹è¿›è¡Œçš„ï¼Œè¿™ä¸ªåˆ†æ´¾è¿‡ç¨‹åœ¨ç¼–è¯‘æ—¶æœŸå°±å®Œæˆäº†ã€‚ 4ï¼ŒåŒåˆ†æ´¾ï¼š æ‰€è°“åŒåˆ†æ´¾æŠ€æœ¯å°±æ˜¯åœ¨é€‰æ‹©ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¸ä»…ä»…è¦æ ¹æ®æ¶ˆæ¯æ¥æ”¶è€…ï¼ˆreceiverï¼‰çš„è¿è¡Œæ—¶åŒºåˆ«ï¼Œè¿˜è¦æ ¹æ®å‚æ•°çš„è¿è¡Œæ—¶åŒºåˆ«ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class Animal &#123; public void accept(Execute exe) &#123; exe.execute(this); &#125;&#125;public class Dog extends Animal &#123; public void accept(Execute exe) &#123; exe.execute(this); &#125;&#125;public class Cat extends Animal &#123; public void accept(Execute exe) &#123; exe.execute(this); &#125;&#125;public class Execute &#123; public void execute(Animal a) &#123; System.out.println(&quot;animal&quot;); &#125; public void execute(Dog d) &#123; System.out.println(&quot;dog&quot;); &#125; public void execute(Cat c) &#123; System.out.println(&quot;cat&quot;); &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; Animal a = new Animal(); Animal d = new Dog(); Animal c = new Cat(); Execute exe = new Execute(); a.accept(exe); d.accept(exe); c.accept(exe); &#125;&#125; åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯å°†Executeå¯¹è±¡åšä¸ºå‚æ•°ä¼ é€’ç»™Animalç±»å‹çš„å˜é‡è°ƒç”¨çš„æ–¹æ³•ï¼Œè¿™é‡Œå®Œæˆç¬¬ä¸€æ¬¡åˆ†æ´¾ï¼Œè¿™é‡Œæ˜¯æ–¹æ³•é‡å†™ï¼Œæ‰€ä»¥æ˜¯åŠ¨æ€åˆ†æ´¾ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œå®é™…ç±»å‹ä¸­çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå°†è‡ªå·±thisä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼Œè¿™é‡Œå°±å®Œæˆäº†ç¬¬äºŒæ¬¡åˆ†æ´¾ï¼Œè¿™é‡Œçš„Executeç±»ä¸­æœ‰å¤šä¸ªé‡è½½çš„æ–¹æ³•ï¼Œè€Œä¼ é€’è¿›è¡Œçš„æ˜¯thisï¼Œå°±æ˜¯å…·ä½“çš„å®é™…ç±»å‹çš„å¯¹è±¡ã€‚ è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»æ˜ç™½åŒåˆ†æ´¾æ˜¯æ€ä¹ˆå›äº‹äº†ï¼Œä½†æ˜¯å®ƒæœ‰ä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿå°±æ˜¯å¯ä»¥å®ç°æ–¹æ³•çš„åŠ¨æ€ç»‘å®šï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸Šé¢çš„ç¨‹åºè¿›è¡Œä¿®æ”¹ã€‚ è¿è¡Œç»“æœå¦‚ä¸‹ï¼š åŒåˆ†æ´¾å®ç°åŠ¨æ€ç»‘å®šçš„æœ¬è´¨ï¼Œå°±æ˜¯åœ¨é‡è½½æ–¹æ³•å§”æ´¾çš„å‰é¢åŠ ä¸Šäº†ç»§æ‰¿ä½“ç³»ä¸­è¦†ç›–çš„ç¯èŠ‚ï¼Œç”±äºè¦†ç›–æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥é‡è½½å°±æ˜¯åŠ¨æ€çš„äº†ã€‚ 6.10 å¤‡å¿˜å½•æ¨¡å¼6.10.1 æ¦‚è¿°å¤‡å¿˜å½•æ¨¡å¼æä¾›äº†ä¸€ç§çŠ¶æ€æ¢å¤çš„å®ç°æœºåˆ¶ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°å›åˆ°ä¸€ä¸ªç‰¹å®šçš„å†å²æ­¥éª¤ï¼Œå½“æ–°çš„çŠ¶æ€æ— æ•ˆæˆ–è€…å­˜åœ¨é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æš‚æ—¶å­˜å‚¨èµ·æ¥çš„å¤‡å¿˜å½•å°†çŠ¶æ€å¤åŸï¼Œå¾ˆå¤šè½¯ä»¶éƒ½æä¾›äº†æ’¤é”€ï¼ˆUndoï¼‰æ“ä½œï¼Œå¦‚ Wordã€è®°äº‹æœ¬ã€Photoshopã€IDEAç­‰è½¯ä»¶åœ¨ç¼–è¾‘æ—¶æŒ‰ Ctrl+Z ç»„åˆé”®æ—¶èƒ½æ’¤é”€å½“å‰æ“ä½œï¼Œä½¿æ–‡æ¡£æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼›è¿˜æœ‰åœ¨ æµè§ˆå™¨ ä¸­çš„åé€€é”®ã€æ•°æ®åº“äº‹åŠ¡ç®¡ç†ä¸­çš„å›æ»šæ“ä½œã€ç©æ¸¸æˆæ—¶çš„ä¸­é—´ç»“æœå­˜æ¡£åŠŸèƒ½ã€æ•°æ®åº“ä¸æ“ä½œç³»ç»Ÿçš„å¤‡ä»½æ“ä½œã€æ£‹ç±»æ¸¸æˆä¸­çš„æ‚”æ£‹åŠŸèƒ½ç­‰éƒ½å±äºè¿™ç±»ã€‚ å®šä¹‰ï¼š åˆå«å¿«ç…§æ¨¡å¼ï¼Œåœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åå½“éœ€è¦æ—¶èƒ½å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚ 6.10.2 ç»“æ„å¤‡å¿˜å½•æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š å‘èµ·äººï¼ˆOriginatorï¼‰è§’è‰²ï¼šè®°å½•å½“å‰æ—¶åˆ»çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯ï¼Œæä¾›åˆ›å»ºå¤‡å¿˜å½•å’Œæ¢å¤å¤‡å¿˜å½•æ•°æ®çš„åŠŸèƒ½ï¼Œå®ç°å…¶ä»–ä¸šåŠ¡åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è®¿é—®å¤‡å¿˜å½•é‡Œçš„æ‰€æœ‰ä¿¡æ¯ã€‚ å¤‡å¿˜å½•ï¼ˆMementoï¼‰è§’è‰²ï¼šè´Ÿè´£å­˜å‚¨å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æä¾›è¿™äº›å†…éƒ¨çŠ¶æ€ç»™å‘èµ·äººã€‚ ç®¡ç†è€…ï¼ˆCaretakerï¼‰è§’è‰²ï¼šå¯¹å¤‡å¿˜å½•è¿›è¡Œç®¡ç†ï¼Œæä¾›ä¿å­˜ä¸è·å–å¤‡å¿˜å½•çš„åŠŸèƒ½ï¼Œä½†å…¶ä¸èƒ½å¯¹å¤‡å¿˜å½•çš„å†…å®¹è¿›è¡Œè®¿é—®ä¸ä¿®æ”¹ã€‚ å¤‡å¿˜å½•æœ‰ä¸¤ä¸ªç­‰æ•ˆçš„æ¥å£ï¼š çª„æ¥å£ï¼šç®¡ç†è€…(Caretaker)å¯¹è±¡ï¼ˆå’Œå…¶ä»–å‘èµ·äººå¯¹è±¡ä¹‹å¤–çš„ä»»ä½•å¯¹è±¡ï¼‰çœ‹åˆ°çš„æ˜¯å¤‡å¿˜å½•çš„çª„æ¥å£(narror Interface)ï¼Œè¿™ä¸ªçª„æ¥å£åªå…è®¸ä»–æŠŠå¤‡å¿˜å½•å¯¹è±¡ä¼ ç»™å…¶ä»–çš„å¯¹è±¡ã€‚ å®½æ¥å£ï¼šä¸ç®¡ç†è€…çœ‹åˆ°çš„çª„æ¥å£ç›¸åï¼Œå‘èµ·äººå¯¹è±¡å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå®½æ¥å£(wide Interface)ï¼Œè¿™ä¸ªå®½æ¥å£å…è®¸å®ƒè¯»å–æ‰€æœ‰çš„æ•°æ®ï¼Œä»¥ä¾¿æ ¹æ®è¿™äº›æ•°æ®æ¢å¤è¿™ä¸ªå‘èµ·äººå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ã€‚ 6.10.3 æ¡ˆä¾‹å®ç°ã€ä¾‹ã€‘æ¸¸æˆæŒ‘æˆ˜BOSS æ¸¸æˆä¸­çš„æŸä¸ªåœºæ™¯ï¼Œä¸€æ¸¸æˆè§’è‰²æœ‰ç”Ÿå‘½åŠ›ã€æ”»å‡»åŠ›ã€é˜²å¾¡åŠ›ç­‰æ•°æ®ï¼Œåœ¨æ‰“Bosså‰å’Œåä¸€å®šä¼šä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å…è®¸ç©å®¶å¦‚æœæ„Ÿè§‰ä¸Bosså†³æ–—çš„æ•ˆæœä¸ç†æƒ³å¯ä»¥è®©æ¸¸æˆæ¢å¤åˆ°å†³æ–—ä¹‹å‰çš„çŠ¶æ€ã€‚ è¦å®ç°ä¸Šè¿°æ¡ˆä¾‹ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š â€œç™½ç®±â€å¤‡å¿˜å½•æ¨¡å¼ â€œé»‘ç®±â€å¤‡å¿˜å½•æ¨¡å¼ 6.10.3.1 â€œç™½ç®±â€å¤‡å¿˜å½•æ¨¡å¼å¤‡å¿˜å½•è§’è‰²å¯¹ä»»ä½•å¯¹è±¡éƒ½æä¾›ä¸€ä¸ªæ¥å£ï¼Œå³å®½æ¥å£ï¼Œå¤‡å¿˜å½•è§’è‰²çš„å†…éƒ¨æ‰€å­˜å‚¨çš„çŠ¶æ€å°±å¯¹æ‰€æœ‰å¯¹è±¡å…¬å¼€ã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137//æ¸¸æˆè§’è‰²ç±»public class GameRole &#123; private int vit; //ç”Ÿå‘½åŠ› private int atk; //æ”»å‡»åŠ› private int def; //é˜²å¾¡åŠ› //åˆå§‹åŒ–çŠ¶æ€ public void initState() &#123; this.vit = 100; this.atk = 100; this.def = 100; &#125; //æˆ˜æ–— public void fight() &#123; this.vit = 0; this.atk = 0; this.def = 0; &#125; //ä¿å­˜è§’è‰²çŠ¶æ€ public RoleStateMemento saveState() &#123; return new RoleStateMemento(vit, atk, def); &#125; //å›å¤è§’è‰²çŠ¶æ€ public void recoverState(RoleStateMemento roleStateMemento) &#123; this.vit = roleStateMemento.getVit(); this.atk = roleStateMemento.getAtk(); this.def = roleStateMemento.getDef(); &#125; public void stateDisplay() &#123; System.out.println(&quot;è§’è‰²ç”Ÿå‘½åŠ›ï¼š&quot; + vit); System.out.println(&quot;è§’è‰²æ”»å‡»åŠ›ï¼š&quot; + atk); System.out.println(&quot;è§’è‰²é˜²å¾¡åŠ›ï¼š&quot; + def); &#125; public int getVit() &#123; return vit; &#125; public void setVit(int vit) &#123; this.vit = vit; &#125; public int getAtk() &#123; return atk; &#125; public void setAtk(int atk) &#123; this.atk = atk; &#125; public int getDef() &#123; return def; &#125; public void setDef(int def) &#123; this.def = def; &#125;&#125;//æ¸¸æˆçŠ¶æ€å­˜å‚¨ç±»(å¤‡å¿˜å½•ç±»)public class RoleStateMemento &#123; private int vit; private int atk; private int def; public RoleStateMemento(int vit, int atk, int def) &#123; this.vit = vit; this.atk = atk; this.def = def; &#125; public int getVit() &#123; return vit; &#125; public void setVit(int vit) &#123; this.vit = vit; &#125; public int getAtk() &#123; return atk; &#125; public void setAtk(int atk) &#123; this.atk = atk; &#125; public int getDef() &#123; return def; &#125; public void setDef(int def) &#123; this.def = def; &#125;&#125;//è§’è‰²çŠ¶æ€ç®¡ç†è€…ç±»public class RoleStateCaretaker &#123; private RoleStateMemento roleStateMemento; public RoleStateMemento getRoleStateMemento() &#123; return roleStateMemento; &#125; public void setRoleStateMemento(RoleStateMemento roleStateMemento) &#123; this.roleStateMemento = roleStateMemento; &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; System.out.println(&quot;------------å¤§æˆ˜Bosså‰------------&quot;); //å¤§æˆ˜Bosså‰ GameRole gameRole = new GameRole(); gameRole.initState(); gameRole.stateDisplay(); //ä¿å­˜è¿›åº¦ RoleStateCaretaker roleStateCaretaker = new RoleStateCaretaker(); roleStateCaretaker.setRoleStateMemento(gameRole.saveState()); System.out.println(&quot;------------å¤§æˆ˜Bosså------------&quot;); //å¤§æˆ˜Bossæ—¶ï¼ŒæŸè€—ä¸¥é‡ gameRole.fight(); gameRole.stateDisplay(); System.out.println(&quot;------------æ¢å¤ä¹‹å‰çŠ¶æ€------------&quot;); //æ¢å¤ä¹‹å‰çŠ¶æ€ gameRole.recoverState(roleStateCaretaker.getRoleStateMemento()); gameRole.stateDisplay(); &#125;&#125; åˆ†æï¼šç™½ç®±å¤‡å¿˜å½•æ¨¡å¼æ˜¯ç ´åå°è£…æ€§çš„ã€‚ä½†æ˜¯é€šè¿‡ç¨‹åºå‘˜è‡ªå¾‹ï¼ŒåŒæ ·å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç°æ¨¡å¼çš„å¤§éƒ¨åˆ†ç”¨æ„ã€‚ 6.10.3.2 â€œé»‘ç®±â€å¤‡å¿˜å½•æ¨¡å¼å¤‡å¿˜å½•è§’è‰²å¯¹å‘èµ·äººå¯¹è±¡æä¾›ä¸€ä¸ªå®½æ¥å£ï¼Œè€Œä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªçª„æ¥å£ã€‚åœ¨Javaè¯­è¨€ä¸­ï¼Œå®ç°åŒé‡æ¥å£çš„åŠæ³•å°±æ˜¯å°†å¤‡å¿˜å½•ç±»è®¾è®¡æˆå‘èµ·äººç±»çš„å†…éƒ¨æˆå‘˜ç±»ã€‚ å°† RoleStateMemento è®¾ä¸º GameRole çš„å†…éƒ¨ç±»ï¼Œä»è€Œå°† RoleStateMemento å¯¹è±¡å°è£…åœ¨ GameRole é‡Œé¢ï¼›åœ¨å¤–é¢æä¾›ä¸€ä¸ªæ ‡è¯†æ¥å£ Memento ç»™ RoleStateCaretaker åŠå…¶ä»–å¯¹è±¡ä½¿ç”¨ã€‚è¿™æ · GameRole ç±»çœ‹åˆ°çš„æ˜¯ RoleStateMemento æ‰€æœ‰çš„æ¥å£ï¼Œè€ŒRoleStateCaretaker åŠå…¶ä»–å¯¹è±¡çœ‹åˆ°çš„ä»…ä»…æ˜¯æ ‡è¯†æ¥å£ Memento æ‰€æš´éœ²å‡ºæ¥çš„æ¥å£ï¼Œä»è€Œç»´æŠ¤äº†å°è£…å‹ã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š çª„æ¥å£Mementoï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡è¯†æ¥å£ï¼Œå› æ­¤æ²¡æœ‰å®šä¹‰å‡ºä»»ä½•çš„æ–¹æ³• 12public interface Memento &#123;&#125; å®šä¹‰å‘èµ·äººç±» GameRoleï¼Œå¹¶åœ¨å†…éƒ¨å®šä¹‰å¤‡å¿˜å½•å†…éƒ¨ç±» RoleStateMementoï¼ˆè¯¥å†…éƒ¨ç±»è®¾ç½®ä¸ºç§æœ‰çš„ï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100/æ¸¸æˆè§’è‰²ç±»public class GameRole &#123; private int vit; //ç”Ÿå‘½åŠ› private int atk; //æ”»å‡»åŠ› private int def; //é˜²å¾¡åŠ› //åˆå§‹åŒ–çŠ¶æ€ public void initState() &#123; this.vit = 100; this.atk = 100; this.def = 100; &#125; //æˆ˜æ–— public void fight() &#123; this.vit = 0; this.atk = 0; this.def = 0; &#125; //ä¿å­˜è§’è‰²çŠ¶æ€ public Memento saveState() &#123; return new RoleStateMemento(vit, atk, def); &#125; //å›å¤è§’è‰²çŠ¶æ€ public void recoverState(Memento memento) &#123; RoleStateMemento roleStateMemento = (RoleStateMemento) memento; this.vit = roleStateMemento.getVit(); this.atk = roleStateMemento.getAtk(); this.def = roleStateMemento.getDef(); &#125; public void stateDisplay() &#123; System.out.println(&quot;è§’è‰²ç”Ÿå‘½åŠ›ï¼š&quot; + vit); System.out.println(&quot;è§’è‰²æ”»å‡»åŠ›ï¼š&quot; + atk); System.out.println(&quot;è§’è‰²é˜²å¾¡åŠ›ï¼š&quot; + def); &#125; public int getVit() &#123; return vit; &#125; public void setVit(int vit) &#123; this.vit = vit; &#125; public int getAtk() &#123; return atk; &#125; public void setAtk(int atk) &#123; this.atk = atk; &#125; public int getDef() &#123; return def; &#125; public void setDef(int def) &#123; this.def = def; &#125; private class RoleStateMemento implements Memento &#123; private int vit; private int atk; private int def; public RoleStateMemento(int vit, int atk, int def) &#123; this.vit = vit; this.atk = atk; this.def = def; &#125; public int getVit() &#123; return vit; &#125; public void setVit(int vit) &#123; this.vit = vit; &#125; public int getAtk() &#123; return atk; &#125; public void setAtk(int atk) &#123; this.atk = atk; &#125; public int getDef() &#123; return def; &#125; public void setDef(int def) &#123; this.def = def; &#125; &#125;&#125; è´Ÿè´£äººè§’è‰²ç±» RoleStateCaretaker èƒ½å¤Ÿå¾—åˆ°çš„å¤‡å¿˜å½•å¯¹è±¡æ˜¯ä»¥ Memento ä¸ºæ¥å£çš„ï¼Œç”±äºè¿™ä¸ªæ¥å£ä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è¯†æ¥å£ï¼Œå› æ­¤è´Ÿè´£äººè§’è‰²ä¸å¯èƒ½æ”¹å˜è¿™ä¸ªå¤‡å¿˜å½•å¯¹è±¡çš„å†…å®¹ 123456789101112//è§’è‰²çŠ¶æ€ç®¡ç†è€…ç±»public class RoleStateCaretaker &#123; private Memento memento; public Memento getMemento() &#123; return memento; &#125; public void setMemento(Memento memento) &#123; this.memento = memento; &#125;&#125; å®¢æˆ·ç«¯æµ‹è¯•ç±» 1234567891011121314151617181920212223public class Client &#123; public static void main(String[] args) &#123; System.out.println(&quot;------------å¤§æˆ˜Bosså‰------------&quot;); //å¤§æˆ˜Bosså‰ GameRole gameRole = new GameRole(); gameRole.initState(); gameRole.stateDisplay(); //ä¿å­˜è¿›åº¦ RoleStateCaretaker roleStateCaretaker = new RoleStateCaretaker(); roleStateCaretaker.setMemento(gameRole.saveState()); System.out.println(&quot;------------å¤§æˆ˜Bosså------------&quot;); //å¤§æˆ˜Bossæ—¶ï¼ŒæŸè€—ä¸¥é‡ gameRole.fight(); gameRole.stateDisplay(); System.out.println(&quot;------------æ¢å¤ä¹‹å‰çŠ¶æ€------------&quot;); //æ¢å¤ä¹‹å‰çŠ¶æ€ gameRole.recoverState(roleStateCaretaker.getMemento()); gameRole.stateDisplay(); &#125;&#125; 6.10.4 ä¼˜ç¼ºç‚¹1ï¼Œä¼˜ç‚¹ï¼š æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ã€‚å½“ç”¨æˆ·éœ€è¦æ—¶èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å°†æ•°æ®æ¢å¤åˆ°æŸä¸ªå†å²çš„çŠ¶æ€ã€‚ å®ç°äº†å†…éƒ¨çŠ¶æ€çš„å°è£…ã€‚é™¤äº†åˆ›å»ºå®ƒçš„å‘èµ·äººä¹‹å¤–ï¼Œå…¶ä»–å¯¹è±¡éƒ½ä¸èƒ½å¤Ÿè®¿é—®è¿™äº›çŠ¶æ€ä¿¡æ¯ã€‚ ç®€åŒ–äº†å‘èµ·äººç±»ã€‚å‘èµ·äººä¸éœ€è¦ç®¡ç†å’Œä¿å­˜å…¶å†…éƒ¨çŠ¶æ€çš„å„ä¸ªå¤‡ä»½ï¼Œæ‰€æœ‰çŠ¶æ€ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¤‡å¿˜å½•ä¸­ï¼Œå¹¶ç”±ç®¡ç†è€…è¿›è¡Œç®¡ç†ï¼Œè¿™ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚ 2ï¼Œç¼ºç‚¹ï¼š èµ„æºæ¶ˆè€—å¤§ã€‚å¦‚æœè¦ä¿å­˜çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯è¿‡å¤šæˆ–è€…ç‰¹åˆ«é¢‘ç¹ï¼Œå°†ä¼šå ç”¨æ¯”è¾ƒå¤§çš„å†…å­˜èµ„æºã€‚ 6.10.5 ä½¿ç”¨åœºæ™¯ éœ€è¦ä¿å­˜ä¸æ¢å¤æ•°æ®çš„åœºæ™¯ï¼Œå¦‚ç©æ¸¸æˆæ—¶çš„ä¸­é—´ç»“æœçš„å­˜æ¡£åŠŸèƒ½ã€‚ éœ€è¦æä¾›ä¸€ä¸ªå¯å›æ»šæ“ä½œçš„åœºæ™¯ï¼Œå¦‚ Wordã€è®°äº‹æœ¬ã€Photoshopï¼Œideaç­‰è½¯ä»¶åœ¨ç¼–è¾‘æ—¶æŒ‰ Ctrl+Z ç»„åˆé”®ï¼Œè¿˜æœ‰æ•°æ®åº“ä¸­äº‹åŠ¡æ“ä½œã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰","slug":"è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰","date":"2023-06-16T05:59:00.000Z","updated":"2023-06-16T05:59:46.592Z","comments":true,"path":"2023/06/16/è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰/","link":"","permalink":"http://example.com/2023/06/16/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E5%9B%9B%EF%BC%89/","excerpt":"","text":"5ï¼Œç»“æ„å‹æ¨¡å¼5.6 ç»„åˆæ¨¡å¼5.6.1 æ¦‚è¿° â€‹ å¯¹äºè¿™ä¸ªå›¾ç‰‡è‚¯å®šä¼šéå¸¸ç†Ÿæ‚‰ï¼Œä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¯¹äºè¿™æ ·çš„ç»“æ„æˆ‘ä»¬ç§°ä¹‹ä¸ºæ ‘å½¢ç»“æ„ã€‚åœ¨æ ‘å½¢ç»“æ„ä¸­å¯ä»¥é€šè¿‡è°ƒç”¨æŸä¸ªæ–¹æ³•æ¥éå†æ•´ä¸ªæ ‘ï¼Œå½“æˆ‘ä»¬æ‰¾åˆ°æŸä¸ªå¶å­èŠ‚ç‚¹åï¼Œå°±å¯ä»¥å¯¹å¶å­èŠ‚ç‚¹è¿›è¡Œç›¸å…³çš„æ“ä½œã€‚å¯ä»¥å°†è¿™é¢—æ ‘ç†è§£æˆä¸€ä¸ªå¤§çš„å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢åŒ…å«å¾ˆå¤šçš„æˆå‘˜å¯¹è±¡ï¼Œè¿™äº›æˆå‘˜å¯¹è±¡å³å¯æ˜¯å®¹å™¨å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯å¶å­å¯¹è±¡ã€‚ä½†æ˜¯ç”±äºå®¹å™¨å¯¹è±¡å’Œå¶å­å¯¹è±¡åœ¨åŠŸèƒ½ä¸Šé¢çš„åŒºåˆ«ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å¿…é¡»è¦åŒºåˆ†å®¹å™¨å¯¹è±¡å’Œå¶å­å¯¹è±¡ï¼Œä½†æ˜¯è¿™æ ·å°±ä¼šç»™å®¢æˆ·å¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦ï¼Œä½œä¸ºå®¢æˆ·è€Œå·²ï¼Œå®ƒå§‹ç»ˆå¸Œæœ›èƒ½å¤Ÿä¸€è‡´çš„å¯¹å¾…å®¹å™¨å¯¹è±¡å’Œå¶å­å¯¹è±¡ã€‚ å®šä¹‰ï¼š â€‹ åˆåéƒ¨åˆ†æ•´ä½“æ¨¡å¼ï¼Œæ˜¯ç”¨äºæŠŠä¸€ç»„ç›¸ä¼¼çš„å¯¹è±¡å½“ä½œä¸€ä¸ªå•ä¸€çš„å¯¹è±¡ã€‚ç»„åˆæ¨¡å¼ä¾æ®æ ‘å½¢ç»“æ„æ¥ç»„åˆå¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºéƒ¨åˆ†ä»¥åŠæ•´ä½“å±‚æ¬¡ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒåˆ›å»ºäº†å¯¹è±¡ç»„çš„æ ‘å½¢ç»“æ„ã€‚ 5.6.2 ç»“æ„ç»„åˆæ¨¡å¼ä¸»è¦åŒ…å«ä¸‰ç§è§’è‰²ï¼š æŠ½è±¡æ ¹èŠ‚ç‚¹ï¼ˆComponentï¼‰ï¼šå®šä¹‰ç³»ç»Ÿå„å±‚æ¬¡å¯¹è±¡çš„å…±æœ‰æ–¹æ³•å’Œå±æ€§ï¼Œå¯ä»¥é¢„å…ˆå®šä¹‰ä¸€äº›é»˜è®¤è¡Œä¸ºå’Œå±æ€§ã€‚ æ ‘æèŠ‚ç‚¹ï¼ˆCompositeï¼‰ï¼šå®šä¹‰æ ‘æèŠ‚ç‚¹çš„è¡Œä¸ºï¼Œå­˜å‚¨å­èŠ‚ç‚¹ï¼Œç»„åˆæ ‘æèŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚ å¶å­èŠ‚ç‚¹ï¼ˆLeafï¼‰ï¼šå¶å­èŠ‚ç‚¹å¯¹è±¡ï¼Œå…¶ä¸‹å†æ— åˆ†æ”¯ï¼Œæ˜¯ç³»ç»Ÿå±‚æ¬¡éå†çš„æœ€å°å•ä½ã€‚ 5.6.3 æ¡ˆä¾‹å®ç°ã€ä¾‹ã€‘è½¯ä»¶èœå• å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬åœ¨è®¿é—®åˆ«çš„ä¸€äº›ç®¡ç†ç³»ç»Ÿæ—¶ï¼Œç»å¸¸å¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„èœå•ã€‚ä¸€ä¸ªèœå•å¯ä»¥åŒ…å«èœå•é¡¹ï¼ˆèœå•é¡¹æ˜¯æŒ‡ä¸å†åŒ…å«å…¶ä»–å†…å®¹çš„èœå•æ¡ç›®ï¼‰ï¼Œä¹Ÿå¯ä»¥åŒ…å«å¸¦æœ‰å…¶ä»–èœå•é¡¹çš„èœå•ï¼Œå› æ­¤ä½¿ç”¨ç»„åˆæ¨¡å¼æè¿°èœå•å°±å¾ˆæ°å½“ï¼Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯é’ˆå¯¹ä¸€ä¸ªèœå•ï¼Œæ‰“å°å‡ºå…¶åŒ…å«çš„æ‰€æœ‰èœå•ä»¥åŠèœå•é¡¹çš„åç§°ã€‚ è¦å®ç°è¯¥æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å…ˆç”»å‡ºç±»å›¾ï¼š ä»£ç å®ç°ï¼š ä¸ç®¡æ˜¯èœå•è¿˜æ˜¯èœå•é¡¹ï¼Œéƒ½åº”è¯¥ç»§æ‰¿è‡ªç»Ÿä¸€çš„æ¥å£ï¼Œè¿™é‡Œå§‘ä¸”å°†è¿™ä¸ªç»Ÿä¸€çš„æ¥å£ç§°ä¸ºèœå•ç»„ä»¶ã€‚ 123456789101112131415161718192021222324252627282930//èœå•ç»„ä»¶ ä¸ç®¡æ˜¯èœå•è¿˜æ˜¯èœå•é¡¹ï¼Œéƒ½åº”è¯¥ç»§æ‰¿è¯¥ç±»public abstract class MenuComponent &#123; protected String name; protected int level; //æ·»åŠ èœå• public void add(MenuComponent menuComponent)&#123; throw new UnsupportedOperationException(); &#125; //ç§»é™¤èœå• public void remove(MenuComponent menuComponent)&#123; throw new UnsupportedOperationException(); &#125; //è·å–æŒ‡å®šçš„å­èœå• public MenuComponent getChild(int i)&#123; throw new UnsupportedOperationException(); &#125; //è·å–èœå•åç§° public String getName()&#123; return name; &#125; public void print()&#123; throw new UnsupportedOperationException(); &#125;&#125; è¿™é‡Œçš„MenuComponentå®šä¹‰ä¸ºæŠ½è±¡ç±»ï¼Œå› ä¸ºæœ‰ä¸€äº›å…±æœ‰çš„å±æ€§å’Œè¡Œä¸ºè¦åœ¨è¯¥ç±»ä¸­å®ç°ï¼ŒMenuå’ŒMenuItemç±»å°±å¯ä»¥åªè¦†ç›–è‡ªå·±æ„Ÿå…´è¶£çš„æ–¹æ³•ï¼Œè€Œä¸ç”¨æ­ç†ä¸éœ€è¦æˆ–è€…ä¸æ„Ÿå…´è¶£çš„æ–¹æ³•ï¼Œä¸¾ä¾‹æ¥è¯´ï¼ŒMenuç±»å¯ä»¥åŒ…å«å­èœå•ï¼Œå› æ­¤éœ€è¦è¦†ç›–add()ã€remove()ã€getChild()æ–¹æ³•ï¼Œä½†æ˜¯MenuItemå°±ä¸åº”è¯¥æœ‰è¿™äº›æ–¹æ³•ã€‚è¿™é‡Œç»™å‡ºçš„é»˜è®¤å®ç°æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ”¹å†™é»˜è®¤å®ç°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637public class Menu extends MenuComponent &#123; private List&lt;MenuComponent&gt; menuComponentList; public Menu(String name,int level)&#123; this.level = level; this.name = name; menuComponentList = new ArrayList&lt;MenuComponent&gt;(); &#125; @Override public void add(MenuComponent menuComponent) &#123; menuComponentList.add(menuComponent); &#125; @Override public void remove(MenuComponent menuComponent) &#123; menuComponentList.remove(menuComponent); &#125; @Override public MenuComponent getChild(int i) &#123; return menuComponentList.get(i); &#125; @Override public void print() &#123; for (int i = 1; i &lt; level; i++) &#123; System.out.print(&quot;--&quot;); &#125; System.out.println(name); for (MenuComponent menuComponent : menuComponentList) &#123; menuComponent.print(); &#125; &#125;&#125; Menuç±»å·²ç»å®ç°äº†é™¤äº†getNameæ–¹æ³•çš„å…¶ä»–æ‰€æœ‰æ–¹æ³•ï¼Œå› ä¸ºMenuç±»å…·æœ‰æ·»åŠ èœå•ï¼Œç§»é™¤èœå•å’Œè·å–å­èœå•çš„åŠŸèƒ½ã€‚ 123456789101112131415public class MenuItem extends MenuComponent &#123; public MenuItem(String name,int level) &#123; this.name = name; this.level = level; &#125; @Override public void print() &#123; for (int i = 1; i &lt; level; i++) &#123; System.out.print(&quot;--&quot;); &#125; System.out.println(name); &#125;&#125; MenuItemæ˜¯èœå•é¡¹ï¼Œä¸èƒ½å†æœ‰å­èœå•ï¼Œæ‰€ä»¥æ·»åŠ èœå•ï¼Œç§»é™¤èœå•å’Œè·å–å­èœå•çš„åŠŸèƒ½å¹¶ä¸èƒ½å®ç°ã€‚ 5.6.4 ç»„åˆæ¨¡å¼çš„åˆ†ç±»åœ¨ä½¿ç”¨ç»„åˆæ¨¡å¼æ—¶ï¼Œæ ¹æ®æŠ½è±¡æ„ä»¶ç±»çš„å®šä¹‰å½¢å¼ï¼Œæˆ‘ä»¬å¯å°†ç»„åˆæ¨¡å¼åˆ†ä¸ºé€æ˜ç»„åˆæ¨¡å¼å’Œå®‰å…¨ç»„åˆæ¨¡å¼ä¸¤ç§å½¢å¼ã€‚ é€æ˜ç»„åˆæ¨¡å¼ é€æ˜ç»„åˆæ¨¡å¼ä¸­ï¼ŒæŠ½è±¡æ ¹èŠ‚ç‚¹è§’è‰²ä¸­å£°æ˜äº†æ‰€æœ‰ç”¨äºç®¡ç†æˆå‘˜å¯¹è±¡çš„æ–¹æ³•ï¼Œæ¯”å¦‚åœ¨ç¤ºä¾‹ä¸­ MenuComponent å£°æ˜äº† addã€remove ã€getChild æ–¹æ³•ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ç¡®ä¿æ‰€æœ‰çš„æ„ä»¶ç±»éƒ½æœ‰ç›¸åŒçš„æ¥å£ã€‚é€æ˜ç»„åˆæ¨¡å¼ä¹Ÿæ˜¯ç»„åˆæ¨¡å¼çš„æ ‡å‡†å½¢å¼ã€‚ é€æ˜ç»„åˆæ¨¡å¼çš„ç¼ºç‚¹æ˜¯ä¸å¤Ÿå®‰å…¨ï¼Œå› ä¸ºå¶å­å¯¹è±¡å’Œå®¹å™¨å¯¹è±¡åœ¨æœ¬è´¨ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ï¼Œå¶å­å¯¹è±¡ä¸å¯èƒ½æœ‰ä¸‹ä¸€ä¸ªå±‚æ¬¡çš„å¯¹è±¡ï¼Œå³ä¸å¯èƒ½åŒ…å«æˆå‘˜å¯¹è±¡ï¼Œå› æ­¤ä¸ºå…¶æä¾› add()ã€remove() ç­‰æ–¹æ³•æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œè¿™åœ¨ç¼–è¯‘é˜¶æ®µä¸ä¼šå‡ºé”™ï¼Œä½†åœ¨è¿è¡Œé˜¶æ®µå¦‚æœè°ƒç”¨è¿™äº›æ–¹æ³•å¯èƒ½ä¼šå‡ºé”™ï¼ˆå¦‚æœæ²¡æœ‰æä¾›ç›¸åº”çš„é”™è¯¯å¤„ç†ä»£ç ï¼‰ å®‰å…¨ç»„åˆæ¨¡å¼ åœ¨å®‰å…¨ç»„åˆæ¨¡å¼ä¸­ï¼Œåœ¨æŠ½è±¡æ„ä»¶è§’è‰²ä¸­æ²¡æœ‰å£°æ˜ä»»ä½•ç”¨äºç®¡ç†æˆå‘˜å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨æ ‘æèŠ‚ç‚¹ Menu ç±»ä¸­å£°æ˜å¹¶å®ç°è¿™äº›æ–¹æ³•ã€‚å®‰å…¨ç»„åˆæ¨¡å¼çš„ç¼ºç‚¹æ˜¯ä¸å¤Ÿé€æ˜ï¼Œå› ä¸ºå¶å­æ„ä»¶å’Œå®¹å™¨æ„ä»¶å…·æœ‰ä¸åŒçš„æ–¹æ³•ï¼Œä¸”å®¹å™¨æ„ä»¶ä¸­é‚£äº›ç”¨äºç®¡ç†æˆå‘˜å¯¹è±¡çš„æ–¹æ³•æ²¡æœ‰åœ¨æŠ½è±¡æ„ä»¶ç±»ä¸­å®šä¹‰ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸èƒ½å®Œå…¨é’ˆå¯¹æŠ½è±¡ç¼–ç¨‹ï¼Œå¿…é¡»æœ‰åŒºåˆ«åœ°å¯¹å¾…å¶å­æ„ä»¶å’Œå®¹å™¨æ„ä»¶ã€‚ 5.6.5 ä¼˜ç‚¹ ç»„åˆæ¨¡å¼å¯ä»¥æ¸…æ¥šåœ°å®šä¹‰åˆ†å±‚æ¬¡çš„å¤æ‚å¯¹è±¡ï¼Œè¡¨ç¤ºå¯¹è±¡çš„å…¨éƒ¨æˆ–éƒ¨åˆ†å±‚æ¬¡ï¼Œå®ƒè®©å®¢æˆ·ç«¯å¿½ç•¥äº†å±‚æ¬¡çš„å·®å¼‚ï¼Œæ–¹ä¾¿å¯¹æ•´ä¸ªå±‚æ¬¡ç»“æ„è¿›è¡Œæ§åˆ¶ã€‚ å®¢æˆ·ç«¯å¯ä»¥ä¸€è‡´åœ°ä½¿ç”¨ä¸€ä¸ªç»„åˆç»“æ„æˆ–å…¶ä¸­å•ä¸ªå¯¹è±¡ï¼Œä¸å¿…å…³å¿ƒå¤„ç†çš„æ˜¯å•ä¸ªå¯¹è±¡è¿˜æ˜¯æ•´ä¸ªç»„åˆç»“æ„ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç ã€‚ åœ¨ç»„åˆæ¨¡å¼ä¸­å¢åŠ æ–°çš„æ ‘æèŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»å¯¹ç°æœ‰ç±»åº“è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚ ç»„åˆæ¨¡å¼ä¸ºæ ‘å½¢ç»“æ„çš„é¢å‘å¯¹è±¡å®ç°æä¾›äº†ä¸€ç§çµæ´»çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å¶å­èŠ‚ç‚¹å’Œæ ‘æèŠ‚ç‚¹çš„é€’å½’ç»„åˆï¼Œå¯ä»¥å½¢æˆå¤æ‚çš„æ ‘å½¢ç»“æ„ï¼Œä½†å¯¹æ ‘å½¢ç»“æ„çš„æ§åˆ¶å´éå¸¸ç®€å•ã€‚ 5.6.6 ä½¿ç”¨åœºæ™¯ç»„åˆæ¨¡å¼æ­£æ˜¯åº”æ ‘å½¢ç»“æ„è€Œç”Ÿï¼Œæ‰€ä»¥ç»„åˆæ¨¡å¼çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯å‡ºç°æ ‘å½¢ç»“æ„çš„åœ°æ–¹ã€‚æ¯”å¦‚ï¼šæ–‡ä»¶ç›®å½•æ˜¾ç¤ºï¼Œå¤šçº§ç›®å½•å‘ˆç°ç­‰æ ‘å½¢ç»“æ„æ•°æ®çš„æ“ä½œã€‚ 5.7 äº«å…ƒæ¨¡å¼5.7.1 æ¦‚è¿°å®šä¹‰ï¼š â€‹ è¿ç”¨å…±äº«æŠ€æœ¯æ¥æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡çš„å¤ç”¨ã€‚å®ƒé€šè¿‡å…±äº«å·²ç»å­˜åœ¨çš„å¯¹è±¡æ¥å¤§å¹…åº¦å‡å°‘éœ€è¦åˆ›å»ºçš„å¯¹è±¡æ•°é‡ã€é¿å…å¤§é‡ç›¸ä¼¼å¯¹è±¡çš„å¼€é”€ï¼Œä»è€Œæé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ã€‚ 5.7.2 ç»“æ„äº«å…ƒï¼ˆFlyweight ï¼‰æ¨¡å¼ä¸­å­˜åœ¨ä»¥ä¸‹ä¸¤ç§çŠ¶æ€ï¼š å†…éƒ¨çŠ¶æ€ï¼Œå³ä¸ä¼šéšç€ç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜çš„å¯å…±äº«éƒ¨åˆ†ã€‚ å¤–éƒ¨çŠ¶æ€ï¼ŒæŒ‡éšç¯å¢ƒæ”¹å˜è€Œæ”¹å˜çš„ä¸å¯ä»¥å…±äº«çš„éƒ¨åˆ†ã€‚äº«å…ƒæ¨¡å¼çš„å®ç°è¦é¢†å°±æ˜¯åŒºåˆ†åº”ç”¨ä¸­çš„è¿™ä¸¤ç§çŠ¶æ€ï¼Œå¹¶å°†å¤–éƒ¨çŠ¶æ€å¤–éƒ¨åŒ–ã€‚ äº«å…ƒæ¨¡å¼çš„ä¸»è¦æœ‰ä»¥ä¸‹è§’è‰²ï¼š æŠ½è±¡äº«å…ƒè§’è‰²ï¼ˆFlyweightï¼‰ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªæ¥å£æˆ–æŠ½è±¡ç±»ï¼Œåœ¨æŠ½è±¡äº«å…ƒç±»ä¸­å£°æ˜äº†å…·ä½“äº«å…ƒç±»å…¬å…±çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥å‘å¤–ç•Œæä¾›äº«å…ƒå¯¹è±¡çš„å†…éƒ¨æ•°æ®ï¼ˆå†…éƒ¨çŠ¶æ€ï¼‰ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡è¿™äº›æ–¹æ³•æ¥è®¾ç½®å¤–éƒ¨æ•°æ®ï¼ˆå¤–éƒ¨çŠ¶æ€ï¼‰ã€‚ å…·ä½“äº«å…ƒï¼ˆConcrete Flyweightï¼‰è§’è‰² ï¼šå®ƒå®ç°äº†æŠ½è±¡äº«å…ƒç±»ï¼Œç§°ä¸ºäº«å…ƒå¯¹è±¡ï¼›åœ¨å…·ä½“äº«å…ƒç±»ä¸­ä¸ºå†…éƒ¨çŠ¶æ€æä¾›äº†å­˜å‚¨ç©ºé—´ã€‚é€šå¸¸æˆ‘ä»¬å¯ä»¥ç»“åˆå•ä¾‹æ¨¡å¼æ¥è®¾è®¡å…·ä½“äº«å…ƒç±»ï¼Œä¸ºæ¯ä¸€ä¸ªå…·ä½“äº«å…ƒç±»æä¾›å”¯ä¸€çš„äº«å…ƒå¯¹è±¡ã€‚ éäº«å…ƒï¼ˆUnsharable Flyweight)è§’è‰² ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰çš„æŠ½è±¡äº«å…ƒç±»çš„å­ç±»éƒ½éœ€è¦è¢«å…±äº«ï¼Œä¸èƒ½è¢«å…±äº«çš„å­ç±»å¯è®¾è®¡ä¸ºéå…±äº«å…·ä½“äº«å…ƒç±»ï¼›å½“éœ€è¦ä¸€ä¸ªéå…±äº«å…·ä½“äº«å…ƒç±»çš„å¯¹è±¡æ—¶å¯ä»¥ç›´æ¥é€šè¿‡å®ä¾‹åŒ–åˆ›å»ºã€‚ äº«å…ƒå·¥å‚ï¼ˆFlyweight Factoryï¼‰è§’è‰² ï¼šè´Ÿè´£åˆ›å»ºå’Œç®¡ç†äº«å…ƒè§’è‰²ã€‚å½“å®¢æˆ·å¯¹è±¡è¯·æ±‚ä¸€ä¸ªäº«å…ƒå¯¹è±¡æ—¶ï¼Œäº«å…ƒå·¥å‚æ£€æŸ»ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆè¦æ±‚çš„äº«å…ƒå¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨åˆ™æä¾›ç»™å®¢æˆ·ï¼›å¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº«å…ƒå¯¹è±¡ã€‚ 5.7.3 æ¡ˆä¾‹å®ç°ã€ä¾‹ã€‘ä¿„ç½—æ–¯æ–¹å— ä¸‹é¢çš„å›¾ç‰‡æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ä¿„ç½—æ–¯æ–¹å—ä¸­çš„ä¸€ä¸ªä¸ªæ–¹å—ï¼Œå¦‚æœåœ¨ä¿„ç½—æ–¯æ–¹å—è¿™ä¸ªæ¸¸æˆä¸­ï¼Œæ¯ä¸ªä¸åŒçš„æ–¹å—éƒ½æ˜¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å°±è¦å ç”¨å¾ˆå¤šçš„å†…å­˜ç©ºé—´ï¼Œä¸‹é¢åˆ©ç”¨äº«å…ƒæ¨¡å¼è¿›è¡Œå®ç°ã€‚ å…ˆæ¥çœ‹ç±»å›¾ï¼š ä»£ç å¦‚ä¸‹ï¼š ä¿„ç½—æ–¯æ–¹å—æœ‰ä¸åŒçš„å½¢çŠ¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›å½¢çŠ¶å‘ä¸ŠæŠ½å–å‡ºAbstractBoxï¼Œç”¨æ¥å®šä¹‰å…±æ€§çš„å±æ€§å’Œè¡Œä¸ºã€‚ 1234567public abstract class AbstractBox &#123; public abstract String getShape(); public void display(String color) &#123; System.out.println(&quot;æ–¹å—å½¢çŠ¶ï¼š&quot; + this.getShape() + &quot; é¢œè‰²ï¼š&quot; + color); &#125;&#125; æ¥ä¸‹æ¥å°±æ˜¯å®šä¹‰ä¸åŒçš„å½¢çŠ¶äº†ï¼ŒIBoxç±»ã€LBoxç±»ã€OBoxç±»ç­‰ã€‚ 1234567891011121314151617181920212223public class IBox extends AbstractBox &#123; @Override public String getShape() &#123; return &quot;I&quot;; &#125;&#125;public class LBox extends AbstractBox &#123; @Override public String getShape() &#123; return &quot;L&quot;; &#125;&#125;public class OBox extends AbstractBox &#123; @Override public String getShape() &#123; return &quot;O&quot;; &#125;&#125; æä¾›äº†ä¸€ä¸ªå·¥å‚ç±»ï¼ˆBoxFactoryï¼‰ï¼Œç”¨æ¥ç®¡ç†äº«å…ƒå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯AbstractBoxå­ç±»å¯¹è±¡ï¼‰ï¼Œè¯¥å·¥å‚ç±»å¯¹è±¡åªéœ€è¦ä¸€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚å¹¶ç»™å·¥å‚ç±»æä¾›ä¸€ä¸ªè·å–å½¢çŠ¶çš„æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526public class BoxFactory &#123; private static HashMap&lt;String, AbstractBox&gt; map; private BoxFactory() &#123; map = new HashMap&lt;String, AbstractBox&gt;(); AbstractBox iBox = new IBox(); AbstractBox lBox = new LBox(); AbstractBox oBox = new OBox(); map.put(&quot;I&quot;, iBox); map.put(&quot;L&quot;, lBox); map.put(&quot;O&quot;, oBox); &#125; public static final BoxFactory getInstance() &#123; return SingletonHolder.INSTANCE; &#125; private static class SingletonHolder &#123; private static final BoxFactory INSTANCE = new BoxFactory(); &#125; public AbstractBox getBox(String key) &#123; return map.get(key); &#125;&#125; 5.7.5 ä¼˜ç¼ºç‚¹å’Œä½¿ç”¨åœºæ™¯1ï¼Œä¼˜ç‚¹ æå¤§å‡å°‘å†…å­˜ä¸­ç›¸ä¼¼æˆ–ç›¸åŒå¯¹è±¡æ•°é‡ï¼ŒèŠ‚çº¦ç³»ç»Ÿèµ„æºï¼Œæä¾›ç³»ç»Ÿæ€§èƒ½ äº«å…ƒæ¨¡å¼ä¸­çš„å¤–éƒ¨çŠ¶æ€ç›¸å¯¹ç‹¬ç«‹ï¼Œä¸”ä¸å½±å“å†…éƒ¨çŠ¶æ€ 2ï¼Œç¼ºç‚¹ï¼š ä¸ºäº†ä½¿å¯¹è±¡å¯ä»¥å…±äº«ï¼Œéœ€è¦å°†äº«å…ƒå¯¹è±¡çš„éƒ¨åˆ†çŠ¶æ€å¤–éƒ¨åŒ–ï¼Œåˆ†ç¦»å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼Œä½¿ç¨‹åºé€»è¾‘å¤æ‚ 3ï¼Œä½¿ç”¨åœºæ™¯ï¼š ä¸€ä¸ªç³»ç»Ÿæœ‰å¤§é‡ç›¸åŒæˆ–è€…ç›¸ä¼¼çš„å¯¹è±¡ï¼Œé€ æˆå†…å­˜çš„å¤§é‡è€—è´¹ã€‚ å¯¹è±¡çš„å¤§éƒ¨åˆ†çŠ¶æ€éƒ½å¯ä»¥å¤–éƒ¨åŒ–ï¼Œå¯ä»¥å°†è¿™äº›å¤–éƒ¨çŠ¶æ€ä¼ å…¥å¯¹è±¡ä¸­ã€‚ åœ¨ä½¿ç”¨äº«å…ƒæ¨¡å¼æ—¶éœ€è¦ç»´æŠ¤ä¸€ä¸ªå­˜å‚¨äº«å…ƒå¯¹è±¡çš„äº«å…ƒæ± ï¼Œè€Œè¿™éœ€è¦è€—è´¹ä¸€å®šçš„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤ï¼Œåº”å½“åœ¨éœ€è¦å¤šæ¬¡é‡å¤ä½¿ç”¨äº«å…ƒå¯¹è±¡æ—¶æ‰å€¼å¾—ä½¿ç”¨äº«å…ƒæ¨¡å¼ã€‚ 5.7.6 JDKæºç è§£æIntegerç±»ä½¿ç”¨äº†äº«å…ƒæ¨¡å¼ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š 12345678910111213public class Demo &#123; public static void main(String[] args) &#123; Integer i1 = 127; Integer i2 = 127; System.out.println(&quot;i1å’Œi2å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Ÿ&quot; + (i1 == i2)); Integer i3 = 128; Integer i4 = 128; System.out.println(&quot;i3å’Œi4å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Ÿ&quot; + (i3 == i4)); &#125;&#125; è¿è¡Œä¸Šé¢ä»£ç ï¼Œç»“æœå¦‚ä¸‹ï¼š ä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªè¾“å‡ºè¯­å¥è¾“å‡ºçš„æ˜¯trueï¼Œç¬¬äºŒä¸ªè¾“å‡ºè¯­å¥è¾“å‡ºçš„æ˜¯falseï¼Ÿé€šè¿‡åç¼–è¯‘è½¯ä»¶è¿›è¡Œåç¼–è¯‘ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910public class Demo &#123; public static void main(String[] args) &#123; Integer i1 = Integer.valueOf((int)127); Integer i2 Integer.valueOf((int)127); System.out.println((String)new StringBuilder().append((String)&quot;i1\\u548ci2\\u5bf9\\u8c61\\u662f\\u5426\\u662f\\u540c\\u4e00\\u4e2a\\u5bf9\\u8c61\\uff1f&quot;).append((boolean)(i1 == i2)).toString()); Integer i3 = Integer.valueOf((int)128); Integer i4 = Integer.valueOf((int)128); System.out.println((String)new StringBuilder().append((String)&quot;i3\\u548ci4\\u5bf9\\u8c61\\u662f\\u5426\\u662f\\u540c\\u4e00\\u4e2a\\u5bf9\\u8c61\\uff1f&quot;).append((boolean)(i3 == i4)).toString()); &#125;&#125; ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œç›´æ¥ç»™Integerç±»å‹çš„å˜é‡èµ‹å€¼åŸºæœ¬æ•°æ®ç±»å‹æ•°æ®çš„æ“ä½œåº•å±‚ä½¿ç”¨çš„æ˜¯ valueOf() ï¼Œæ‰€ä»¥åªéœ€è¦çœ‹è¯¥æ–¹æ³•å³å¯ 1234567891011121314151617181920212223242526272829303132333435363738public final class Integer extends Number implements Comparable&lt;Integer&gt; &#123; public static Integer valueOf(int i) &#123; if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i); &#125; private static class IntegerCache &#123; static final int low = -128; static final int high; static final Integer cache[]; static &#123; int h = 127; String integerCacheHighPropValue = sun.misc.VM.getSavedProperty(&quot;java.lang.Integer.IntegerCache.high&quot;); if (integerCacheHighPropValue != null) &#123; try &#123; int i = parseInt(integerCacheHighPropValue); i = Math.max(i, 127); // Maximum array size is Integer.MAX_VALUE h = Math.min(i, Integer.MAX_VALUE - (-low) -1); &#125; catch( NumberFormatException nfe) &#123; &#125; &#125; high = h; cache = new Integer[(high - low) + 1]; int j = low; for(int k = 0; k &lt; cache.length; k++) cache[k] = new Integer(j++); // range [-128, 127] must be interned (JLS7 5.1.7) assert IntegerCache.high &gt;= 127; &#125; private IntegerCache() &#123;&#125; &#125;&#125; å¯ä»¥çœ‹åˆ° Integer é»˜è®¤å…ˆåˆ›å»ºå¹¶ç¼“å­˜ -128 ~ 127 ä¹‹é—´æ•°çš„ Integer å¯¹è±¡ï¼Œå½“è°ƒç”¨ valueOf æ—¶å¦‚æœå‚æ•°åœ¨ -128 ~ 127 ä¹‹é—´åˆ™è®¡ç®—ä¸‹æ ‡å¹¶ä»ç¼“å­˜ä¸­è¿”å›ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ Integer å¯¹è±¡ã€‚ 6ï¼Œè¡Œä¸ºå‹æ¨¡å¼è¡Œä¸ºå‹æ¨¡å¼ç”¨äºæè¿°ç¨‹åºåœ¨è¿è¡Œæ—¶å¤æ‚çš„æµç¨‹æ§åˆ¶ï¼Œå³æè¿°å¤šä¸ªç±»æˆ–å¯¹è±¡ä¹‹é—´æ€æ ·ç›¸äº’åä½œå…±åŒå®Œæˆå•ä¸ªå¯¹è±¡éƒ½æ— æ³•å•ç‹¬å®Œæˆçš„ä»»åŠ¡ï¼Œå®ƒæ¶‰åŠç®—æ³•ä¸å¯¹è±¡é—´èŒè´£çš„åˆ†é…ã€‚ è¡Œä¸ºå‹æ¨¡å¼åˆ†ä¸ºç±»è¡Œä¸ºæ¨¡å¼å’Œå¯¹è±¡è¡Œä¸ºæ¨¡å¼ï¼Œå‰è€…é‡‡ç”¨ç»§æ‰¿æœºåˆ¶æ¥åœ¨ç±»é—´åˆ†æ´¾è¡Œä¸ºï¼Œåè€…é‡‡ç”¨ç»„åˆæˆ–èšåˆåœ¨å¯¹è±¡é—´åˆ†é…è¡Œä¸ºã€‚ç”±äºç»„åˆå…³ç³»æˆ–èšåˆå…³ç³»æ¯”ç»§æ‰¿å…³ç³»è€¦åˆåº¦ä½ï¼Œæ»¡è¶³â€œåˆæˆå¤ç”¨åŸåˆ™â€ï¼Œæ‰€ä»¥å¯¹è±¡è¡Œä¸ºæ¨¡å¼æ¯”ç±»è¡Œä¸ºæ¨¡å¼å…·æœ‰æ›´å¤§çš„çµæ´»æ€§ã€‚ è¡Œä¸ºå‹æ¨¡å¼åˆ†ä¸ºï¼š æ¨¡æ¿æ–¹æ³•æ¨¡å¼ ç­–ç•¥æ¨¡å¼ å‘½ä»¤æ¨¡å¼ èŒè´£é“¾æ¨¡å¼ çŠ¶æ€æ¨¡å¼ è§‚å¯Ÿè€…æ¨¡å¼ ä¸­ä»‹è€…æ¨¡å¼ è¿­ä»£å™¨æ¨¡å¼ è®¿é—®è€…æ¨¡å¼ å¤‡å¿˜å½•æ¨¡å¼ è§£é‡Šå™¨æ¨¡å¼ ä»¥ä¸Š 11 ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œé™¤äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼å’Œè§£é‡Šå™¨æ¨¡å¼æ˜¯ç±»è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…¶ä»–çš„å…¨éƒ¨å±äºå¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ã€‚ 6.1 æ¨¡æ¿æ–¹æ³•æ¨¡å¼6.1.1 æ¦‚è¿°åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œç¨‹åºå‘˜å¸¸å¸¸ä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼šè®¾è®¡ä¸€ä¸ªç³»ç»Ÿæ—¶çŸ¥é“äº†ç®—æ³•æ‰€éœ€çš„å…³é”®æ­¥éª¤ï¼Œè€Œä¸”ç¡®å®šäº†è¿™äº›æ­¥éª¤çš„æ‰§è¡Œé¡ºåºï¼Œä½†æŸäº›æ­¥éª¤çš„å…·ä½“å®ç°è¿˜æœªçŸ¥ï¼Œæˆ–è€…è¯´æŸäº›æ­¥éª¤çš„å®ç°ä¸å…·ä½“çš„ç¯å¢ƒç›¸å…³ã€‚ ä¾‹å¦‚ï¼Œå»é“¶è¡ŒåŠç†ä¸šåŠ¡ä¸€èˆ¬è¦ç»è¿‡ä»¥ä¸‹4ä¸ªæµç¨‹ï¼šå–å·ã€æ’é˜Ÿã€åŠç†å…·ä½“ä¸šåŠ¡ã€å¯¹é“¶è¡Œå·¥ä½œäººå‘˜è¿›è¡Œè¯„åˆ†ç­‰ï¼Œå…¶ä¸­å–å·ã€æ’é˜Ÿå’Œå¯¹é“¶è¡Œå·¥ä½œäººå‘˜è¿›è¡Œè¯„åˆ†çš„ä¸šåŠ¡å¯¹æ¯ä¸ªå®¢æˆ·æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥åœ¨çˆ¶ç±»ä¸­å®ç°ï¼Œä½†æ˜¯åŠç†å…·ä½“ä¸šåŠ¡å´å› äººè€Œå¼‚ï¼Œå®ƒå¯èƒ½æ˜¯å­˜æ¬¾ã€å–æ¬¾æˆ–è€…è½¬è´¦ç­‰ï¼Œå¯ä»¥å»¶è¿Ÿåˆ°å­ç±»ä¸­å®ç°ã€‚ å®šä¹‰ï¼š å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•éª¨æ¶ï¼Œè€Œå°†ç®—æ³•çš„ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜è¯¥ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚ 6.1.2 ç»“æ„æ¨¡æ¿æ–¹æ³•ï¼ˆTemplate Methodï¼‰æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š æŠ½è±¡ç±»ï¼ˆAbstract Classï¼‰ï¼šè´Ÿè´£ç»™å‡ºä¸€ä¸ªç®—æ³•çš„è½®å»“å’Œéª¨æ¶ã€‚å®ƒç”±ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•å’Œè‹¥å¹²ä¸ªåŸºæœ¬æ–¹æ³•æ„æˆã€‚ æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ï¼ŒæŒ‰æŸç§é¡ºåºè°ƒç”¨å…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•ã€‚ åŸºæœ¬æ–¹æ³•ï¼šæ˜¯å®ç°ç®—æ³•å„ä¸ªæ­¥éª¤çš„æ–¹æ³•ï¼Œæ˜¯æ¨¡æ¿æ–¹æ³•çš„ç»„æˆéƒ¨åˆ†ã€‚åŸºæœ¬æ–¹æ³•åˆå¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼š æŠ½è±¡æ–¹æ³•(Abstract Method) ï¼šä¸€ä¸ªæŠ½è±¡æ–¹æ³•ç”±æŠ½è±¡ç±»å£°æ˜ã€ç”±å…¶å…·ä½“å­ç±»å®ç°ã€‚ å…·ä½“æ–¹æ³•(Concrete Method) ï¼šä¸€ä¸ªå…·ä½“æ–¹æ³•ç”±ä¸€ä¸ªæŠ½è±¡ç±»æˆ–å…·ä½“ç±»å£°æ˜å¹¶å®ç°ï¼Œå…¶å­ç±»å¯ä»¥è¿›è¡Œè¦†ç›–ä¹Ÿå¯ä»¥ç›´æ¥ç»§æ‰¿ã€‚ é’©å­æ–¹æ³•(Hook Method) ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²ç»å®ç°ï¼ŒåŒ…æ‹¬ç”¨äºåˆ¤æ–­çš„é€»è¾‘æ–¹æ³•å’Œéœ€è¦å­ç±»é‡å†™çš„ç©ºæ–¹æ³•ä¸¤ç§ã€‚ ä¸€èˆ¬é’©å­æ–¹æ³•æ˜¯ç”¨äºåˆ¤æ–­çš„é€»è¾‘æ–¹æ³•ï¼Œè¿™ç±»æ–¹æ³•åä¸€èˆ¬ä¸ºisXxxï¼Œè¿”å›å€¼ç±»å‹ä¸ºbooleanç±»å‹ã€‚ å…·ä½“å­ç±»ï¼ˆConcrete Classï¼‰ï¼šå®ç°æŠ½è±¡ç±»ä¸­æ‰€å®šä¹‰çš„æŠ½è±¡æ–¹æ³•å’Œé’©å­æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ç»„æˆæ­¥éª¤ã€‚ 6.1.3 æ¡ˆä¾‹å®ç°ã€ä¾‹ã€‘ç‚’èœ ç‚’èœçš„æ­¥éª¤æ˜¯å›ºå®šçš„ï¼Œåˆ†ä¸ºå€’æ²¹ã€çƒ­æ²¹ã€å€’è”¬èœã€å€’è°ƒæ–™å“ã€ç¿»ç‚’ç­‰æ­¥éª¤ã€‚ç°é€šè¿‡æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¥ç”¨ä»£ç æ¨¡æ‹Ÿã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273public abstract class AbstractClass &#123; public final void cookProcess() &#123; //ç¬¬ä¸€æ­¥ï¼šå€’æ²¹ this.pourOil(); //ç¬¬äºŒæ­¥ï¼šçƒ­æ²¹ this.heatOil(); //ç¬¬ä¸‰æ­¥ï¼šå€’è”¬èœ this.pourVegetable(); //ç¬¬å››æ­¥ï¼šå€’è°ƒå‘³æ–™ this.pourSauce(); //ç¬¬äº”æ­¥ï¼šç¿»ç‚’ this.fry(); &#125; public void pourOil() &#123; System.out.println(&quot;å€’æ²¹&quot;); &#125; //ç¬¬äºŒæ­¥ï¼šçƒ­æ²¹æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›´æ¥å®ç° public void heatOil() &#123; System.out.println(&quot;çƒ­æ²¹&quot;); &#125; //ç¬¬ä¸‰æ­¥ï¼šå€’è”¬èœæ˜¯ä¸ä¸€æ ·çš„ï¼ˆä¸€ä¸ªä¸‹åŒ…èœï¼Œä¸€ä¸ªæ˜¯ä¸‹èœå¿ƒï¼‰ public abstract void pourVegetable(); //ç¬¬å››æ­¥ï¼šå€’è°ƒå‘³æ–™æ˜¯ä¸ä¸€æ · public abstract void pourSauce(); //ç¬¬äº”æ­¥ï¼šç¿»ç‚’æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›´æ¥å®ç° public void fry()&#123; System.out.println(&quot;ç‚’å•Šç‚’å•Šç‚’åˆ°ç†Ÿå•Š&quot;); &#125;&#125;public class ConcreteClass_BaoCai extends AbstractClass &#123; @Override public void pourVegetable() &#123; System.out.println(&quot;ä¸‹é”…çš„è”¬èœæ˜¯åŒ…èœ&quot;); &#125; @Override public void pourSauce() &#123; System.out.println(&quot;ä¸‹é”…çš„é…±æ–™æ˜¯è¾£æ¤’&quot;); &#125;&#125;public class ConcreteClass_CaiXin extends AbstractClass &#123; @Override public void pourVegetable() &#123; System.out.println(&quot;ä¸‹é”…çš„è”¬èœæ˜¯èœå¿ƒ&quot;); &#125; @Override public void pourSauce() &#123; System.out.println(&quot;ä¸‹é”…çš„é…±æ–™æ˜¯è’œè“‰&quot;); &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; //ç‚’æ‰‹æ’•åŒ…èœ ConcreteClass_BaoCai baoCai = new ConcreteClass_BaoCai(); baoCai.cookProcess(); //ç‚’è’œè“‰èœå¿ƒ ConcreteClass_CaiXin caiXin = new ConcreteClass_CaiXin(); caiXin.cookProcess(); &#125;&#125; æ³¨æ„ï¼šä¸ºé˜²æ­¢æ¶æ„æ“ä½œï¼Œä¸€èˆ¬æ¨¡æ¿æ–¹æ³•éƒ½åŠ ä¸Š final å…³é”®è¯ã€‚ 6.1.3 ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š æé«˜ä»£ç å¤ç”¨æ€§ å°†ç›¸åŒéƒ¨åˆ†çš„ä»£ç æ”¾åœ¨æŠ½è±¡çš„çˆ¶ç±»ä¸­ï¼Œè€Œå°†ä¸åŒçš„ä»£ç æ”¾å…¥ä¸åŒçš„å­ç±»ä¸­ã€‚ å®ç°äº†åå‘æ§åˆ¶ é€šè¿‡ä¸€ä¸ªçˆ¶ç±»è°ƒç”¨å…¶å­ç±»çš„æ“ä½œï¼Œé€šè¿‡å¯¹å­ç±»çš„å…·ä½“å®ç°æ‰©å±•ä¸åŒçš„è¡Œä¸ºï¼Œå®ç°äº†åå‘æ§åˆ¶ ï¼Œå¹¶ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚ ç¼ºç‚¹ï¼š å¯¹æ¯ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œè¿™ä¼šå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œç³»ç»Ÿæ›´åŠ åºå¤§ï¼Œè®¾è®¡ä¹Ÿæ›´åŠ æŠ½è±¡ã€‚ çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ç”±å­ç±»å®ç°ï¼Œå­ç±»æ‰§è¡Œçš„ç»“æœä¼šå½±å“çˆ¶ç±»çš„ç»“æœï¼Œè¿™å¯¼è‡´ä¸€ç§åå‘çš„æ§åˆ¶ç»“æ„ï¼Œå®ƒæé«˜äº†ä»£ç é˜…è¯»çš„éš¾åº¦ã€‚ 6.1.4 é€‚ç”¨åœºæ™¯ ç®—æ³•çš„æ•´ä½“æ­¥éª¤å¾ˆå›ºå®šï¼Œä½†å…¶ä¸­ä¸ªåˆ«éƒ¨åˆ†æ˜“å˜æ—¶ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå°†å®¹æ˜“å˜çš„éƒ¨åˆ†æŠ½è±¡å‡ºæ¥ï¼Œä¾›å­ç±»å®ç°ã€‚ éœ€è¦é€šè¿‡å­ç±»æ¥å†³å®šçˆ¶ç±»ç®—æ³•ä¸­æŸä¸ªæ­¥éª¤æ˜¯å¦æ‰§è¡Œï¼Œå®ç°å­ç±»å¯¹çˆ¶ç±»çš„åå‘æ§åˆ¶ã€‚ 6.1.5 JDKæºç è§£æInputStreamç±»å°±ä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚åœ¨InputStreamç±»ä¸­å®šä¹‰äº†å¤šä¸ª read() æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637public abstract class InputStream implements Closeable &#123; //æŠ½è±¡æ–¹æ³•ï¼Œè¦æ±‚å­ç±»å¿…é¡»é‡å†™ public abstract int read() throws IOException; public int read(byte b[]) throws IOException &#123; return read(b, 0, b.length); &#125; public int read(byte b[], int off, int len) throws IOException &#123; if (b == null) &#123; throw new NullPointerException(); &#125; else if (off &lt; 0 || len &lt; 0 || len &gt; b.length - off) &#123; throw new IndexOutOfBoundsException(); &#125; else if (len == 0) &#123; return 0; &#125; int c = read(); //è°ƒç”¨äº†æ— å‚çš„readæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯æ¯æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚æ•°æ® if (c == -1) &#123; return -1; &#125; b[off] = (byte)c; int i = 1; try &#123; for (; i &lt; len ; i++) &#123; c = read(); if (c == -1) &#123; break; &#125; b[off + i] = (byte)c; &#125; &#125; catch (IOException ee) &#123; &#125; return i; &#125;&#125; ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæ— å‚çš„ read() æ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œè¦æ±‚å­ç±»å¿…é¡»å®ç°ã€‚è€Œ read(byte b[]) æ–¹æ³•è°ƒç”¨äº† read(byte b[], int off, int len) æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„é‡ç‚¹çœ‹çš„æ–¹æ³•æ˜¯å¸¦ä¸‰ä¸ªå‚æ•°çš„æ–¹æ³•ã€‚ åœ¨è¯¥æ–¹æ³•ä¸­ç¬¬18è¡Œã€27è¡Œï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨äº†æ— å‚çš„æŠ½è±¡çš„ read() æ–¹æ³•ã€‚ æ€»ç»“å¦‚ä¸‹ï¼š åœ¨InputStreamçˆ¶ç±»ä¸­å·²ç»å®šä¹‰å¥½äº†è¯»å–ä¸€ä¸ªå­—èŠ‚æ•°ç»„æ•°æ®çš„æ–¹æ³•æ˜¯æ¯æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ°æ•°ç»„çš„ç¬¬ä¸€ä¸ªç´¢å¼•ä½ç½®ï¼Œè¯»å–lenä¸ªå­—èŠ‚æ•°æ®ã€‚å…·ä½“å¦‚ä½•è¯»å–ä¸€ä¸ªå­—èŠ‚æ•°æ®å‘¢ï¼Ÿç”±å­ç±»å®ç°ã€‚ 6.2 ç­–ç•¥æ¨¡å¼6.2.1 æ¦‚è¿°å…ˆçœ‹ä¸‹é¢çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å»æ—…æ¸¸é€‰æ‹©å‡ºè¡Œæ¨¡å¼æœ‰å¾ˆå¤šç§ï¼Œå¯ä»¥éª‘è‡ªè¡Œè½¦ã€å¯ä»¥åæ±½è½¦ã€å¯ä»¥åç«è½¦ã€å¯ä»¥åé£æœºã€‚ ä½œä¸ºä¸€ä¸ªç¨‹åºçŒ¿ï¼Œå¼€å‘éœ€è¦é€‰æ‹©ä¸€æ¬¾å¼€å‘å·¥å…·ï¼Œå½“ç„¶å¯ä»¥è¿›è¡Œä»£ç å¼€å‘çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œå¯ä»¥é€‰æ‹©Ideaè¿›è¡Œå¼€å‘ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨eclipseè¿›è¡Œå¼€å‘ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„ä¸€äº›å¼€å‘å·¥å…·ã€‚ å®šä¹‰ï¼š â€‹ è¯¥æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä¸”ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚ç­–ç•¥æ¨¡å¼å±äºå¯¹è±¡è¡Œä¸ºæ¨¡å¼ï¼Œå®ƒé€šè¿‡å¯¹ç®—æ³•è¿›è¡Œå°è£…ï¼ŒæŠŠä½¿ç”¨ç®—æ³•çš„è´£ä»»å’Œç®—æ³•çš„å®ç°åˆ†å‰²å¼€æ¥ï¼Œå¹¶å§”æ´¾ç»™ä¸åŒçš„å¯¹è±¡å¯¹è¿™äº›ç®—æ³•è¿›è¡Œç®¡ç†ã€‚ 6.2.2 ç»“æ„ç­–ç•¥æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š æŠ½è±¡ç­–ç•¥ï¼ˆStrategyï¼‰ç±»ï¼šè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡è§’è‰²ï¼Œé€šå¸¸ç”±ä¸€ä¸ªæ¥å£æˆ–æŠ½è±¡ç±»å®ç°ã€‚æ­¤è§’è‰²ç»™å‡ºæ‰€æœ‰çš„å…·ä½“ç­–ç•¥ç±»æ‰€éœ€çš„æ¥å£ã€‚ å…·ä½“ç­–ç•¥ï¼ˆConcrete Strategyï¼‰ç±»ï¼šå®ç°äº†æŠ½è±¡ç­–ç•¥å®šä¹‰çš„æ¥å£ï¼Œæä¾›å…·ä½“çš„ç®—æ³•å®ç°æˆ–è¡Œä¸ºã€‚ ç¯å¢ƒï¼ˆContextï¼‰ç±»ï¼šæŒæœ‰ä¸€ä¸ªç­–ç•¥ç±»çš„å¼•ç”¨ï¼Œæœ€ç»ˆç»™å®¢æˆ·ç«¯è°ƒç”¨ã€‚ 6.2.3 æ¡ˆä¾‹å®ç°ã€ä¾‹ã€‘ä¿ƒé”€æ´»åŠ¨ ä¸€å®¶ç™¾è´§å…¬å¸åœ¨å®šå¹´åº¦çš„ä¿ƒé”€æ´»åŠ¨ã€‚é’ˆå¯¹ä¸åŒçš„èŠ‚æ—¥ï¼ˆæ˜¥èŠ‚ã€ä¸­ç§‹èŠ‚ã€åœ£è¯èŠ‚ï¼‰æ¨å‡ºä¸åŒçš„ä¿ƒé”€æ´»åŠ¨ï¼Œç”±ä¿ƒé”€å‘˜å°†ä¿ƒé”€æ´»åŠ¨å±•ç¤ºç»™å®¢æˆ·ã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š å®šä¹‰ç™¾è´§å…¬å¸æ‰€æœ‰ä¿ƒé”€æ´»åŠ¨çš„å…±åŒæ¥å£ 123public interface Strategy &#123; void show();&#125; å®šä¹‰å…·ä½“ç­–ç•¥è§’è‰²ï¼ˆConcrete Strategyï¼‰ï¼šæ¯ä¸ªèŠ‚æ—¥å…·ä½“çš„ä¿ƒé”€æ´»åŠ¨ 1234567891011121314151617181920212223//ä¸ºæ˜¥èŠ‚å‡†å¤‡çš„ä¿ƒé”€æ´»åŠ¨Apublic class StrategyA implements Strategy &#123; public void show() &#123; System.out.println(&quot;ä¹°ä¸€é€ä¸€&quot;); &#125;&#125;//ä¸ºä¸­ç§‹å‡†å¤‡çš„ä¿ƒé”€æ´»åŠ¨Bpublic class StrategyB implements Strategy &#123; public void show() &#123; System.out.println(&quot;æ»¡200å…ƒå‡50å…ƒ&quot;); &#125;&#125;//ä¸ºåœ£è¯å‡†å¤‡çš„ä¿ƒé”€æ´»åŠ¨Cpublic class StrategyC implements Strategy &#123; public void show() &#123; System.out.println(&quot;æ»¡1000å…ƒåŠ ä¸€å…ƒæ¢è´­ä»»æ„200å…ƒä»¥ä¸‹å•†å“&quot;); &#125;&#125; å®šä¹‰ç¯å¢ƒè§’è‰²ï¼ˆContextï¼‰ï¼šç”¨äºè¿æ¥ä¸Šä¸‹æ–‡ï¼Œå³æŠŠä¿ƒé”€æ´»åŠ¨æ¨é”€ç»™å®¢æˆ·ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºé”€å”®å‘˜ 12345678910111213public class SalesMan &#123; //æŒæœ‰æŠ½è±¡ç­–ç•¥è§’è‰²çš„å¼•ç”¨ private Strategy strategy; public SalesMan(Strategy strategy) &#123; this.strategy = strategy; &#125; //å‘å®¢æˆ·å±•ç¤ºä¿ƒé”€æ´»åŠ¨ public void salesManShow()&#123; strategy.show(); &#125; &#125; 6.2.4 ä¼˜ç¼ºç‚¹1ï¼Œä¼˜ç‚¹ï¼š ç­–ç•¥ç±»ä¹‹é—´å¯ä»¥è‡ªç”±åˆ‡æ¢ ç”±äºç­–ç•¥ç±»éƒ½å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥ä½¿å®ƒä»¬ä¹‹é—´å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚ æ˜“äºæ‰©å±• å¢åŠ ä¸€ä¸ªæ–°çš„ç­–ç•¥åªéœ€è¦æ·»åŠ ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥ç±»å³å¯ï¼ŒåŸºæœ¬ä¸éœ€è¦æ”¹å˜åŸæœ‰çš„ä»£ç ï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€œ é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶é€‰æ‹©è¯­å¥ï¼ˆif elseï¼‰ï¼Œå……åˆ†ä½“ç°é¢å‘å¯¹è±¡è®¾è®¡æ€æƒ³ã€‚ 2ï¼Œç¼ºç‚¹ï¼š å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚ ç­–ç•¥æ¨¡å¼å°†é€ æˆäº§ç”Ÿå¾ˆå¤šç­–ç•¥ç±»ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨äº«å…ƒæ¨¡å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘å¯¹è±¡çš„æ•°é‡ã€‚ 6.2.5 ä½¿ç”¨åœºæ™¯ ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§æ—¶ï¼Œå¯å°†æ¯ä¸ªç®—æ³•å°è£…åˆ°ç­–ç•¥ç±»ä¸­ã€‚ ä¸€ä¸ªç±»å®šä¹‰äº†å¤šç§è¡Œä¸ºï¼Œå¹¶ä¸”è¿™äº›è¡Œä¸ºåœ¨è¿™ä¸ªç±»çš„æ“ä½œä¸­ä»¥å¤šä¸ªæ¡ä»¶è¯­å¥çš„å½¢å¼å‡ºç°ï¼Œå¯å°†æ¯ä¸ªæ¡ä»¶åˆ†æ”¯ç§»å…¥å®ƒä»¬å„è‡ªçš„ç­–ç•¥ç±»ä¸­ä»¥ä»£æ›¿è¿™äº›æ¡ä»¶è¯­å¥ã€‚ ç³»ç»Ÿä¸­å„ç®—æ³•å½¼æ­¤å®Œå…¨ç‹¬ç«‹ï¼Œä¸”è¦æ±‚å¯¹å®¢æˆ·éšè—å…·ä½“ç®—æ³•çš„å®ç°ç»†èŠ‚æ—¶ã€‚ ç³»ç»Ÿè¦æ±‚ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ä¸åº”è¯¥çŸ¥é“å…¶æ“ä½œçš„æ•°æ®æ—¶ï¼Œå¯ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥éšè—ä¸ç®—æ³•ç›¸å…³çš„æ•°æ®ç»“æ„ã€‚ å¤šä¸ªç±»åªåŒºåˆ«åœ¨è¡¨ç°è¡Œä¸ºä¸åŒï¼Œå¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©å…·ä½“è¦æ‰§è¡Œçš„è¡Œä¸ºã€‚ 6.2.6 JDKæºç è§£æComparator ä¸­çš„ç­–ç•¥æ¨¡å¼ã€‚åœ¨Arraysç±»ä¸­æœ‰ä¸€ä¸ª sort() æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š 123456789101112public class Arrays&#123; public static &lt;T&gt; void sort(T[] a, Comparator&lt;? super T&gt; c) &#123; if (c == null) &#123; sort(a); &#125; else &#123; if (LegacyMergeSort.userRequested) legacyMergeSort(a, c); else TimSort.sort(a, 0, a.length, c, null, 0, 0); &#125; &#125;&#125; Arrayså°±æ˜¯ä¸€ä¸ªç¯å¢ƒè§’è‰²ç±»ï¼Œè¿™ä¸ªsortæ–¹æ³•å¯ä»¥ä¼ ä¸€ä¸ªæ–°ç­–ç•¥è®©Arraysæ ¹æ®è¿™ä¸ªç­–ç•¥æ¥è¿›è¡Œæ’åºã€‚å°±æ¯”å¦‚ä¸‹é¢çš„æµ‹è¯•ç±»ã€‚ 12345678910111213public class demo &#123; public static void main(String[] args) &#123; Integer[] data = &#123;12, 2, 3, 2, 4, 5, 1&#125;; // å®ç°é™åºæ’åº Arrays.sort(data, new Comparator&lt;Integer&gt;() &#123; public int compare(Integer o1, Integer o2) &#123; return o2 - o1; &#125; &#125;); System.out.println(Arrays.toString(data)); //[12, 5, 4, 3, 2, 2, 1] &#125;&#125; è¿™é‡Œæˆ‘ä»¬åœ¨è°ƒç”¨Arraysçš„sortæ–¹æ³•æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ é€’çš„æ˜¯Comparatoræ¥å£çš„å­å®ç°ç±»å¯¹è±¡ã€‚æ‰€ä»¥Comparatorå……å½“çš„æ˜¯æŠ½è±¡ç­–ç•¥è§’è‰²ï¼Œè€Œå…·ä½“çš„å­å®ç°ç±»å……å½“çš„æ˜¯å…·ä½“ç­–ç•¥è§’è‰²ã€‚ç¯å¢ƒè§’è‰²ç±»ï¼ˆArraysï¼‰åº”è¯¥æŒæœ‰æŠ½è±¡ç­–ç•¥çš„å¼•ç”¨æ¥è°ƒç”¨ã€‚é‚£ä¹ˆï¼ŒArraysç±»çš„sortæ–¹æ³•åˆ°åº•æœ‰æ²¡æœ‰ä½¿ç”¨Comparatorå­å®ç°ç±»ä¸­çš„ compare() æ–¹æ³•å—ï¼Ÿè®©æˆ‘ä»¬ç»§ç»­æŸ¥çœ‹TimSortç±»çš„ sort() æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637class TimSort&lt;T&gt; &#123; static &lt;T&gt; void sort(T[] a, int lo, int hi, Comparator&lt;? super T&gt; c, T[] work, int workBase, int workLen) &#123; assert c != null &amp;&amp; a != null &amp;&amp; lo &gt;= 0 &amp;&amp; lo &lt;= hi &amp;&amp; hi &lt;= a.length; int nRemaining = hi - lo; if (nRemaining &lt; 2) return; // Arrays of size 0 and 1 are always sorted // If array is small, do a &quot;mini-TimSort&quot; with no merges if (nRemaining &lt; MIN_MERGE) &#123; int initRunLen = countRunAndMakeAscending(a, lo, hi, c); binarySort(a, lo, hi, lo + initRunLen, c); return; &#125; ... &#125; private static &lt;T&gt; int countRunAndMakeAscending(T[] a, int lo, int hi,Comparator&lt;? super T&gt; c) &#123; assert lo &lt; hi; int runHi = lo + 1; if (runHi == hi) return 1; // Find end of run, and reverse range if descending if (c.compare(a[runHi++], a[lo]) &lt; 0) &#123; // Descending while (runHi &lt; hi &amp;&amp; c.compare(a[runHi], a[runHi - 1]) &lt; 0) runHi++; reverseRange(a, lo, runHi); &#125; else &#123; // Ascending while (runHi &lt; hi &amp;&amp; c.compare(a[runHi], a[runHi - 1]) &gt;= 0) runHi++; &#125; return runHi - lo; &#125;&#125; ä¸Šé¢çš„ä»£ç ä¸­æœ€ç»ˆä¼šè·‘åˆ° countRunAndMakeAscending() è¿™ä¸ªæ–¹æ³•ä¸­ã€‚æˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œåªç”¨äº†compareæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨Arrays.sortæ–¹æ³•åªä¼ å…·ä½“compareé‡å†™æ–¹æ³•çš„ç±»å¯¹è±¡å°±è¡Œï¼Œè¿™ä¹Ÿæ˜¯Comparatoræ¥å£ä¸­å¿…é¡»è¦å­ç±»å®ç°çš„ä¸€ä¸ªæ–¹æ³•ã€‚ 6.3 å‘½ä»¤æ¨¡å¼6.3.1 æ¦‚è¿°æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å‡ºå»åƒé¥­éƒ½ä¼šé‡åˆ°ä¸‹é¢çš„åœºæ™¯ã€‚ å®šä¹‰ï¼š å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†å‰²å¼€ã€‚è¿™æ ·ä¸¤è€…ä¹‹é—´é€šè¿‡å‘½ä»¤å¯¹è±¡è¿›è¡Œæ²Ÿé€šï¼Œè¿™æ ·æ–¹ä¾¿å°†å‘½ä»¤å¯¹è±¡è¿›è¡Œå­˜å‚¨ã€ä¼ é€’ã€è°ƒç”¨ã€å¢åŠ ä¸ç®¡ç†ã€‚ 6.3.2 ç»“æ„å‘½ä»¤æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š æŠ½è±¡å‘½ä»¤ç±»ï¼ˆCommandï¼‰è§’è‰²ï¼š å®šä¹‰å‘½ä»¤çš„æ¥å£ï¼Œå£°æ˜æ‰§è¡Œçš„æ–¹æ³•ã€‚ å…·ä½“å‘½ä»¤ï¼ˆConcrete Commandï¼‰è§’è‰²ï¼šå…·ä½“çš„å‘½ä»¤ï¼Œå®ç°å‘½ä»¤æ¥å£ï¼›é€šå¸¸ä¼šæŒæœ‰æ¥æ”¶è€…ï¼Œå¹¶è°ƒç”¨æ¥æ”¶è€…çš„åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œã€‚ å®ç°è€…&#x2F;æ¥æ”¶è€…ï¼ˆReceiverï¼‰è§’è‰²ï¼š æ¥æ”¶è€…ï¼ŒçœŸæ­£æ‰§è¡Œå‘½ä»¤çš„å¯¹è±¡ã€‚ä»»ä½•ç±»éƒ½å¯èƒ½æˆä¸ºä¸€ä¸ªæ¥æ”¶è€…ï¼Œåªè¦å®ƒèƒ½å¤Ÿå®ç°å‘½ä»¤è¦æ±‚å®ç°çš„ç›¸åº”åŠŸèƒ½ã€‚ è°ƒç”¨è€…&#x2F;è¯·æ±‚è€…ï¼ˆInvokerï¼‰è§’è‰²ï¼š è¦æ±‚å‘½ä»¤å¯¹è±¡æ‰§è¡Œè¯·æ±‚ï¼Œé€šå¸¸ä¼šæŒæœ‰å‘½ä»¤å¯¹è±¡ï¼Œå¯ä»¥æŒæœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ã€‚è¿™ä¸ªæ˜¯å®¢æˆ·ç«¯çœŸæ­£è§¦å‘å‘½ä»¤å¹¶è¦æ±‚å‘½ä»¤æ‰§è¡Œç›¸åº”æ“ä½œçš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯è¯´ç›¸å½“äºä½¿ç”¨å‘½ä»¤å¯¹è±¡çš„å…¥å£ã€‚ 6.3.3 æ¡ˆä¾‹å®ç°å°†ä¸Šé¢çš„æ¡ˆä¾‹ç”¨ä»£ç å®ç°ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦åˆ†æå‘½ä»¤æ¨¡å¼çš„è§’è‰²åœ¨è¯¥æ¡ˆä¾‹ä¸­ç”±è°æ¥å……å½“ã€‚ æœåŠ¡å‘˜ï¼š å°±æ˜¯è°ƒç”¨è€…è§’è‰²ï¼Œç”±å¥¹æ¥å‘èµ·å‘½ä»¤ã€‚ èµ„æ·±å¤§å¨ï¼š å°±æ˜¯æ¥æ”¶è€…è§’è‰²ï¼ŒçœŸæ­£å‘½ä»¤æ‰§è¡Œçš„å¯¹è±¡ã€‚ è®¢å•ï¼š å‘½ä»¤ä¸­åŒ…å«è®¢å•ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116public interface Command &#123; void execute();//åªéœ€è¦å®šä¹‰ä¸€ä¸ªç»Ÿä¸€çš„æ‰§è¡Œæ–¹æ³•&#125;public class OrderCommand implements Command &#123; //æŒæœ‰æ¥å—è€…å¯¹è±¡ private SeniorChef receiver; private Order order; public OrderCommand(SeniorChef receiver, Order order)&#123; this.receiver = receiver; this.order = order; &#125; public void execute() &#123; System.out.println(order.getDiningTable() + &quot;æ¡Œçš„è®¢å•ï¼š&quot;); Set&lt;String&gt; keys = order.getFoodDic().keySet(); for (String key : keys) &#123; receiver.makeFood(order.getFoodDic().get(key),key); &#125; try &#123; Thread.sleep(100);//åœé¡¿ä¸€ä¸‹ æ¨¡æ‹Ÿåšé¥­çš„è¿‡ç¨‹ &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(order.getDiningTable() + &quot;æ¡Œçš„é¥­å¼„å¥½äº†&quot;); &#125;&#125;public class Order &#123; // é¤æ¡Œå·ç  private int diningTable; // ç”¨æ¥å­˜å‚¨é¤åå¹¶è®°å½•ä»½æ•° private Map&lt;String, Integer&gt; foodDic = new HashMap&lt;String, Integer&gt;(); public int getDiningTable() &#123; return diningTable; &#125; public void setDiningTable(int diningTable) &#123; this.diningTable = diningTable; &#125; public Map&lt;String, Integer&gt; getFoodDic() &#123; return foodDic; &#125; public void setFoodDic(String name, int num) &#123; foodDic.put(name,num); &#125;&#125;// èµ„æ·±å¤§å¨ç±» æ˜¯å‘½ä»¤çš„Receiverpublic class SeniorChef &#123; public void makeFood(int num,String foodName) &#123; System.out.println(num + &quot;ä»½&quot; + foodName); &#125;&#125;public class Waitor &#123; private ArrayList&lt;Command&gt; commands;//å¯ä»¥æŒæœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ public Waitor() &#123; commands = new ArrayList(); &#125; public void setCommand(Command cmd)&#123; commands.add(cmd); &#125; // å‘å‡ºå‘½ä»¤ å–Š è®¢å•æ¥äº†ï¼Œå¨å¸ˆå¼€å§‹æ‰§è¡Œ public void orderUp() &#123; System.out.println(&quot;ç¾å¥³æœåŠ¡å‘˜ï¼šå®å’šï¼Œå¤§å¨ï¼Œæ–°è®¢å•æ¥äº†.......&quot;); for (int i = 0; i &lt; commands.size(); i++) &#123; Command cmd = commands.get(i); if (cmd != null) &#123; cmd.execute(); &#125; &#125; &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; //åˆ›å»º2ä¸ªorder Order order1 = new Order(); order1.setDiningTable(1); order1.getFoodDic().put(&quot;è¥¿çº¢æŸ¿é¸¡è›‹é¢&quot;,1); order1.getFoodDic().put(&quot;å°æ¯å¯ä¹&quot;,2); Order order2 = new Order(); order2.setDiningTable(3); order2.getFoodDic().put(&quot;å°–æ¤’è‚‰ä¸ç›–é¥­&quot;,1); order2.getFoodDic().put(&quot;å°æ¯é›ªç¢§&quot;,1); //åˆ›å»ºæ¥æ”¶è€… SeniorChef receiver=new SeniorChef(); //å°†è®¢å•å’Œæ¥æ”¶è€…å°è£…æˆå‘½ä»¤å¯¹è±¡ OrderCommand cmd1 = new OrderCommand(receiver, order1); OrderCommand cmd2 = new OrderCommand(receiver, order2); //åˆ›å»ºè°ƒç”¨è€… waitor Waitor invoker = new Waitor(); invoker.setCommand(cmd1); invoker.setCommand(cmd2); //å°†è®¢å•å¸¦åˆ°æŸœå° å¹¶å‘å¨å¸ˆå–Š è®¢å•æ¥äº† invoker.orderUp(); &#125;&#125; 6.3.4 ä¼˜ç¼ºç‚¹1ï¼Œä¼˜ç‚¹ï¼š é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚å‘½ä»¤æ¨¡å¼èƒ½å°†è°ƒç”¨æ“ä½œçš„å¯¹è±¡ä¸å®ç°è¯¥æ“ä½œçš„å¯¹è±¡è§£è€¦ã€‚ å¢åŠ æˆ–åˆ é™¤å‘½ä»¤éå¸¸æ–¹ä¾¿ã€‚é‡‡ç”¨å‘½ä»¤æ¨¡å¼å¢åŠ ä¸åˆ é™¤å‘½ä»¤ä¸ä¼šå½±å“å…¶ä»–ç±»ï¼Œå®ƒæ»¡è¶³â€œå¼€é—­åŸåˆ™â€ï¼Œå¯¹æ‰©å±•æ¯”è¾ƒçµæ´»ã€‚ å¯ä»¥å®ç°å®å‘½ä»¤ã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸ç»„åˆæ¨¡å¼ç»“åˆï¼Œå°†å¤šä¸ªå‘½ä»¤è£…é…æˆä¸€ä¸ªç»„åˆå‘½ä»¤ï¼Œå³å®å‘½ä»¤ã€‚ æ–¹ä¾¿å®ç° Undo å’Œ Redo æ“ä½œã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸åé¢ä»‹ç»çš„å¤‡å¿˜å½•æ¨¡å¼ç»“åˆï¼Œå®ç°å‘½ä»¤çš„æ’¤é”€ä¸æ¢å¤ã€‚ 2ï¼Œç¼ºç‚¹ï¼š ä½¿ç”¨å‘½ä»¤æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ã€‚ ç³»ç»Ÿç»“æ„æ›´åŠ å¤æ‚ã€‚ 6.3.5 ä½¿ç”¨åœºæ™¯ ç³»ç»Ÿéœ€è¦å°†è¯·æ±‚è°ƒç”¨è€…å’Œè¯·æ±‚æ¥æ”¶è€…è§£è€¦ï¼Œä½¿å¾—è°ƒç”¨è€…å’Œæ¥æ”¶è€…ä¸ç›´æ¥äº¤äº’ã€‚ ç³»ç»Ÿéœ€è¦åœ¨ä¸åŒçš„æ—¶é—´æŒ‡å®šè¯·æ±‚ã€å°†è¯·æ±‚æ’é˜Ÿå’Œæ‰§è¡Œè¯·æ±‚ã€‚ ç³»ç»Ÿéœ€è¦æ”¯æŒå‘½ä»¤çš„æ’¤é”€(Undo)æ“ä½œå’Œæ¢å¤(Redo)æ“ä½œã€‚ 6.3.6 JDKæºç è§£æRunableæ˜¯ä¸€ä¸ªå…¸å‹å‘½ä»¤æ¨¡å¼ï¼ŒRunnableæ‹…å½“å‘½ä»¤çš„è§’è‰²ï¼ŒThreadå……å½“çš„æ˜¯è°ƒç”¨è€…ï¼Œstartæ–¹æ³•å°±æ˜¯å…¶æ‰§è¡Œæ–¹æ³• 12345678910111213141516171819202122232425262728293031//å‘½ä»¤æ¥å£(æŠ½è±¡å‘½ä»¤è§’è‰²)public interface Runnable &#123; public abstract void run();&#125;//è°ƒç”¨è€…public class Thread implements Runnable &#123; private Runnable target; public synchronized void start() &#123; if (threadStatus != 0) throw new IllegalThreadStateException(); group.add(this); boolean started = false; try &#123; start0(); started = true; &#125; finally &#123; try &#123; if (!started) &#123; group.threadStartFailed(this); &#125; &#125; catch (Throwable ignore) &#123; &#125; &#125; &#125; private native void start0();&#125; ä¼šè°ƒç”¨ä¸€ä¸ªnativeæ–¹æ³•start0(),è°ƒç”¨ç³»ç»Ÿæ–¹æ³•ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹ã€‚è€Œæ¥æ”¶è€…æ˜¯å¯¹ç¨‹åºå‘˜å¼€æ”¾çš„ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰æ¥æ”¶è€…ã€‚ 1234567891011121314/** * jdk Runnable å‘½ä»¤æ¨¡å¼ * TurnOffThread ï¼š å±äºå…·ä½“ */public class TurnOffThread implements Runnable&#123; private Receiver receiver; public TurnOffThread(Receiver receiver) &#123; this.receiver = receiver; &#125; public void run() &#123; receiver.turnOFF(); &#125;&#125; 1234567891011/** * æµ‹è¯•ç±» */public class Demo &#123; public static void main(String[] args) &#123; Receiver receiver = new Receiver(); TurnOffThread turnOffThread = new TurnOffThread(receiver); Thread thread = new Thread(turnOffThread); thread.start(); &#125;&#125; 6.4 è´£ä»»é“¾æ¨¡å¼6.4.1 æ¦‚è¿°åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå¸¸å¸¸ä¼šå‡ºç°è¿™æ ·çš„äº‹ä¾‹ï¼šä¸€ä¸ªè¯·æ±‚æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†ï¼Œä½†æ¯ä¸ªå¯¹è±¡çš„å¤„ç†æ¡ä»¶æˆ–æƒé™ä¸åŒã€‚ä¾‹å¦‚ï¼Œå…¬å¸å‘˜å·¥è¯·å‡ï¼Œå¯æ‰¹å‡çš„é¢†å¯¼æœ‰éƒ¨é—¨è´Ÿè´£äººã€å‰¯æ€»ç»ç†ã€æ€»ç»ç†ç­‰ï¼Œä½†æ¯ä¸ªé¢†å¯¼èƒ½æ‰¹å‡†çš„å¤©æ•°ä¸åŒï¼Œå‘˜å·¥å¿…é¡»æ ¹æ®è‡ªå·±è¦è¯·å‡çš„å¤©æ•°å»æ‰¾ä¸åŒçš„é¢†å¯¼ç­¾åï¼Œä¹Ÿå°±æ˜¯è¯´å‘˜å·¥å¿…é¡»è®°ä½æ¯ä¸ªé¢†å¯¼çš„å§“åã€ç”µè¯å’Œåœ°å€ç­‰ä¿¡æ¯ï¼Œè¿™å¢åŠ äº†éš¾åº¦ã€‚è¿™æ ·çš„ä¾‹å­è¿˜æœ‰å¾ˆå¤šï¼Œå¦‚æ‰¾é¢†å¯¼å‡ºå·®æŠ¥é”€ã€ç”Ÿæ´»ä¸­çš„â€œå‡»é¼“ä¼ èŠ±â€æ¸¸æˆç­‰ã€‚ å®šä¹‰ï¼š åˆåèŒè´£é“¾æ¨¡å¼ï¼Œä¸ºäº†é¿å…è¯·æ±‚å‘é€è€…ä¸å¤šä¸ªè¯·æ±‚å¤„ç†è€…è€¦åˆåœ¨ä¸€èµ·ï¼Œå°†æ‰€æœ‰è¯·æ±‚çš„å¤„ç†è€…é€šè¿‡å‰ä¸€å¯¹è±¡è®°ä½å…¶ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è€Œè¿æˆä¸€æ¡é“¾ï¼›å½“æœ‰è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œå¯å°†è¯·æ±‚æ²¿ç€è¿™æ¡é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚ 6.4.2 ç»“æ„èŒè´£é“¾æ¨¡å¼ä¸»è¦åŒ…å«ä»¥ä¸‹è§’è‰²: æŠ½è±¡å¤„ç†è€…ï¼ˆHandlerï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼ŒåŒ…å«æŠ½è±¡å¤„ç†æ–¹æ³•å’Œä¸€ä¸ªåç»§è¿æ¥ã€‚ å…·ä½“å¤„ç†è€…ï¼ˆConcrete Handlerï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡å¤„ç†è€…çš„å¤„ç†æ–¹æ³•ï¼Œåˆ¤æ–­èƒ½å¦å¤„ç†æœ¬æ¬¡è¯·æ±‚ï¼Œå¦‚æœå¯ä»¥å¤„ç†è¯·æ±‚åˆ™å¤„ç†ï¼Œå¦åˆ™å°†è¯¥è¯·æ±‚è½¬ç»™å®ƒçš„åç»§è€…ã€‚ å®¢æˆ·ç±»ï¼ˆClientï¼‰è§’è‰²ï¼šåˆ›å»ºå¤„ç†é“¾ï¼Œå¹¶å‘é“¾å¤´çš„å…·ä½“å¤„ç†è€…å¯¹è±¡æäº¤è¯·æ±‚ï¼Œå®ƒä¸å…³å¿ƒå¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’è¿‡ç¨‹ã€‚ 6.4.3 æ¡ˆä¾‹å®ç°ç°éœ€è¦å¼€å‘ä¸€ä¸ªè¯·å‡æµç¨‹æ§åˆ¶ç³»ç»Ÿã€‚è¯·å‡ä¸€å¤©ä»¥ä¸‹çš„å‡åªéœ€è¦å°ç»„é•¿åŒæ„å³å¯ï¼›è¯·å‡1å¤©åˆ°3å¤©çš„å‡è¿˜éœ€è¦éƒ¨é—¨ç»ç†åŒæ„ï¼›è¯·æ±‚3å¤©åˆ°7å¤©è¿˜éœ€è¦æ€»ç»ç†åŒæ„æ‰è¡Œã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138//è¯·å‡æ¡public class LeaveRequest &#123; private String name;//å§“å private int num;//è¯·å‡å¤©æ•° private String content;//è¯·å‡å†…å®¹ public LeaveRequest(String name, int num, String content) &#123; this.name = name; this.num = num; this.content = content; &#125; public String getName() &#123; return name; &#125; public int getNum() &#123; return num; &#125; public String getContent() &#123; return content; &#125;&#125;//å¤„ç†è€…æŠ½è±¡ç±»public abstract class Handler &#123; protected final static int NUM_ONE = 1; protected final static int NUM_THREE = 3; protected final static int NUM_SEVEN = 7; //è¯¥é¢†å¯¼å¤„ç†çš„è¯·å‡å¤©æ•°åŒºé—´ private int numStart; private int numEnd; //é¢†å¯¼ä¸Šé¢è¿˜æœ‰é¢†å¯¼ private Handler nextHandler; //è®¾ç½®è¯·å‡å¤©æ•°èŒƒå›´ ä¸Šä¸å°é¡¶ public Handler(int numStart) &#123; this.numStart = numStart; &#125; //è®¾ç½®è¯·å‡å¤©æ•°èŒƒå›´ public Handler(int numStart, int numEnd) &#123; this.numStart = numStart; this.numEnd = numEnd; &#125; //è®¾ç½®ä¸Šçº§é¢†å¯¼ public void setNextHandler(Handler nextHandler)&#123; this.nextHandler = nextHandler; &#125; //æäº¤è¯·å‡æ¡ public final void submit(LeaveRequest leave)&#123; if(0 == this.numStart)&#123; return; &#125; //å¦‚æœè¯·å‡å¤©æ•°è¾¾åˆ°è¯¥é¢†å¯¼è€…çš„å¤„ç†è¦æ±‚ if(leave.getNum() &gt;= this.numStart)&#123; this.handleLeave(leave); //å¦‚æœè¿˜æœ‰ä¸Šçº§ å¹¶ä¸”è¯·å‡å¤©æ•°è¶…è¿‡äº†å½“å‰é¢†å¯¼çš„å¤„ç†èŒƒå›´ if(null != this.nextHandler &amp;&amp; leave.getNum() &gt; numEnd)&#123; this.nextHandler.submit(leave);//ç»§ç»­æäº¤ &#125; else &#123; System.out.println(&quot;æµç¨‹ç»“æŸ&quot;); &#125; &#125; &#125; //å„çº§é¢†å¯¼å¤„ç†è¯·å‡æ¡æ–¹æ³• protected abstract void handleLeave(LeaveRequest leave);&#125;//å°ç»„é•¿public class GroupLeader extends Handler &#123; public GroupLeader() &#123; //å°ç»„é•¿å¤„ç†1-3å¤©çš„è¯·å‡ super(Handler.NUM_ONE, Handler.NUM_THREE); &#125; @Override protected void handleLeave(LeaveRequest leave) &#123; System.out.println(leave.getName() + &quot;è¯·å‡&quot; + leave.getNum() + &quot;å¤©,&quot; + leave.getContent() + &quot;ã€‚&quot;); System.out.println(&quot;å°ç»„é•¿å®¡æ‰¹ï¼šåŒæ„ã€‚&quot;); &#125;&#125;//éƒ¨é—¨ç»ç†public class Manager extends Handler &#123; public Manager() &#123; //éƒ¨é—¨ç»ç†å¤„ç†3-7å¤©çš„è¯·å‡ super(Handler.NUM_THREE, Handler.NUM_SEVEN); &#125; @Override protected void handleLeave(LeaveRequest leave) &#123; System.out.println(leave.getName() + &quot;è¯·å‡&quot; + leave.getNum() + &quot;å¤©,&quot; + leave.getContent() + &quot;ã€‚&quot;); System.out.println(&quot;éƒ¨é—¨ç»ç†å®¡æ‰¹ï¼šåŒæ„ã€‚&quot;); &#125;&#125;//æ€»ç»ç†public class GeneralManager extends Handler &#123; public GeneralManager() &#123; //éƒ¨é—¨ç»ç†å¤„ç†7å¤©ä»¥ä¸Šçš„è¯·å‡ super(Handler.NUM_SEVEN); &#125; @Override protected void handleLeave(LeaveRequest leave) &#123; System.out.println(leave.getName() + &quot;è¯·å‡&quot; + leave.getNum() + &quot;å¤©,&quot; + leave.getContent() + &quot;ã€‚&quot;); System.out.println(&quot;æ€»ç»ç†å®¡æ‰¹ï¼šåŒæ„ã€‚&quot;); &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; //è¯·å‡æ¡æ¥ä¸€å¼  LeaveRequest leave = new LeaveRequest(&quot;å°èŠ±&quot;,5,&quot;èº«ä½“ä¸é€‚&quot;); //å„ä½é¢†å¯¼ GroupLeader groupLeader = new GroupLeader(); Manager manager = new Manager(); GeneralManager generalManager = new GeneralManager(); groupLeader.setNextHandler(manager);//å°ç»„é•¿çš„é¢†å¯¼æ˜¯éƒ¨é—¨ç»ç† manager.setNextHandler(generalManager);//éƒ¨é—¨ç»ç†çš„é¢†å¯¼æ˜¯æ€»ç»ç† //ä¹‹æ‰€ä»¥åœ¨è¿™é‡Œè®¾ç½®ä¸Šçº§é¢†å¯¼ï¼Œæ˜¯å› ä¸ºå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚æ¥æ›´æ”¹è®¾ç½®ï¼Œå¦‚æœå®æˆ˜ä¸­ä¸Šçº§é¢†å¯¼äººéƒ½æ˜¯å›ºå®šçš„ï¼Œåˆ™å¯ä»¥ç§»åˆ°é¢†å¯¼å®ç°ç±»ä¸­ã€‚ //æäº¤ç”³è¯· groupLeader.submit(leave); &#125;&#125; 6.4.4 ä¼˜ç¼ºç‚¹1ï¼Œä¼˜ç‚¹ï¼š é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ è¯¥æ¨¡å¼é™ä½äº†è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…çš„è€¦åˆåº¦ã€‚ å¢å¼ºäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ã€‚ å¢å¼ºäº†ç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§ å½“å·¥ä½œæµç¨‹å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥åŠ¨æ€åœ°æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…ä¿®æ”¹å®ƒä»¬çš„æ¬¡åºï¼Œä¹Ÿå¯åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚ è´£ä»»é“¾ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„è¿æ¥ ä¸€ä¸ªå¯¹è±¡åªéœ€ä¿æŒä¸€ä¸ªæŒ‡å‘å…¶åç»§è€…çš„å¼•ç”¨ï¼Œä¸éœ€ä¿æŒå…¶ä»–æ‰€æœ‰å¤„ç†è€…çš„å¼•ç”¨ï¼Œè¿™é¿å…äº†ä½¿ç”¨ä¼—å¤šçš„ if æˆ–è€… ifÂ·Â·Â·else è¯­å¥ã€‚ è´£ä»»åˆ†æ‹… æ¯ä¸ªç±»åªéœ€è¦å¤„ç†è‡ªå·±è¯¥å¤„ç†çš„å·¥ä½œï¼Œä¸èƒ½å¤„ç†çš„ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡å®Œæˆï¼Œæ˜ç¡®å„ç±»çš„è´£ä»»èŒƒå›´ï¼Œç¬¦åˆç±»çš„å•ä¸€èŒè´£åŸåˆ™ã€‚ 2ï¼Œç¼ºç‚¹ï¼š ä¸èƒ½ä¿è¯æ¯ä¸ªè¯·æ±‚ä¸€å®šè¢«å¤„ç†ã€‚ç”±äºä¸€ä¸ªè¯·æ±‚æ²¡æœ‰æ˜ç¡®çš„æ¥æ”¶è€…ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šè¢«å¤„ç†ï¼Œè¯¥è¯·æ±‚å¯èƒ½ä¸€ç›´ä¼ åˆ°é“¾çš„æœ«ç«¯éƒ½å¾—ä¸åˆ°å¤„ç†ã€‚ å¯¹æ¯”è¾ƒé•¿çš„èŒè´£é“¾ï¼Œè¯·æ±‚çš„å¤„ç†å¯èƒ½æ¶‰åŠå¤šä¸ªå¤„ç†å¯¹è±¡ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ã€‚ èŒè´£é“¾å»ºç«‹çš„åˆç†æ€§è¦é å®¢æˆ·ç«¯æ¥ä¿è¯ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ï¼Œå¯èƒ½ä¼šç”±äºèŒè´£é“¾çš„é”™è¯¯è®¾ç½®è€Œå¯¼è‡´ç³»ç»Ÿå‡ºé”™ï¼Œå¦‚å¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨ã€‚ 6.4.5 æºç è§£æåœ¨javaWebåº”ç”¨å¼€å‘ä¸­ï¼ŒFilterChainæ˜¯èŒè´£é“¾ï¼ˆè¿‡æ»¤å™¨ï¼‰æ¨¡å¼çš„å…¸å‹åº”ç”¨ï¼Œä»¥ä¸‹æ˜¯Filterçš„æ¨¡æ‹Ÿå®ç°åˆ†æ: æ¨¡æ‹Ÿwebè¯·æ±‚Requestä»¥åŠwebå“åº”Response 1234567public interface Request&#123; &#125;public interface Response&#123; &#125; æ¨¡æ‹Ÿwebè¿‡æ»¤å™¨Filter 123public interface Filter &#123; public void doFilter(Request req,Response res,FilterChain c);&#125; æ¨¡æ‹Ÿå®ç°å…·ä½“è¿‡æ»¤å™¨ 12345678910111213141516171819202122232425public class FirstFilter implements Filter &#123; @Override public void doFilter(Request request, Response response, FilterChain chain) &#123; System.out.println(&quot;è¿‡æ»¤å™¨1 å‰ç½®å¤„ç†&quot;); // å…ˆæ‰§è¡Œæ‰€æœ‰requestå†å€’åºæ‰§è¡Œæ‰€æœ‰response chain.doFilter(request, response); System.out.println(&quot;è¿‡æ»¤å™¨1 åç½®å¤„ç†&quot;); &#125;&#125;public class SecondFilter implements Filter &#123; @Override public void doFilter(Request request, Response response, FilterChain chain) &#123; System.out.println(&quot;è¿‡æ»¤å™¨2 å‰ç½®å¤„ç†&quot;); // å…ˆæ‰§è¡Œæ‰€æœ‰requestå†å€’åºæ‰§è¡Œæ‰€æœ‰response chain.doFilter(request, response); System.out.println(&quot;è¿‡æ»¤å™¨2 åç½®å¤„ç†&quot;); &#125;&#125; æ¨¡æ‹Ÿå®ç°è¿‡æ»¤å™¨é“¾FilterChain 123456789101112131415161718192021public class FilterChain &#123; private List&lt;Filter&gt; filters = new ArrayList&lt;Filter&gt;(); private int index = 0; // é“¾å¼è°ƒç”¨ public FilterChain addFilter(Filter filter) &#123; this.filters.add(filter); return this; &#125; public void doFilter(Request request, Response response) &#123; if (index == filters.size()) &#123; return; &#125; Filter filter = filters.get(index); index++; filter.doFilter(request, response, this); &#125;&#125; æµ‹è¯•ç±» 12345678910public class Client &#123; public static void main(String[] args) &#123; Request req = null; Response res = null ; FilterChain filterChain = new FilterChain(); filterChain.addFilter(new FirstFilter()).addFilter(new SecondFilter()); filterChain.doFilter(req,res); &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è®¾è®¡æ¨¡å¼ï¼ˆä¸‰ï¼‰","slug":"è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆä¸‰ï¼‰","date":"2023-06-16T05:55:17.000Z","updated":"2023-06-16T05:57:12.599Z","comments":true,"path":"2023/06/16/è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆä¸‰ï¼‰/","link":"","permalink":"http://example.com/2023/06/16/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%89%EF%BC%89/","excerpt":"","text":"5ï¼Œç»“æ„å‹æ¨¡å¼ç»“æ„å‹æ¨¡å¼æè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§å¸ƒå±€ç»„æˆæ›´å¤§çš„ç»“æ„ã€‚å®ƒåˆ†ä¸ºç±»ç»“æ„å‹æ¨¡å¼å’Œå¯¹è±¡ç»“æ„å‹æ¨¡å¼ï¼Œå‰è€…é‡‡ç”¨ç»§æ‰¿æœºåˆ¶æ¥ç»„ç»‡æ¥å£å’Œç±»ï¼Œåè€…é‡†ç”¨ç»„åˆæˆ–èšåˆæ¥ç»„åˆå¯¹è±¡ã€‚ ç”±äºç»„åˆå…³ç³»æˆ–èšåˆå…³ç³»æ¯”ç»§æ‰¿å…³ç³»è€¦åˆåº¦ä½ï¼Œæ»¡è¶³â€œåˆæˆå¤ç”¨åŸåˆ™â€ï¼Œæ‰€ä»¥å¯¹è±¡ç»“æ„å‹æ¨¡å¼æ¯”ç±»ç»“æ„å‹æ¨¡å¼å…·æœ‰æ›´å¤§çš„çµæ´»æ€§ã€‚ ç»“æ„å‹æ¨¡å¼åˆ†ä¸ºä»¥ä¸‹ 7 ç§ï¼š ä»£ç†æ¨¡å¼ é€‚é…å™¨æ¨¡å¼ è£…é¥°è€…æ¨¡å¼ æ¡¥æ¥æ¨¡å¼ å¤–è§‚æ¨¡å¼ ç»„åˆæ¨¡å¼ äº«å…ƒæ¨¡å¼ 5.1 ä»£ç†æ¨¡å¼5.1.1 æ¦‚è¿°ç”±äºæŸäº›åŸå› éœ€è¦ç»™æŸå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®ã€‚è¿™æ—¶ï¼Œè®¿é—®å¯¹è±¡ä¸é€‚åˆæˆ–è€…ä¸èƒ½ç›´æ¥å¼•ç”¨ç›®æ ‡å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡ä½œä¸ºè®¿é—®å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´çš„ä¸­ä»‹ã€‚ Javaä¸­çš„ä»£ç†æŒ‰ç…§ä»£ç†ç±»ç”Ÿæˆæ—¶æœºä¸åŒåˆåˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚é™æ€ä»£ç†ä»£ç†ç±»åœ¨ç¼–è¯‘æœŸå°±ç”Ÿæˆï¼Œè€ŒåŠ¨æ€ä»£ç†ä»£ç†ç±»åˆ™æ˜¯åœ¨Javaè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆã€‚åŠ¨æ€ä»£ç†åˆæœ‰JDKä»£ç†å’ŒCGLibä»£ç†ä¸¤ç§ã€‚ 5.1.2 ç»“æ„ä»£ç†ï¼ˆProxyï¼‰æ¨¡å¼åˆ†ä¸ºä¸‰ç§è§’è‰²ï¼š æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰ç±»ï¼š é€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»å£°æ˜çœŸå®ä¸»é¢˜å’Œä»£ç†å¯¹è±¡å®ç°çš„ä¸šåŠ¡æ–¹æ³•ã€‚ çœŸå®ä¸»é¢˜ï¼ˆReal Subjectï¼‰ç±»ï¼š å®ç°äº†æŠ½è±¡ä¸»é¢˜ä¸­çš„å…·ä½“ä¸šåŠ¡ï¼Œæ˜¯ä»£ç†å¯¹è±¡æ‰€ä»£è¡¨çš„çœŸå®å¯¹è±¡ï¼Œæ˜¯æœ€ç»ˆè¦å¼•ç”¨çš„å¯¹è±¡ã€‚ ä»£ç†ï¼ˆProxyï¼‰ç±» ï¼š æä¾›äº†ä¸çœŸå®ä¸»é¢˜ç›¸åŒçš„æ¥å£ï¼Œå…¶å†…éƒ¨å«æœ‰å¯¹çœŸå®ä¸»é¢˜çš„å¼•ç”¨ï¼Œå®ƒå¯ä»¥è®¿é—®ã€æ§åˆ¶æˆ–æ‰©å±•çœŸå®ä¸»é¢˜çš„åŠŸèƒ½ã€‚ 5.1.3 é™æ€ä»£ç†æˆ‘ä»¬é€šè¿‡æ¡ˆä¾‹æ¥æ„Ÿå—ä¸€ä¸‹é™æ€ä»£ç†ã€‚ ã€ä¾‹ã€‘ç«è½¦ç«™å–ç¥¨ å¦‚æœè¦ä¹°ç«è½¦ç¥¨çš„è¯ï¼Œéœ€è¦å»ç«è½¦ç«™ä¹°ç¥¨ï¼Œåè½¦åˆ°ç«è½¦ç«™ï¼Œæ’é˜Ÿç­‰ä¸€ç³»åˆ—çš„æ“ä½œï¼Œæ˜¾ç„¶æ¯”è¾ƒéº»çƒ¦ã€‚è€Œç«è½¦ç«™åœ¨å¤šä¸ªåœ°æ–¹éƒ½æœ‰ä»£å”®ç‚¹ï¼Œæˆ‘ä»¬å»ä»£å”®ç‚¹ä¹°ç¥¨å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚è¿™ä¸ªä¾‹å­å…¶å®å°±æ˜¯å…¸å‹çš„ä»£ç†æ¨¡å¼ï¼Œç«è½¦ç«™æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œä»£å”®ç‚¹æ˜¯ä»£ç†å¯¹è±¡ã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031//å–ç¥¨æ¥å£public interface SellTickets &#123; void sell();&#125;//ç«è½¦ç«™ ç«è½¦ç«™å…·æœ‰å–ç¥¨åŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦å®ç°SellTicketsæ¥å£public class TrainStation implements SellTickets &#123; public void sell() &#123; System.out.println(&quot;ç«è½¦ç«™å–ç¥¨&quot;); &#125;&#125;//ä»£å”®ç‚¹public class ProxyPoint implements SellTickets &#123; private TrainStation station = new TrainStation(); public void sell() &#123; System.out.println(&quot;ä»£ç†ç‚¹æ”¶å–ä¸€äº›æœåŠ¡è´¹ç”¨&quot;); station.sell(); &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; ProxyPoint pp = new ProxyPoint(); pp.sell(); &#125;&#125; ä»ä¸Šé¢ä»£ç ä¸­å¯ä»¥çœ‹å‡ºæµ‹è¯•ç±»ç›´æ¥è®¿é—®çš„æ˜¯ProxyPointç±»å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ProxyPointä½œä¸ºè®¿é—®å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡çš„ä¸­ä»‹ã€‚åŒæ—¶ä¹Ÿå¯¹sellæ–¹æ³•è¿›è¡Œäº†å¢å¼ºï¼ˆä»£ç†ç‚¹æ”¶å–ä¸€äº›æœåŠ¡è´¹ç”¨ï¼‰ã€‚ 5.1.4 JDKåŠ¨æ€ä»£ç†æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°ä¸Šé¢æ¡ˆä¾‹ï¼Œå…ˆè¯´è¯´JDKæä¾›çš„åŠ¨æ€ä»£ç†ã€‚Javaä¸­æä¾›äº†ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»Proxyï¼ŒProxyå¹¶ä¸æ˜¯æˆ‘ä»¬ä¸Šè¿°æ‰€è¯´çš„ä»£ç†å¯¹è±¡çš„ç±»ï¼Œè€Œæ˜¯æä¾›äº†ä¸€ä¸ªåˆ›å»ºä»£ç†å¯¹è±¡çš„é™æ€æ–¹æ³•ï¼ˆnewProxyInstanceæ–¹æ³•ï¼‰æ¥è·å–ä»£ç†å¯¹è±¡ã€‚ ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657//å–ç¥¨æ¥å£public interface SellTickets &#123; void sell();&#125;//ç«è½¦ç«™ ç«è½¦ç«™å…·æœ‰å–ç¥¨åŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦å®ç°SellTicketsæ¥å£public class TrainStation implements SellTickets &#123; public void sell() &#123; System.out.println(&quot;ç«è½¦ç«™å–ç¥¨&quot;); &#125;&#125;//ä»£ç†å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºä»£ç†å¯¹è±¡public class ProxyFactory &#123; private TrainStation station = new TrainStation(); public SellTickets getProxyObject() &#123; //ä½¿ç”¨Proxyè·å–ä»£ç†å¯¹è±¡ /* newProxyInstance()æ–¹æ³•å‚æ•°è¯´æ˜ï¼š ClassLoader loader ï¼š ç±»åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½ä»£ç†ç±»ï¼Œä½¿ç”¨çœŸå®å¯¹è±¡çš„ç±»åŠ è½½å™¨å³å¯ Class&lt;?&gt;[] interfaces ï¼š çœŸå®å¯¹è±¡æ‰€å®ç°çš„æ¥å£ï¼Œä»£ç†æ¨¡å¼çœŸå®å¯¹è±¡å’Œä»£ç†å¯¹è±¡å®ç°ç›¸åŒçš„æ¥å£ InvocationHandler h ï¼š ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åº */ SellTickets sellTickets = (SellTickets) Proxy.newProxyInstance(station.getClass().getClassLoader(), station.getClass().getInterfaces(), new InvocationHandler() &#123; /* InvocationHandlerä¸­invokeæ–¹æ³•å‚æ•°è¯´æ˜ï¼š proxy ï¼š ä»£ç†å¯¹è±¡ method ï¼š å¯¹åº”äºåœ¨ä»£ç†å¯¹è±¡ä¸Šè°ƒç”¨çš„æ¥å£æ–¹æ³•çš„ Method å®ä¾‹ args ï¼š ä»£ç†å¯¹è±¡è°ƒç”¨æ¥å£æ–¹æ³•æ—¶ä¼ é€’çš„å®é™…å‚æ•° */ public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(&quot;ä»£ç†ç‚¹æ”¶å–ä¸€äº›æœåŠ¡è´¹ç”¨(JDKåŠ¨æ€ä»£ç†æ–¹å¼)&quot;); //æ‰§è¡ŒçœŸå®å¯¹è±¡ Object result = method.invoke(station, args); return result; &#125; &#125;); return sellTickets; &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; //è·å–ä»£ç†å¯¹è±¡ ProxyFactory factory = new ProxyFactory(); SellTickets proxyObject = factory.getProxyObject(); proxyObject.sell(); &#125;&#125; ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œæˆ‘ä»¬æ€è€ƒä¸‹é¢é—®é¢˜ï¼š ProxyFactoryæ˜¯ä»£ç†ç±»å—ï¼Ÿ ProxyFactoryä¸æ˜¯ä»£ç†æ¨¡å¼ä¸­æ‰€è¯´çš„ä»£ç†ç±»ï¼Œè€Œä»£ç†ç±»æ˜¯ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€çš„åœ¨å†…å­˜ä¸­ç”Ÿæˆçš„ç±»ã€‚é€šè¿‡é˜¿é‡Œå·´å·´å¼€æºçš„ Java è¯Šæ–­å·¥å…·ï¼ˆArthasã€é˜¿å°”è¨æ–¯ã€‘ï¼‰æŸ¥çœ‹ä»£ç†ç±»çš„ç»“æ„ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283package com.sun.proxy;import com.itheima.proxy.dynamic.jdk.SellTickets;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.lang.reflect.UndeclaredThrowableException;public final class $Proxy0 extends Proxy implements SellTickets &#123; private static Method m1; private static Method m2; private static Method m3; private static Method m0; public $Proxy0(InvocationHandler invocationHandler) &#123; super(invocationHandler); &#125; static &#123; try &#123; m1 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;equals&quot;, Class.forName(&quot;java.lang.Object&quot;)); m2 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;toString&quot;, new Class[0]); m3 = Class.forName(&quot;com.itheima.proxy.dynamic.jdk.SellTickets&quot;).getMethod(&quot;sell&quot;, new Class[0]); m0 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;hashCode&quot;, new Class[0]); return; &#125; catch (NoSuchMethodException noSuchMethodException) &#123; throw new NoSuchMethodError(noSuchMethodException.getMessage()); &#125; catch (ClassNotFoundException classNotFoundException) &#123; throw new NoClassDefFoundError(classNotFoundException.getMessage()); &#125; &#125; public final boolean equals(Object object) &#123; try &#123; return (Boolean)this.h.invoke(this, m1, new Object[]&#123;object&#125;); &#125; catch (Error | RuntimeException throwable) &#123; throw throwable; &#125; catch (Throwable throwable) &#123; throw new UndeclaredThrowableException(throwable); &#125; &#125; public final String toString() &#123; try &#123; return (String)this.h.invoke(this, m2, null); &#125; catch (Error | RuntimeException throwable) &#123; throw throwable; &#125; catch (Throwable throwable) &#123; throw new UndeclaredThrowableException(throwable); &#125; &#125; public final int hashCode() &#123; try &#123; return (Integer)this.h.invoke(this, m0, null); &#125; catch (Error | RuntimeException throwable) &#123; throw throwable; &#125; catch (Throwable throwable) &#123; throw new UndeclaredThrowableException(throwable); &#125; &#125; public final void sell() &#123; try &#123; this.h.invoke(this, m3, null); return; &#125; catch (Error | RuntimeException throwable) &#123; throw throwable; &#125; catch (Throwable throwable) &#123; throw new UndeclaredThrowableException(throwable); &#125; &#125;&#125; ä»ä¸Šé¢çš„ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å‡ ä¸ªä¿¡æ¯ï¼š ä»£ç†ç±»ï¼ˆ$Proxy0ï¼‰å®ç°äº†SellTicketsã€‚è¿™ä¹Ÿå°±å°è¯äº†æˆ‘ä»¬ä¹‹å‰è¯´çš„çœŸå®ç±»å’Œä»£ç†ç±»å®ç°åŒæ ·çš„æ¥å£ã€‚ ä»£ç†ç±»ï¼ˆ$Proxy0ï¼‰å°†æˆ‘ä»¬æä¾›äº†çš„åŒ¿åå†…éƒ¨ç±»å¯¹è±¡ä¼ é€’ç»™äº†çˆ¶ç±»ã€‚ åŠ¨æ€ä»£ç†çš„æ‰§è¡Œæµç¨‹æ˜¯ä»€ä¹ˆæ ·ï¼Ÿ ä¸‹é¢æ˜¯æ‘˜å–çš„é‡ç‚¹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657//ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»public final class $Proxy0 extends Proxy implements SellTickets &#123; private static Method m3; public $Proxy0(InvocationHandler invocationHandler) &#123; super(invocationHandler); &#125; static &#123; m3 = Class.forName(&quot;com.itheima.proxy.dynamic.jdk.SellTickets&quot;).getMethod(&quot;sell&quot;, new Class[0]); &#125; public final void sell() &#123; this.h.invoke(this, m3, null); &#125;&#125;//Javaæä¾›çš„åŠ¨æ€ä»£ç†ç›¸å…³ç±»public class Proxy implements java.io.Serializable &#123; protected InvocationHandler h; protected Proxy(InvocationHandler h) &#123; this.h = h; &#125;&#125;//ä»£ç†å·¥å‚ç±»public class ProxyFactory &#123; private TrainStation station = new TrainStation(); public SellTickets getProxyObject() &#123; SellTickets sellTickets = (SellTickets) Proxy.newProxyInstance(station.getClass().getClassLoader(), station.getClass().getInterfaces(), new InvocationHandler() &#123; public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(&quot;ä»£ç†ç‚¹æ”¶å–ä¸€äº›æœåŠ¡è´¹ç”¨(JDKåŠ¨æ€ä»£ç†æ–¹å¼)&quot;); Object result = method.invoke(station, args); return result; &#125; &#125;); return sellTickets; &#125;&#125;//æµ‹è¯•è®¿é—®ç±»public class Client &#123; public static void main(String[] args) &#123; //è·å–ä»£ç†å¯¹è±¡ ProxyFactory factory = new ProxyFactory(); SellTickets proxyObject = factory.getProxyObject(); proxyObject.sell(); &#125;&#125; æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š 1. åœ¨æµ‹è¯•ç±»ä¸­é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨sell()æ–¹æ³• 2. æ ¹æ®å¤šæ€çš„ç‰¹æ€§ï¼Œæ‰§è¡Œçš„æ˜¯ä»£ç†ç±»ï¼ˆ$Proxy0ï¼‰ä¸­çš„sell()æ–¹æ³• 3. ä»£ç†ç±»ï¼ˆ$Proxy0ï¼‰ä¸­çš„sell()æ–¹æ³•ä¸­åˆè°ƒç”¨äº†InvocationHandleræ¥å£çš„å­å®ç°ç±»å¯¹è±¡çš„invokeæ–¹æ³• 4. invokeæ–¹æ³•é€šè¿‡åå°„æ‰§è¡Œäº†çœŸå®å¯¹è±¡æ‰€å±ç±»(TrainStation)ä¸­çš„sell()æ–¹æ³• 5.1.5 CGLIBåŠ¨æ€ä»£ç†åŒæ ·æ˜¯ä¸Šé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨CGLIBä»£ç†å®ç°ã€‚ å¦‚æœæ²¡æœ‰å®šä¹‰SellTicketsæ¥å£ï¼Œåªå®šä¹‰äº†TrainStation(ç«è½¦ç«™ç±»)ã€‚å¾ˆæ˜¾ç„¶JDKä»£ç†æ˜¯æ— æ³•ä½¿ç”¨äº†ï¼Œå› ä¸ºJDKåŠ¨æ€ä»£ç†è¦æ±‚å¿…é¡»å®šä¹‰æ¥å£ï¼Œå¯¹æ¥å£è¿›è¡Œä»£ç†ã€‚ CGLIBæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ï¼Œé«˜æ€§èƒ½çš„ä»£ç ç”ŸæˆåŒ…ã€‚å®ƒä¸ºæ²¡æœ‰å®ç°æ¥å£çš„ç±»æä¾›ä»£ç†ï¼Œä¸ºJDKçš„åŠ¨æ€ä»£ç†æä¾›äº†å¾ˆå¥½çš„è¡¥å……ã€‚ CGLIBæ˜¯ç¬¬ä¸‰æ–¹æä¾›çš„åŒ…ï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥jaråŒ…çš„åæ ‡ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;cglib&lt;/groupId&gt; &lt;artifactId&gt;cglib&lt;/artifactId&gt; &lt;version&gt;2.2.2&lt;/version&gt;&lt;/dependency&gt; ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950//ç«è½¦ç«™public class TrainStation &#123; public void sell() &#123; System.out.println(&quot;ç«è½¦ç«™å–ç¥¨&quot;); &#125;&#125;//ä»£ç†å·¥å‚public class ProxyFactory implements MethodInterceptor &#123; private TrainStation target = new TrainStation(); public TrainStation getProxyObject() &#123; //åˆ›å»ºEnhancerå¯¹è±¡ï¼Œç±»ä¼¼äºJDKåŠ¨æ€ä»£ç†çš„Proxyç±»ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è®¾ç½®å‡ ä¸ªå‚æ•° Enhancer enhancer =new Enhancer(); //è®¾ç½®çˆ¶ç±»çš„å­—èŠ‚ç å¯¹è±¡ enhancer.setSuperclass(target.getClass()); //è®¾ç½®å›è°ƒå‡½æ•° enhancer.setCallback(this); //åˆ›å»ºä»£ç†å¯¹è±¡ TrainStation obj = (TrainStation) enhancer.create(); return obj; &#125; /* interceptæ–¹æ³•å‚æ•°è¯´æ˜ï¼š o ï¼š ä»£ç†å¯¹è±¡ method ï¼š çœŸå®å¯¹è±¡ä¸­çš„æ–¹æ³•çš„Methodå®ä¾‹ args ï¼š å®é™…å‚æ•° methodProxy ï¼šä»£ç†å¯¹è±¡ä¸­çš„æ–¹æ³•çš„methodå®ä¾‹ */ public TrainStation intercept(Object o, Method method, Object[] args, MethodProxy methodProxy) throws Throwable &#123; System.out.println(&quot;ä»£ç†ç‚¹æ”¶å–ä¸€äº›æœåŠ¡è´¹ç”¨(CGLIBåŠ¨æ€ä»£ç†æ–¹å¼)&quot;); TrainStation result = (TrainStation) methodProxy.invokeSuper(o, args); return result; &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; //åˆ›å»ºä»£ç†å·¥å‚å¯¹è±¡ ProxyFactory factory = new ProxyFactory(); //è·å–ä»£ç†å¯¹è±¡ TrainStation proxyObject = factory.getProxyObject(); proxyObject.sell(); &#125;&#125; 5.1.6 ä¸‰ç§ä»£ç†çš„å¯¹æ¯” jdkä»£ç†å’ŒCGLIBä»£ç† ä½¿ç”¨CGLibå®ç°åŠ¨æ€ä»£ç†ï¼ŒCGLibåº•å±‚é‡‡ç”¨ASMå­—èŠ‚ç ç”Ÿæˆæ¡†æ¶ï¼Œä½¿ç”¨å­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆä»£ç†ç±»ï¼Œåœ¨JDK1.6ä¹‹å‰æ¯”ä½¿ç”¨Javaåå°„æ•ˆç‡è¦é«˜ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCGLibä¸èƒ½å¯¹å£°æ˜ä¸ºfinalçš„ç±»æˆ–è€…æ–¹æ³•è¿›è¡Œä»£ç†ï¼Œå› ä¸ºCGLibåŸç†æ˜¯åŠ¨æ€ç”Ÿæˆè¢«ä»£ç†ç±»çš„å­ç±»ã€‚ åœ¨JDK1.6ã€JDK1.7ã€JDK1.8é€æ­¥å¯¹JDKåŠ¨æ€ä»£ç†ä¼˜åŒ–ä¹‹åï¼Œåœ¨è°ƒç”¨æ¬¡æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ŒJDKä»£ç†æ•ˆç‡é«˜äºCGLibä»£ç†æ•ˆç‡ï¼Œåªæœ‰å½“è¿›è¡Œå¤§é‡è°ƒç”¨çš„æ—¶å€™ï¼ŒJDK1.6å’ŒJDK1.7æ¯”CGLibä»£ç†æ•ˆç‡ä½ä¸€ç‚¹ï¼Œä½†æ˜¯åˆ°JDK1.8çš„æ—¶å€™ï¼ŒJDKä»£ç†æ•ˆç‡é«˜äºCGLibä»£ç†ã€‚æ‰€ä»¥å¦‚æœæœ‰æ¥å£ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼Œå¦‚æœæ²¡æœ‰æ¥å£ä½¿ç”¨CGLIBä»£ç†ã€‚ åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç† åŠ¨æ€ä»£ç†ä¸é™æ€ä»£ç†ç›¸æ¯”è¾ƒï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯æ¥å£ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•éƒ½è¢«è½¬ç§»åˆ°è°ƒç”¨å¤„ç†å™¨ä¸€ä¸ªé›†ä¸­çš„æ–¹æ³•ä¸­å¤„ç†ï¼ˆInvocationHandler.invokeï¼‰ã€‚è¿™æ ·ï¼Œåœ¨æ¥å£æ–¹æ³•æ•°é‡æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œçµæ´»å¤„ç†ï¼Œè€Œä¸éœ€è¦åƒé™æ€ä»£ç†é‚£æ ·æ¯ä¸€ä¸ªæ–¹æ³•è¿›è¡Œä¸­è½¬ã€‚ å¦‚æœæ¥å£å¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œé™æ€ä»£ç†æ¨¡å¼é™¤äº†æ‰€æœ‰å®ç°ç±»éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•å¤–ï¼Œæ‰€æœ‰ä»£ç†ç±»ä¹Ÿéœ€è¦å®ç°æ­¤æ–¹æ³•ã€‚å¢åŠ äº†ä»£ç ç»´æŠ¤çš„å¤æ‚åº¦ã€‚è€ŒåŠ¨æ€ä»£ç†ä¸ä¼šå‡ºç°è¯¥é—®é¢˜ 5.1.7 ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š ä»£ç†æ¨¡å¼åœ¨å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸€ä¸ªä¸­ä»‹ä½œç”¨å’Œä¿æŠ¤ç›®æ ‡å¯¹è±¡çš„ä½œç”¨ï¼› ä»£ç†å¯¹è±¡å¯ä»¥æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼› ä»£ç†æ¨¡å¼èƒ½å°†å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡åˆ†ç¦»ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ï¼› ç¼ºç‚¹ï¼š å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼› 5.1.8 ä½¿ç”¨åœºæ™¯ è¿œç¨‹ï¼ˆRemoteï¼‰ä»£ç† æœ¬åœ°æœåŠ¡é€šè¿‡ç½‘ç»œè¯·æ±‚è¿œç¨‹æœåŠ¡ã€‚ä¸ºäº†å®ç°æœ¬åœ°åˆ°è¿œç¨‹çš„é€šä¿¡ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ç½‘ç»œé€šä¿¡ï¼Œå¤„ç†å…¶ä¸­å¯èƒ½çš„å¼‚å¸¸ã€‚ä¸ºè‰¯å¥½çš„ä»£ç è®¾è®¡å’Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬å°†ç½‘ç»œé€šä¿¡éƒ¨åˆ†éšè—èµ·æ¥ï¼Œåªæš´éœ²ç»™æœ¬åœ°æœåŠ¡ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¯¥æ¥å£å³å¯è®¿é—®è¿œç¨‹æœåŠ¡æä¾›çš„åŠŸèƒ½ï¼Œè€Œä¸å¿…è¿‡å¤šå…³å¿ƒé€šä¿¡éƒ¨åˆ†çš„ç»†èŠ‚ã€‚ é˜²ç«å¢™ï¼ˆFirewallï¼‰ä»£ç† å½“ä½ å°†æµè§ˆå™¨é…ç½®æˆä½¿ç”¨ä»£ç†åŠŸèƒ½æ—¶ï¼Œé˜²ç«å¢™å°±å°†ä½ çš„æµè§ˆå™¨çš„è¯·æ±‚è½¬ç»™äº’è”ç½‘ï¼›å½“äº’è”ç½‘è¿”å›å“åº”æ—¶ï¼Œä»£ç†æœåŠ¡å™¨å†æŠŠå®ƒè½¬ç»™ä½ çš„æµè§ˆå™¨ã€‚ ä¿æŠ¤ï¼ˆProtect or Accessï¼‰ä»£ç† æ§åˆ¶å¯¹ä¸€ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥ç»™ä¸åŒçš„ç”¨æˆ·æä¾›ä¸åŒçº§åˆ«çš„ä½¿ç”¨æƒé™ã€‚ 5.2 é€‚é…å™¨æ¨¡å¼5.2.1 æ¦‚è¿°å¦‚æœå»æ¬§æ´²å›½å®¶å»æ—…æ¸¸çš„è¯ï¼Œä»–ä»¬çš„æ’åº§å¦‚ä¸‹å›¾æœ€å·¦è¾¹ï¼Œæ˜¯æ¬§æ´²æ ‡å‡†ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨çš„æ’å¤´å¦‚ä¸‹å›¾æœ€å³è¾¹çš„ã€‚å› æ­¤æˆ‘ä»¬çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œæ‰‹æœºåœ¨å½“åœ°ä¸èƒ½ç›´æ¥å……ç”µã€‚æ‰€ä»¥å°±éœ€è¦ä¸€ä¸ªæ’åº§è½¬æ¢å™¨ï¼Œè½¬æ¢å™¨ç¬¬1é¢æ’å…¥å½“åœ°çš„æ’åº§ï¼Œç¬¬2é¢ä¾›æˆ‘ä»¬å……ç”µï¼Œè¿™æ ·ä½¿å¾—æˆ‘ä»¬çš„æ’å¤´åœ¨å½“åœ°èƒ½ä½¿ç”¨ã€‚ç”Ÿæ´»ä¸­è¿™æ ·çš„ä¾‹å­å¾ˆå¤šï¼Œæ‰‹æœºå……ç”µå™¨ï¼ˆå°†220vè½¬æ¢ä¸º5vçš„ç”µå‹ï¼‰ï¼Œè¯»å¡å™¨ç­‰ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€‚ å®šä¹‰ï¼š â€‹ å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»èƒ½ä¸€èµ·å·¥ä½œã€‚ â€‹ é€‚é…å™¨æ¨¡å¼åˆ†ä¸ºç±»é€‚é…å™¨æ¨¡å¼å’Œå¯¹è±¡é€‚é…å™¨æ¨¡å¼ï¼Œå‰è€…ç±»ä¹‹é—´çš„è€¦åˆåº¦æ¯”åè€…é«˜ï¼Œä¸”è¦æ±‚ç¨‹åºå‘˜äº†è§£ç°æœ‰ç»„ä»¶åº“ä¸­çš„ç›¸å…³ç»„ä»¶çš„å†…éƒ¨ç»“æ„ï¼Œæ‰€ä»¥åº”ç”¨ç›¸å¯¹è¾ƒå°‘äº›ã€‚ 5.2.2 ç»“æ„é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š ç›®æ ‡ï¼ˆTargetï¼‰æ¥å£ï¼šå½“å‰ç³»ç»Ÿä¸šåŠ¡æ‰€æœŸå¾…çš„æ¥å£ï¼Œå®ƒå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–æ¥å£ã€‚ é€‚é…è€…ï¼ˆAdapteeï¼‰ç±»ï¼šå®ƒæ˜¯è¢«è®¿é—®å’Œé€‚é…çš„ç°å­˜ç»„ä»¶åº“ä¸­çš„ç»„ä»¶æ¥å£ã€‚ é€‚é…å™¨ï¼ˆAdapterï¼‰ç±»ï¼šå®ƒæ˜¯ä¸€ä¸ªè½¬æ¢å™¨ï¼Œé€šè¿‡ç»§æ‰¿æˆ–å¼•ç”¨é€‚é…è€…çš„å¯¹è±¡ï¼ŒæŠŠé€‚é…è€…æ¥å£è½¬æ¢æˆç›®æ ‡æ¥å£ï¼Œè®©å®¢æˆ·æŒ‰ç›®æ ‡æ¥å£çš„æ ¼å¼è®¿é—®é€‚é…è€…ã€‚ 5.2.3 ç±»é€‚é…å™¨æ¨¡å¼å®ç°æ–¹å¼ï¼šå®šä¹‰ä¸€ä¸ªé€‚é…å™¨ç±»æ¥å®ç°å½“å‰ç³»ç»Ÿçš„ä¸šåŠ¡æ¥å£ï¼ŒåŒæ—¶åˆç»§æ‰¿ç°æœ‰ç»„ä»¶åº“ä¸­å·²ç»å­˜åœ¨çš„ç»„ä»¶ã€‚ ã€ä¾‹ã€‘è¯»å¡å™¨ ç°æœ‰ä¸€å°ç”µè„‘åªèƒ½è¯»å–SDå¡ï¼Œè€Œè¦è¯»å–TFå¡ä¸­çš„å†…å®¹çš„è¯å°±éœ€è¦ä½¿ç”¨åˆ°é€‚é…å™¨æ¨¡å¼ã€‚åˆ›å»ºä¸€ä¸ªè¯»å¡å™¨ï¼Œå°†TFå¡ä¸­çš„å†…å®¹è¯»å–å‡ºæ¥ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879//SDå¡çš„æ¥å£public interface SDCard &#123; //è¯»å–SDå¡æ–¹æ³• String readSD(); //å†™å…¥SDå¡åŠŸèƒ½ void writeSD(String msg);&#125;//SDå¡å®ç°ç±»public class SDCardImpl implements SDCard &#123; public String readSD() &#123; String msg = &quot;sd card read a msg :hello word SD&quot;; return msg; &#125; public void writeSD(String msg) &#123; System.out.println(&quot;sd card write msg : &quot; + msg); &#125;&#125;//ç”µè„‘ç±»public class Computer &#123; public String readSD(SDCard sdCard) &#123; if(sdCard == null) &#123; throw new NullPointerException(&quot;sd card null&quot;); &#125; return sdCard.readSD(); &#125;&#125;//TFå¡æ¥å£public interface TFCard &#123; //è¯»å–TFå¡æ–¹æ³• String readTF(); //å†™å…¥TFå¡åŠŸèƒ½ void writeTF(String msg);&#125;//TFå¡å®ç°ç±»public class TFCardImpl implements TFCard &#123; public String readTF() &#123; String msg =&quot;tf card read msg : hello word tf card&quot;; return msg; &#125; public void writeTF(String msg) &#123; System.out.println(&quot;tf card write a msg : &quot; + msg); &#125;&#125;//å®šä¹‰é€‚é…å™¨ç±»ï¼ˆSDå…¼å®¹TFï¼‰public class SDAdapterTF extends TFCardImpl implements SDCard &#123; public String readSD() &#123; System.out.println(&quot;adapter read tf card &quot;); return readTF(); &#125; public void writeSD(String msg) &#123; System.out.println(&quot;adapter write tf card&quot;); writeTF(msg); &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; Computer computer = new Computer(); SDCard sdCard = new SDCardImpl(); System.out.println(computer.readSD(sdCard)); System.out.println(&quot;------------&quot;); SDAdapterTF adapter = new SDAdapterTF(); System.out.println(computer.readSD(adapter)); &#125;&#125; ç±»é€‚é…å™¨æ¨¡å¼è¿èƒŒäº†åˆæˆå¤ç”¨åŸåˆ™ã€‚ç±»é€‚é…å™¨æ˜¯å®¢æˆ·ç±»æœ‰ä¸€ä¸ªæ¥å£è§„èŒƒçš„æƒ…å†µä¸‹å¯ç”¨ï¼Œåä¹‹ä¸å¯ç”¨ã€‚ 5.2.4 å¯¹è±¡é€‚é…å™¨æ¨¡å¼å®ç°æ–¹å¼ï¼šå¯¹è±¡é€‚é…å™¨æ¨¡å¼å¯é‡†ç”¨å°†ç°æœ‰ç»„ä»¶åº“ä¸­å·²ç»å®ç°çš„ç»„ä»¶å¼•å…¥é€‚é…å™¨ç±»ä¸­ï¼Œè¯¥ç±»åŒæ—¶å®ç°å½“å‰ç³»ç»Ÿçš„ä¸šåŠ¡æ¥å£ã€‚ ã€ä¾‹ã€‘è¯»å¡å™¨ æˆ‘ä»¬ä½¿ç”¨å¯¹è±¡é€‚é…å™¨æ¨¡å¼å°†è¯»å¡å™¨çš„æ¡ˆä¾‹è¿›è¡Œæ”¹å†™ã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š ç±»é€‚é…å™¨æ¨¡å¼çš„ä»£ç ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹é€‚é…å™¨ç±»ï¼ˆSDAdapterTFï¼‰å’Œæµ‹è¯•ç±»ã€‚ 12345678910111213141516171819202122232425262728293031323334//åˆ›å»ºé€‚é…å™¨å¯¹è±¡ï¼ˆSDå…¼å®¹TFï¼‰public class SDAdapterTF implements SDCard &#123; private TFCard tfCard; public SDAdapterTF(TFCard tfCard) &#123; this.tfCard = tfCard; &#125; public String readSD() &#123; System.out.println(&quot;adapter read tf card &quot;); return tfCard.readTF(); &#125; public void writeSD(String msg) &#123; System.out.println(&quot;adapter write tf card&quot;); tfCard.writeTF(msg); &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; Computer computer = new Computer(); SDCard sdCard = new SDCardImpl(); System.out.println(computer.readSD(sdCard)); System.out.println(&quot;------------&quot;); TFCard tfCard = new TFCardImpl(); SDAdapterTF adapter = new SDAdapterTF(tfCard); System.out.println(computer.readSD(adapter)); &#125;&#125; æ³¨æ„ï¼šè¿˜æœ‰ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼æ˜¯æ¥å£é€‚é…å™¨æ¨¡å¼ã€‚å½“ä¸å¸Œæœ›å®ç°ä¸€ä¸ªæ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•æ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»Adapter ï¼Œå®ç°æ‰€æœ‰æ–¹æ³•ã€‚è€Œæ­¤æ—¶æˆ‘ä»¬åªéœ€è¦ç»§æ‰¿è¯¥æŠ½è±¡ç±»å³å¯ã€‚ 5.2.5 åº”ç”¨åœºæ™¯ ä»¥å‰å¼€å‘çš„ç³»ç»Ÿå­˜åœ¨æ»¡è¶³æ–°ç³»ç»ŸåŠŸèƒ½éœ€æ±‚çš„ç±»ï¼Œä½†å…¶æ¥å£åŒæ–°ç³»ç»Ÿçš„æ¥å£ä¸ä¸€è‡´ã€‚ ä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„ç»„ä»¶ï¼Œä½†ç»„ä»¶æ¥å£å®šä¹‰å’Œè‡ªå·±è¦æ±‚çš„æ¥å£å®šä¹‰ä¸åŒã€‚ 5.2.6 JDKæºç è§£æReaderï¼ˆå­—ç¬¦æµï¼‰ã€InputStreamï¼ˆå­—èŠ‚æµï¼‰çš„é€‚é…ä½¿ç”¨çš„æ˜¯InputStreamReaderã€‚ InputStreamReaderç»§æ‰¿è‡ªjava.ioåŒ…ä¸­çš„Readerï¼Œå¯¹ä»–ä¸­çš„æŠ½è±¡çš„æœªå®ç°çš„æ–¹æ³•ç»™å‡ºå®ç°ã€‚å¦‚ï¼š 1234567public int read() throws IOException &#123; return sd.read();&#125;public int read(char cbuf[], int offset, int length) throws IOException &#123; return sd.read(cbuf, offset, length);&#125; å¦‚ä¸Šä»£ç ä¸­çš„sdï¼ˆStreamDecoderç±»å¯¹è±¡ï¼‰ï¼Œåœ¨Sunçš„JDKå®ç°ä¸­ï¼Œå®é™…çš„æ–¹æ³•å®ç°æ˜¯å¯¹sun.nio.cs.StreamDecoderç±»çš„åŒåæ–¹æ³•çš„è°ƒç”¨å°è£…ã€‚ç±»ç»“æ„å›¾å¦‚ä¸‹ï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼š InputStreamReaderæ˜¯å¯¹åŒæ ·å®ç°äº†Readerçš„StreamDecoderçš„å°è£…ã€‚ StreamDecoderä¸æ˜¯Java SE APIä¸­çš„å†…å®¹ï¼Œæ˜¯Sun JDKç»™å‡ºçš„è‡ªèº«å®ç°ã€‚ä½†æˆ‘ä»¬çŸ¥é“ä»–ä»¬å¯¹æ„é€ æ–¹æ³•ä¸­çš„å­—èŠ‚æµç±»ï¼ˆInputStreamï¼‰è¿›è¡Œå°è£…ï¼Œå¹¶é€šè¿‡è¯¥ç±»è¿›è¡Œäº†å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´çš„è§£ç è½¬æ¢ã€‚ ç»“è®ºï¼š â€‹ ä»è¡¨å±‚æ¥çœ‹ï¼ŒInputStreamReaderåšäº†InputStreamå­—èŠ‚æµç±»åˆ°Readerå­—ç¬¦æµä¹‹é—´çš„è½¬æ¢ã€‚è€Œä»å¦‚ä¸ŠSun JDKä¸­çš„å®ç°ç±»å…³ç³»ç»“æ„ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ˜¯StreamDecoderçš„è®¾è®¡å®ç°åœ¨å®é™…ä¸Šé‡‡ç”¨äº†é€‚é…å™¨æ¨¡å¼ã€‚ 5.3 è£…é¥°è€…æ¨¡å¼5.3.1 æ¦‚è¿°æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªå¿«é¤åº—çš„ä¾‹å­ã€‚ å¿«é¤åº—æœ‰ç‚’é¢ã€ç‚’é¥­è¿™äº›å¿«é¤ï¼Œå¯ä»¥é¢å¤–é™„åŠ é¸¡è›‹ã€ç«è…¿ã€åŸ¹æ ¹è¿™äº›é…èœï¼Œå½“ç„¶åŠ é…èœéœ€è¦é¢å¤–åŠ é’±ï¼Œæ¯ä¸ªé…èœçš„ä»·é’±é€šå¸¸ä¸å¤ªä¸€æ ·ï¼Œé‚£ä¹ˆè®¡ç®—æ€»ä»·å°±ä¼šæ˜¾å¾—æ¯”è¾ƒéº»çƒ¦ã€‚ ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼å­˜åœ¨çš„é—®é¢˜ï¼š æ‰©å±•æ€§ä¸å¥½ å¦‚æœè¦å†åŠ ä¸€ç§é…æ–™ï¼ˆç«è…¿è‚ ï¼‰ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°éœ€è¦ç»™FriedRiceå’ŒFriedNoodlesåˆ†åˆ«å®šä¹‰ä¸€ä¸ªå­ç±»ã€‚å¦‚æœè¦æ–°å¢ä¸€ä¸ªå¿«é¤å“ç±»ï¼ˆç‚’æ²³ç²‰ï¼‰çš„è¯ï¼Œå°±éœ€è¦å®šä¹‰æ›´å¤šçš„å­ç±»ã€‚ äº§ç”Ÿè¿‡å¤šçš„å­ç±» å®šä¹‰ï¼š â€‹ æŒ‡åœ¨ä¸æ”¹å˜ç°æœ‰å¯¹è±¡ç»“æ„çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°ç»™è¯¥å¯¹è±¡å¢åŠ ä¸€äº›èŒè´£ï¼ˆå³å¢åŠ å…¶é¢å¤–åŠŸèƒ½ï¼‰çš„æ¨¡å¼ã€‚ 5.3.2 ç»“æ„è£…é¥°ï¼ˆDecoratorï¼‰æ¨¡å¼ä¸­çš„è§’è‰²ï¼š æŠ½è±¡æ„ä»¶ï¼ˆComponentï¼‰è§’è‰² ï¼šå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ¥å£ä»¥è§„èŒƒå‡†å¤‡æ¥æ”¶é™„åŠ è´£ä»»çš„å¯¹è±¡ã€‚ å…·ä½“æ„ä»¶ï¼ˆConcrete Componentï¼‰è§’è‰² ï¼šå®ç°æŠ½è±¡æ„ä»¶ï¼Œé€šè¿‡è£…é¥°è§’è‰²ä¸ºå…¶æ·»åŠ ä¸€äº›èŒè´£ã€‚ æŠ½è±¡è£…é¥°ï¼ˆDecoratorï¼‰è§’è‰² ï¼š ç»§æ‰¿æˆ–å®ç°æŠ½è±¡æ„ä»¶ï¼Œå¹¶åŒ…å«å…·ä½“æ„ä»¶çš„å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡å…¶å­ç±»æ‰©å±•å…·ä½“æ„ä»¶çš„åŠŸèƒ½ã€‚ å…·ä½“è£…é¥°ï¼ˆConcreteDecoratorï¼‰è§’è‰² ï¼šå®ç°æŠ½è±¡è£…é¥°çš„ç›¸å…³æ–¹æ³•ï¼Œå¹¶ç»™å…·ä½“æ„ä»¶å¯¹è±¡æ·»åŠ é™„åŠ çš„è´£ä»»ã€‚ 5.3.3 æ¡ˆä¾‹æˆ‘ä»¬ä½¿ç”¨è£…é¥°è€…æ¨¡å¼å¯¹å¿«é¤åº—æ¡ˆä¾‹è¿›è¡Œæ”¹è¿›ï¼Œä½“ä¼šè£…é¥°è€…æ¨¡å¼çš„ç²¾é«“ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135//å¿«é¤æ¥å£public abstract class FastFood &#123; private float price; private String desc; public FastFood() &#123; &#125; public FastFood(float price, String desc) &#123; this.price = price; this.desc = desc; &#125; public void setPrice(float price) &#123; this.price = price; &#125; public float getPrice() &#123; return price; &#125; public String getDesc() &#123; return desc; &#125; public void setDesc(String desc) &#123; this.desc = desc; &#125; public abstract float cost(); //è·å–ä»·æ ¼&#125;//ç‚’é¥­public class FriedRice extends FastFood &#123; public FriedRice() &#123; super(10, &quot;ç‚’é¥­&quot;); &#125; public float cost() &#123; return getPrice(); &#125;&#125;//ç‚’é¢public class FriedNoodles extends FastFood &#123; public FriedNoodles() &#123; super(12, &quot;ç‚’é¢&quot;); &#125; public float cost() &#123; return getPrice(); &#125;&#125;//é…æ–™ç±»public abstract class Garnish extends FastFood &#123; private FastFood fastFood; public FastFood getFastFood() &#123; return fastFood; &#125; public void setFastFood(FastFood fastFood) &#123; this.fastFood = fastFood; &#125; public Garnish(FastFood fastFood, float price, String desc) &#123; super(price,desc); this.fastFood = fastFood; &#125;&#125;//é¸¡è›‹é…æ–™public class Egg extends Garnish &#123; public Egg(FastFood fastFood) &#123; super(fastFood,1,&quot;é¸¡è›‹&quot;); &#125; public float cost() &#123; return getPrice() + getFastFood().getPrice(); &#125; @Override public String getDesc() &#123; return super.getDesc() + getFastFood().getDesc(); &#125;&#125;//åŸ¹æ ¹é…æ–™public class Bacon extends Garnish &#123; public Bacon(FastFood fastFood) &#123; super(fastFood,2,&quot;åŸ¹æ ¹&quot;); &#125; @Override public float cost() &#123; return getPrice() + getFastFood().getPrice(); &#125; @Override public String getDesc() &#123; return super.getDesc() + getFastFood().getDesc(); &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; //ç‚¹ä¸€ä»½ç‚’é¥­ FastFood food = new FriedRice(); //èŠ±è´¹çš„ä»·æ ¼ System.out.println(food.getDesc() + &quot; &quot; + food.cost() + &quot;å…ƒ&quot;); System.out.println(&quot;========&quot;); //ç‚¹ä¸€ä»½åŠ é¸¡è›‹çš„ç‚’é¥­ FastFood food1 = new FriedRice(); food1 = new Egg(food1); //èŠ±è´¹çš„ä»·æ ¼ System.out.println(food1.getDesc() + &quot; &quot; + food1.cost() + &quot;å…ƒ&quot;); System.out.println(&quot;========&quot;); //ç‚¹ä¸€ä»½åŠ åŸ¹æ ¹çš„ç‚’é¢ FastFood food2 = new FriedNoodles(); food2 = new Bacon(food2); //èŠ±è´¹çš„ä»·æ ¼ System.out.println(food2.getDesc() + &quot; &quot; + food2.cost() + &quot;å…ƒ&quot;); &#125;&#125; å¥½å¤„ï¼š é¥°è€…æ¨¡å¼å¯ä»¥å¸¦æ¥æ¯”ç»§æ‰¿æ›´åŠ çµæ´»æ€§çš„æ‰©å±•åŠŸèƒ½ï¼Œä½¿ç”¨æ›´åŠ æ–¹ä¾¿ï¼Œå¯ä»¥é€šè¿‡ç»„åˆä¸åŒçš„è£…é¥°è€…å¯¹è±¡æ¥è·å–å…·æœ‰ä¸åŒè¡Œä¸ºçŠ¶æ€çš„å¤šæ ·åŒ–çš„ç»“æœã€‚è£…é¥°è€…æ¨¡å¼æ¯”ç»§æ‰¿æ›´å…·è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œå®Œç¾çš„éµå¾ªå¼€é—­åŸåˆ™ï¼Œç»§æ‰¿æ˜¯é™æ€çš„é™„åŠ è´£ä»»ï¼Œè£…é¥°è€…åˆ™æ˜¯åŠ¨æ€çš„é™„åŠ è´£ä»»ã€‚ è£…é¥°ç±»å’Œè¢«è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸ä¼šç›¸äº’è€¦åˆï¼Œè£…é¥°æ¨¡å¼æ˜¯ç»§æ‰¿çš„ä¸€ä¸ªæ›¿ä»£æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼å¯ä»¥åŠ¨æ€æ‰©å±•ä¸€ä¸ªå®ç°ç±»çš„åŠŸèƒ½ã€‚ 5.3.4 ä½¿ç”¨åœºæ™¯ å½“ä¸èƒ½é‡‡ç”¨ç»§æ‰¿çš„æ–¹å¼å¯¹ç³»ç»Ÿè¿›è¡Œæ‰©å……æˆ–è€…é‡‡ç”¨ç»§æ‰¿ä¸åˆ©äºç³»ç»Ÿæ‰©å±•å’Œç»´æŠ¤æ—¶ã€‚ ä¸èƒ½é‡‡ç”¨ç»§æ‰¿çš„æƒ…å†µä¸»è¦æœ‰ä¸¤ç±»ï¼š ç¬¬ä¸€ç±»æ˜¯ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡ç‹¬ç«‹çš„æ‰©å±•ï¼Œä¸ºæ”¯æŒæ¯ä¸€ç§ç»„åˆå°†äº§ç”Ÿå¤§é‡çš„å­ç±»ï¼Œä½¿å¾—å­ç±»æ•°ç›®å‘ˆçˆ†ç‚¸æ€§å¢é•¿ï¼› ç¬¬äºŒç±»æ˜¯å› ä¸ºç±»å®šä¹‰ä¸èƒ½ç»§æ‰¿ï¼ˆå¦‚finalç±»ï¼‰ åœ¨ä¸å½±å“å…¶ä»–å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œä»¥åŠ¨æ€ã€é€æ˜çš„æ–¹å¼ç»™å•ä¸ªå¯¹è±¡æ·»åŠ èŒè´£ã€‚ å½“å¯¹è±¡çš„åŠŸèƒ½è¦æ±‚å¯ä»¥åŠ¨æ€åœ°æ·»åŠ ï¼Œä¹Ÿå¯ä»¥å†åŠ¨æ€åœ°æ’¤é”€æ—¶ã€‚ 5.3.5 JDKæºç è§£æIOæµä¸­çš„åŒ…è£…ç±»ä½¿ç”¨åˆ°äº†è£…é¥°è€…æ¨¡å¼ã€‚BufferedInputStreamï¼ŒBufferedOutputStreamï¼ŒBufferedReaderï¼ŒBufferedWriterã€‚ æˆ‘ä»¬ä»¥BufferedWriterä¸¾ä¾‹æ¥è¯´æ˜ï¼Œå…ˆçœ‹çœ‹å¦‚ä½•ä½¿ç”¨BufferedWriter 12345678910111213public class Demo &#123; public static void main(String[] args) throws Exception&#123; //åˆ›å»ºBufferedWriterå¯¹è±¡ //åˆ›å»ºFileWriterå¯¹è±¡ FileWriter fw = new FileWriter(&quot;C:\\\\Users\\\\Think\\\\Desktop\\\\a.txt&quot;); BufferedWriter bw = new BufferedWriter(fw); //å†™æ•°æ® bw.write(&quot;hello Buffered&quot;); bw.close(); &#125;&#125; ä½¿ç”¨èµ·æ¥æ„Ÿè§‰ç¡®å®åƒæ˜¯è£…é¥°è€…æ¨¡å¼ï¼Œæ¥ä¸‹æ¥çœ‹å®ƒä»¬çš„ç»“æ„ï¼š å°ç»“ï¼š â€‹ BufferedWriterä½¿ç”¨è£…é¥°è€…æ¨¡å¼å¯¹Writerå­å®ç°ç±»è¿›è¡Œäº†å¢å¼ºï¼Œæ·»åŠ äº†ç¼“å†²åŒºï¼Œæé«˜äº†å†™æ•°æ®çš„æ•ˆç‡ã€‚ 5.3.6 ä»£ç†å’Œè£…é¥°è€…çš„åŒºåˆ«é™æ€ä»£ç†å’Œè£…é¥°è€…æ¨¡å¼çš„åŒºåˆ«ï¼š ç›¸åŒç‚¹ï¼š éƒ½è¦å®ç°ä¸ç›®æ ‡ç±»ç›¸åŒçš„ä¸šåŠ¡æ¥å£ åœ¨ä¸¤ä¸ªç±»ä¸­éƒ½è¦å£°æ˜ç›®æ ‡å¯¹è±¡ éƒ½å¯ä»¥åœ¨ä¸ä¿®æ”¹ç›®æ ‡ç±»çš„å‰æä¸‹å¢å¼ºç›®æ ‡æ–¹æ³• ä¸åŒç‚¹ï¼š ç›®çš„ä¸åŒè£…é¥°è€…æ˜¯ä¸ºäº†å¢å¼ºç›®æ ‡å¯¹è±¡é™æ€ä»£ç†æ˜¯ä¸ºäº†ä¿æŠ¤å’Œéšè—ç›®æ ‡å¯¹è±¡ è·å–ç›®æ ‡å¯¹è±¡æ„å»ºçš„åœ°æ–¹ä¸åŒè£…é¥°è€…æ˜¯ç”±å¤–ç•Œä¼ é€’è¿›æ¥ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•ä¼ é€’é™æ€ä»£ç†æ˜¯åœ¨ä»£ç†ç±»å†…éƒ¨åˆ›å»ºï¼Œä»¥æ­¤æ¥éšè—ç›®æ ‡å¯¹è±¡ 5.4 æ¡¥æ¥æ¨¡å¼5.4.1 æ¦‚è¿°ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦åˆ›å»ºä¸åŒçš„å›¾å½¢ï¼Œå¹¶ä¸”æ¯ä¸ªå›¾å½¢éƒ½æœ‰å¯èƒ½ä¼šæœ‰ä¸åŒçš„é¢œè‰²ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç»§æ‰¿çš„æ–¹å¼æ¥è®¾è®¡ç±»çš„å…³ç³»ï¼š æˆ‘ä»¬å¯ä»¥å‘ç°æœ‰å¾ˆå¤šçš„ç±»ï¼Œå‡å¦‚æˆ‘ä»¬å†å¢åŠ ä¸€ä¸ªå½¢çŠ¶æˆ–å†å¢åŠ ä¸€ç§é¢œè‰²ï¼Œå°±éœ€è¦åˆ›å»ºæ›´å¤šçš„ç±»ã€‚ è¯•æƒ³ï¼Œåœ¨ä¸€ä¸ªæœ‰å¤šç§å¯èƒ½ä¼šå˜åŒ–çš„ç»´åº¦çš„ç³»ç»Ÿä¸­ï¼Œç”¨ç»§æ‰¿æ–¹å¼ä¼šé€ æˆç±»çˆ†ç‚¸ï¼Œæ‰©å±•èµ·æ¥ä¸çµæ´»ã€‚æ¯æ¬¡åœ¨ä¸€ä¸ªç»´åº¦ä¸Šæ–°å¢ä¸€ä¸ªå…·ä½“å®ç°éƒ½è¦å¢åŠ å¤šä¸ªå­ç±»ã€‚ä¸ºäº†æ›´åŠ çµæ´»çš„è®¾è®¡ç³»ç»Ÿï¼Œæˆ‘ä»¬æ­¤æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨æ¡¥æ¥æ¨¡å¼ã€‚ å®šä¹‰ï¼š â€‹ å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚å®ƒæ˜¯ç”¨ç»„åˆå…³ç³»ä»£æ›¿ç»§æ‰¿å…³ç³»æ¥å®ç°ï¼Œä»è€Œé™ä½äº†æŠ½è±¡å’Œå®ç°è¿™ä¸¤ä¸ªå¯å˜ç»´åº¦çš„è€¦åˆåº¦ã€‚ 5.4.2 ç»“æ„æ¡¥æ¥ï¼ˆBridgeï¼‰æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š æŠ½è±¡åŒ–ï¼ˆAbstractionï¼‰è§’è‰² ï¼šå®šä¹‰æŠ½è±¡ç±»ï¼Œå¹¶åŒ…å«ä¸€ä¸ªå¯¹å®ç°åŒ–å¯¹è±¡çš„å¼•ç”¨ã€‚ æ‰©å±•æŠ½è±¡åŒ–ï¼ˆRefined Abstractionï¼‰è§’è‰² ï¼šæ˜¯æŠ½è±¡åŒ–è§’è‰²çš„å­ç±»ï¼Œå®ç°çˆ¶ç±»ä¸­çš„ä¸šåŠ¡æ–¹æ³•ï¼Œå¹¶é€šè¿‡ç»„åˆå…³ç³»è°ƒç”¨å®ç°åŒ–è§’è‰²ä¸­çš„ä¸šåŠ¡æ–¹æ³•ã€‚ å®ç°åŒ–ï¼ˆImplementorï¼‰è§’è‰² ï¼šå®šä¹‰å®ç°åŒ–è§’è‰²çš„æ¥å£ï¼Œä¾›æ‰©å±•æŠ½è±¡åŒ–è§’è‰²è°ƒç”¨ã€‚ å…·ä½“å®ç°åŒ–ï¼ˆConcrete Implementorï¼‰è§’è‰² ï¼šç»™å‡ºå®ç°åŒ–è§’è‰²æ¥å£çš„å…·ä½“å®ç°ã€‚ 5.4.3 æ¡ˆä¾‹ã€ä¾‹ã€‘è§†é¢‘æ’­æ”¾å™¨ éœ€è¦å¼€å‘ä¸€ä¸ªè·¨å¹³å°è§†é¢‘æ’­æ”¾å™¨ï¼Œå¯ä»¥åœ¨ä¸åŒæ“ä½œç³»ç»Ÿå¹³å°ï¼ˆå¦‚Windowsã€Macã€Linuxç­‰ï¼‰ä¸Šæ’­æ”¾å¤šç§æ ¼å¼çš„è§†é¢‘æ–‡ä»¶ï¼Œå¸¸è§çš„è§†é¢‘æ ¼å¼åŒ…æ‹¬RMVBã€AVIã€WMVç­‰ã€‚è¯¥æ’­æ”¾å™¨åŒ…å«äº†ä¸¤ä¸ªç»´åº¦ï¼Œé€‚åˆä½¿ç”¨æ¡¥æ¥æ¨¡å¼ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263//è§†é¢‘æ–‡ä»¶public interface VideoFile &#123; void decode(String fileName);&#125;//aviæ–‡ä»¶public class AVIFile implements VideoFile &#123; public void decode(String fileName) &#123; System.out.println(&quot;aviè§†é¢‘æ–‡ä»¶ï¼š&quot;+ fileName); &#125;&#125;//rmvbæ–‡ä»¶public class REVBBFile implements VideoFile &#123; public void decode(String fileName) &#123; System.out.println(&quot;rmvbæ–‡ä»¶ï¼š&quot; + fileName); &#125;&#125;//æ“ä½œç³»ç»Ÿç‰ˆæœ¬public abstract class OperatingSystemVersion &#123; protected VideoFile videoFile; public OperatingSystemVersion(VideoFile videoFile) &#123; this.videoFile = videoFile; &#125; public abstract void play(String fileName);&#125;//Windowsç‰ˆæœ¬public class Windows extends OperatingSystem &#123; public Windows(VideoFile videoFile) &#123; super(videoFile); &#125; public void play(String fileName) &#123; videoFile.decode(fileName); &#125;&#125;//macç‰ˆæœ¬public class Mac extends OperatingSystemVersion &#123; public Mac(VideoFile videoFile) &#123; super(videoFile); &#125; public void play(String fileName) &#123; videoFile.decode(fileName); &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; OperatingSystem os = new Windows(new AVIFile()); os.play(&quot;æˆ˜ç‹¼3&quot;); &#125;&#125; å¥½å¤„ï¼š æ¡¥æ¥æ¨¡å¼æé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å……æ€§ï¼Œåœ¨ä¸¤ä¸ªå˜åŒ–ç»´åº¦ä¸­ä»»æ„æ‰©å±•ä¸€ä¸ªç»´åº¦ï¼Œéƒ½ä¸éœ€è¦ä¿®æ”¹åŸæœ‰ç³»ç»Ÿã€‚ å¦‚ï¼šå¦‚æœç°åœ¨è¿˜æœ‰ä¸€ç§è§†é¢‘æ–‡ä»¶ç±»å‹wmvï¼Œæˆ‘ä»¬åªéœ€è¦å†å®šä¹‰ä¸€ä¸ªç±»å®ç°VideoFileæ¥å£å³å¯ï¼Œå…¶ä»–ç±»ä¸éœ€è¦å‘ç”Ÿå˜åŒ–ã€‚ å®ç°ç»†èŠ‚å¯¹å®¢æˆ·é€æ˜ 5.4.4 ä½¿ç”¨åœºæ™¯ å½“ä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä¸”è¿™ä¸¤ä¸ªç»´åº¦éƒ½éœ€è¦è¿›è¡Œæ‰©å±•æ—¶ã€‚ å½“ä¸€ä¸ªç³»ç»Ÿä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿æˆ–å› ä¸ºå¤šå±‚æ¬¡ç»§æ‰¿å¯¼è‡´ç³»ç»Ÿç±»çš„ä¸ªæ•°æ€¥å‰§å¢åŠ æ—¶ã€‚ å½“ä¸€ä¸ªç³»ç»Ÿéœ€è¦åœ¨æ„ä»¶çš„æŠ½è±¡åŒ–è§’è‰²å’Œå…·ä½“åŒ–è§’è‰²ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§æ—¶ã€‚é¿å…åœ¨ä¸¤ä¸ªå±‚æ¬¡ä¹‹é—´å»ºç«‹é™æ€çš„ç»§æ‰¿è”ç³»ï¼Œé€šè¿‡æ¡¥æ¥æ¨¡å¼å¯ä»¥ä½¿å®ƒä»¬åœ¨æŠ½è±¡å±‚å»ºç«‹ä¸€ä¸ªå…³è”å…³ç³»ã€‚ 5.5 å¤–è§‚æ¨¡å¼5.5.1 æ¦‚è¿°æœ‰äº›äººå¯èƒ½ç‚’è¿‡è‚¡ç¥¨ï¼Œä½†å…¶å®å¤§éƒ¨åˆ†äººéƒ½ä¸å¤ªæ‡‚ï¼Œè¿™ç§æ²¡æœ‰è¶³å¤Ÿäº†è§£è¯åˆ¸çŸ¥è¯†çš„æƒ…å†µä¸‹åšè‚¡ç¥¨æ˜¯å¾ˆå®¹æ˜“äºé’±çš„ï¼Œåˆšå¼€å§‹ç‚’è‚¡è‚¯å®šéƒ½ä¼šæƒ³ï¼Œå¦‚æœæœ‰ä¸ªæ‡‚è¡Œçš„å¸®å¸®æ‰‹å°±å¥½ï¼Œå…¶å®åŸºé‡‘å°±æ˜¯ä¸ªå¥½å¸®æ‰‹ï¼Œæ”¯ä»˜å®é‡Œå°±æœ‰è®¸å¤šçš„åŸºé‡‘ï¼Œå®ƒå°†æŠ•èµ„è€…åˆ†æ•£çš„èµ„é‡‘é›†ä¸­èµ·æ¥ï¼Œäº¤ç”±ä¸“ä¸šçš„ç»ç†äººè¿›è¡Œç®¡ç†ï¼ŒæŠ•èµ„äºè‚¡ç¥¨ã€å€ºåˆ¸ã€å¤–æ±‡ç­‰é¢†åŸŸï¼Œè€ŒåŸºé‡‘æŠ•èµ„çš„æ”¶ç›Šå½’æŒæœ‰è€…æ‰€æœ‰ï¼Œç®¡ç†æœºæ„æ”¶å–ä¸€å®šæ¯”ä¾‹çš„æ‰˜ç®¡ç®¡ç†è´¹ç”¨ã€‚ å®šä¹‰ï¼š â€‹ åˆåé—¨é¢æ¨¡å¼ï¼Œæ˜¯ä¸€ç§é€šè¿‡ä¸ºå¤šä¸ªå¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ä¸ªä¸€è‡´çš„æ¥å£ï¼Œè€Œä½¿è¿™äº›å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“è¢«è®¿é—®çš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼å¯¹å¤–æœ‰ä¸€ä¸ªç»Ÿä¸€æ¥å£ï¼Œå¤–éƒ¨åº”ç”¨ç¨‹åºä¸ç”¨å…³å¿ƒå†…éƒ¨å­ç³»ç»Ÿçš„å…·ä½“çš„ç»†èŠ‚ï¼Œè¿™æ ·ä¼šå¤§å¤§é™ä½åº”ç”¨ç¨‹åºçš„å¤æ‚åº¦ï¼Œæé«˜äº†ç¨‹åºçš„å¯ç»´æŠ¤æ€§ã€‚ â€‹ å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼æ˜¯â€œè¿ªç±³ç‰¹æ³•åˆ™â€çš„å…¸å‹åº”ç”¨ 5.5.2 ç»“æ„å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š å¤–è§‚ï¼ˆFacadeï¼‰è§’è‰²ï¼šä¸ºå¤šä¸ªå­ç³»ç»Ÿå¯¹å¤–æä¾›ä¸€ä¸ªå…±åŒçš„æ¥å£ã€‚ å­ç³»ç»Ÿï¼ˆSub Systemï¼‰è§’è‰²ï¼šå®ç°ç³»ç»Ÿçš„éƒ¨åˆ†åŠŸèƒ½ï¼Œå®¢æˆ·å¯ä»¥é€šè¿‡å¤–è§‚è§’è‰²è®¿é—®å®ƒã€‚ 5.5.3 æ¡ˆä¾‹ã€ä¾‹ã€‘æ™ºèƒ½å®¶ç”µæ§åˆ¶ å°æ˜çš„çˆ·çˆ·å·²ç»60å²äº†ï¼Œä¸€ä¸ªäººåœ¨å®¶ç”Ÿæ´»ï¼šæ¯æ¬¡éƒ½éœ€è¦æ‰“å¼€ç¯ã€æ‰“å¼€ç”µè§†ã€æ‰“å¼€ç©ºè°ƒï¼›ç¡è§‰æ—¶å…³é—­ç¯ã€å…³é—­ç”µè§†ã€å…³é—­ç©ºè°ƒï¼›æ“ä½œèµ·æ¥éƒ½æ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥å°æ˜ç»™çˆ·çˆ·ä¹°äº†æ™ºèƒ½éŸ³ç®±ï¼Œå¯ä»¥é€šè¿‡è¯­éŸ³ç›´æ¥æ§åˆ¶è¿™äº›æ™ºèƒ½å®¶ç”µçš„å¼€å¯å’Œå…³é—­ã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283//ç¯ç±»public class Light &#123; public void on() &#123; System.out.println(&quot;æ‰“å¼€äº†ç¯....&quot;); &#125; public void off() &#123; System.out.println(&quot;å…³é—­äº†ç¯....&quot;); &#125;&#125;//ç”µè§†ç±»public class TV &#123; public void on() &#123; System.out.println(&quot;æ‰“å¼€äº†ç”µè§†....&quot;); &#125; public void off() &#123; System.out.println(&quot;å…³é—­äº†ç”µè§†....&quot;); &#125;&#125;//æ§åˆ¶ç±»public class AirCondition &#123; public void on() &#123; System.out.println(&quot;æ‰“å¼€äº†ç©ºè°ƒ....&quot;); &#125; public void off() &#123; System.out.println(&quot;å…³é—­äº†ç©ºè°ƒ....&quot;); &#125;&#125;//æ™ºèƒ½éŸ³ç®±public class SmartAppliancesFacade &#123; private Light light; private TV tv; private AirCondition airCondition; public SmartAppliancesFacade() &#123; light = new Light(); tv = new TV(); airCondition = new AirCondition(); &#125; public void say(String message) &#123; if(message.contains(&quot;æ‰“å¼€&quot;)) &#123; on(); &#125; else if(message.contains(&quot;å…³é—­&quot;)) &#123; off(); &#125; else &#123; System.out.println(&quot;æˆ‘è¿˜å¬ä¸æ‡‚ä½ è¯´çš„ï¼ï¼ï¼&quot;); &#125; &#125; //èµ·åºŠåä¸€é”®å¼€ç”µå™¨ private void on() &#123; System.out.println(&quot;èµ·åºŠäº†&quot;); light.on(); tv.on(); airCondition.on(); &#125; //ç¡è§‰ä¸€é”®å…³ç”µå™¨ private void off() &#123; System.out.println(&quot;ç¡è§‰äº†&quot;); light.off(); tv.off(); airCondition.off(); &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; //åˆ›å»ºå¤–è§‚å¯¹è±¡ SmartAppliancesFacade facade = new SmartAppliancesFacade(); //å®¢æˆ·ç«¯ç›´æ¥ä¸å¤–è§‚å¯¹è±¡è¿›è¡Œäº¤äº’ facade.say(&quot;æ‰“å¼€å®¶ç”µ&quot;); facade.say(&quot;å…³é—­å®¶ç”µ&quot;); &#125;&#125; å¥½å¤„ï¼š é™ä½äº†å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿å¾—å­ç³»ç»Ÿçš„å˜åŒ–ä¸ä¼šå½±å“è°ƒç”¨å®ƒçš„å®¢æˆ·ç±»ã€‚ å¯¹å®¢æˆ·å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ï¼Œå‡å°‘äº†å®¢æˆ·å¤„ç†çš„å¯¹è±¡æ•°ç›®ï¼Œå¹¶ä½¿å¾—å­ç³»ç»Ÿä½¿ç”¨èµ·æ¥æ›´åŠ å®¹æ˜“ã€‚ ç¼ºç‚¹ï¼š ä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œä¿®æ”¹å¾ˆéº»çƒ¦ 5.5.4 ä½¿ç”¨åœºæ™¯ å¯¹åˆ†å±‚ç»“æ„ç³»ç»Ÿæ„å»ºæ—¶ï¼Œä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰å­ç³»ç»Ÿä¸­æ¯å±‚çš„å…¥å£ç‚¹å¯ä»¥ç®€åŒ–å­ç³»ç»Ÿä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ å½“ä¸€ä¸ªå¤æ‚ç³»ç»Ÿçš„å­ç³»ç»Ÿå¾ˆå¤šæ—¶ï¼Œå¤–è§‚æ¨¡å¼å¯ä»¥ä¸ºç³»ç»Ÿè®¾è®¡ä¸€ä¸ªç®€å•çš„æ¥å£ä¾›å¤–ç•Œè®¿é—®ã€‚ å½“å®¢æˆ·ç«¯ä¸å¤šä¸ªå­ç³»ç»Ÿä¹‹é—´å­˜åœ¨å¾ˆå¤§çš„è”ç³»æ—¶ï¼Œå¼•å…¥å¤–è§‚æ¨¡å¼å¯å°†å®ƒä»¬åˆ†ç¦»ï¼Œä»è€Œæé«˜å­ç³»ç»Ÿçš„ç‹¬ç«‹æ€§å’Œå¯ç§»æ¤æ€§ã€‚ 5.5.5 æºç è§£æä½¿ç”¨tomcatä½œä¸ºwebå®¹å™¨æ—¶ï¼Œæ¥æ”¶æµè§ˆå™¨å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œtomcatä¼šå°†è¯·æ±‚ä¿¡æ¯å°è£…æˆServletRequestå¯¹è±¡ï¼Œå¦‚ä¸‹å›¾â‘ å¤„å¯¹è±¡ã€‚ä½†æ˜¯å¤§å®¶æƒ³æƒ³ServletRequestæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªå­æ¥å£HttpServletRequestï¼Œè€Œæˆ‘ä»¬çŸ¥é“è¯¥requestå¯¹è±¡è‚¯å®šæ˜¯ä¸€ä¸ªHttpServletRequestå¯¹è±¡çš„å­å®ç°ç±»å¯¹è±¡ï¼Œåˆ°åº•æ˜¯å“ªä¸ªç±»çš„å¯¹è±¡å‘¢ï¼Ÿå¯ä»¥é€šè¿‡è¾“å‡ºrequestå¯¹è±¡ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°æ˜¯ä¸€ä¸ªåä¸ºRequestFacadeçš„ç±»çš„å¯¹è±¡ã€‚ RequestFacadeç±»å°±ä½¿ç”¨äº†å¤–è§‚æ¨¡å¼ã€‚å…ˆçœ‹ç»“æ„å›¾ï¼š ä¸ºä»€ä¹ˆåœ¨æ­¤å¤„ä½¿ç”¨å¤–è§‚æ¨¡å¼å‘¢ï¼Ÿ â€‹ å®šä¹‰ RequestFacade ç±»ï¼Œåˆ†åˆ«å®ç° ServletRequest ï¼ŒåŒæ—¶å®šä¹‰ç§æœ‰æˆå‘˜å˜é‡ Request ï¼Œå¹¶ä¸”æ–¹æ³•çš„å®ç°è°ƒç”¨ Request çš„å®ç°ã€‚ç„¶åï¼Œå°† RequestFacadeä¸Šè½¬ä¸º ServletRequest ä¼ ç»™ servlet çš„ service æ–¹æ³•ï¼Œè¿™æ ·å³ä½¿åœ¨ servlet ä¸­è¢«ä¸‹è½¬ä¸º RequestFacade ï¼Œä¹Ÿä¸èƒ½è®¿é—®ç§æœ‰æˆå‘˜å˜é‡å¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚æ—¢ç”¨äº† Request ï¼Œåˆèƒ½é˜²æ­¢å…¶ä¸­æ–¹æ³•è¢«ä¸åˆç†çš„è®¿é—®ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰","slug":"è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰","date":"2023-06-16T05:41:43.000Z","updated":"2023-06-16T05:51:51.409Z","comments":true,"path":"2023/06/16/è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰/","link":"","permalink":"http://example.com/2023/06/16/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%BA%8C%EF%BC%89/","excerpt":"","text":"4ï¼Œåˆ›å»ºå‹æ¨¡å¼4.2 å·¥å‚æ¨¡å¼4.2.1 æ¦‚è¿°éœ€æ±‚ï¼šè®¾è®¡ä¸€ä¸ªå’–å•¡åº—ç‚¹é¤ç³»ç»Ÿã€‚ è®¾è®¡ä¸€ä¸ªå’–å•¡ç±»ï¼ˆCoffeeï¼‰ï¼Œå¹¶å®šä¹‰å…¶ä¸¤ä¸ªå­ç±»ï¼ˆç¾å¼å’–å•¡ã€AmericanCoffeeã€‘å’Œæ‹¿é“å’–å•¡ã€LatteCoffeeã€‘ï¼‰ï¼›å†è®¾è®¡ä¸€ä¸ªå’–å•¡åº—ç±»ï¼ˆCoffeeStoreï¼‰ï¼Œå’–å•¡åº—å…·æœ‰ç‚¹å’–å•¡çš„åŠŸèƒ½ã€‚ å…·ä½“ç±»çš„è®¾è®¡å¦‚ä¸‹ï¼š åœ¨javaä¸­ï¼Œä¸‡ç‰©çš†å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡éƒ½éœ€è¦åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„æ—¶å€™ç›´æ¥newè¯¥å¯¹è±¡ï¼Œå°±ä¼šå¯¹è¯¥å¯¹è±¡è€¦åˆä¸¥é‡ï¼Œå‡å¦‚æˆ‘ä»¬è¦æ›´æ¢å¯¹è±¡ï¼Œæ‰€æœ‰newå¯¹è±¡çš„åœ°æ–¹éƒ½éœ€è¦ä¿®æ”¹ä¸€éï¼Œè¿™æ˜¾ç„¶è¿èƒŒäº†è½¯ä»¶è®¾è®¡çš„å¼€é—­åŸåˆ™ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨å·¥å‚æ¥ç”Ÿäº§å¯¹è±¡ï¼Œæˆ‘ä»¬å°±åªå’Œå·¥å‚æ‰“äº¤é“å°±å¯ä»¥äº†ï¼Œå½»åº•å’Œå¯¹è±¡è§£è€¦ï¼Œå¦‚æœè¦æ›´æ¢å¯¹è±¡ï¼Œç›´æ¥åœ¨å·¥å‚é‡Œæ›´æ¢è¯¥å¯¹è±¡å³å¯ï¼Œè¾¾åˆ°äº†ä¸å¯¹è±¡è§£è€¦çš„ç›®çš„ï¼›æ‰€ä»¥è¯´ï¼Œå·¥å‚æ¨¡å¼æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ï¼šè§£è€¦ã€‚ åœ¨æœ¬æ•™ç¨‹ä¸­ä¼šä»‹ç»ä¸‰ç§å·¥å‚çš„ä½¿ç”¨ ç®€å•å·¥å‚æ¨¡å¼ï¼ˆä¸å±äºGOFçš„23ç§ç»å…¸è®¾è®¡æ¨¡å¼ï¼‰ å·¥å‚æ–¹æ³•æ¨¡å¼ æŠ½è±¡å·¥å‚æ¨¡å¼ 4.2.2 ç®€å•å·¥å‚æ¨¡å¼ç®€å•å·¥å‚ä¸æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œåè€Œæ¯”è¾ƒåƒæ˜¯ä¸€ç§ç¼–ç¨‹ä¹ æƒ¯ã€‚ 4.2.2.1 ç»“æ„ç®€å•å·¥å‚åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š æŠ½è±¡äº§å“ ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚ å…·ä½“äº§å“ ï¼šå®ç°æˆ–è€…ç»§æ‰¿æŠ½è±¡äº§å“çš„å­ç±» å…·ä½“å·¥å‚ ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ–¹æ³•ï¼Œè°ƒç”¨è€…é€šè¿‡è¯¥æ–¹æ³•æ¥è·å–äº§å“ã€‚ 4.2.2.2 å®ç°ç°åœ¨ä½¿ç”¨ç®€å•å·¥å‚å¯¹ä¸Šé¢æ¡ˆä¾‹è¿›è¡Œæ”¹è¿›ï¼Œç±»å›¾å¦‚ä¸‹ï¼š å·¥å‚ç±»ä»£ç å¦‚ä¸‹ï¼š 123456789101112public class SimpleCoffeeFactory &#123; public Coffee createCoffee(String type) &#123; Coffee coffee = null; if(&quot;americano&quot;.equals(type)) &#123; coffee = new AmericanoCoffee(); &#125; else if(&quot;latte&quot;.equals(type)) &#123; coffee = new LatteCoffee(); &#125; return coffee; &#125;&#125; å·¥å‚ï¼ˆfactoryï¼‰å¤„ç†åˆ›å»ºå¯¹è±¡çš„ç»†èŠ‚ï¼Œä¸€æ—¦æœ‰äº†SimpleCoffeeFactoryï¼ŒCoffeeStoreç±»ä¸­çš„orderCoffee()å°±å˜æˆæ­¤å¯¹è±¡çš„å®¢æˆ·ï¼ŒåæœŸå¦‚æœéœ€è¦Coffeeå¯¹è±¡ç›´æ¥ä»å·¥å‚ä¸­è·å–å³å¯ã€‚è¿™æ ·ä¹Ÿå°±è§£é™¤äº†å’ŒCoffeeå®ç°ç±»çš„è€¦åˆï¼ŒåŒæ—¶åˆäº§ç”Ÿäº†æ–°çš„è€¦åˆï¼ŒCoffeeStoreå¯¹è±¡å’ŒSimpleCoffeeFactoryå·¥å‚å¯¹è±¡çš„è€¦åˆï¼Œå·¥å‚å¯¹è±¡å’Œå•†å“å¯¹è±¡çš„è€¦åˆã€‚ åæœŸå¦‚æœå†åŠ æ–°å“ç§çš„å’–å•¡ï¼Œæˆ‘ä»¬åŠ¿å¿…è¦éœ€æ±‚ä¿®æ”¹SimpleCoffeeFactoryçš„ä»£ç ï¼Œè¿åäº†å¼€é—­åŸåˆ™ã€‚å·¥å‚ç±»çš„å®¢æˆ·ç«¯å¯èƒ½æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚åˆ›å»ºç¾å›¢å¤–å–ç­‰ï¼Œè¿™æ ·åªéœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç ï¼Œçœå»å…¶ä»–çš„ä¿®æ”¹æ“ä½œã€‚ 4.2.2.4 ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š å°è£…äº†åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡å‚æ•°ç›´æ¥è·å–å¯¹è±¡ã€‚æŠŠå¯¹è±¡çš„åˆ›å»ºå’Œä¸šåŠ¡é€»è¾‘å±‚åˆ†å¼€ï¼Œè¿™æ ·ä»¥åå°±é¿å…äº†ä¿®æ”¹å®¢æˆ·ä»£ç ï¼Œå¦‚æœè¦å®ç°æ–°äº§å“ç›´æ¥ä¿®æ”¹å·¥å‚ç±»ï¼Œè€Œä¸éœ€è¦åœ¨åŸä»£ç ä¸­ä¿®æ”¹ï¼Œè¿™æ ·å°±é™ä½äº†å®¢æˆ·ä»£ç ä¿®æ”¹çš„å¯èƒ½æ€§ï¼Œæ›´åŠ å®¹æ˜“æ‰©å±•ã€‚ ç¼ºç‚¹ï¼š å¢åŠ æ–°äº§å“æ—¶è¿˜æ˜¯éœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚ 4.2.2.3 æ‰©å±•é™æ€å·¥å‚ åœ¨å¼€å‘ä¸­ä¹Ÿæœ‰ä¸€éƒ¨åˆ†äººå°†å·¥å‚ç±»ä¸­çš„åˆ›å»ºå¯¹è±¡çš„åŠŸèƒ½å®šä¹‰ä¸ºé™æ€çš„ï¼Œè¿™ä¸ªå°±æ˜¯é™æ€å·¥å‚æ¨¡å¼ï¼Œå®ƒä¹Ÿä¸æ˜¯23ç§è®¾è®¡æ¨¡å¼ä¸­çš„ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112public class SimpleCoffeeFactory &#123; public static Coffee createCoffee(String type) &#123; Coffee coffee = null; if(&quot;americano&quot;.equals(type)) &#123; coffee = new AmericanoCoffee(); &#125; else if(&quot;latte&quot;.equals(type)) &#123; coffee = new LatteCoffee(); &#125; return coffe; &#125;&#125; 4.2.3 å·¥å‚æ–¹æ³•æ¨¡å¼é’ˆå¯¹ä¸Šä¾‹ä¸­çš„ç¼ºç‚¹ï¼Œä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼å°±å¯ä»¥å®Œç¾çš„è§£å†³ï¼Œå®Œå…¨éµå¾ªå¼€é—­åŸåˆ™ã€‚ 4.2.3.1 æ¦‚å¿µå®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªäº§å“ç±»å¯¹è±¡ã€‚å·¥å‚æ–¹æ³•ä½¿ä¸€ä¸ªäº§å“ç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å·¥å‚çš„å­ç±»ã€‚ 4.2.3.2 ç»“æ„å·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸»è¦è§’è‰²ï¼š æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œè°ƒç”¨è€…é€šè¿‡å®ƒè®¿é—®å…·ä½“å·¥å‚çš„å·¥å‚æ–¹æ³•æ¥åˆ›å»ºäº§å“ã€‚ å…·ä½“å·¥å‚ï¼ˆConcreteFactoryï¼‰ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚ æŠ½è±¡äº§å“ï¼ˆProductï¼‰ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚ å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒåŒå…·ä½“å·¥å‚ä¹‹é—´ä¸€ä¸€å¯¹åº”ã€‚ 4.2.3.3 å®ç°ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼å¯¹ä¸Šä¾‹è¿›è¡Œæ”¹è¿›ï¼Œç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š æŠ½è±¡å·¥å‚ï¼š 1234public interface CoffeeFactory &#123; Coffee createCoffee();&#125; å…·ä½“å·¥å‚ï¼š 12345678910111213public class LatteCoffeeFactory implements CoffeeFactory &#123; public Coffee createCoffee() &#123; return new LatteCoffee(); &#125;&#125;public class AmericanCoffeeFactory implements CoffeeFactory &#123; public Coffee createCoffee() &#123; return new AmericanCoffee(); &#125;&#125; å’–å•¡åº—ç±»ï¼š 123456789101112131415public class CoffeeStore &#123; private CoffeeFactory factory; public CoffeeStore(CoffeeFactory factory) &#123; this.factory = factory; &#125; public Coffee orderCoffee(String type) &#123; Coffee coffee = factory.createCoffee(); coffee.addMilk(); coffee.addsugar(); return coffee; &#125;&#125; ä»ä»¥ä¸Šçš„ç¼–å†™çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œè¦å¢åŠ äº§å“ç±»æ—¶ä¹Ÿè¦ç›¸åº”åœ°å¢åŠ å·¥å‚ç±»ï¼Œä¸éœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç äº†ï¼Œè¿™æ ·å°±è§£å†³äº†ç®€å•å·¥å‚æ¨¡å¼çš„ç¼ºç‚¹ã€‚ å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„è¿›ä¸€æ­¥æŠ½è±¡ã€‚ç”±äºä½¿ç”¨äº†å¤šæ€æ€§ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼ä¿æŒäº†ç®€å•å·¥å‚æ¨¡å¼çš„ä¼˜ç‚¹ï¼Œè€Œä¸”å…‹æœäº†å®ƒçš„ç¼ºç‚¹ã€‚ 4.2.3.4 ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š ç”¨æˆ·åªéœ€è¦çŸ¥é“å…·ä½“å·¥å‚çš„åç§°å°±å¯å¾—åˆ°æ‰€è¦çš„äº§å“ï¼Œæ— é¡»çŸ¥é“äº§å“çš„å…·ä½“åˆ›å»ºè¿‡ç¨‹ï¼› åœ¨ç³»ç»Ÿå¢åŠ æ–°çš„äº§å“æ—¶åªéœ€è¦æ·»åŠ å…·ä½“äº§å“ç±»å’Œå¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œæ— é¡»å¯¹åŸå·¥å‚è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ï¼› ç¼ºç‚¹ï¼š æ¯å¢åŠ ä¸€ä¸ªäº§å“å°±è¦å¢åŠ ä¸€ä¸ªå…·ä½“äº§å“ç±»å’Œä¸€ä¸ªå¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œè¿™å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚ 4.2.4 æŠ½è±¡å·¥å‚æ¨¡å¼å‰é¢ä»‹ç»çš„å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­è€ƒè™‘çš„æ˜¯ä¸€ç±»äº§å“çš„ç”Ÿäº§ï¼Œå¦‚ç•œç‰§åœºåªå…»åŠ¨ç‰©ã€ç”µè§†æœºå‚åªç”Ÿäº§ç”µè§†æœºã€ä¼ æ™ºæ’­å®¢åªåŸ¹å…»è®¡ç®—æœºè½¯ä»¶ä¸“ä¸šçš„å­¦ç”Ÿç­‰ã€‚ è¿™äº›å·¥å‚åªç”Ÿäº§åŒç§ç±»äº§å“ï¼ŒåŒç§ç±»äº§å“ç§°ä¸ºåŒç­‰çº§äº§å“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼åªè€ƒè™‘ç”Ÿäº§åŒç­‰çº§çš„äº§å“ï¼Œä½†æ˜¯åœ¨ç°å®ç”Ÿæ´»ä¸­è®¸å¤šå·¥å‚æ˜¯ç»¼åˆå‹çš„å·¥å‚ï¼Œèƒ½ç”Ÿäº§å¤šç­‰çº§ï¼ˆç§ç±»ï¼‰ çš„äº§å“ï¼Œå¦‚ç”µå™¨å‚æ—¢ç”Ÿäº§ç”µè§†æœºåˆç”Ÿäº§æ´—è¡£æœºæˆ–ç©ºè°ƒï¼Œå¤§å­¦æ—¢æœ‰è½¯ä»¶ä¸“ä¸šåˆæœ‰ç”Ÿç‰©ä¸“ä¸šç­‰ã€‚ æœ¬èŠ‚è¦ä»‹ç»çš„æŠ½è±¡å·¥å‚æ¨¡å¼å°†è€ƒè™‘å¤šç­‰çº§äº§å“çš„ç”Ÿäº§ï¼Œå°†åŒä¸€ä¸ªå…·ä½“å·¥å‚æ‰€ç”Ÿäº§çš„ä½äºä¸åŒç­‰çº§çš„ä¸€ç»„äº§å“ç§°ä¸ºä¸€ä¸ªäº§å“æ—ï¼Œä¸‹å›¾æ‰€ç¤ºæ¨ªè½´æ˜¯äº§å“ç­‰çº§ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ç±»äº§å“ï¼›çºµè½´æ˜¯äº§å“æ—ï¼Œä¹Ÿå°±æ˜¯åŒä¸€å“ç‰Œçš„äº§å“ï¼ŒåŒä¸€å“ç‰Œçš„äº§å“äº§è‡ªåŒä¸€ä¸ªå·¥å‚ã€‚ 4.2.4.1 æ¦‚å¿µæ˜¯ä¸€ç§ä¸ºè®¿é—®ç±»æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç»„ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œä¸”è®¿é—®ç±»æ— é¡»æŒ‡å®šæ‰€è¦äº§å“çš„å…·ä½“ç±»å°±èƒ½å¾—åˆ°åŒæ—çš„ä¸åŒç­‰çº§çš„äº§å“çš„æ¨¡å¼ç»“æ„ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„å‡çº§ç‰ˆæœ¬ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼åªç”Ÿäº§ä¸€ä¸ªç­‰çº§çš„äº§å“ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼å¯ç”Ÿäº§å¤šä¸ªç­‰çº§çš„äº§å“ã€‚ 4.2.4.2 ç»“æ„æŠ½è±¡å·¥å‚æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œå®ƒåŒ…å«å¤šä¸ªåˆ›å»ºäº§å“çš„æ–¹æ³•ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªä¸åŒç­‰çº§çš„äº§å“ã€‚ å…·ä½“å·¥å‚ï¼ˆConcrete Factoryï¼‰ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚ æŠ½è±¡äº§å“ï¼ˆProductï¼‰ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ‰å¤šä¸ªæŠ½è±¡äº§å“ã€‚ å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒ åŒå…·ä½“å·¥å‚ä¹‹é—´æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ã€‚ 4.2.4.2 å®ç°ç°å’–å•¡åº—ä¸šåŠ¡å‘ç”Ÿæ”¹å˜ï¼Œä¸ä»…è¦ç”Ÿäº§å’–å•¡è¿˜è¦ç”Ÿäº§ç”œç‚¹ï¼Œå¦‚ææ‹‰ç±³è‹ã€æŠ¹èŒ¶æ…•æ–¯ç­‰ï¼Œè¦æ˜¯æŒ‰ç…§å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œéœ€è¦å®šä¹‰ææ‹‰ç±³è‹ç±»ã€æŠ¹èŒ¶æ…•æ–¯ç±»ã€ææ‹‰ç±³è‹å·¥å‚ã€æŠ¹èŒ¶æ…•æ–¯å·¥å‚ã€ç”œç‚¹å·¥å‚ç±»ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿç±»çˆ†ç‚¸æƒ…å†µã€‚å…¶ä¸­æ‹¿é“å’–å•¡ã€ç¾å¼å’–å•¡æ˜¯ä¸€ä¸ªäº§å“ç­‰çº§ï¼Œéƒ½æ˜¯å’–å•¡ï¼›ææ‹‰ç±³è‹ã€æŠ¹èŒ¶æ…•æ–¯ä¹Ÿæ˜¯ä¸€ä¸ªäº§å“ç­‰çº§ï¼›æ‹¿é“å’–å•¡å’Œææ‹‰ç±³è‹æ˜¯åŒä¸€äº§å“æ—ï¼ˆä¹Ÿå°±æ˜¯éƒ½å±äºæ„å¤§åˆ©é£å‘³ï¼‰ï¼Œç¾å¼å’–å•¡å’ŒæŠ¹èŒ¶æ…•æ–¯æ˜¯åŒä¸€äº§å“æ—ï¼ˆä¹Ÿå°±æ˜¯éƒ½å±äºç¾å¼é£å‘³ï¼‰ã€‚æ‰€ä»¥è¿™ä¸ªæ¡ˆä¾‹å¯ä»¥ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼å®ç°ã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š æŠ½è±¡å·¥å‚ï¼š 123456public interface DessertFactory &#123; Coffee createCoffee(); Dessert createDessert();&#125; å…·ä½“å·¥å‚ï¼š 12345678910111213141516171819202122//ç¾å¼ç”œç‚¹å·¥å‚public class AmericanDessertFactory implements DessertFactory &#123; public Coffee createCoffee() &#123; return new AmericanCoffee(); &#125; public Dessert createDessert() &#123; return new MatchaMousse(); &#125;&#125;//æ„å¤§åˆ©é£å‘³ç”œç‚¹å·¥å‚public class ItalyDessertFactory implements DessertFactory &#123; public Coffee createCoffee() &#123; return new LatteCoffee(); &#125; public Dessert createDessert() &#123; return new Tiramisu(); &#125;&#125; å¦‚æœè¦åŠ åŒä¸€ä¸ªäº§å“æ—çš„è¯ï¼Œåªéœ€è¦å†åŠ ä¸€ä¸ªå¯¹åº”çš„å·¥å‚ç±»å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹å…¶ä»–çš„ç±»ã€‚ 4.2.4.3 ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š å½“ä¸€ä¸ªäº§å“æ—ä¸­çš„å¤šä¸ªå¯¹è±¡è¢«è®¾è®¡æˆä¸€èµ·å·¥ä½œæ—¶ï¼Œå®ƒèƒ½ä¿è¯å®¢æˆ·ç«¯å§‹ç»ˆåªä½¿ç”¨åŒä¸€ä¸ªäº§å“æ—ä¸­çš„å¯¹è±¡ã€‚ ç¼ºç‚¹ï¼š å½“äº§å“æ—ä¸­éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„äº§å“æ—¶ï¼Œæ‰€æœ‰çš„å·¥å‚ç±»éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚ 4.2.4.4 ä½¿ç”¨åœºæ™¯ å½“éœ€è¦åˆ›å»ºçš„å¯¹è±¡æ˜¯ä¸€ç³»åˆ—ç›¸äº’å…³è”æˆ–ç›¸äº’ä¾èµ–çš„äº§å“æ—æ—¶ï¼Œå¦‚ç”µå™¨å·¥å‚ä¸­çš„ç”µè§†æœºã€æ´—è¡£æœºã€ç©ºè°ƒç­‰ã€‚ ç³»ç»Ÿä¸­æœ‰å¤šä¸ªäº§å“æ—ï¼Œä½†æ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„æŸä¸€æ—äº§å“ã€‚å¦‚æœ‰äººåªå–œæ¬¢ç©¿æŸä¸€ä¸ªå“ç‰Œçš„è¡£æœå’Œé‹ã€‚ ç³»ç»Ÿä¸­æä¾›äº†äº§å“çš„ç±»åº“ï¼Œä¸”æ‰€æœ‰äº§å“çš„æ¥å£ç›¸åŒï¼Œå®¢æˆ·ç«¯ä¸ä¾èµ–äº§å“å®ä¾‹çš„åˆ›å»ºç»†èŠ‚å’Œå†…éƒ¨ç»“æ„ã€‚ å¦‚ï¼šè¾“å…¥æ³•æ¢çš®è‚¤ï¼Œä¸€æ•´å¥—ä¸€èµ·æ¢ã€‚ç”Ÿæˆä¸åŒæ“ä½œç³»ç»Ÿçš„ç¨‹åºã€‚ 4.2.5 æ¨¡å¼æ‰©å±•ç®€å•å·¥å‚+é…ç½®æ–‡ä»¶è§£é™¤è€¦åˆ å¯ä»¥é€šè¿‡å·¥å‚æ¨¡å¼+é…ç½®æ–‡ä»¶çš„æ–¹å¼è§£é™¤å·¥å‚å¯¹è±¡å’Œäº§å“å¯¹è±¡çš„è€¦åˆã€‚åœ¨å·¥å‚ç±»ä¸­åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„å…¨ç±»åï¼Œå¹¶åˆ›å»ºå¯¹è±¡è¿›è¡Œå­˜å‚¨ï¼Œå®¢æˆ·ç«¯å¦‚æœéœ€è¦å¯¹è±¡ï¼Œç›´æ¥è¿›è¡Œè·å–å³å¯ã€‚ ç¬¬ä¸€æ­¥ï¼šå®šä¹‰é…ç½®æ–‡ä»¶ ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨propertiesæ–‡ä»¶ä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œåç§°ä¸ºbean.properties 12american=com.itheima.pattern.factory.config_factory.AmericanCoffeelatte=com.itheima.pattern.factory.config_factory.LatteCoffee ç¬¬äºŒæ­¥ï¼šæ”¹è¿›å·¥å‚ç±» 1234567891011121314151617181920212223242526272829public class CoffeeFactory &#123; private static Map&lt;String,Coffee&gt; map = new HashMap(); static &#123; Properties p = new Properties(); InputStream is = CoffeeFactory.class.getClassLoader().getResourceAsStream(&quot;bean.properties&quot;); try &#123; p.load(is); //éå†Propertiesé›†åˆå¯¹è±¡ Set&lt;Object&gt; keys = p.keySet(); for (Object key : keys) &#123; //æ ¹æ®é”®è·å–å€¼ï¼ˆå…¨ç±»åï¼‰ String className = p.getProperty((String) key); //è·å–å­—èŠ‚ç å¯¹è±¡ Class clazz = Class.forName(className); Coffee obj = (Coffee) clazz.newInstance(); map.put((String)key,obj); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; public static Coffee createCoffee(String name) &#123; return map.get(name); &#125;&#125; é™æ€æˆå‘˜å˜é‡ç”¨æ¥å­˜å‚¨åˆ›å»ºçš„å¯¹è±¡ï¼ˆé”®å­˜å‚¨çš„æ˜¯åç§°ï¼Œå€¼å­˜å‚¨çš„æ˜¯å¯¹åº”çš„å¯¹è±¡ï¼‰ï¼Œè€Œè¯»å–é…ç½®æ–‡ä»¶ä»¥åŠåˆ›å»ºå¯¹è±¡å†™åœ¨é™æ€ä»£ç å—ä¸­ï¼Œç›®çš„å°±æ˜¯åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ã€‚ 4.2.6 JDKæºç è§£æ-Collection.iteratoræ–¹æ³•12345678910111213141516public class Demo &#123; public static void main(String[] args) &#123; List&lt;String&gt; list = new ArrayList&lt;&gt;(); list.add(&quot;ä»¤ç‹å†²&quot;); list.add(&quot;é£æ¸…æ‰¬&quot;); list.add(&quot;ä»»æˆ‘è¡Œ&quot;); //è·å–è¿­ä»£å™¨å¯¹è±¡ Iterator&lt;String&gt; it = list.iterator(); //ä½¿ç”¨è¿­ä»£å™¨éå† while(it.hasNext()) &#123; String ele = it.next(); System.out.println(ele); &#125; &#125;&#125; å¯¹ä¸Šé¢çš„ä»£ç å¤§å®¶åº”è¯¥å¾ˆç†Ÿï¼Œä½¿ç”¨è¿­ä»£å™¨éå†é›†åˆï¼Œè·å–é›†åˆä¸­çš„å…ƒç´ ã€‚è€Œå•åˆ—é›†åˆè·å–è¿­ä»£å™¨çš„æ–¹æ³•å°±ä½¿ç”¨åˆ°äº†å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚æˆ‘ä»¬çœ‹é€šè¿‡ç±»å›¾çœ‹çœ‹ç»“æ„ï¼š Collectionæ¥å£æ˜¯æŠ½è±¡å·¥å‚ç±»ï¼ŒArrayListæ˜¯å…·ä½“çš„å·¥å‚ç±»ï¼›Iteratoræ¥å£æ˜¯æŠ½è±¡å•†å“ç±»ï¼ŒArrayListç±»ä¸­çš„Iterå†…éƒ¨ç±»æ˜¯å…·ä½“çš„å•†å“ç±»ã€‚åœ¨å…·ä½“çš„å·¥å‚ç±»ä¸­iterator()æ–¹æ³•åˆ›å»ºå…·ä½“çš„å•†å“ç±»çš„å¯¹è±¡ã€‚ å¦ï¼š â€‹ 1,DateForamtç±»ä¸­çš„getInstance()æ–¹æ³•ä½¿ç”¨çš„æ˜¯å·¥å‚æ¨¡å¼ï¼› â€‹ 2,Calendarç±»ä¸­çš„getInstance()æ–¹æ³•ä½¿ç”¨çš„æ˜¯å·¥å‚æ¨¡å¼ï¼› 4.3 åŸå‹æ¨¡å¼4.3.1 æ¦‚è¿°ç”¨ä¸€ä¸ªå·²ç»åˆ›å»ºçš„å®ä¾‹ä½œä¸ºåŸå‹ï¼Œé€šè¿‡å¤åˆ¶è¯¥åŸå‹å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå’ŒåŸå‹å¯¹è±¡ç›¸åŒçš„æ–°å¯¹è±¡ã€‚ 4.3.2 ç»“æ„åŸå‹æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š æŠ½è±¡åŸå‹ç±»ï¼šè§„å®šäº†å…·ä½“åŸå‹å¯¹è±¡å¿…é¡»å®ç°çš„çš„ clone() æ–¹æ³•ã€‚ å…·ä½“åŸå‹ç±»ï¼šå®ç°æŠ½è±¡åŸå‹ç±»çš„ clone() æ–¹æ³•ï¼Œå®ƒæ˜¯å¯è¢«å¤åˆ¶çš„å¯¹è±¡ã€‚ è®¿é—®ç±»ï¼šä½¿ç”¨å…·ä½“åŸå‹ç±»ä¸­çš„ clone() æ–¹æ³•æ¥å¤åˆ¶æ–°çš„å¯¹è±¡ã€‚ æ¥å£ç±»å›¾å¦‚ä¸‹ï¼š 4.3.3 å®ç°åŸå‹æ¨¡å¼çš„å…‹éš†åˆ†ä¸ºæµ…å…‹éš†å’Œæ·±å…‹éš†ã€‚ æµ…å…‹éš†ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡çš„å±æ€§å’ŒåŸæ¥å¯¹è±¡å®Œå…¨ç›¸åŒï¼Œå¯¹äºéåŸºæœ¬ç±»å‹å±æ€§ï¼Œä»æŒ‡å‘åŸæœ‰å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚ æ·±å…‹éš†ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå±æ€§ä¸­å¼•ç”¨çš„å…¶ä»–å¯¹è±¡ä¹Ÿä¼šè¢«å…‹éš†ï¼Œä¸å†æŒ‡å‘åŸæœ‰å¯¹è±¡åœ°å€ã€‚ Javaä¸­çš„Objectç±»ä¸­æä¾›äº† clone() æ–¹æ³•æ¥å®ç°æµ…å…‹éš†ã€‚ Cloneable æ¥å£æ˜¯ä¸Šé¢çš„ç±»å›¾ä¸­çš„æŠ½è±¡åŸå‹ç±»ï¼Œè€Œå®ç°äº†Cloneableæ¥å£çš„å­å®ç°ç±»å°±æ˜¯å…·ä½“çš„åŸå‹ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š Realizetypeï¼ˆå…·ä½“çš„åŸå‹ç±»ï¼‰ï¼š 123456789101112public class Realizetype implements Cloneable &#123; public Realizetype() &#123; System.out.println(&quot;å…·ä½“çš„åŸå‹å¯¹è±¡åˆ›å»ºå®Œæˆï¼&quot;); &#125; @Override protected Realizetype clone() throws CloneNotSupportedException &#123; System.out.println(&quot;å…·ä½“åŸå‹å¤åˆ¶æˆåŠŸï¼&quot;); return (Realizetype) super.clone(); &#125;&#125; PrototypeTestï¼ˆæµ‹è¯•è®¿é—®ç±»ï¼‰ï¼š 12345678public class PrototypeTest &#123; public static void main(String[] args) throws CloneNotSupportedException &#123; Realizetype r1 = new Realizetype(); Realizetype r2 = r1.clone(); System.out.println(&quot;å¯¹è±¡r1å’Œr2æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Ÿ&quot; + (r1 == r2)); &#125;&#125; 4.3.4 æ¡ˆä¾‹ç”¨åŸå‹æ¨¡å¼ç”Ÿæˆâ€œä¸‰å¥½å­¦ç”Ÿâ€å¥–çŠ¶ åŒä¸€å­¦æ ¡çš„â€œä¸‰å¥½å­¦ç”Ÿâ€å¥–çŠ¶é™¤äº†è·å¥–äººå§“åä¸åŒï¼Œå…¶ä»–éƒ½ç›¸åŒï¼Œå¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼å¤åˆ¶å¤šä¸ªâ€œä¸‰å¥½å­¦ç”Ÿâ€å¥–çŠ¶å‡ºæ¥ï¼Œç„¶ååœ¨ä¿®æ”¹å¥–çŠ¶ä¸Šçš„åå­—å³å¯ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637//å¥–çŠ¶ç±»public class Citation implements Cloneable &#123; private String name; public void setName(String name) &#123; this.name = name; &#125; public String getName() &#123; return (this.name); &#125; public void show() &#123; System.out.println(name + &quot;åŒå­¦ï¼šåœ¨2020å­¦å¹´ç¬¬ä¸€å­¦æœŸä¸­è¡¨ç°ä¼˜ç§€ï¼Œè¢«è¯„ä¸ºä¸‰å¥½å­¦ç”Ÿã€‚ç‰¹å‘æ­¤çŠ¶ï¼&quot;); &#125; @Override public Citation clone() throws CloneNotSupportedException &#123; return (Citation) super.clone(); &#125;&#125;//æµ‹è¯•è®¿é—®ç±»public class CitationTest &#123; public static void main(String[] args) throws CloneNotSupportedException &#123; Citation c1 = new Citation(); c1.setName(&quot;å¼ ä¸‰&quot;); //å¤åˆ¶å¥–çŠ¶ Citation c2 = c1.clone(); //å°†å¥–çŠ¶çš„åå­—ä¿®æ”¹æå›› c2.setName(&quot;æå››&quot;); c1.show(); c2.show(); &#125;&#125; 4.3.5 ä½¿ç”¨åœºæ™¯ å¯¹è±¡çš„åˆ›å»ºéå¸¸å¤æ‚ï¼Œå¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼å¿«æ·çš„åˆ›å»ºå¯¹è±¡ã€‚ æ€§èƒ½å’Œå®‰å…¨è¦æ±‚æ¯”è¾ƒé«˜ã€‚ 4.3.6 æ‰©å±•ï¼ˆæ·±å…‹éš†ï¼‰å°†ä¸Šé¢çš„â€œä¸‰å¥½å­¦ç”Ÿâ€å¥–çŠ¶çš„æ¡ˆä¾‹ä¸­Citationç±»çš„nameå±æ€§ä¿®æ”¹ä¸ºStudentç±»å‹çš„å±æ€§ã€‚ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273//å¥–çŠ¶ç±»public class Citation implements Cloneable &#123; private Student stu; public Student getStu() &#123; return stu; &#125; public void setStu(Student stu) &#123; this.stu = stu; &#125; void show() &#123; System.out.println(stu.getName() + &quot;åŒå­¦ï¼šåœ¨2020å­¦å¹´ç¬¬ä¸€å­¦æœŸä¸­è¡¨ç°ä¼˜ç§€ï¼Œè¢«è¯„ä¸ºä¸‰å¥½å­¦ç”Ÿã€‚ç‰¹å‘æ­¤çŠ¶ï¼&quot;); &#125; @Override public Citation clone() throws CloneNotSupportedException &#123; return (Citation) super.clone(); &#125;&#125;//å­¦ç”Ÿç±»public class Student &#123; private String name; private String address; public Student(String name, String address) &#123; this.name = name; this.address = address; &#125; public Student() &#123; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getAddress() &#123; return address; &#125; public void setAddress(String address) &#123; this.address = address; &#125;&#125;//æµ‹è¯•ç±»public class CitationTest &#123; public static void main(String[] args) throws CloneNotSupportedException &#123; Citation c1 = new Citation(); Student stu = new Student(&quot;å¼ ä¸‰&quot;, &quot;è¥¿å®‰&quot;); c1.setStu(stu); //å¤åˆ¶å¥–çŠ¶ Citation c2 = c1.clone(); //è·å–c2å¥–çŠ¶æ‰€å±å­¦ç”Ÿå¯¹è±¡ Student stu1 = c2.getStu(); stu1.setName(&quot;æå››&quot;); //åˆ¤æ–­stuå¯¹è±¡å’Œstu1å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ System.out.println(&quot;stuå’Œstu1æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Ÿ&quot; + (stu == stu1)); c1.show(); c2.show(); &#125;&#125; è¿è¡Œç»“æœä¸ºï¼š è¯´æ˜ï¼š â€‹ stuå¯¹è±¡å’Œstu1å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¼šäº§ç”Ÿå°†stu1å¯¹è±¡ä¸­nameå±æ€§å€¼æ”¹ä¸ºâ€œæå››â€ï¼Œä¸¤ä¸ªCitationï¼ˆå¥–çŠ¶ï¼‰å¯¹è±¡ä¸­æ˜¾ç¤ºçš„éƒ½æ˜¯æå››ã€‚è¿™å°±æ˜¯æµ…å…‹éš†çš„æ•ˆæœï¼Œå¯¹å…·ä½“åŸå‹ç±»ï¼ˆCitationï¼‰ä¸­çš„å¼•ç”¨ç±»å‹çš„å±æ€§è¿›è¡Œå¼•ç”¨çš„å¤åˆ¶ã€‚è¿™ç§æƒ…å†µéœ€è¦ä½¿ç”¨æ·±å…‹éš†ï¼Œè€Œè¿›è¡Œæ·±å…‹éš†éœ€è¦ä½¿ç”¨å¯¹è±¡æµã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627public class CitationTest1 &#123; public static void main(String[] args) throws Exception &#123; Citation c1 = new Citation(); Student stu = new Student(&quot;å¼ ä¸‰&quot;, &quot;è¥¿å®‰&quot;); c1.setStu(stu); //åˆ›å»ºå¯¹è±¡è¾“å‡ºæµå¯¹è±¡ ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Think\\\\Desktop\\\\b.txt&quot;)); //å°†c1å¯¹è±¡å†™å‡ºåˆ°æ–‡ä»¶ä¸­ oos.writeObject(c1); oos.close(); //åˆ›å»ºå¯¹è±¡å‡ºå…¥æµå¯¹è±¡ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Think\\\\Desktop\\\\b.txt&quot;)); //è¯»å–å¯¹è±¡ Citation c2 = (Citation) ois.readObject(); //è·å–c2å¥–çŠ¶æ‰€å±å­¦ç”Ÿå¯¹è±¡ Student stu1 = c2.getStu(); stu1.setName(&quot;æå››&quot;); //åˆ¤æ–­stuå¯¹è±¡å’Œstu1å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ System.out.println(&quot;stuå’Œstu1æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Ÿ&quot; + (stu == stu1)); c1.show(); c2.show(); &#125;&#125; è¿è¡Œç»“æœä¸ºï¼š æ³¨æ„ï¼šCitationç±»å’ŒStudentç±»å¿…é¡»å®ç°Serializableæ¥å£ï¼Œå¦åˆ™ä¼šæŠ›NotSerializableExceptionå¼‚å¸¸ã€‚ 4.5 å»ºé€ è€…æ¨¡å¼4.4.1 æ¦‚è¿°å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚ åˆ†ç¦»äº†éƒ¨ä»¶çš„æ„é€ (ç”±Builderæ¥è´Ÿè´£)å’Œè£…é…(ç”±Directorè´Ÿè´£)ã€‚ ä»è€Œå¯ä»¥æ„é€ å‡ºå¤æ‚çš„å¯¹è±¡ã€‚è¿™ä¸ªæ¨¡å¼é€‚ç”¨äºï¼šæŸä¸ªå¯¹è±¡çš„æ„å»ºè¿‡ç¨‹å¤æ‚çš„æƒ…å†µã€‚ ç”±äºå®ç°äº†æ„å»ºå’Œè£…é…çš„è§£è€¦ã€‚ä¸åŒçš„æ„å»ºå™¨ï¼Œç›¸åŒçš„è£…é…ï¼Œä¹Ÿå¯ä»¥åšå‡ºä¸åŒçš„å¯¹è±¡ï¼›ç›¸åŒçš„æ„å»ºå™¨ï¼Œä¸åŒçš„è£…é…é¡ºåºä¹Ÿå¯ä»¥åšå‡ºä¸åŒçš„å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯å®ç°äº†æ„å»ºç®—æ³•ã€è£…é…ç®—æ³•çš„è§£è€¦ï¼Œå®ç°äº†æ›´å¥½çš„å¤ç”¨ã€‚ å»ºé€ è€…æ¨¡å¼å¯ä»¥å°†éƒ¨ä»¶å’Œå…¶ç»„è£…è¿‡ç¨‹åˆ†å¼€ï¼Œä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚ç”¨æˆ·åªéœ€è¦æŒ‡å®šå¤æ‚å¯¹è±¡çš„ç±»å‹å°±å¯ä»¥å¾—åˆ°è¯¥å¯¹è±¡ï¼Œè€Œæ— é¡»çŸ¥é“å…¶å†…éƒ¨çš„å…·ä½“æ„é€ ç»†èŠ‚ã€‚ 4.4.2 ç»“æ„å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š æŠ½è±¡å»ºé€ è€…ç±»ï¼ˆBuilderï¼‰ï¼šè¿™ä¸ªæ¥å£è§„å®šè¦å®ç°å¤æ‚å¯¹è±¡çš„é‚£äº›éƒ¨åˆ†çš„åˆ›å»ºï¼Œå¹¶ä¸æ¶‰åŠå…·ä½“çš„éƒ¨ä»¶å¯¹è±¡çš„åˆ›å»ºã€‚ å…·ä½“å»ºé€ è€…ç±»ï¼ˆConcreteBuilderï¼‰ï¼šå®ç° Builder æ¥å£ï¼Œå®Œæˆå¤æ‚äº§å“çš„å„ä¸ªéƒ¨ä»¶çš„å…·ä½“åˆ›å»ºæ–¹æ³•ã€‚åœ¨æ„é€ è¿‡ç¨‹å®Œæˆåï¼Œæä¾›äº§å“çš„å®ä¾‹ã€‚ äº§å“ç±»ï¼ˆProductï¼‰ï¼šè¦åˆ›å»ºçš„å¤æ‚å¯¹è±¡ã€‚ æŒ‡æŒ¥è€…ç±»ï¼ˆDirectorï¼‰ï¼šè°ƒç”¨å…·ä½“å»ºé€ è€…æ¥åˆ›å»ºå¤æ‚å¯¹è±¡çš„å„ä¸ªéƒ¨åˆ†ï¼Œåœ¨æŒ‡å¯¼è€…ä¸­ä¸æ¶‰åŠå…·ä½“äº§å“çš„ä¿¡æ¯ï¼Œåªè´Ÿè´£ä¿è¯å¯¹è±¡å„éƒ¨åˆ†å®Œæ•´åˆ›å»ºæˆ–æŒ‰æŸç§é¡ºåºåˆ›å»ºã€‚ ç±»å›¾å¦‚ä¸‹ï¼š 4.4.3 å®ä¾‹åˆ›å»ºå…±äº«å•è½¦ ç”Ÿäº§è‡ªè¡Œè½¦æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œå®ƒåŒ…å«äº†è½¦æ¶ï¼Œè½¦åº§ç­‰ç»„ä»¶çš„ç”Ÿäº§ã€‚è€Œè½¦æ¶åˆæœ‰ç¢³çº¤ç»´ï¼Œé“åˆé‡‘ç­‰æè´¨çš„ï¼Œè½¦åº§æœ‰æ©¡èƒ¶ï¼ŒçœŸçš®ç­‰æè´¨ã€‚å¯¹äºè‡ªè¡Œè½¦çš„ç”Ÿäº§å°±å¯ä»¥ä½¿ç”¨å»ºé€ è€…æ¨¡å¼ã€‚ è¿™é‡ŒBikeæ˜¯äº§å“ï¼ŒåŒ…å«è½¦æ¶ï¼Œè½¦åº§ç­‰ç»„ä»¶ï¼›Builderæ˜¯æŠ½è±¡å»ºé€ è€…ï¼ŒMobikeBuilderå’ŒOfoBuilderæ˜¯å…·ä½“çš„å»ºé€ è€…ï¼›Directoræ˜¯æŒ‡æŒ¥è€…ã€‚ç±»å›¾å¦‚ä¸‹ï¼š å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798//è‡ªè¡Œè½¦ç±»public class Bike &#123; private String frame; private String seat; public String getFrame() &#123; return frame; &#125; public void setFrame(String frame) &#123; this.frame = frame; &#125; public String getSeat() &#123; return seat; &#125; public void setSeat(String seat) &#123; this.seat = seat; &#125;&#125;// æŠ½è±¡ builder ç±»public abstract class Builder &#123; protected Bike mBike = new Bike(); public abstract void buildFrame(); public abstract void buildSeat(); public abstract Bike createBike();&#125;//æ‘©æ‹œå•è½¦Builderç±»public class MobikeBuilder extends Builder &#123; @Override public void buildFrame() &#123; mBike.setFrame(&quot;é“åˆé‡‘è½¦æ¶&quot;); &#125; @Override public void buildSeat() &#123; mBike.setSeat(&quot;çœŸçš®è½¦åº§&quot;); &#125; @Override public Bike createBike() &#123; return mBike; &#125;&#125;//ofoå•è½¦Builderç±»public class OfoBuilder extends Builder &#123; @Override public void buildFrame() &#123; mBike.setFrame(&quot;ç¢³çº¤ç»´è½¦æ¶&quot;); &#125; @Override public void buildSeat() &#123; mBike.setSeat(&quot;æ©¡èƒ¶è½¦åº§&quot;); &#125; @Override public Bike createBike() &#123; return mBike; &#125;&#125;//æŒ‡æŒ¥è€…ç±»public class Director &#123; private Builder mBuilder; public Director(Builder builder) &#123; mBuilder = builder; &#125; public Bike construct() &#123; mBuilder.buildFrame(); mBuilder.buildSeat(); return mBuilder.createBike(); &#125;&#125;//æµ‹è¯•ç±»public class Client &#123; public static void main(String[] args) &#123; showBike(new OfoBuilder()); showBike(new MobikeBuilder()); &#125; private static void showBike(Builder builder) &#123; Director director = new Director(builder); Bike bike = director.construct(); System.out.println(bike.getFrame()); System.out.println(bike.getSeat()); &#125;&#125; æ³¨æ„ï¼š ä¸Šé¢ç¤ºä¾‹æ˜¯ Builderæ¨¡å¼çš„å¸¸è§„ç”¨æ³•ï¼ŒæŒ‡æŒ¥è€…ç±» Director åœ¨å»ºé€ è€…æ¨¡å¼ä¸­å…·æœ‰å¾ˆé‡è¦çš„ä½œç”¨ï¼Œå®ƒç”¨äºæŒ‡å¯¼å…·ä½“æ„å»ºè€…å¦‚ä½•æ„å»ºäº§å“ï¼Œæ§åˆ¶è°ƒç”¨å…ˆåæ¬¡åºï¼Œå¹¶å‘è°ƒç”¨è€…è¿”å›å®Œæ•´çš„äº§å“ç±»ï¼Œä½†æ˜¯æœ‰äº›æƒ…å†µä¸‹éœ€è¦ç®€åŒ–ç³»ç»Ÿç»“æ„ï¼Œå¯ä»¥æŠŠæŒ‡æŒ¥è€…ç±»å’ŒæŠ½è±¡å»ºé€ è€…è¿›è¡Œç»“åˆ 123456789101112131415// æŠ½è±¡ builder ç±»public abstract class Builder &#123; protected Bike mBike = new Bike(); public abstract void buildFrame(); public abstract void buildSeat(); public abstract Bike createBike(); public Bike construct() &#123; this.buildFrame(); this.BuildSeat(); return this.createBike(); &#125;&#125; è¯´æ˜ï¼š è¿™æ ·åšç¡®å®ç®€åŒ–äº†ç³»ç»Ÿç»“æ„ï¼Œä½†åŒæ—¶ä¹ŸåŠ é‡äº†æŠ½è±¡å»ºé€ è€…ç±»çš„èŒè´£ï¼Œä¹Ÿä¸æ˜¯å¤ªç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼Œå¦‚æœconstruct() è¿‡äºå¤æ‚ï¼Œå»ºè®®è¿˜æ˜¯å°è£…åˆ° Director ä¸­ã€‚ 4.4.4 ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š å»ºé€ è€…æ¨¡å¼çš„å°è£…æ€§å¾ˆå¥½ã€‚ä½¿ç”¨å»ºé€ è€…æ¨¡å¼å¯ä»¥æœ‰æ•ˆçš„å°è£…å˜åŒ–ï¼Œåœ¨ä½¿ç”¨å»ºé€ è€…æ¨¡å¼çš„åœºæ™¯ä¸­ï¼Œä¸€èˆ¬äº§å“ç±»å’Œå»ºé€ è€…ç±»æ˜¯æ¯”è¾ƒç¨³å®šçš„ï¼Œå› æ­¤ï¼Œå°†ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘å°è£…åœ¨æŒ‡æŒ¥è€…ç±»ä¸­å¯¹æ•´ä½“è€Œè¨€å¯ä»¥å–å¾—æ¯”è¾ƒå¥½çš„ç¨³å®šæ€§ã€‚ åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ï¼Œå°†äº§å“æœ¬èº«ä¸äº§å“çš„åˆ›å»ºè¿‡ç¨‹è§£è€¦ï¼Œä½¿å¾—ç›¸åŒçš„åˆ›å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“å¯¹è±¡ã€‚ å¯ä»¥æ›´åŠ ç²¾ç»†åœ°æ§åˆ¶äº§å“çš„åˆ›å»ºè¿‡ç¨‹ ã€‚å°†å¤æ‚äº§å“çš„åˆ›å»ºæ­¥éª¤åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œä½¿å¾—åˆ›å»ºè¿‡ç¨‹æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ›´æ–¹ä¾¿ä½¿ç”¨ç¨‹åºæ¥æ§åˆ¶åˆ›å»ºè¿‡ç¨‹ã€‚ å»ºé€ è€…æ¨¡å¼å¾ˆå®¹æ˜“è¿›è¡Œæ‰©å±•ã€‚å¦‚æœæœ‰æ–°çš„éœ€æ±‚ï¼Œé€šè¿‡å®ç°ä¸€ä¸ªæ–°çš„å»ºé€ è€…ç±»å°±å¯ä»¥å®Œæˆï¼ŒåŸºæœ¬ä¸Šä¸ç”¨ä¿®æ”¹ä¹‹å‰å·²ç»æµ‹è¯•é€šè¿‡çš„ä»£ç ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šå¯¹åŸæœ‰åŠŸèƒ½å¼•å…¥é£é™©ã€‚ç¬¦åˆå¼€é—­åŸåˆ™ã€‚ ç¼ºç‚¹ï¼š é€ è€…æ¨¡å¼æ‰€åˆ›å»ºçš„äº§å“ä¸€èˆ¬å…·æœ‰è¾ƒå¤šçš„å…±åŒç‚¹ï¼Œå…¶ç»„æˆéƒ¨åˆ†ç›¸ä¼¼ï¼Œå¦‚æœäº§å“ä¹‹é—´çš„å·®å¼‚æ€§å¾ˆå¤§ï¼Œåˆ™ä¸é€‚åˆä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œå› æ­¤å…¶ä½¿ç”¨èŒƒå›´å—åˆ°ä¸€å®šçš„é™åˆ¶ã€‚ 4.4.5 ä½¿ç”¨åœºæ™¯å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼åˆ›å»ºçš„æ˜¯å¤æ‚å¯¹è±¡ï¼Œå…¶äº§å“çš„å„ä¸ªéƒ¨åˆ†ç»å¸¸é¢ä¸´ç€å‰§çƒˆçš„å˜åŒ–ï¼Œä½†å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·çš„ç®—æ³•å´ç›¸å¯¹ç¨³å®šï¼Œæ‰€ä»¥å®ƒé€šå¸¸åœ¨ä»¥ä¸‹åœºåˆä½¿ç”¨ã€‚ åˆ›å»ºçš„å¯¹è±¡è¾ƒå¤æ‚ï¼Œç”±å¤šä¸ªéƒ¨ä»¶æ„æˆï¼Œå„éƒ¨ä»¶é¢ä¸´ç€å¤æ‚çš„å˜åŒ–ï¼Œä½†æ„ä»¶é—´çš„å»ºé€ é¡ºåºæ˜¯ç¨³å®šçš„ã€‚ åˆ›å»ºå¤æ‚å¯¹è±¡çš„ç®—æ³•ç‹¬ç«‹äºè¯¥å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ä»¥åŠå®ƒä»¬çš„è£…é…æ–¹å¼ï¼Œå³äº§å“çš„æ„å»ºè¿‡ç¨‹å’Œæœ€ç»ˆçš„è¡¨ç¤ºæ˜¯ç‹¬ç«‹çš„ã€‚ 4.4.6 æ¨¡å¼æ‰©å±•å»ºé€ è€…æ¨¡å¼é™¤äº†ä¸Šé¢çš„ç”¨é€”å¤–ï¼Œåœ¨å¼€å‘ä¸­è¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„ä½¿ç”¨æ–¹å¼ï¼Œå°±æ˜¯å½“ä¸€ä¸ªç±»æ„é€ å™¨éœ€è¦ä¼ å…¥å¾ˆå¤šå‚æ•°æ—¶ï¼Œå¦‚æœåˆ›å»ºè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œä»£ç å¯è¯»æ€§ä¼šéå¸¸å·®ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å¼•å…¥é”™è¯¯ï¼Œæ­¤æ—¶å°±å¯ä»¥åˆ©ç”¨å»ºé€ è€…æ¨¡å¼è¿›è¡Œé‡æ„ã€‚ é‡æ„å‰ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263public class Phone &#123; private String cpu; private String screen; private String memory; private String mainboard; public Phone(String cpu, String screen, String memory, String mainboard) &#123; this.cpu = cpu; this.screen = screen; this.memory = memory; this.mainboard = mainboard; &#125; public String getCpu() &#123; return cpu; &#125; public void setCpu(String cpu) &#123; this.cpu = cpu; &#125; public String getScreen() &#123; return screen; &#125; public void setScreen(String screen) &#123; this.screen = screen; &#125; public String getMemory() &#123; return memory; &#125; public void setMemory(String memory) &#123; this.memory = memory; &#125; public String getMainboard() &#123; return mainboard; &#125; public void setMainboard(String mainboard) &#123; this.mainboard = mainboard; &#125; @Override public String toString() &#123; return &quot;Phone&#123;&quot; + &quot;cpu=&#x27;&quot; + cpu + &#x27;\\&#x27;&#x27; + &quot;, screen=&#x27;&quot; + screen + &#x27;\\&#x27;&#x27; + &quot;, memory=&#x27;&quot; + memory + &#x27;\\&#x27;&#x27; + &quot;, mainboard=&#x27;&quot; + mainboard + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; //æ„å»ºPhoneå¯¹è±¡ Phone phone = new Phone(&quot;intel&quot;,&quot;ä¸‰æ˜Ÿå±å¹•&quot;,&quot;é‡‘å£«é¡¿&quot;,&quot;åç¡•&quot;); System.out.println(phone); &#125;&#125; ä¸Šé¢åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­æ„å»ºPhoneå¯¹è±¡ï¼Œä¼ é€’äº†å››ä¸ªå‚æ•°ï¼Œå¦‚æœå‚æ•°æ›´å¤šå‘¢ï¼Ÿä»£ç çš„å¯è¯»æ€§åŠä½¿ç”¨çš„æˆæœ¬å°±æ˜¯æ¯”è¾ƒé«˜ã€‚ é‡æ„åä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263public class Phone &#123; private String cpu; private String screen; private String memory; private String mainboard; private Phone(Builder builder) &#123; cpu = builder.cpu; screen = builder.screen; memory = builder.memory; mainboard = builder.mainboard; &#125; public static final class Builder &#123; private String cpu; private String screen; private String memory; private String mainboard; public Builder() &#123;&#125; public Builder cpu(String val) &#123; cpu = val; return this; &#125; public Builder screen(String val) &#123; screen = val; return this; &#125; public Builder memory(String val) &#123; memory = val; return this; &#125; public Builder mainboard(String val) &#123; mainboard = val; return this; &#125; public Phone build() &#123; return new Phone(this);&#125; &#125; @Override public String toString() &#123; return &quot;Phone&#123;&quot; + &quot;cpu=&#x27;&quot; + cpu + &#x27;\\&#x27;&#x27; + &quot;, screen=&#x27;&quot; + screen + &#x27;\\&#x27;&#x27; + &quot;, memory=&#x27;&quot; + memory + &#x27;\\&#x27;&#x27; + &quot;, mainboard=&#x27;&quot; + mainboard + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; Phone phone = new Phone.Builder() .cpu(&quot;intel&quot;) .mainboard(&quot;åç¡•&quot;) .memory(&quot;é‡‘å£«é¡¿&quot;) .screen(&quot;ä¸‰æ˜Ÿ&quot;) .build(); System.out.println(phone); &#125;&#125; é‡æ„åçš„ä»£ç åœ¨ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼ŒæŸç§ç¨‹åº¦ä¸Šä¹Ÿå¯ä»¥æé«˜å¼€å‘æ•ˆç‡ã€‚ä»è½¯ä»¶è®¾è®¡ä¸Šï¼Œå¯¹ç¨‹åºå‘˜çš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚ 4.6 åˆ›å»ºè€…æ¨¡å¼å¯¹æ¯”4.6.1 å·¥å‚æ–¹æ³•æ¨¡å¼VSå»ºé€ è€…æ¨¡å¼å·¥å‚æ–¹æ³•æ¨¡å¼æ³¨é‡çš„æ˜¯æ•´ä½“å¯¹è±¡çš„åˆ›å»ºæ–¹å¼ï¼›è€Œå»ºé€ è€…æ¨¡å¼æ³¨é‡çš„æ˜¯éƒ¨ä»¶æ„å»ºçš„è¿‡ç¨‹ï¼Œæ„åœ¨é€šè¿‡ä¸€æ­¥ä¸€æ­¥åœ°ç²¾ç¡®æ„é€ åˆ›å»ºå‡ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚ æˆ‘ä»¬ä¸¾ä¸ªç®€å•ä¾‹å­æ¥è¯´æ˜ä¸¤è€…çš„å·®å¼‚ï¼Œå¦‚è¦åˆ¶é€ ä¸€ä¸ªè¶…äººï¼Œå¦‚æœä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œç›´æ¥äº§ç”Ÿå‡ºæ¥çš„å°±æ˜¯ä¸€ä¸ªåŠ›å¤§æ— ç©·ã€èƒ½å¤Ÿé£ç¿”ã€å†…è£¤å¤–ç©¿çš„è¶…äººï¼›è€Œå¦‚æœä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œåˆ™éœ€è¦ç»„è£…æ‰‹ã€å¤´ã€è„šã€èº¯å¹²ç­‰éƒ¨åˆ†ï¼Œç„¶åå†æŠŠå†…è£¤å¤–ç©¿ï¼Œäºæ˜¯ä¸€ä¸ªè¶…äººå°±è¯ç”Ÿäº†ã€‚ 4.6.2 æŠ½è±¡å·¥å‚æ¨¡å¼VSå»ºé€ è€…æ¨¡å¼æŠ½è±¡å·¥å‚æ¨¡å¼å®ç°å¯¹äº§å“å®¶æ—çš„åˆ›å»ºï¼Œä¸€ä¸ªäº§å“å®¶æ—æ˜¯è¿™æ ·çš„ä¸€ç³»åˆ—äº§å“ï¼šå…·æœ‰ä¸åŒåˆ†ç±»ç»´åº¦çš„äº§å“ç»„åˆï¼Œé‡‡ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼åˆ™æ˜¯ä¸éœ€è¦å…³å¿ƒæ„å»ºè¿‡ç¨‹ï¼Œåªå…³å¿ƒä»€ä¹ˆäº§å“ç”±ä»€ä¹ˆå·¥å‚ç”Ÿäº§å³å¯ã€‚ å»ºé€ è€…æ¨¡å¼åˆ™æ˜¯è¦æ±‚æŒ‰ç…§æŒ‡å®šçš„è“å›¾å»ºé€ äº§å“ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯é€šè¿‡ç»„è£…é›¶é…ä»¶è€Œäº§ç”Ÿä¸€ä¸ªæ–°äº§å“ã€‚ å¦‚æœå°†æŠ½è±¡å·¥å‚æ¨¡å¼çœ‹æˆæ±½è½¦é…ä»¶ç”Ÿäº§å·¥å‚ï¼Œç”Ÿäº§ä¸€ä¸ªäº§å“æ—çš„äº§å“ï¼Œé‚£ä¹ˆå»ºé€ è€…æ¨¡å¼å°±æ˜¯ä¸€ä¸ªæ±½è½¦ç»„è£…å·¥å‚ï¼Œé€šè¿‡å¯¹éƒ¨ä»¶çš„ç»„è£…å¯ä»¥è¿”å›ä¸€è¾†å®Œæ•´çš„æ±½è½¦ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰","slug":"è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰","date":"2023-06-16T03:31:38.000Z","updated":"2023-06-16T03:35:08.745Z","comments":true,"path":"2023/06/16/è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰/","link":"","permalink":"http://example.com/2023/06/16/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%80%EF%BC%89/","excerpt":"","text":"1ï¼Œè®¾è®¡æ¨¡å¼æ¦‚è¿°1.1 è½¯ä»¶è®¾è®¡æ¨¡å¼çš„äº§ç”ŸèƒŒæ™¯â€œè®¾è®¡æ¨¡å¼â€æœ€åˆå¹¶ä¸æ˜¯å‡ºç°åœ¨è½¯ä»¶è®¾è®¡ä¸­ï¼Œè€Œæ˜¯è¢«ç”¨äºå»ºç­‘é¢†åŸŸçš„è®¾è®¡ä¸­ã€‚ 1977å¹´ç¾å›½è‘—åå»ºç­‘å¤§å¸ˆã€åŠ åˆ©ç¦å°¼äºšå¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡ç¯å¢ƒç»“æ„ä¸­å¿ƒä¸»ä»»å…‹é‡Œæ–¯æ‰˜å¤«Â·äºšå†å±±å¤§ï¼ˆChristopher Alexanderï¼‰åœ¨ä»–çš„è‘—ä½œã€Šå»ºç­‘æ¨¡å¼è¯­è¨€ï¼šåŸé•‡ã€å»ºç­‘ã€æ„é€ ã€‹ä¸­æè¿°äº†ä¸€äº›å¸¸è§çš„å»ºç­‘è®¾è®¡é—®é¢˜ï¼Œå¹¶æå‡ºäº† 253 ç§å…³äºå¯¹åŸé•‡ã€é‚»é‡Œã€ä½å®…ã€èŠ±å›­å’Œæˆ¿é—´ç­‰è¿›è¡Œè®¾è®¡çš„åŸºæœ¬æ¨¡å¼ã€‚ 1990å¹´è½¯ä»¶å·¥ç¨‹ç•Œå¼€å§‹ç ”è®¨è®¾è®¡æ¨¡å¼çš„è¯é¢˜ï¼Œåæ¥å¬å¼€äº†å¤šæ¬¡å…³äºè®¾è®¡æ¨¡å¼çš„ç ”è®¨ä¼šã€‚ç›´åˆ°1995 å¹´ï¼Œè‰¾ç‘å…‹Â·ä¼½é©¬ï¼ˆErichGammaï¼‰ã€ç†æŸ»å¾·Â·æµ·å°”å§†ï¼ˆRichard Helmï¼‰ã€æ‹‰å°”å¤«Â·çº¦ç¿°æ£®ï¼ˆRalph Johnsonï¼‰ã€çº¦ç¿°Â·å¨åˆ©æ–¯è¿ªæ–¯ï¼ˆJohn Vlissidesï¼‰ç­‰ 4 ä½ä½œè€…åˆä½œå‡ºç‰ˆäº†ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦ï¼Œåœ¨æ­¤ä¹¦ä¸­æ”¶å½•äº† 23 ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¿™æ˜¯è®¾è®¡æ¨¡å¼é¢†åŸŸé‡Œç¨‹ç¢‘çš„äº‹ä»¶ï¼Œå¯¼è‡´äº†è½¯ä»¶è®¾è®¡æ¨¡å¼çš„çªç ´ã€‚è¿™ 4 ä½ä½œè€…åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸé‡Œä¹Ÿä»¥ä»–ä»¬çš„â€œå››äººç»„â€ï¼ˆGang of Fourï¼ŒGoFï¼‰è‘—ç§°ã€‚ 1.2 è½¯ä»¶è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µè½¯ä»¶è®¾è®¡æ¨¡å¼ï¼ˆSoftware Design Patternï¼‰ï¼Œåˆç§°è®¾è®¡æ¨¡å¼ï¼Œæ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚å®ƒæè¿°äº†åœ¨è½¯ä»¶è®¾è®¡è¿‡ç¨‹ä¸­çš„ä¸€äº›ä¸æ–­é‡å¤å‘ç”Ÿçš„é—®é¢˜ï¼Œä»¥åŠè¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„ä¸€ç³»åˆ—å¥—è·¯ï¼Œæ˜¯å‰è¾ˆä»¬çš„ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ï¼Œå…·æœ‰ä¸€å®šçš„æ™®éæ€§ï¼Œå¯ä»¥åå¤ä½¿ç”¨ã€‚ 1.3 å­¦ä¹ è®¾è®¡æ¨¡å¼çš„å¿…è¦æ€§è®¾è®¡æ¨¡å¼çš„æœ¬è´¨æ˜¯é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™çš„å®é™…è¿ç”¨ï¼Œæ˜¯å¯¹ç±»çš„å°è£…æ€§ã€ç»§æ‰¿æ€§å’Œå¤šæ€æ€§ä»¥åŠç±»çš„å…³è”å…³ç³»å’Œç»„åˆå…³ç³»çš„å……åˆ†ç†è§£ã€‚ æ­£ç¡®ä½¿ç”¨è®¾è®¡æ¨¡å¼å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ã€‚ å¯ä»¥æé«˜ç¨‹åºå‘˜çš„æ€ç»´èƒ½åŠ›ã€ç¼–ç¨‹èƒ½åŠ›å’Œè®¾è®¡èƒ½åŠ›ã€‚ ä½¿ç¨‹åºè®¾è®¡æ›´åŠ æ ‡å‡†åŒ–ã€ä»£ç ç¼–åˆ¶æ›´åŠ å·¥ç¨‹åŒ–ï¼Œä½¿è½¯ä»¶å¼€å‘æ•ˆç‡å¤§å¤§æé«˜ï¼Œä»è€Œç¼©çŸ­è½¯ä»¶çš„å¼€å‘å‘¨æœŸã€‚ ä½¿è®¾è®¡çš„ä»£ç å¯é‡ç”¨æ€§é«˜ã€å¯è¯»æ€§å¼ºã€å¯é æ€§é«˜ã€çµæ´»æ€§å¥½ã€å¯ç»´æŠ¤æ€§å¼ºã€‚ 1.4 è®¾è®¡æ¨¡å¼åˆ†ç±» åˆ›å»ºå‹æ¨¡å¼ ç”¨äºæè¿°â€œæ€æ ·åˆ›å»ºå¯¹è±¡â€ï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯â€œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»â€ã€‚GoFï¼ˆå››äººç»„ï¼‰ä¹¦ä¸­æä¾›äº†å•ä¾‹ã€åŸå‹ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€å»ºé€ è€…ç­‰ 5 ç§åˆ›å»ºå‹æ¨¡å¼ã€‚ ç»“æ„å‹æ¨¡å¼ ç”¨äºæè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§å¸ƒå±€ç»„æˆæ›´å¤§çš„ç»“æ„ï¼ŒGoFï¼ˆå››äººç»„ï¼‰ä¹¦ä¸­æä¾›äº†ä»£ç†ã€é€‚é…å™¨ã€æ¡¥æ¥ã€è£…é¥°ã€å¤–è§‚ã€äº«å…ƒã€ç»„åˆç­‰ 7 ç§ç»“æ„å‹æ¨¡å¼ã€‚ è¡Œä¸ºå‹æ¨¡å¼ ç”¨äºæè¿°ç±»æˆ–å¯¹è±¡ä¹‹é—´æ€æ ·ç›¸äº’åä½œå…±åŒå®Œæˆå•ä¸ªå¯¹è±¡æ— æ³•å•ç‹¬å®Œæˆçš„ä»»åŠ¡ï¼Œä»¥åŠæ€æ ·åˆ†é…èŒè´£ã€‚GoFï¼ˆå››äººç»„ï¼‰ä¹¦ä¸­æä¾›äº†æ¨¡æ¿æ–¹æ³•ã€ç­–ç•¥ã€å‘½ä»¤ã€èŒè´£é“¾ã€çŠ¶æ€ã€è§‚å¯Ÿè€…ã€ä¸­ä»‹è€…ã€è¿­ä»£å™¨ã€è®¿é—®è€…ã€å¤‡å¿˜å½•ã€è§£é‡Šå™¨ç­‰ 11 ç§è¡Œä¸ºå‹æ¨¡å¼ã€‚ 2ï¼ŒUMLå›¾ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼ˆUnified Modeling Languageï¼ŒUMLï¼‰æ˜¯ç”¨æ¥è®¾è®¡è½¯ä»¶çš„å¯è§†åŒ–å»ºæ¨¡è¯­è¨€ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ç®€å•ã€ç»Ÿä¸€ã€å›¾å½¢åŒ–ã€èƒ½è¡¨è¾¾è½¯ä»¶è®¾è®¡ä¸­çš„åŠ¨æ€ä¸é™æ€ä¿¡æ¯ã€‚ UML ä»ç›®æ ‡ç³»ç»Ÿçš„ä¸åŒè§’åº¦å‡ºå‘ï¼Œå®šä¹‰äº†ç”¨ä¾‹å›¾ã€ç±»å›¾ã€å¯¹è±¡å›¾ã€çŠ¶æ€å›¾ã€æ´»åŠ¨å›¾ã€æ—¶åºå›¾ã€åä½œå›¾ã€æ„ä»¶å›¾ã€éƒ¨ç½²å›¾ç­‰ 9 ç§å›¾ã€‚ 2.1 ç±»å›¾æ¦‚è¿°ç±»å›¾(Class diagram)æ˜¯æ˜¾ç¤ºäº†æ¨¡å‹çš„é™æ€ç»“æ„ï¼Œç‰¹åˆ«æ˜¯æ¨¡å‹ä¸­å­˜åœ¨çš„ç±»ã€ç±»çš„å†…éƒ¨ç»“æ„ä»¥åŠå®ƒä»¬ä¸å…¶ä»–ç±»çš„å…³ç³»ç­‰ã€‚ç±»å›¾ä¸æ˜¾ç¤ºæš‚æ—¶æ€§çš„ä¿¡æ¯ã€‚ç±»å›¾æ˜¯é¢å‘å¯¹è±¡å»ºæ¨¡çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚ 2.2 ç±»å›¾çš„ä½œç”¨ åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œç±»å›¾æ˜¯ä¸€ç§é™æ€çš„ç»“æ„å›¾ï¼Œæè¿°äº†ç³»ç»Ÿçš„ç±»çš„é›†åˆï¼Œç±»çš„å±æ€§å’Œç±»ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥ç®€åŒ–äº†äººä»¬å¯¹ç³»ç»Ÿçš„ç†è§£ï¼› ç±»å›¾æ˜¯ç³»ç»Ÿåˆ†æå’Œè®¾è®¡é˜¶æ®µçš„é‡è¦äº§ç‰©ï¼Œæ˜¯ç³»ç»Ÿç¼–ç å’Œæµ‹è¯•çš„é‡è¦æ¨¡å‹ã€‚ 2.3 ç±»å›¾è¡¨ç¤ºæ³•2.3.1 ç±»çš„è¡¨ç¤ºæ–¹å¼åœ¨UMLç±»å›¾ä¸­ï¼Œç±»ä½¿ç”¨åŒ…å«ç±»åã€å±æ€§(field) å’Œæ–¹æ³•(method) ä¸”å¸¦æœ‰åˆ†å‰²çº¿çš„çŸ©å½¢æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªEmployeeç±»ï¼Œå®ƒåŒ…å«name,ageå’Œaddressè¿™3ä¸ªå±æ€§ï¼Œä»¥åŠwork()æ–¹æ³•ã€‚ å±æ€§&#x2F;æ–¹æ³•åç§°å‰åŠ çš„åŠ å·å’Œå‡å·è¡¨ç¤ºäº†è¿™ä¸ªå±æ€§&#x2F;æ–¹æ³•çš„å¯è§æ€§ï¼ŒUMLç±»å›¾ä¸­è¡¨ç¤ºå¯è§æ€§çš„ç¬¦å·æœ‰ä¸‰ç§ï¼š +ï¼šè¡¨ç¤ºpublic -ï¼šè¡¨ç¤ºprivate #ï¼šè¡¨ç¤ºprotected å±æ€§çš„å®Œæ•´è¡¨ç¤ºæ–¹å¼æ˜¯ï¼š å¯è§æ€§ åç§° ï¼šç±»å‹ [ &#x3D; ç¼ºçœå€¼] æ–¹æ³•çš„å®Œæ•´è¡¨ç¤ºæ–¹å¼æ˜¯ï¼š å¯è§æ€§ åç§°(å‚æ•°åˆ—è¡¨) [ ï¼š è¿”å›ç±»å‹] æ³¨æ„ï¼š â€‹ 1ï¼Œä¸­æ‹¬å·ä¸­çš„å†…å®¹è¡¨ç¤ºæ˜¯å¯é€‰çš„ â€‹ 2ï¼Œä¹Ÿæœ‰å°†ç±»å‹æ”¾åœ¨å˜é‡åå‰é¢ï¼Œè¿”å›å€¼ç±»å‹æ”¾åœ¨æ–¹æ³•åå‰é¢ ä¸¾ä¸ªæ —å­ï¼š ä¸Šå›¾Demoç±»å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š method()æ–¹æ³•ï¼šä¿®é¥°ç¬¦ä¸ºpublicï¼Œæ²¡æœ‰å‚æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚ method1()æ–¹æ³•ï¼šä¿®é¥°ç¬¦ä¸ºprivateï¼Œæ²¡æœ‰å‚æ•°ï¼Œè¿”å›å€¼ç±»å‹ä¸ºStringã€‚ method2()æ–¹æ³•ï¼šä¿®é¥°ç¬¦ä¸ºprotectedï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹ä¸ºintï¼Œç¬¬äºŒä¸ªå‚æ•°ç±»å‹ä¸ºStringï¼Œè¿”å›å€¼ç±»å‹æ˜¯intã€‚ 2.3.2 ç±»ä¸ç±»ä¹‹é—´å…³ç³»çš„è¡¨ç¤ºæ–¹å¼2.3.2.1 å…³è”å…³ç³»å…³è”å…³ç³»æ˜¯å¯¹è±¡ä¹‹é—´çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œç”¨äºè¡¨ç¤ºä¸€ç±»å¯¹è±¡ä¸å¦ä¸€ç±»å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼Œå¦‚è€å¸ˆå’Œå­¦ç”Ÿã€å¸ˆå‚…å’Œå¾’å¼Ÿã€ä¸ˆå¤«å’Œå¦»å­ç­‰ã€‚å…³è”å…³ç³»æ˜¯ç±»ä¸ç±»ä¹‹é—´æœ€å¸¸ç”¨çš„ä¸€ç§å…³ç³»ï¼Œåˆ†ä¸ºä¸€èˆ¬å…³è”å…³ç³»ã€èšåˆå…³ç³»å’Œç»„åˆå…³ç³»ã€‚æˆ‘ä»¬å…ˆä»‹ç»ä¸€èˆ¬å…³è”ã€‚ å…³è”åˆå¯ä»¥åˆ†ä¸ºå•å‘å…³è”ï¼ŒåŒå‘å…³è”ï¼Œè‡ªå…³è”ã€‚ 1ï¼Œå•å‘å…³è” åœ¨UMLç±»å›¾ä¸­å•å‘å…³è”ç”¨ä¸€ä¸ªå¸¦ç®­å¤´çš„å®çº¿è¡¨ç¤ºã€‚ä¸Šå›¾è¡¨ç¤ºæ¯ä¸ªé¡¾å®¢éƒ½æœ‰ä¸€ä¸ªåœ°å€ï¼Œè¿™é€šè¿‡è®©Customerç±»æŒæœ‰ä¸€ä¸ªç±»å‹ä¸ºAddressçš„æˆå‘˜å˜é‡ç±»å®ç°ã€‚ 2ï¼ŒåŒå‘å…³è” ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œæ‰€è°“çš„åŒå‘å…³è”å°±æ˜¯åŒæ–¹å„è‡ªæŒæœ‰å¯¹æ–¹ç±»å‹çš„æˆå‘˜å˜é‡ã€‚ åœ¨UMLç±»å›¾ä¸­ï¼ŒåŒå‘å…³è”ç”¨ä¸€ä¸ªä¸å¸¦ç®­å¤´çš„ç›´çº¿è¡¨ç¤ºã€‚ä¸Šå›¾ä¸­åœ¨Customerç±»ä¸­ç»´æŠ¤ä¸€ä¸ªList&lt;Product&gt;ï¼Œè¡¨ç¤ºä¸€ä¸ªé¡¾å®¢å¯ä»¥è´­ä¹°å¤šä¸ªå•†å“ï¼›åœ¨Productç±»ä¸­ç»´æŠ¤ä¸€ä¸ªCustomerç±»å‹çš„æˆå‘˜å˜é‡è¡¨ç¤ºè¿™ä¸ªäº§å“è¢«å“ªä¸ªé¡¾å®¢æ‰€è´­ä¹°ã€‚ 3ï¼Œè‡ªå…³è” è‡ªå…³è”åœ¨UMLç±»å›¾ä¸­ç”¨ä¸€ä¸ªå¸¦æœ‰ç®­å¤´ä¸”æŒ‡å‘è‡ªèº«çš„çº¿è¡¨ç¤ºã€‚ä¸Šå›¾çš„æ„æ€å°±æ˜¯Nodeç±»åŒ…å«ç±»å‹ä¸ºNodeçš„æˆå‘˜å˜é‡ï¼Œä¹Ÿå°±æ˜¯â€œè‡ªå·±åŒ…å«è‡ªå·±â€ã€‚ 2.3.2.2 èšåˆå…³ç³»èšåˆå…³ç³»æ˜¯å…³è”å…³ç³»çš„ä¸€ç§ï¼Œæ˜¯å¼ºå…³è”å…³ç³»ï¼Œæ˜¯æ•´ä½“å’Œéƒ¨åˆ†ä¹‹é—´çš„å…³ç³»ã€‚ èšåˆå…³ç³»ä¹Ÿæ˜¯é€šè¿‡æˆå‘˜å¯¹è±¡æ¥å®ç°çš„ï¼Œå…¶ä¸­æˆå‘˜å¯¹è±¡æ˜¯æ•´ä½“å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯æˆå‘˜å¯¹è±¡å¯ä»¥è„±ç¦»æ•´ä½“å¯¹è±¡è€Œç‹¬ç«‹å­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œå­¦æ ¡ä¸è€å¸ˆçš„å…³ç³»ï¼Œå­¦æ ¡åŒ…å«è€å¸ˆï¼Œä½†å¦‚æœå­¦æ ¡åœåŠäº†ï¼Œè€å¸ˆä¾ç„¶å­˜åœ¨ã€‚ åœ¨ UML ç±»å›¾ä¸­ï¼Œèšåˆå…³ç³»å¯ä»¥ç”¨å¸¦ç©ºå¿ƒè±å½¢çš„å®çº¿æ¥è¡¨ç¤ºï¼Œè±å½¢æŒ‡å‘æ•´ä½“ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯å¤§å­¦å’Œæ•™å¸ˆçš„å…³ç³»å›¾ï¼š 2.3.2.3 ç»„åˆå…³ç³»ç»„åˆè¡¨ç¤ºç±»ä¹‹é—´çš„æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ï¼Œä½†å®ƒæ˜¯ä¸€ç§æ›´å¼ºçƒˆçš„èšåˆå…³ç³»ã€‚ åœ¨ç»„åˆå…³ç³»ä¸­ï¼Œæ•´ä½“å¯¹è±¡å¯ä»¥æ§åˆ¶éƒ¨åˆ†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€æ—¦æ•´ä½“å¯¹è±¡ä¸å­˜åœ¨ï¼Œéƒ¨åˆ†å¯¹è±¡ä¹Ÿå°†ä¸å­˜åœ¨ï¼Œéƒ¨åˆ†å¯¹è±¡ä¸èƒ½è„±ç¦»æ•´ä½“å¯¹è±¡è€Œå­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œå¤´å’Œå˜´çš„å…³ç³»ï¼Œæ²¡æœ‰äº†å¤´ï¼Œå˜´ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚ åœ¨ UML ç±»å›¾ä¸­ï¼Œç»„åˆå…³ç³»ç”¨å¸¦å®å¿ƒè±å½¢çš„å®çº¿æ¥è¡¨ç¤ºï¼Œè±å½¢æŒ‡å‘æ•´ä½“ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯å¤´å’Œå˜´çš„å…³ç³»å›¾ï¼š 2.3.2.4 ä¾èµ–å…³ç³»ä¾èµ–å…³ç³»æ˜¯ä¸€ç§ä½¿ç”¨å…³ç³»ï¼Œå®ƒæ˜¯å¯¹è±¡ä¹‹é—´è€¦åˆåº¦æœ€å¼±çš„ä¸€ç§å…³è”æ–¹å¼ï¼Œæ˜¯ä¸´æ—¶æ€§çš„å…³è”ã€‚åœ¨ä»£ç ä¸­ï¼ŒæŸä¸ªç±»çš„æ–¹æ³•é€šè¿‡å±€éƒ¨å˜é‡ã€æ–¹æ³•çš„å‚æ•°æˆ–è€…å¯¹é™æ€æ–¹æ³•çš„è°ƒç”¨æ¥è®¿é—®å¦ä¸€ä¸ªç±»ï¼ˆè¢«ä¾èµ–ç±»ï¼‰ä¸­çš„æŸäº›æ–¹æ³•æ¥å®Œæˆä¸€äº›èŒè´£ã€‚ åœ¨ UML ç±»å›¾ä¸­ï¼Œä¾èµ–å…³ç³»ä½¿ç”¨å¸¦ç®­å¤´çš„è™šçº¿æ¥è¡¨ç¤ºï¼Œç®­å¤´ä»ä½¿ç”¨ç±»æŒ‡å‘è¢«ä¾èµ–çš„ç±»ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯å¸æœºå’Œæ±½è½¦çš„å…³ç³»å›¾ï¼Œå¸æœºé©¾é©¶æ±½è½¦ï¼š 2.3.2.5 ç»§æ‰¿å…³ç³»ç»§æ‰¿å…³ç³»æ˜¯å¯¹è±¡ä¹‹é—´è€¦åˆåº¦æœ€å¤§çš„ä¸€ç§å…³ç³»ï¼Œè¡¨ç¤ºä¸€èˆ¬ä¸ç‰¹æ®Šçš„å…³ç³»ï¼Œæ˜¯çˆ¶ç±»ä¸å­ç±»ä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯ä¸€ç§ç»§æ‰¿å…³ç³»ã€‚ åœ¨ UML ç±»å›¾ä¸­ï¼Œæ³›åŒ–å…³ç³»ç”¨å¸¦ç©ºå¿ƒä¸‰è§’ç®­å¤´çš„å®çº¿æ¥è¡¨ç¤ºï¼Œç®­å¤´ä»å­ç±»æŒ‡å‘çˆ¶ç±»ã€‚åœ¨ä»£ç å®ç°æ—¶ï¼Œä½¿ç”¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿æœºåˆ¶æ¥å®ç°æ³›åŒ–å…³ç³»ã€‚ä¾‹å¦‚ï¼ŒStudent ç±»å’Œ Teacher ç±»éƒ½æ˜¯ Person ç±»çš„å­ç±»ï¼Œå…¶ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2.3.2.6 å®ç°å…³ç³»å®ç°å…³ç³»æ˜¯æ¥å£ä¸å®ç°ç±»ä¹‹é—´çš„å…³ç³»ã€‚åœ¨è¿™ç§å…³ç³»ä¸­ï¼Œç±»å®ç°äº†æ¥å£ï¼Œç±»ä¸­çš„æ“ä½œå®ç°äº†æ¥å£ä¸­æ‰€å£°æ˜çš„æ‰€æœ‰çš„æŠ½è±¡æ“ä½œã€‚ åœ¨ UML ç±»å›¾ä¸­ï¼Œå®ç°å…³ç³»ä½¿ç”¨å¸¦ç©ºå¿ƒä¸‰è§’ç®­å¤´çš„è™šçº¿æ¥è¡¨ç¤ºï¼Œç®­å¤´ä»å®ç°ç±»æŒ‡å‘æ¥å£ã€‚ä¾‹å¦‚ï¼Œæ±½è½¦å’Œèˆ¹å®ç°äº†äº¤é€šå·¥å…·ï¼Œå…¶ç±»å›¾å¦‚å›¾ 9 æ‰€ç¤ºã€‚ 3ï¼Œè½¯ä»¶è®¾è®¡åŸåˆ™åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œä¸ºäº†æé«˜è½¯ä»¶ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§ï¼Œå¢åŠ è½¯ä»¶çš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œç¨‹åºå‘˜è¦å°½é‡æ ¹æ®6æ¡åŸåˆ™æ¥å¼€å‘ç¨‹åºï¼Œä»è€Œæé«˜è½¯ä»¶å¼€å‘æ•ˆç‡ã€èŠ‚çº¦è½¯ä»¶å¼€å‘æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ã€‚ 3.1 å¼€é—­åŸåˆ™å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚åœ¨ç¨‹åºéœ€è¦è¿›è¡Œæ‹“å±•çš„æ—¶å€™ï¼Œä¸èƒ½å»ä¿®æ”¹åŸæœ‰çš„ä»£ç ï¼Œå®ç°ä¸€ä¸ªçƒ­æ’æ‹”çš„æ•ˆæœã€‚ç®€è¨€ä¹‹ï¼Œæ˜¯ä¸ºäº†ä½¿ç¨‹åºçš„æ‰©å±•æ€§å¥½ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚ æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ã€‚ å› ä¸ºæŠ½è±¡çµæ´»æ€§å¥½ï¼Œé€‚åº”æ€§å¹¿ï¼Œåªè¦æŠ½è±¡çš„åˆç†ï¼Œå¯ä»¥åŸºæœ¬ä¿æŒè½¯ä»¶æ¶æ„çš„ç¨³å®šã€‚è€Œè½¯ä»¶ä¸­æ˜“å˜çš„ç»†èŠ‚å¯ä»¥ä»æŠ½è±¡æ´¾ç”Ÿæ¥çš„å®ç°ç±»æ¥è¿›è¡Œæ‰©å±•ï¼Œå½“è½¯ä»¶éœ€è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªéœ€è¦æ ¹æ®éœ€æ±‚é‡æ–°æ´¾ç”Ÿä¸€ä¸ªå®ç°ç±»æ¥æ‰©å±•å°±å¯ä»¥äº†ã€‚ ä¸‹é¢ä»¥ æœç‹—è¾“å…¥æ³• çš„çš®è‚¤ä¸ºä¾‹ä»‹ç»å¼€é—­åŸåˆ™çš„åº”ç”¨ã€‚ ã€ä¾‹ã€‘æœç‹—è¾“å…¥æ³• çš„çš®è‚¤è®¾è®¡ã€‚ åˆ†æï¼šæœç‹—è¾“å…¥æ³• çš„çš®è‚¤æ˜¯è¾“å…¥æ³•èƒŒæ™¯å›¾ç‰‡ã€çª—å£é¢œè‰²å’Œå£°éŸ³ç­‰å…ƒç´ çš„ç»„åˆã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œçˆ±æ›´æ¢è‡ªå·±çš„è¾“å…¥æ³•çš„çš®è‚¤ï¼Œä¹Ÿå¯ä»¥ä»ç½‘ä¸Šä¸‹è½½æ–°çš„çš®è‚¤ã€‚è¿™äº›çš®è‚¤æœ‰å…±åŒçš„ç‰¹ç‚¹ï¼Œå¯ä»¥ä¸ºå…¶å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆAbstractSkinï¼‰ï¼Œè€Œæ¯ä¸ªå…·ä½“çš„çš®è‚¤ï¼ˆDefaultSpecificSkinå’ŒHeimaSpecificSkinï¼‰æ˜¯å…¶å­ç±»ã€‚ç”¨æˆ·çª—ä½“å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©æˆ–è€…å¢åŠ æ–°çš„ä¸»é¢˜ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åŸä»£ç ï¼Œæ‰€ä»¥å®ƒæ˜¯æ»¡è¶³å¼€é—­åŸåˆ™çš„ã€‚ 3.2 é‡Œæ°ä»£æ¢åŸåˆ™é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚ é‡Œæ°ä»£æ¢åŸåˆ™ï¼šä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚é€šä¿—ç†è§£ï¼šå­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ã€‚æ¢å¥è¯è¯´ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œé™¤æ·»åŠ æ–°çš„æ–¹æ³•å®Œæˆæ–°å¢åŠŸèƒ½å¤–ï¼Œå°½é‡ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚ å¦‚æœé€šè¿‡é‡å†™çˆ¶ç±»çš„æ–¹æ³•æ¥å®Œæˆæ–°çš„åŠŸèƒ½ï¼Œè¿™æ ·å†™èµ·æ¥è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æ•´ä¸ªç»§æ‰¿ä½“ç³»çš„å¯å¤ç”¨æ€§ä¼šæ¯”è¾ƒå·®ï¼Œç‰¹åˆ«æ˜¯è¿ç”¨å¤šæ€æ¯”è¾ƒé¢‘ç¹æ—¶ï¼Œç¨‹åºè¿è¡Œå‡ºé”™çš„æ¦‚ç‡ä¼šéå¸¸å¤§ã€‚ ä¸‹é¢çœ‹ä¸€ä¸ªé‡Œæ°æ›¿æ¢åŸåˆ™ä¸­ç»å…¸çš„ä¸€ä¸ªä¾‹å­ ã€ä¾‹ã€‘æ­£æ–¹å½¢ä¸æ˜¯é•¿æ–¹å½¢ã€‚ åœ¨æ•°å­¦é¢†åŸŸé‡Œï¼Œæ­£æ–¹å½¢æ¯«æ— ç–‘é—®æ˜¯é•¿æ–¹å½¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªé•¿å®½ç›¸ç­‰çš„é•¿æ–¹å½¢ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¼€å‘çš„ä¸€ä¸ªä¸å‡ ä½•å›¾å½¢ç›¸å…³çš„è½¯ä»¶ç³»ç»Ÿï¼Œå°±å¯ä»¥é¡ºç†æˆç« çš„è®©æ­£æ–¹å½¢ç»§æ‰¿è‡ªé•¿æ–¹å½¢ã€‚ ä»£ç å¦‚ä¸‹ï¼š é•¿æ–¹å½¢ç±»ï¼ˆRectangleï¼‰ï¼š 1234567891011121314151617181920public class Rectangle &#123; private double length; private double width; public double getLength() &#123; return length; &#125; public void setLength(double length) &#123; this.length = length; &#125; public double getWidth() &#123; return width; &#125; public void setWidth(double width) &#123; this.width = width; &#125;&#125; æ­£æ–¹å½¢ï¼ˆSquareï¼‰ï¼š ç”±äºæ­£æ–¹å½¢çš„é•¿å’Œå®½ç›¸åŒï¼Œæ‰€ä»¥åœ¨æ–¹æ³•setLengthå’ŒsetWidthä¸­ï¼Œå¯¹é•¿åº¦å’Œå®½åº¦éƒ½éœ€è¦èµ‹ç›¸åŒå€¼ã€‚ 123456789101112public class Square extends Rectangle &#123; public void setWidth(double width) &#123; super.setLength(width); super.setWidth(width); &#125; public void setLength(double length) &#123; super.setLength(length); super.setWidth(length); &#125;&#125; ç±»RectangleDemoæ˜¯æˆ‘ä»¬çš„è½¯ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæœ‰ä¸€ä¸ªresizeæ–¹æ³•ä¾èµ–åŸºç±»Rectangleï¼Œresizeæ–¹æ³•æ˜¯RectandleDemoç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥å®ç°å®½åº¦é€æ¸å¢é•¿çš„æ•ˆæœã€‚ 1234567891011121314151617181920212223242526272829public class RectangleDemo &#123; public static void resize(Rectangle rectangle) &#123; while (rectangle.getWidth() &lt;= rectangle.getLength()) &#123; rectangle.setWidth(rectangle.getWidth() + 1); &#125; &#125; //æ‰“å°é•¿æ–¹å½¢çš„é•¿å’Œå®½ public static void printLengthAndWidth(Rectangle rectangle) &#123; System.out.println(rectangle.getLength()); System.out.println(rectangle.getWidth()); &#125; public static void main(String[] args) &#123; Rectangle rectangle = new Rectangle(); rectangle.setLength(20); rectangle.setWidth(10); resize(rectangle); printLengthAndWidth(rectangle); System.out.println(&quot;============&quot;); Rectangle rectangle1 = new Square(); rectangle1.setLength(10); resize(rectangle1); printLengthAndWidth(rectangle1); &#125;&#125; æˆ‘ä»¬è¿è¡Œä¸€ä¸‹è¿™æ®µä»£ç å°±ä¼šå‘ç°ï¼Œå‡å¦‚æˆ‘ä»¬æŠŠä¸€ä¸ªæ™®é€šé•¿æ–¹å½¢ä½œä¸ºå‚æ•°ä¼ å…¥resizeæ–¹æ³•ï¼Œå°±ä¼šçœ‹åˆ°é•¿æ–¹å½¢å®½åº¦é€æ¸å¢é•¿çš„æ•ˆæœï¼Œå½“å®½åº¦å¤§äºé•¿åº¦,ä»£ç å°±ä¼šåœæ­¢ï¼Œè¿™ç§è¡Œä¸ºçš„ç»“æœç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼›å‡å¦‚æˆ‘ä»¬å†æŠŠä¸€ä¸ªæ­£æ–¹å½¢ä½œä¸ºå‚æ•°ä¼ å…¥resizeæ–¹æ³•åï¼Œå°±ä¼šçœ‹åˆ°æ­£æ–¹å½¢çš„å®½åº¦å’Œé•¿åº¦éƒ½åœ¨ä¸æ–­å¢é•¿ï¼Œä»£ç ä¼šä¸€ç›´è¿è¡Œä¸‹å»ï¼Œç›´è‡³ç³»ç»Ÿäº§ç”Ÿæº¢å‡ºé”™è¯¯ã€‚æ‰€ä»¥ï¼Œæ™®é€šçš„é•¿æ–¹å½¢æ˜¯é€‚åˆè¿™æ®µä»£ç çš„ï¼Œæ­£æ–¹å½¢ä¸é€‚åˆã€‚æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šåœ¨resizeæ–¹æ³•ä¸­ï¼ŒRectangleç±»å‹çš„å‚æ•°æ˜¯ä¸èƒ½è¢«Squareç±»å‹çš„å‚æ•°æ‰€ä»£æ›¿ï¼Œå¦‚æœè¿›è¡Œäº†æ›¿æ¢å°±å¾—ä¸åˆ°é¢„æœŸç»“æœã€‚å› æ­¤ï¼ŒSquareç±»å’ŒRectangleç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»è¿åäº†é‡Œæ°ä»£æ¢åŸåˆ™ï¼Œå®ƒä»¬ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ä¸æˆç«‹ï¼Œæ­£æ–¹å½¢ä¸æ˜¯é•¿æ–¹å½¢ã€‚ å¦‚ä½•æ”¹è¿›å‘¢ï¼Ÿæ­¤æ—¶æˆ‘ä»¬éœ€è¦é‡æ–°è®¾è®¡ä»–ä»¬ä¹‹é—´çš„å…³ç³»ã€‚æŠ½è±¡å‡ºæ¥ä¸€ä¸ªå››è¾¹å½¢æ¥å£(Quadrilateral)ï¼Œè®©Rectangleç±»å’ŒSquareç±»å®ç°Quadrilateralæ¥å£ 3.3 ä¾èµ–å€’è½¬åŸåˆ™é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚ç®€å•çš„è¯´å°±æ˜¯è¦æ±‚å¯¹æŠ½è±¡è¿›è¡Œç¼–ç¨‹ï¼Œä¸è¦å¯¹å®ç°è¿›è¡Œç¼–ç¨‹ï¼Œè¿™æ ·å°±é™ä½äº†å®¢æˆ·ä¸å®ç°æ¨¡å—é—´çš„è€¦åˆã€‚ ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£ä¾èµ–å€’è½¬åŸåˆ™ ã€ä¾‹ã€‘ç»„è£…ç”µè„‘ ç°è¦ç»„è£…ä¸€å°ç”µè„‘ï¼Œéœ€è¦é…ä»¶cpuï¼Œç¡¬ç›˜ï¼Œå†…å­˜æ¡ã€‚åªæœ‰è¿™äº›é…ç½®éƒ½æœ‰äº†ï¼Œè®¡ç®—æœºæ‰èƒ½æ­£å¸¸çš„è¿è¡Œã€‚é€‰æ‹©cpuæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œå¦‚Intelï¼ŒAMDç­‰ï¼Œç¡¬ç›˜å¯ä»¥é€‰æ‹©å¸Œæ·ï¼Œè¥¿æ•°ç­‰ï¼Œå†…å­˜æ¡å¯ä»¥é€‰æ‹©é‡‘å£«é¡¿ï¼Œæµ·ç›—èˆ¹ç­‰ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š å¸Œæ·ç¡¬ç›˜ç±»ï¼ˆXiJieHardDiskï¼‰: 1234567891011public class XiJieHardDisk implements HardDisk &#123; public void save(String data) &#123; System.out.println(&quot;ä½¿ç”¨å¸Œæ·ç¡¬ç›˜å­˜å‚¨æ•°æ®&quot; + data); &#125; public String get() &#123; System.out.println(&quot;ä½¿ç”¨å¸Œæ·å¸Œæ·ç¡¬ç›˜å–æ•°æ®&quot;); return &quot;æ•°æ®&quot;; &#125;&#125; Intelå¤„ç†å™¨ï¼ˆIntelCpuï¼‰ï¼š 123456public class IntelCpu implements Cpu &#123; public void run() &#123; System.out.println(&quot;ä½¿ç”¨Intelå¤„ç†å™¨&quot;); &#125;&#125; é‡‘å£«é¡¿å†…å­˜æ¡ï¼ˆKingstonMemoryï¼‰ï¼š 123456public class KingstonMemory implements Memory &#123; public void save() &#123; System.out.println(&quot;ä½¿ç”¨é‡‘å£«é¡¿ä½œä¸ºå†…å­˜æ¡&quot;); &#125;&#125; ç”µè„‘ï¼ˆComputerï¼‰ï¼š 1234567891011121314151617181920212223242526272829303132333435363738public class Computer &#123; private XiJieHardDisk hardDisk; private IntelCpu cpu; private KingstonMemory memory; public IntelCpu getCpu() &#123; return cpu; &#125; public void setCpu(IntelCpu cpu) &#123; this.cpu = cpu; &#125; public KingstonMemory getMemory() &#123; return memory; &#125; public void setMemory(KingstonMemory memory) &#123; this.memory = memory; &#125; public XiJieHardDisk getHardDisk() &#123; return hardDisk; &#125; public void setHardDisk(XiJieHardDisk hardDisk) &#123; this.hardDisk = hardDisk; &#125; public void run() &#123; System.out.println(&quot;è®¡ç®—æœºå·¥ä½œ&quot;); cpu.run(); memory.save(); String data = hardDisk.get(); System.out.println(&quot;ä»ç¡¬ç›˜ä¸­è·å–çš„æ•°æ®ä¸ºï¼š&quot; + data); &#125;&#125; æµ‹è¯•ç±»ï¼ˆTestComputerï¼‰ï¼š æµ‹è¯•ç±»ç”¨æ¥ç»„è£…ç”µè„‘ã€‚ 12345678910public class TestComputer &#123; public static void main(String[] args) &#123; Computer computer = new Computer(); computer.setHardDisk(new XiJieHardDisk()); computer.setCpu(new IntelCpu()); computer.setMemory(new KingstonMemory()); computer.run(); &#125;&#125; ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°å·²ç»ç»„è£…äº†ä¸€å°ç”µè„‘ï¼Œä½†æ˜¯ä¼¼ä¹ç»„è£…çš„ç”µè„‘çš„cpuåªèƒ½æ˜¯Intelçš„ï¼Œå†…å­˜æ¡åªèƒ½æ˜¯é‡‘å£«é¡¿çš„ï¼Œç¡¬ç›˜åªèƒ½æ˜¯å¸Œæ·çš„ï¼Œè¿™å¯¹ç”¨æˆ·è‚¯å®šæ˜¯ä¸å‹å¥½çš„ï¼Œç”¨æˆ·æœ‰äº†æœºç®±è‚¯å®šæ˜¯æƒ³æŒ‰ç…§è‡ªå·±çš„å–œå¥½ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„é…ä»¶ã€‚ æ ¹æ®ä¾èµ–å€’è½¬åŸåˆ™è¿›è¡Œæ”¹è¿›ï¼š ä»£ç æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹Computerç±»ï¼Œè®©Computerç±»ä¾èµ–æŠ½è±¡ï¼ˆå„ä¸ªé…ä»¶çš„æ¥å£ï¼‰ï¼Œè€Œä¸æ˜¯ä¾èµ–äºå„ä¸ªç»„ä»¶å…·ä½“çš„å®ç°ç±»ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ç”µè„‘ï¼ˆComputerï¼‰ï¼š 12345678910111213141516171819202122232425262728293031323334public class Computer &#123; private HardDisk hardDisk; private Cpu cpu; private Memory memory; public HardDisk getHardDisk() &#123; return hardDisk; &#125; public void setHardDisk(HardDisk hardDisk) &#123; this.hardDisk = hardDisk; &#125; public Cpu getCpu() &#123; return cpu; &#125; public void setCpu(Cpu cpu) &#123; this.cpu = cpu; &#125; public Memory getMemory() &#123; return memory; &#125; public void setMemory(Memory memory) &#123; this.memory = memory; &#125; public void run() &#123; System.out.println(&quot;è®¡ç®—æœºå·¥ä½œ&quot;); &#125;&#125; é¢å‘å¯¹è±¡çš„å¼€å‘å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æŠ½è±¡çš„å˜åŒ–æ¦‚ç‡å¾ˆå°ï¼Œè®©ç”¨æˆ·ç¨‹åºä¾èµ–äºæŠ½è±¡ï¼Œå®ç°çš„ç»†èŠ‚ä¹Ÿä¾èµ–äºæŠ½è±¡ã€‚å³ä½¿å®ç°ç»†èŠ‚ä¸æ–­å˜åŠ¨ï¼Œåªè¦æŠ½è±¡ä¸å˜ï¼Œå®¢æˆ·ç¨‹åºå°±ä¸éœ€è¦å˜åŒ–ã€‚è¿™å¤§å¤§é™ä½äº†å®¢æˆ·ç¨‹åºä¸å®ç°ç»†èŠ‚çš„è€¦åˆåº¦ã€‚ 3.4 æ¥å£éš”ç¦»åŸåˆ™å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–äºå®ƒä¸ä½¿ç”¨çš„æ–¹æ³•ï¼›ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚ ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£æ¥å£éš”ç¦»åŸåˆ™ ã€ä¾‹ã€‘å®‰å…¨é—¨æ¡ˆä¾‹ æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªé»‘é©¬å“ç‰Œçš„å®‰å…¨é—¨ï¼Œè¯¥å®‰å…¨é—¨å…·æœ‰é˜²ç«ã€é˜²æ°´ã€é˜²ç›—çš„åŠŸèƒ½ã€‚å¯ä»¥å°†é˜²ç«ï¼Œé˜²æ°´ï¼Œé˜²ç›—åŠŸèƒ½æå–æˆä¸€ä¸ªæ¥å£ï¼Œå½¢æˆä¸€å¥—è§„èŒƒã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä¸Šé¢çš„è®¾è®¡æˆ‘ä»¬å‘ç°äº†å®ƒå­˜åœ¨çš„é—®é¢˜ï¼Œé»‘é©¬å“ç‰Œçš„å®‰å…¨é—¨å…·æœ‰é˜²ç›—ï¼Œé˜²æ°´ï¼Œé˜²ç«çš„åŠŸèƒ½ã€‚ç°åœ¨å¦‚æœæˆ‘ä»¬è¿˜éœ€è¦å†åˆ›å»ºä¸€ä¸ªä¼ æ™ºå“ç‰Œçš„å®‰å…¨é—¨ï¼Œè€Œè¯¥å®‰å…¨é—¨åªå…·æœ‰é˜²ç›—ã€é˜²æ°´åŠŸèƒ½å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶å¦‚æœå®ç°SafetyDooræ¥å£å°±è¿èƒŒäº†æ¥å£éš”ç¦»åŸåˆ™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¿›è¡Œä¿®æ”¹å‘¢ï¼Ÿçœ‹å¦‚ä¸‹ç±»å›¾ï¼š ä»£ç å¦‚ä¸‹ï¼š AntiTheftï¼ˆæ¥å£ï¼‰ï¼š 123public interface AntiTheft &#123; void antiTheft();&#125; Fireproofï¼ˆæ¥å£ï¼‰ï¼š 123public interface Fireproof &#123; void fireproof();&#125; Waterproofï¼ˆæ¥å£ï¼‰ï¼š 123public interface Waterproof &#123; void waterproof();&#125; HeiMaSafetyDoorï¼ˆç±»ï¼‰ï¼š 1234567891011121314public class HeiMaSafetyDoor implements AntiTheft,Fireproof,Waterproof &#123; public void antiTheft() &#123; System.out.println(&quot;é˜²ç›—&quot;); &#125; public void fireproof() &#123; System.out.println(&quot;é˜²ç«&quot;); &#125; public void waterproof() &#123; System.out.println(&quot;é˜²æ°´&quot;); &#125;&#125; ItcastSafetyDoorï¼ˆç±»ï¼‰ï¼š 123456789public class ItcastSafetyDoor implements AntiTheft,Fireproof &#123; public void antiTheft() &#123; System.out.println(&quot;é˜²ç›—&quot;); &#125; public void fireproof() &#123; System.out.println(&quot;é˜²ç«&quot;); &#125;&#125; 3.5 è¿ªç±³ç‰¹æ³•åˆ™è¿ªç±³ç‰¹æ³•åˆ™åˆå«æœ€å°‘çŸ¥è¯†åŸåˆ™ã€‚ åªå’Œä½ çš„ç›´æ¥æœ‹å‹äº¤è°ˆï¼Œä¸è·Ÿâ€œé™Œç”Ÿäººâ€è¯´è¯ï¼ˆTalk only to your immediate friends and not to strangersï¼‰ã€‚ å…¶å«ä¹‰æ˜¯ï¼šå¦‚æœä¸¤ä¸ªè½¯ä»¶å®ä½“æ— é¡»ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆå°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹è½¬å‘è¯¥è°ƒç”¨ã€‚å…¶ç›®çš„æ˜¯é™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§ã€‚ è¿ªç±³ç‰¹æ³•åˆ™ä¸­çš„â€œæœ‹å‹â€æ˜¯æŒ‡ï¼šå½“å‰å¯¹è±¡æœ¬èº«ã€å½“å‰å¯¹è±¡çš„æˆå‘˜å¯¹è±¡ã€å½“å‰å¯¹è±¡æ‰€åˆ›å»ºçš„å¯¹è±¡ã€å½“å‰å¯¹è±¡çš„æ–¹æ³•å‚æ•°ç­‰ï¼Œè¿™äº›å¯¹è±¡åŒå½“å‰å¯¹è±¡å­˜åœ¨å…³è”ã€èšåˆæˆ–ç»„åˆå…³ç³»ï¼Œå¯ä»¥ç›´æ¥è®¿é—®è¿™äº›å¯¹è±¡çš„æ–¹æ³•ã€‚ ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£è¿ªç±³ç‰¹æ³•åˆ™ ã€ä¾‹ã€‘æ˜æ˜Ÿä¸ç»çºªäººçš„å…³ç³»å®ä¾‹ æ˜æ˜Ÿç”±äºå…¨èº«å¿ƒæŠ•å…¥è‰ºæœ¯ï¼Œæ‰€ä»¥è®¸å¤šæ—¥å¸¸äº‹åŠ¡ç”±ç»çºªäººè´Ÿè´£å¤„ç†ï¼Œå¦‚å’Œç²‰ä¸çš„è§é¢ä¼šï¼Œå’Œåª’ä½“å…¬å¸çš„ä¸šåŠ¡æ´½æ·¡ç­‰ã€‚è¿™é‡Œçš„ç»çºªäººæ˜¯æ˜æ˜Ÿçš„æœ‹å‹ï¼Œè€Œç²‰ä¸å’Œåª’ä½“å…¬å¸æ˜¯é™Œç”Ÿäººï¼Œæ‰€ä»¥é€‚åˆä½¿ç”¨è¿ªç±³ç‰¹æ³•åˆ™ã€‚ ç±»å›¾å¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š æ˜æ˜Ÿç±»ï¼ˆStarï¼‰ 1234567891011public class Star &#123; private String name; public Star(String name) &#123; this.name=name; &#125; public String getName() &#123; return name; &#125;&#125; ç²‰ä¸ç±»ï¼ˆFansï¼‰ 1234567891011public class Fans &#123; private String name; public Fans(String name) &#123; this.name=name; &#125; public String getName() &#123; return name; &#125;&#125; åª’ä½“å…¬å¸ç±»ï¼ˆCompanyï¼‰ 1234567891011public class Company &#123; private String name; public Company(String name) &#123; this.name=name; &#125; public String getName() &#123; return name; &#125;&#125; ç»çºªäººç±»ï¼ˆAgentï¼‰ 12345678910111213141516171819202122232425public class Agent &#123; private Star star; private Fans fans; private Company company; public void setStar(Star star) &#123; this.star = star; &#125; public void setFans(Fans fans) &#123; this.fans = fans; &#125; public void setCompany(Company company) &#123; this.company = company; &#125; public void meeting() &#123; System.out.println(fans.getName() + &quot;ä¸æ˜æ˜Ÿ&quot; + star.getName() + &quot;è§é¢äº†ã€‚&quot;); &#125; public void business() &#123; System.out.println(company.getName() + &quot;ä¸æ˜æ˜Ÿ&quot; + star.getName() + &quot;æ´½æ·¡ä¸šåŠ¡ã€‚&quot;); &#125;&#125; 3.6 åˆæˆå¤ç”¨åŸåˆ™åˆæˆå¤ç”¨åŸåˆ™æ˜¯æŒ‡ï¼šå°½é‡å…ˆä½¿ç”¨ç»„åˆæˆ–è€…èšåˆç­‰å…³è”å…³ç³»æ¥å®ç°ï¼Œå…¶æ¬¡æ‰è€ƒè™‘ä½¿ç”¨ç»§æ‰¿å…³ç³»æ¥å®ç°ã€‚ é€šå¸¸ç±»çš„å¤ç”¨åˆ†ä¸ºç»§æ‰¿å¤ç”¨å’Œåˆæˆå¤ç”¨ä¸¤ç§ã€‚ ç»§æ‰¿å¤ç”¨è™½ç„¶æœ‰ç®€å•å’Œæ˜“å®ç°çš„ä¼˜ç‚¹ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ï¼š ç»§æ‰¿å¤ç”¨ç ´åäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºç»§æ‰¿ä¼šå°†çˆ¶ç±»çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ï¼Œçˆ¶ç±»å¯¹å­ç±»æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œç™½ç®±â€å¤ç”¨ã€‚ å­ç±»ä¸çˆ¶ç±»çš„è€¦åˆåº¦é«˜ã€‚çˆ¶ç±»çš„å®ç°çš„ä»»ä½•æ”¹å˜éƒ½ä¼šå¯¼è‡´å­ç±»çš„å®ç°å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸åˆ©äºç±»çš„æ‰©å±•ä¸ç»´æŠ¤ã€‚ å®ƒé™åˆ¶äº†å¤ç”¨çš„çµæ´»æ€§ã€‚ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥çš„å®ç°æ˜¯é™æ€çš„ï¼Œåœ¨ç¼–è¯‘æ—¶å·²ç»å®šä¹‰ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶ä¸å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ é‡‡ç”¨ç»„åˆæˆ–èšåˆå¤ç”¨æ—¶ï¼Œå¯ä»¥å°†å·²æœ‰å¯¹è±¡çº³å…¥æ–°å¯¹è±¡ä¸­ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ–°å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š å®ƒç»´æŒäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºæˆåˆ†å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚æ˜¯æ–°å¯¹è±¡çœ‹ä¸è§çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œé»‘ç®±â€å¤ç”¨ã€‚ å¯¹è±¡é—´çš„è€¦åˆåº¦ä½ã€‚å¯ä»¥åœ¨ç±»çš„æˆå‘˜ä½ç½®å£°æ˜æŠ½è±¡ã€‚ å¤ç”¨çš„çµæ´»æ€§é«˜ã€‚è¿™ç§å¤ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è¿›è¡Œï¼Œæ–°å¯¹è±¡å¯ä»¥åŠ¨æ€åœ°å¼•ç”¨ä¸æˆåˆ†å¯¹è±¡ç±»å‹ç›¸åŒçš„å¯¹è±¡ã€‚ ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£åˆæˆå¤ç”¨åŸåˆ™ ã€ä¾‹ã€‘æ±½è½¦åˆ†ç±»ç®¡ç†ç¨‹åº æ±½è½¦æŒ‰â€œåŠ¨åŠ›æºâ€åˆ’åˆ†å¯åˆ†ä¸ºæ±½æ²¹æ±½è½¦ã€ç”µåŠ¨æ±½è½¦ç­‰ï¼›æŒ‰â€œé¢œè‰²â€åˆ’åˆ†å¯åˆ†ä¸ºç™½è‰²æ±½è½¦ã€é»‘è‰²æ±½è½¦å’Œçº¢è‰²æ±½è½¦ç­‰ã€‚å¦‚æœåŒæ—¶è€ƒè™‘è¿™ä¸¤ç§åˆ†ç±»ï¼Œå…¶ç»„åˆå°±å¾ˆå¤šã€‚ç±»å›¾å¦‚ä¸‹ï¼š ä»ä¸Šé¢ç±»å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ç»§æ‰¿å¤ç”¨äº§ç”Ÿäº†å¾ˆå¤šå­ç±»ï¼Œå¦‚æœç°åœ¨åˆæœ‰æ–°çš„åŠ¨åŠ›æºæˆ–è€…æ–°çš„é¢œè‰²çš„è¯ï¼Œå°±éœ€è¦å†å®šä¹‰æ–°çš„ç±»ã€‚æˆ‘ä»¬è¯•ç€å°†ç»§æ‰¿å¤ç”¨æ”¹ä¸ºèšåˆå¤ç”¨çœ‹ä¸€ä¸‹ã€‚ 4ï¼Œåˆ›å»ºè€…æ¨¡å¼åˆ›å»ºå‹æ¨¡å¼çš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯â€œæ€æ ·åˆ›å»ºå¯¹è±¡ï¼Ÿâ€ï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯â€œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»â€ã€‚ è¿™æ ·å¯ä»¥é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ï¼Œä½¿ç”¨è€…ä¸éœ€è¦å…³æ³¨å¯¹è±¡çš„åˆ›å»ºç»†èŠ‚ã€‚ åˆ›å»ºå‹æ¨¡å¼åˆ†ä¸ºï¼š å•ä¾‹æ¨¡å¼ å·¥å‚æ–¹æ³•æ¨¡å¼ æŠ½è±¡å·¥ç¨‹æ¨¡å¼ åŸå‹æ¨¡å¼ å»ºé€ è€…æ¨¡å¼ 4.1 å•ä¾‹è®¾è®¡æ¨¡å¼å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ Java ä¸­æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚ è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»ºã€‚è¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚ 4.1.1 å•ä¾‹æ¨¡å¼çš„ç»“æ„å•ä¾‹æ¨¡å¼çš„ä¸»è¦æœ‰ä»¥ä¸‹è§’è‰²ï¼š å•ä¾‹ç±»ã€‚åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„ç±» è®¿é—®ç±»ã€‚ä½¿ç”¨å•ä¾‹ç±» 4.1.2 å•ä¾‹æ¨¡å¼çš„å®ç° å•ä¾‹è®¾è®¡æ¨¡å¼åˆ†ç±»ä¸¤ç§ï¼š â€‹ é¥¿æ±‰å¼ï¼šç±»åŠ è½½å°±ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»º â€‹ æ‡’æ±‰å¼ï¼šç±»åŠ è½½ä¸ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»ºï¼Œè€Œæ˜¯é¦–æ¬¡ä½¿ç”¨è¯¥å¯¹è±¡æ—¶æ‰ä¼šåˆ›å»º é¥¿æ±‰å¼-æ–¹å¼1ï¼ˆé™æ€å˜é‡æ–¹å¼ï¼‰ 12345678910111213141516/** * é¥¿æ±‰å¼ * é™æ€å˜é‡åˆ›å»ºç±»çš„å¯¹è±¡ */public class Singleton &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123;&#125; //åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡ private static Singleton instance = new Singleton(); //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static Singleton getInstance() &#123; return instance; &#125;&#125; è¯´æ˜ï¼š â€‹ è¯¥æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜Singletonç±»å‹çš„é™æ€å˜é‡ï¼Œå¹¶åˆ›å»ºSingletonç±»çš„å¯¹è±¡instanceã€‚instanceå¯¹è±¡æ˜¯éšç€ç±»çš„åŠ è½½è€Œåˆ›å»ºçš„ã€‚å¦‚æœè¯¥å¯¹è±¡è¶³å¤Ÿå¤§çš„è¯ï¼Œè€Œä¸€ç›´æ²¡æœ‰ä½¿ç”¨å°±ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚ é¥¿æ±‰å¼-æ–¹å¼2ï¼ˆé™æ€ä»£ç å—æ–¹å¼ï¼‰ 123456789101112131415161718192021/** * æ¶æ±‰å¼ * åœ¨é™æ€ä»£ç å—ä¸­åˆ›å»ºè¯¥ç±»å¯¹è±¡ */public class Singleton &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123;&#125; //åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡ private static Singleton instance; static &#123; instance = new Singleton(); &#125; //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static Singleton getInstance() &#123; return instance; &#125;&#125; è¯´æ˜ï¼š â€‹ è¯¥æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜Singletonç±»å‹çš„é™æ€å˜é‡ï¼Œè€Œå¯¹è±¡çš„åˆ›å»ºæ˜¯åœ¨é™æ€ä»£ç å—ä¸­ï¼Œä¹Ÿæ˜¯å¯¹ç€ç±»çš„åŠ è½½è€Œåˆ›å»ºã€‚æ‰€ä»¥å’Œé¥¿æ±‰å¼çš„æ–¹å¼1åŸºæœ¬ä¸Šä¸€æ ·ï¼Œå½“ç„¶è¯¥æ–¹å¼ä¹Ÿå­˜åœ¨å†…å­˜æµªè´¹é—®é¢˜ã€‚ æ‡’æ±‰å¼-æ–¹å¼1ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ 1234567891011121314151617181920/** * æ‡’æ±‰å¼ * çº¿ç¨‹ä¸å®‰å…¨ */public class Singleton &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123;&#125; //åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡ private static Singleton instance; //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static Singleton getInstance() &#123; if(instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125;&#125; è¯´æ˜ï¼š â€‹ ä»ä¸Šé¢ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¯¥æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜Singletonç±»å‹çš„é™æ€å˜é‡ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå¯¹è±¡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™èµ‹å€¼çš„å‘¢ï¼Ÿå½“è°ƒç”¨getInstance()æ–¹æ³•è·å–Singletonç±»çš„å¯¹è±¡çš„æ—¶å€™æ‰åˆ›å»ºSingletonç±»çš„å¯¹è±¡ï¼Œè¿™æ ·å°±å®ç°äº†æ‡’åŠ è½½çš„æ•ˆæœã€‚ä½†æ˜¯ï¼Œå¦‚æœæ˜¯å¤šçº¿ç¨‹ç¯å¢ƒï¼Œä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ æ‡’æ±‰å¼-æ–¹å¼2ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ 1234567891011121314151617181920/** * æ‡’æ±‰å¼ * çº¿ç¨‹å®‰å…¨ */public class Singleton &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123;&#125; //åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡ private static Singleton instance; //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static synchronized Singleton getInstance() &#123; if(instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125;&#125; è¯´æ˜ï¼š â€‹ è¯¥æ–¹å¼ä¹Ÿå®ç°äº†æ‡’åŠ è½½æ•ˆæœï¼ŒåŒæ—¶åˆè§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä½†æ˜¯åœ¨getInstance()æ–¹æ³•ä¸Šæ·»åŠ äº†synchronizedå…³é”®å­—ï¼Œå¯¼è‡´è¯¥æ–¹æ³•çš„æ‰§è¡Œæ•ˆæœç‰¹åˆ«ä½ã€‚ä»ä¸Šé¢ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå…¶å®å°±æ˜¯åœ¨åˆå§‹åŒ–instanceçš„æ—¶å€™æ‰ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸€æ—¦åˆå§‹åŒ–å®Œæˆå°±ä¸å­˜åœ¨äº†ã€‚ æ‡’æ±‰å¼-æ–¹å¼3ï¼ˆåŒé‡æ£€æŸ¥é”ï¼‰ å†æ¥è®¨è®ºä¸€ä¸‹æ‡’æ±‰æ¨¡å¼ä¸­åŠ é”çš„é—®é¢˜ï¼Œå¯¹äº getInstance() æ–¹æ³•æ¥è¯´ï¼Œç»å¤§éƒ¨åˆ†çš„æ“ä½œéƒ½æ˜¯è¯»æ“ä½œï¼Œè¯»æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡å¿…è®©æ¯ä¸ªçº¿ç¨‹å¿…é¡»æŒæœ‰é”æ‰èƒ½è°ƒç”¨è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´åŠ é”çš„æ—¶æœºã€‚ç”±æ­¤ä¹Ÿäº§ç”Ÿäº†ä¸€ç§æ–°çš„å®ç°æ¨¡å¼ï¼šåŒé‡æ£€æŸ¥é”æ¨¡å¼ 123456789101112131415161718192021222324/** * åŒé‡æ£€æŸ¥æ–¹å¼ */public class Singleton &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123;&#125; private static Singleton instance; //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static Singleton getInstance() &#123; //ç¬¬ä¸€æ¬¡åˆ¤æ–­ï¼Œå¦‚æœinstanceä¸ä¸ºnullï¼Œä¸è¿›å…¥æŠ¢é”é˜¶æ®µï¼Œç›´æ¥è¿”å›å®ä¾‹ if(instance == null) &#123; synchronized (Singleton.class) &#123; //æŠ¢åˆ°é”ä¹‹åå†æ¬¡åˆ¤æ–­æ˜¯å¦ä¸ºnull if(instance == null) &#123; instance = new Singleton(); &#125; &#125; &#125; return instance; &#125;&#125; åŒé‡æ£€æŸ¥é”æ¨¡å¼æ˜¯ä¸€ç§éå¸¸å¥½çš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œè§£å†³äº†å•ä¾‹ã€æ€§èƒ½ã€çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸Šé¢çš„åŒé‡æ£€æµ‹é”æ¨¡å¼çœ‹ä¸Šå»å®Œç¾æ— ç¼ºï¼Œå…¶å®æ˜¯å­˜åœ¨é—®é¢˜ï¼Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆé—®é¢˜ï¼Œå‡ºç°é—®é¢˜çš„åŸå› æ˜¯JVMåœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ä¼šè¿›è¡Œä¼˜åŒ–å’ŒæŒ‡ä»¤é‡æ’åºæ“ä½œã€‚ è¦è§£å†³åŒé‡æ£€æŸ¥é”æ¨¡å¼å¸¦æ¥ç©ºæŒ‡é’ˆå¼‚å¸¸çš„é—®é¢˜ï¼Œåªéœ€è¦ä½¿ç”¨ volatile å…³é”®å­—, volatile å…³é”®å­—å¯ä»¥ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§ã€‚ 123456789101112131415161718192021222324/** * åŒé‡æ£€æŸ¥æ–¹å¼ */public class Singleton &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123;&#125; private static volatile Singleton instance; //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static Singleton getInstance() &#123; //ç¬¬ä¸€æ¬¡åˆ¤æ–­ï¼Œå¦‚æœinstanceä¸ä¸ºnullï¼Œä¸è¿›å…¥æŠ¢é”é˜¶æ®µï¼Œç›´æ¥è¿”å›å®é™… if(instance == null) &#123; synchronized (Singleton.class) &#123; //æŠ¢åˆ°é”ä¹‹åå†æ¬¡åˆ¤æ–­æ˜¯å¦ä¸ºç©º if(instance == null) &#123; instance = new Singleton(); &#125; &#125; &#125; return instance; &#125;&#125; å°ç»“ï¼š æ·»åŠ  volatile å…³é”®å­—ä¹‹åçš„åŒé‡æ£€æŸ¥é”æ¨¡å¼æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œèƒ½å¤Ÿä¿è¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹çº¿ç¨‹å®‰å…¨ä¹Ÿä¸ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚ æ‡’æ±‰å¼-æ–¹å¼4ï¼ˆé™æ€å†…éƒ¨ç±»æ–¹å¼ï¼‰ é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ä¸­å®ä¾‹ç”±å†…éƒ¨ç±»åˆ›å»ºï¼Œç”±äº JVM åœ¨åŠ è½½å¤–éƒ¨ç±»çš„è¿‡ç¨‹ä¸­, æ˜¯ä¸ä¼šåŠ è½½é™æ€å†…éƒ¨ç±»çš„, åªæœ‰å†…éƒ¨ç±»çš„å±æ€§&#x2F;æ–¹æ³•è¢«è°ƒç”¨æ—¶æ‰ä¼šè¢«åŠ è½½, å¹¶åˆå§‹åŒ–å…¶é™æ€å±æ€§ã€‚é™æ€å±æ€§ç”±äºè¢« static ä¿®é¥°ï¼Œä¿è¯åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¸¥æ ¼ä¿è¯å®ä¾‹åŒ–é¡ºåºã€‚ 1234567891011121314151617/** * é™æ€å†…éƒ¨ç±»æ–¹å¼ */public class Singleton &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123;&#125; private static class SingletonHolder &#123; private static final Singleton INSTANCE = new Singleton(); &#125; //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static Singleton getInstance() &#123; return SingletonHolder.INSTANCE; &#125;&#125; è¯´æ˜ï¼š â€‹ ç¬¬ä¸€æ¬¡åŠ è½½Singletonç±»æ—¶ä¸ä¼šå»åˆå§‹åŒ–INSTANCEï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceï¼Œè™šæ‹ŸæœºåŠ è½½SingletonHolder å¹¶åˆå§‹åŒ–INSTANCEï¼Œè¿™æ ·ä¸ä»…èƒ½ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿèƒ½ä¿è¯ Singleton ç±»çš„å”¯ä¸€æ€§ã€‚ å°ç»“ï¼š â€‹ é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§ä¼˜ç§€çš„å•ä¾‹æ¨¡å¼ï¼Œæ˜¯å¼€æºé¡¹ç›®ä¸­æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§å•ä¾‹æ¨¡å¼ã€‚åœ¨æ²¡æœ‰åŠ ä»»ä½•é”çš„æƒ…å†µä¸‹ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¸‹çš„å®‰å…¨ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•æ€§èƒ½å½±å“å’Œç©ºé—´çš„æµªè´¹ã€‚ æšä¸¾æ–¹å¼ æšä¸¾ç±»å®ç°å•ä¾‹æ¨¡å¼æ˜¯æåŠ›æ¨èçš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œå› ä¸ºæšä¸¾ç±»å‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”åªä¼šè£…è½½ä¸€æ¬¡ï¼Œè®¾è®¡è€…å……åˆ†çš„åˆ©ç”¨äº†æšä¸¾çš„è¿™ä¸ªç‰¹æ€§æ¥å®ç°å•ä¾‹æ¨¡å¼ï¼Œæšä¸¾çš„å†™æ³•éå¸¸ç®€å•ï¼Œè€Œä¸”æšä¸¾ç±»å‹æ˜¯æ‰€ç”¨å•ä¾‹å®ç°ä¸­å”¯ä¸€ä¸€ç§ä¸ä¼šè¢«ç ´åçš„å•ä¾‹å®ç°æ¨¡å¼ã€‚ 123456/** * æšä¸¾æ–¹å¼ */public enum Singleton &#123; INSTANCE;&#125; è¯´æ˜ï¼š â€‹ æšä¸¾æ–¹å¼å±äºæ¶æ±‰å¼æ–¹å¼ã€‚ 4.1.3 å­˜åœ¨çš„é—®é¢˜4.1.3.1 é—®é¢˜æ¼”ç¤ºç ´åå•ä¾‹æ¨¡å¼ï¼š ä½¿ä¸Šé¢å®šä¹‰çš„å•ä¾‹ç±»ï¼ˆSingletonï¼‰å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼Œæšä¸¾æ–¹å¼é™¤å¤–ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åºåˆ—åŒ–å’Œåå°„ã€‚ åºåˆ—åŒ–ååºåˆ—åŒ– Singletonç±»ï¼š 1234567891011121314public class Singleton implements Serializable &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123;&#125; private static class SingletonHolder &#123; private static final Singleton INSTANCE = new Singleton(); &#125; //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static Singleton getInstance() &#123; return SingletonHolder.INSTANCE; &#125;&#125; Testç±»ï¼š 123456789101112131415161718192021222324252627282930public class Test &#123; public static void main(String[] args) throws Exception &#123; //å¾€æ–‡ä»¶ä¸­å†™å¯¹è±¡ //writeObject2File(); //ä»æ–‡ä»¶ä¸­è¯»å–å¯¹è±¡ Singleton s1 = readObjectFromFile(); Singleton s2 = readObjectFromFile(); //åˆ¤æ–­ä¸¤ä¸ªååºåˆ—åŒ–åçš„å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ System.out.println(s1 == s2); &#125; private static Singleton readObjectFromFile() throws Exception &#123; //åˆ›å»ºå¯¹è±¡è¾“å…¥æµå¯¹è±¡ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Think\\\\Desktop\\\\a.txt&quot;)); //ç¬¬ä¸€ä¸ªè¯»å–Singletonå¯¹è±¡ Singleton instance = (Singleton) ois.readObject(); return instance; &#125; public static void writeObject2File() throws Exception &#123; //è·å–Singletonç±»çš„å¯¹è±¡ Singleton instance = Singleton.getInstance(); //åˆ›å»ºå¯¹è±¡è¾“å‡ºæµ ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Think\\\\Desktop\\\\a.txt&quot;)); //å°†instanceå¯¹è±¡å†™å‡ºåˆ°æ–‡ä»¶ä¸­ oos.writeObject(instance); &#125;&#125; ä¸Šé¢ä»£ç è¿è¡Œç»“æœæ˜¯falseï¼Œè¡¨æ˜åºåˆ—åŒ–å’Œååºåˆ—åŒ–å·²ç»ç ´åäº†å•ä¾‹è®¾è®¡æ¨¡å¼ã€‚ åå°„ Singletonç±»ï¼š 1234567891011121314151617181920212223public class Singleton &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123;&#125; private static volatile Singleton instance; //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static Singleton getInstance() &#123; if(instance != null) &#123; return instance; &#125; synchronized (Singleton.class) &#123; if(instance != null) &#123; return instance; &#125; instance = new Singleton(); return instance; &#125; &#125;&#125; Testç±»ï¼š 123456789101112131415161718public class Test &#123; public static void main(String[] args) throws Exception &#123; //è·å–Singletonç±»çš„å­—èŠ‚ç å¯¹è±¡ Class clazz = Singleton.class; //è·å–Singletonç±»çš„ç§æœ‰æ— å‚æ„é€ æ–¹æ³•å¯¹è±¡ Constructor constructor = clazz.getDeclaredConstructor(); //å–æ¶ˆè®¿é—®æ£€æŸ¥ constructor.setAccessible(true); //åˆ›å»ºSingletonç±»çš„å¯¹è±¡s1 Singleton s1 = (Singleton) constructor.newInstance(); //åˆ›å»ºSingletonç±»çš„å¯¹è±¡s2 Singleton s2 = (Singleton) constructor.newInstance(); //åˆ¤æ–­é€šè¿‡åå°„åˆ›å»ºçš„ä¸¤ä¸ªSingletonå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ System.out.println(s1 == s2); &#125;&#125; ä¸Šé¢ä»£ç è¿è¡Œç»“æœæ˜¯falseï¼Œè¡¨æ˜åºåˆ—åŒ–å’Œååºåˆ—åŒ–å·²ç»ç ´åäº†å•ä¾‹è®¾è®¡æ¨¡å¼ æ³¨æ„ï¼šæšä¸¾æ–¹å¼ä¸ä¼šå‡ºç°è¿™ä¸¤ä¸ªé—®é¢˜ã€‚ 4.1.3.2 é—®é¢˜çš„è§£å†³ åºåˆ—åŒ–ã€ååºåˆ—æ–¹å¼ç ´åå•ä¾‹æ¨¡å¼çš„è§£å†³æ–¹æ³• åœ¨Singletonç±»ä¸­æ·»åŠ readResolve()æ–¹æ³•ï¼Œåœ¨ååºåˆ—åŒ–æ—¶è¢«åå°„è°ƒç”¨ï¼Œå¦‚æœå®šä¹‰äº†è¿™ä¸ªæ–¹æ³•ï¼Œå°±è¿”å›è¿™ä¸ªæ–¹æ³•çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œåˆ™è¿”å›æ–°newå‡ºæ¥çš„å¯¹è±¡ã€‚ Singletonç±»ï¼š 123456789101112131415161718192021public class Singleton implements Serializable &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123;&#125; private static class SingletonHolder &#123; private static final Singleton INSTANCE = new Singleton(); &#125; //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static Singleton getInstance() &#123; return SingletonHolder.INSTANCE; &#125; /** * ä¸‹é¢æ˜¯ä¸ºäº†è§£å†³åºåˆ—åŒ–ååºåˆ—åŒ–ç ´è§£å•ä¾‹æ¨¡å¼ */ private Object readResolve() &#123; return SingletonHolder.INSTANCE; &#125;&#125; æºç è§£æï¼š ObjectInputStreamç±» 1234567891011121314151617181920212223242526272829303132333435363738public final Object readObject() throws IOException, ClassNotFoundException&#123; ... // if nested read, passHandle contains handle of enclosing object int outerHandle = passHandle; try &#123; Object obj = readObject0(false);//é‡ç‚¹æŸ¥çœ‹readObject0æ–¹æ³• .....&#125; private Object readObject0(boolean unshared) throws IOException &#123; ... try &#123; switch (tc) &#123; ... case TC_OBJECT: return checkResolve(readOrdinaryObject(unshared));//é‡ç‚¹æŸ¥çœ‹readOrdinaryObjectæ–¹æ³• ... &#125; &#125; finally &#123; depth--; bin.setBlockDataMode(oldMode); &#125; &#125; private Object readOrdinaryObject(boolean unshared) throws IOException &#123; ... //isInstantiable è¿”å›trueï¼Œæ‰§è¡Œ desc.newInstance()ï¼Œé€šè¿‡åå°„åˆ›å»ºæ–°çš„å•ä¾‹ç±»ï¼Œ obj = desc.isInstantiable() ? desc.newInstance() : null; ... // åœ¨Singletonç±»ä¸­æ·»åŠ  readResolve æ–¹æ³•å desc.hasReadResolveMethod() æ–¹æ³•æ‰§è¡Œç»“æœä¸ºtrue if (obj != null &amp;&amp; handles.lookupException(passHandle) == null &amp;&amp; desc.hasReadResolveMethod()) &#123; // é€šè¿‡åå°„è°ƒç”¨ Singleton ç±»ä¸­çš„ readResolve æ–¹æ³•ï¼Œå°†è¿”å›å€¼èµ‹å€¼ç»™repå˜é‡ // è¿™æ ·å¤šæ¬¡è°ƒç”¨ObjectInputStreamç±»ä¸­çš„readObjectæ–¹æ³•ï¼Œç»§è€Œå°±ä¼šè°ƒç”¨æˆ‘ä»¬å®šä¹‰çš„readResolveæ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ Object rep = desc.invokeReadResolve(obj); ... &#125; return obj;&#125; åå°„æ–¹å¼ç ´è§£å•ä¾‹çš„è§£å†³æ–¹æ³• 123456789101112131415161718192021222324252627282930public class Singleton &#123; //ç§æœ‰æ„é€ æ–¹æ³• private Singleton() &#123; /* åå°„ç ´è§£å•ä¾‹æ¨¡å¼éœ€è¦æ·»åŠ çš„ä»£ç  */ if(instance != null) &#123; throw new RuntimeException(); &#125; &#125; private static volatile Singleton instance; //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡ public static Singleton getInstance() &#123; if(instance != null) &#123; return instance; &#125; synchronized (Singleton.class) &#123; if(instance != null) &#123; return instance; &#125; instance = new Singleton(); return instance; &#125; &#125;&#125; è¯´æ˜: â€‹ è¿™ç§æ–¹å¼æ¯”è¾ƒå¥½ç†è§£ã€‚å½“é€šè¿‡åå°„æ–¹å¼è°ƒç”¨æ„é€ æ–¹æ³•è¿›è¡Œåˆ›å»ºåˆ›å»ºæ—¶ï¼Œç›´æ¥æŠ›å¼‚å¸¸ã€‚ä¸è¿è¡Œæ­¤ä¸­æ“ä½œã€‚ 4.1.4 JDKæºç è§£æ-Runtimeç±»Runtimeç±»å°±æ˜¯ä½¿ç”¨çš„å•ä¾‹è®¾è®¡æ¨¡å¼ã€‚ é€šè¿‡æºä»£ç æŸ¥çœ‹ä½¿ç”¨çš„æ˜¯å“ªå„¿ç§å•ä¾‹æ¨¡å¼ 12345678910111213141516171819public class Runtime &#123; private static Runtime currentRuntime = new Runtime(); /** * Returns the runtime object associated with the current Java application. * Most of the methods of class &lt;code&gt;Runtime&lt;/code&gt; are instance * methods and must be invoked with respect to the current runtime object. * * @return the &lt;code&gt;Runtime&lt;/code&gt; object associated with the current * Java application. */ public static Runtime getRuntime() &#123; return currentRuntime; &#125; /** Don&#x27;t let anyone else instantiate this class */ private Runtime() &#123;&#125; ...&#125; ä»ä¸Šé¢æºä»£ç ä¸­å¯ä»¥çœ‹å‡ºRuntimeç±»ä½¿ç”¨çš„æ˜¯æ¶æ±‰å¼ï¼ˆé™æ€å±æ€§ï¼‰æ–¹å¼æ¥å®ç°å•ä¾‹æ¨¡å¼çš„ã€‚ ä½¿ç”¨Runtimeç±»ä¸­çš„æ–¹æ³• 12345678910111213141516171819public class RuntimeDemo &#123; public static void main(String[] args) throws IOException &#123; //è·å–Runtimeç±»å¯¹è±¡ Runtime runtime = Runtime.getRuntime(); //è¿”å› Java è™šæ‹Ÿæœºä¸­çš„å†…å­˜æ€»é‡ã€‚ System.out.println(runtime.totalMemory()); //è¿”å› Java è™šæ‹Ÿæœºè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡ã€‚ System.out.println(runtime.maxMemory()); //åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æ‰§è¡ŒæŒ‡å®šçš„å­—ç¬¦ä¸²å‘½ä»¤ï¼Œè¿”å›è¿›ç¨‹å¯¹è±¡ Process process = runtime.exec(&quot;ipconfig&quot;); //è·å–å‘½ä»¤æ‰§è¡Œåçš„ç»“æœï¼Œé€šè¿‡è¾“å…¥æµè·å– InputStream inputStream = process.getInputStream(); byte[] arr = new byte[1024 * 1024* 100]; int b = inputStream.read(arr); System.out.println(new String(arr,0,b,&quot;gbk&quot;)); &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"test2","slug":"è®¾è®¡æ¨¡å¼/test2","date":"2023-06-15T09:42:48.000Z","updated":"2023-06-16T01:57:15.031Z","comments":true,"path":"2023/06/15/è®¾è®¡æ¨¡å¼/test2/","link":"","permalink":"http://example.com/2023/06/15/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/test2/","excerpt":"","text":"111","categories":[],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]}],"categories":[{"name":"elk","slug":"elk","permalink":"http://example.com/elk/"},{"name":"ts","slug":"ts","permalink":"http://example.com/ts/"},{"name":"juc","slug":"juc","permalink":"http://example.com/juc/"},{"name":"mq","slug":"mq","permalink":"http://example.com/mq/"},{"name":"spring","slug":"spring","permalink":"http://example.com/spring/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"elk","slug":"elk","permalink":"http://example.com/tags/elk/"},{"name":"ts","slug":"ts","permalink":"http://example.com/tags/ts/"},{"name":"juc","slug":"juc","permalink":"http://example.com/tags/juc/"},{"name":"mq","slug":"mq","permalink":"http://example.com/tags/mq/"},{"name":"spring","slug":"spring","permalink":"http://example.com/tags/spring/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]}